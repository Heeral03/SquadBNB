const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/core-DDNlgivr.js","assets/index-BDcKlTkx.js","assets/index-DQ3P1g1z.css"])))=>i.map(i=>d[i]);
import{e7 as Z,e8 as Wf,e9 as Xp,ea as ya,eb as Xf,ec as tr,ed as o5,ee as a5,ef as X2,eg as wi,eh as c5,ei as f5,ej as nn,ek as ba,el as Jp,em as l5,en as Qp,eo as e0,ep as uc,eq as t0,er as Mi,es as J2,et as Bn,eu as rn,ev as Ac,ew as u5,ex as h5,ey as Wn,ez as Q2,dH as d5}from"./index-BDcKlTkx.js";function p5(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function em(t,...e){if(!p5(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Mg(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function g5(t,e){em(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const wo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const pu=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function y5(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function tm(t){return typeof t=="string"&&(t=y5(t)),em(t),t}let b5=class{clone(){return this._cloneInto()}};function w5(t){const e=n=>t().update(tm(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function rm(t=32){if(wo&&typeof wo.getRandomValues=="function")return wo.getRandomValues(new Uint8Array(t));if(wo&&typeof wo.randomBytes=="function")return wo.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function m5(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}let v5=class extends b5{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=pu(this.buffer)}update(e){Mg(this);const{view:r,buffer:n,blockLen:s}=this;e=tm(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=pu(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Mg(this),g5(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;m5(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=pu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%r&&e.buffer.set(n),e}};const Hc=BigInt(2**32-1),ud=BigInt(32);function nm(t,e=!1){return e?{h:Number(t&Hc),l:Number(t>>ud&Hc)}:{h:Number(t>>ud&Hc)|0,l:Number(t&Hc)|0}}function E5(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:i,l:o}=nm(t[s],e);[r[s],n[s]]=[i,o]}return[r,n]}const x5=(t,e)=>BigInt(t>>>0)<<ud|BigInt(e>>>0),$5=(t,e,r)=>t>>>r,I5=(t,e,r)=>t<<32-r|e>>>r,B5=(t,e,r)=>t>>>r|e<<32-r,A5=(t,e,r)=>t<<32-r|e>>>r,S5=(t,e,r)=>t<<64-r|e>>>r-32,O5=(t,e,r)=>t>>>r-32|e<<64-r,_5=(t,e)=>e,F5=(t,e)=>t,U5=(t,e,r)=>t<<r|e>>>32-r,P5=(t,e,r)=>e<<r|t>>>32-r,C5=(t,e,r)=>e<<r-32|t>>>64-r,R5=(t,e,r)=>t<<r-32|e>>>64-r;function T5(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const L5=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),N5=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,k5=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),D5=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,j5=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),q5=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,ne={fromBig:nm,split:E5,toBig:x5,shrSH:$5,shrSL:I5,rotrSH:B5,rotrSL:A5,rotrBH:S5,rotrBL:O5,rotr32H:_5,rotr32L:F5,rotlSH:U5,rotlSL:P5,rotlBH:C5,rotlBL:R5,add:T5,add3L:L5,add3H:N5,add4L:k5,add4H:D5,add5H:q5,add5L:j5},[z5,M5]=ne.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Xn=new Uint32Array(80),Jn=new Uint32Array(80);let H5=class extends v5{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:f,El:l,Fh:h,Fl:u,Gh:d,Gl:g,Hh:b,Hl:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=l|0,this.Fh=h|0,this.Fl=u|0,this.Gh=d|0,this.Gl=g|0,this.Hh=b|0,this.Hl=E|0}process(e,r){for(let $=0;$<16;$++,r+=4)Xn[$]=e.getUint32(r),Jn[$]=e.getUint32(r+=4);for(let $=16;$<80;$++){const F=Xn[$-15]|0,P=Jn[$-15]|0,C=ne.rotrSH(F,P,1)^ne.rotrSH(F,P,8)^ne.shrSH(F,P,7),T=ne.rotrSL(F,P,1)^ne.rotrSL(F,P,8)^ne.shrSL(F,P,7),R=Xn[$-2]|0,A=Jn[$-2]|0,j=ne.rotrSH(R,A,19)^ne.rotrBH(R,A,61)^ne.shrSH(R,A,6),q=ne.rotrSL(R,A,19)^ne.rotrBL(R,A,61)^ne.shrSL(R,A,6),S=ne.add4L(T,q,Jn[$-7],Jn[$-16]),m=ne.add4H(S,C,j,Xn[$-7],Xn[$-16]);Xn[$]=m|0,Jn[$]=S|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:f,Dl:l,Eh:h,El:u,Fh:d,Fl:g,Gh:b,Gl:E,Hh:U,Hl:L}=this;for(let $=0;$<80;$++){const F=ne.rotrSH(h,u,14)^ne.rotrSH(h,u,18)^ne.rotrBH(h,u,41),P=ne.rotrSL(h,u,14)^ne.rotrSL(h,u,18)^ne.rotrBL(h,u,41),C=h&d^~h&b,T=u&g^~u&E,R=ne.add5L(L,P,T,M5[$],Jn[$]),A=ne.add5H(R,U,F,C,z5[$],Xn[$]),j=R|0,q=ne.rotrSH(n,s,28)^ne.rotrBH(n,s,34)^ne.rotrBH(n,s,39),S=ne.rotrSL(n,s,28)^ne.rotrBL(n,s,34)^ne.rotrBL(n,s,39),m=n&i^n&a^i&a,x=s&o^s&c^o&c;U=b|0,L=E|0,b=d|0,E=g|0,d=h|0,g=u|0,{h,l:u}=ne.add(f|0,l|0,A|0,j|0),f=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const y=ne.add3L(j,S,x);n=ne.add3H(y,A,q,m),s=y|0}({h:n,l:s}=ne.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=ne.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=ne.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l}=ne.add(this.Dh|0,this.Dl|0,f|0,l|0),{h,l:u}=ne.add(this.Eh|0,this.El|0,h|0,u|0),{h:d,l:g}=ne.add(this.Fh|0,this.Fl|0,d|0,g|0),{h:b,l:E}=ne.add(this.Gh|0,this.Gl|0,b|0,E|0),{h:U,l:L}=ne.add(this.Hh|0,this.Hl|0,U|0,L|0),this.set(n,s,i,o,a,c,f,l,h,u,d,g,b,E,U,L)}roundClean(){Xn.fill(0),Jn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const V5=w5(()=>new H5);const r0=BigInt(0),sm=BigInt(1),K5=BigInt(2);function n0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function s0(t){if(!n0(t))throw new Error("Uint8Array expected")}function gu(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const G5=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function i0(t){s0(t);let e="";for(let r=0;r<t.length;r++)e+=G5[t[r]];return e}function im(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?r0:BigInt("0x"+t)}const un={_0:48,_9:57,A:65,F:70,a:97,f:102};function Hg(t){if(t>=un._0&&t<=un._9)return t-un._0;if(t>=un.A&&t<=un.F)return t-(un.A-10);if(t>=un.a&&t<=un.f)return t-(un.a-10)}function om(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=Hg(t.charCodeAt(i)),a=Hg(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function Z5(t){return im(i0(t))}function qf(t){return s0(t),im(i0(Uint8Array.from(t).reverse()))}function am(t,e){return om(t.toString(16).padStart(e*2,"0"))}function hd(t,e){return am(t,e).reverse()}function hn(t,e,r){let n;if(typeof e=="string")try{n=om(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(n0(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function Vg(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];s0(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}const yu=t=>typeof t=="bigint"&&r0<=t;function Y5(t,e,r){return yu(t)&&yu(e)&&yu(r)&&e<=t&&t<r}function xa(t,e,r,n){if(!Y5(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function W5(t){let e;for(e=0;t>r0;t>>=sm,e+=1);return e}const X5=t=>(K5<<BigInt(t-1))-sm,J5={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||n0(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function o0(t,e,r={}){const n=(s,i,o)=>{const a=J5[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(r))n(s,i,!0);return t}function Kg(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const je=BigInt(0),$e=BigInt(1),ki=BigInt(2),Q5=BigInt(3),dd=BigInt(4),Gg=BigInt(5),Zg=BigInt(8);function Pe(t,e){const r=t%e;return r>=je?r:e+r}function ex(t,e,r){if(e<je)throw new Error("invalid exponent, negatives unsupported");if(r<=je)throw new Error("invalid modulus");if(r===$e)return je;let n=$e;for(;e>je;)e&$e&&(n=n*t%r),t=t*t%r,e>>=$e;return n}function Hr(t,e,r){let n=t;for(;e-- >je;)n*=n,n%=r;return n}function Yg(t,e){if(t===je)throw new Error("invert: expected non-zero number");if(e<=je)throw new Error("invert: expected positive modulus, got "+e);let r=Pe(t,e),n=e,s=je,i=$e;for(;r!==je;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==$e)throw new Error("invert: does not exist");return Pe(s,e)}function tx(t){const e=(t-$e)/ki;let r,n,s;for(r=t-$e,n=0;r%ki===je;r/=ki,n++);for(s=ki;s<t&&ex(s,e,t)!==t-$e;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+$e)/dd;return function(a,c){const f=a.pow(c,o);if(!a.eql(a.sqr(f),c))throw new Error("Cannot find square root");return f}}const i=(r+$e)/ki;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,f=o.pow(o.mul(o.ONE,s),r),l=o.pow(a,i),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let u=1;for(let g=o.sqr(h);u<c&&!o.eql(g,o.ONE);u++)g=o.sqr(g);const d=o.pow(f,$e<<BigInt(c-u-1));f=o.sqr(d),l=o.mul(l,d),h=o.mul(h,f),c=u}return l}}function rx(t){if(t%dd===Q5){const e=(t+$e)/dd;return function(r,n){const s=r.pow(n,e);if(!r.eql(r.sqr(s),n))throw new Error("Cannot find square root");return s}}if(t%Zg===Gg){const e=(t-Gg)/Zg;return function(r,n){const s=r.mul(n,ki),i=r.pow(s,e),o=r.mul(n,i),a=r.mul(r.mul(o,ki),i),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return tx(t)}const nx=(t,e)=>(Pe(t,e)&$e)===$e,sx=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ix(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=sx.reduce((n,s)=>(n[s]="function",n),e);return o0(t,r)}function ox(t,e,r){if(r<je)throw new Error("invalid exponent, negatives unsupported");if(r===je)return t.ONE;if(r===$e)return e;let n=t.ONE,s=e;for(;r>je;)r&$e&&(n=t.mul(n,s)),s=t.sqr(s),r>>=$e;return n}function ax(t,e){const r=new Array(e.length),n=e.reduce((i,o,a)=>t.is0(o)?i:(r[a]=i,t.mul(i,o)),t.ONE),s=t.inv(n);return e.reduceRight((i,o,a)=>t.is0(o)?i:(r[a]=t.mul(i,r[a]),t.mul(i,o)),s),r}function cm(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function fm(t,e,r=!1,n={}){if(t<=je)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:i}=cm(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:X5(s),ZERO:je,ONE:$e,create:c=>Pe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return je<=c&&c<t},is0:c=>c===je,isOdd:c=>(c&$e)===$e,neg:c=>Pe(-c,t),eql:(c,f)=>c===f,sqr:c=>Pe(c*c,t),add:(c,f)=>Pe(c+f,t),sub:(c,f)=>Pe(c-f,t),mul:(c,f)=>Pe(c*f,t),pow:(c,f)=>ox(a,c,f),div:(c,f)=>Pe(c*Yg(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>Yg(c,t),sqrt:n.sqrt||(c=>(o||(o=rx(t)),o(a,c))),invertBatch:c=>ax(a,c),cmov:(c,f,l)=>l?f:c,toBytes:c=>r?hd(c,i):am(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?qf(c):Z5(c)}});return Object.freeze(a)}const Wg=BigInt(0),Vc=BigInt(1);function bu(t,e){const r=e.negate();return t?r:e}function lm(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function wu(t,e){lm(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function cx(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function fx(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const mu=new WeakMap,um=new WeakMap;function vu(t){return um.get(t)||1}function lx(t,e){return{constTimeNegate:bu,hasPrecomputes(r){return vu(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>Wg;)n&Vc&&(s=s.add(i)),i=i.double(),n>>=Vc;return s},precomputeWindow(r,n){const{windows:s,windowSize:i}=wu(n,e),o=[];let a=r,c=a;for(let f=0;f<s;f++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){const{windows:i,windowSize:o}=wu(r,e);let a=t.ZERO,c=t.BASE;const f=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let u=0;u<i;u++){const d=u*o;let g=Number(s&f);s>>=h,g>o&&(g-=l,s+=Vc);const b=d,E=d+Math.abs(g)-1,U=u%2!==0,L=g<0;g===0?c=c.add(bu(U,n[b])):a=a.add(bu(L,n[E]))}return{p:a,f:c}},wNAFUnsafe(r,n,s,i=t.ZERO){const{windows:o,windowSize:a}=wu(r,e),c=BigInt(2**r-1),f=2**r,l=BigInt(r);for(let h=0;h<o;h++){const u=h*a;if(s===Wg)break;let d=Number(s&c);if(s>>=l,d>a&&(d-=f,s+=Vc),d===0)continue;let g=n[u+Math.abs(d)-1];d<0&&(g=g.negate()),i=i.add(g)}return i},getPrecomputes(r,n,s){let i=mu.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&mu.set(n,s(i))),i},wNAFCached(r,n,s){const i=vu(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){const o=vu(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){lm(n,e),um.set(r,n),mu.delete(r)}}}function ux(t,e,r,n){if(cx(r,t),fx(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,i=W5(BigInt(r.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),f=Math.floor((e.BITS-1)/o)*o;let l=s;for(let h=f;h>=0;h-=o){c.fill(s);for(let d=0;d<n.length;d++){const g=n[d],b=Number(g>>BigInt(h)&BigInt(a));c[b]=c[b].add(r[d])}let u=s;for(let d=c.length-1,g=s;d>0;d--)g=g.add(c[d]),u=u.add(g);if(l=l.add(u),h!==0)for(let d=0;d<o;d++)l=l.double()}return l}function hx(t){return ix(t.Fp),o0(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...cm(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const wr=BigInt(0),Ot=BigInt(1),Kc=BigInt(2),dx=BigInt(8),px={zip215:!0};function gx(t){const e=hx(t);return o0(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function yx(t){const e=gx(t),{Fp:r,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,f=Kc<<BigInt(a*8)-Ot,l=r.create,h=fm(e.n,e.nBitLength),u=e.uvRatio||((y,p)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(p))}}catch{return{isValid:!1,value:wr}}}),d=e.adjustScalarBytes||(y=>y),g=e.domain||((y,p,v)=>{if(gu("phflag",v),p.length||v)throw new Error("Contexts/pre-hash are not supported");return y});function b(y,p){xa("coordinate "+y,p,wr,f)}function E(y){if(!(y instanceof $))throw new Error("ExtendedPoint expected")}const U=Kg((y,p)=>{const{ex:v,ey:I,ez:w}=y,B=y.is0();p==null&&(p=B?dx:r.inv(w));const O=l(v*p),_=l(I*p),k=l(w*p);if(B)return{x:wr,y:Ot};if(k!==Ot)throw new Error("invZ was invalid");return{x:O,y:_}}),L=Kg(y=>{const{a:p,d:v}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:I,ey:w,ez:B,et:O}=y,_=l(I*I),k=l(w*w),D=l(B*B),N=l(D*D),z=l(_*p),H=l(D*l(z+k)),V=l(N+l(v*l(_*k)));if(H!==V)throw new Error("bad point: equation left != right (1)");const M=l(I*w),K=l(B*O);if(M!==K)throw new Error("bad point: equation left != right (2)");return!0});class ${constructor(p,v,I,w){this.ex=p,this.ey=v,this.ez=I,this.et=w,b("x",p),b("y",v),b("z",I),b("t",w),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(p){if(p instanceof $)throw new Error("extended point not allowed");const{x:v,y:I}=p||{};return b("x",v),b("y",I),new $(v,I,Ot,l(v*I))}static normalizeZ(p){const v=r.invertBatch(p.map(I=>I.ez));return p.map((I,w)=>I.toAffine(v[w])).map($.fromAffine)}static msm(p,v){return ux($,h,p,v)}_setWindowSize(p){C.setWindowSize(this,p)}assertValidity(){L(this)}equals(p){E(p);const{ex:v,ey:I,ez:w}=this,{ex:B,ey:O,ez:_}=p,k=l(v*_),D=l(B*w),N=l(I*_),z=l(O*w);return k===D&&N===z}is0(){return this.equals($.ZERO)}negate(){return new $(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:p}=e,{ex:v,ey:I,ez:w}=this,B=l(v*v),O=l(I*I),_=l(Kc*l(w*w)),k=l(p*B),D=v+I,N=l(l(D*D)-B-O),z=k+O,H=z-_,V=k-O,M=l(N*H),K=l(z*V),Q=l(N*V),te=l(H*z);return new $(M,K,te,Q)}add(p){E(p);const{a:v,d:I}=e,{ex:w,ey:B,ez:O,et:_}=this,{ex:k,ey:D,ez:N,et:z}=p;if(v===BigInt(-1)){const ur=l((B-w)*(D+k)),hr=l((B+w)*(D-k)),Et=l(hr-ur);if(Et===wr)return this.double();const dr=l(O*Kc*z),pr=l(_*Kc*N),gr=pr+dr,yr=hr+ur,br=pr-dr,Bi=l(gr*Et),Ai=l(yr*br),Si=l(gr*br),Oi=l(Et*yr);return new $(Bi,Ai,Oi,Si)}const H=l(w*k),V=l(B*D),M=l(_*I*z),K=l(O*N),Q=l((w+B)*(k+D)-H-V),te=K-M,re=K+M,le=l(V-v*H),nt=l(Q*te),Mr=l(re*le),$i=l(Q*le),Ii=l(te*re);return new $(nt,Mr,Ii,$i)}subtract(p){return this.add(p.negate())}wNAF(p){return C.wNAFCached(this,p,$.normalizeZ)}multiply(p){const v=p;xa("scalar",v,Ot,n);const{p:I,f:w}=this.wNAF(v);return $.normalizeZ([I,w])[0]}multiplyUnsafe(p,v=$.ZERO){const I=p;return xa("scalar",I,wr,n),I===wr?P:this.is0()||I===Ot?this:C.wNAFCachedUnsafe(this,I,$.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return C.unsafeLadder(this,n).is0()}toAffine(p){return U(this,p)}clearCofactor(){const{h:p}=e;return p===Ot?this:this.multiplyUnsafe(p)}static fromHex(p,v=!1){const{d:I,a:w}=e,B=r.BYTES;p=hn("pointHex",p,B),gu("zip215",v);const O=p.slice(),_=p[B-1];O[B-1]=_&-129;const k=qf(O),D=v?f:r.ORDER;xa("pointHex.y",k,wr,D);const N=l(k*k),z=l(N-Ot),H=l(I*N-w);let{isValid:V,value:M}=u(z,H);if(!V)throw new Error("Point.fromHex: invalid y coordinate");const K=(M&Ot)===Ot,Q=(_&128)!==0;if(!v&&M===wr&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==K&&(M=l(-M)),$.fromAffine({x:M,y:k})}static fromPrivateKey(p){return A(p).point}toRawBytes(){const{x:p,y:v}=this.toAffine(),I=hd(v,r.BYTES);return I[I.length-1]|=p&Ot?128:0,I}toHex(){return i0(this.toRawBytes())}}$.BASE=new $(e.Gx,e.Gy,Ot,l(e.Gx*e.Gy)),$.ZERO=new $(wr,Ot,Ot,wr);const{BASE:F,ZERO:P}=$,C=lx($,a*8);function T(y){return Pe(y,n)}function R(y){return T(qf(y))}function A(y){const p=r.BYTES;y=hn("private key",y,p);const v=hn("hashed private key",i(y),2*p),I=d(v.slice(0,p)),w=v.slice(p,2*p),B=R(I),O=F.multiply(B),_=O.toRawBytes();return{head:I,prefix:w,scalar:B,point:O,pointBytes:_}}function j(y){return A(y).pointBytes}function q(y=new Uint8Array,...p){const v=Vg(...p);return R(i(g(v,hn("context",y),!!s)))}function S(y,p,v={}){y=hn("message",y),s&&(y=s(y));const{prefix:I,scalar:w,pointBytes:B}=A(p),O=q(v.context,I,y),_=F.multiply(O).toRawBytes(),k=q(v.context,_,B,y),D=T(O+k*w);xa("signature.s",D,wr,n);const N=Vg(_,hd(D,r.BYTES));return hn("result",N,r.BYTES*2)}const m=px;function x(y,p,v,I=m){const{context:w,zip215:B}=I,O=r.BYTES;y=hn("signature",y,2*O),p=hn("message",p),v=hn("publicKey",v,O),B!==void 0&&gu("zip215",B),s&&(p=s(p));const _=qf(y.slice(O,2*O));let k,D,N;try{k=$.fromHex(v,B),D=$.fromHex(y.slice(0,O),B),N=F.multiplyUnsafe(_)}catch{return!1}if(!B&&k.isSmallOrder())return!1;const z=q(w,D.toRawBytes(),k.toRawBytes(),p);return D.add(k.multiplyUnsafe(z)).subtract(N).clearCofactor().equals($.ZERO)}return F._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:S,verify:x,ExtendedPoint:$,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,p=$.BASE){return p._setWindowSize(y),p.multiply(BigInt(3)),p}}}}BigInt(0),BigInt(1);const a0=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Xg=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const bx=BigInt(1),Jg=BigInt(2);BigInt(3);const wx=BigInt(5),mx=BigInt(8);function vx(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=a0,o=t*t%i*t%i,a=Hr(o,Jg,i)*o%i,c=Hr(a,bx,i)*t%i,f=Hr(c,wx,i)*c%i,l=Hr(f,e,i)*f%i,h=Hr(l,r,i)*l%i,u=Hr(h,n,i)*h%i,d=Hr(u,s,i)*u%i,g=Hr(d,s,i)*u%i,b=Hr(g,e,i)*f%i;return{pow_p_5_8:Hr(b,Jg,i)*t%i,b2:o}}function Ex(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function xx(t,e){const r=a0,n=Pe(e*e*e,r),s=Pe(n*n*e,r),i=vx(t*s).pow_p_5_8;let o=Pe(t*n*i,r);const a=Pe(e*o*o,r),c=o,f=Pe(o*Xg,r),l=a===t,h=a===Pe(-t,r),u=a===Pe(-t*Xg,r);return l&&(o=c),(h||u)&&(o=f),nx(o,r)&&(o=Pe(-o,r)),{isValid:l||h,value:o}}const $x=fm(a0,void 0,!0),Ix={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:$x,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:mx,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:V5,randomBytes:rm,adjustScalarBytes:Ex,uvRatio:xx},hm=yx(Ix),Bx="EdDSA",Ax="JWT",Jf=".",Ol="base64url",dm="utf8",pm="utf8",Sx=":",Ox="did",_x="key",Qg="base58btc",Fx="z",Ux="K36",Px=32;function c0(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function gm(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?c0(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ym(t,e){e||(e=t.reduce((s,i)=>s+i.length,0));const r=gm(e);let n=0;for(const s of t)r.set(s,n),n+=s.length;return c0(r)}function Cx(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var b=0,E=0,U=0,L=g.length;U!==L&&g[U]===0;)U++,b++;for(var $=(L-U)*l+1>>>0,F=new Uint8Array($);U!==L;){for(var P=g[U],C=0,T=$-1;(P!==0||C<E)&&T!==-1;T--,C++)P+=256*F[T]>>>0,F[T]=P%a>>>0,P=P/a>>>0;if(P!==0)throw new Error("Non-zero carry");E=C,U++}for(var R=$-E;R!==$&&F[R]===0;)R++;for(var A=c.repeat(b);R<$;++R)A+=t.charAt(F[R]);return A}function u(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var b=0;if(g[b]!==" "){for(var E=0,U=0;g[b]===c;)E++,b++;for(var L=(g.length-b)*f+1>>>0,$=new Uint8Array(L);g[b];){var F=r[g.charCodeAt(b)];if(F===255)return;for(var P=0,C=L-1;(F!==0||P<U)&&C!==-1;C--,P++)F+=a*$[C]>>>0,$[C]=F%256>>>0,F=F/256>>>0;if(F!==0)throw new Error("Non-zero carry");U=P,b++}if(g[b]!==" "){for(var T=L-U;T!==L&&$[T]===0;)T++;for(var R=new Uint8Array(E+(L-T)),A=E;T!==L;)R[A++]=$[T++];return R}}}function d(g){var b=u(g);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:u,decode:d}}var Rx=Cx,Tx=Rx;const bm=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Lx=t=>new TextEncoder().encode(t),Nx=t=>new TextDecoder().decode(t);let kx=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Dx=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return wm(this,e)}},jx=class{constructor(e){this.decoders=e}or(e){return wm(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const wm=(t,e)=>new jx({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let qx=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new kx(e,r,n),this.decoder=new Dx(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const _l=({name:t,prefix:e,encode:r,decode:n})=>new qx(t,e,r,n),Sc=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:s}=Tx(r,e);return _l({prefix:t,name:e,encode:n,decode:i=>bm(s(i))})},zx=(t,e,r,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,f=0;for(let l=0;l<i;++l){const h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Mx=(t,e,r)=>{const n=e[e.length-1]==="=",s=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},Je=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>_l({prefix:e,name:t,encode(s){return Mx(s,n,r)},decode(s){return zx(s,n,r,t)}}),Hx=_l({prefix:"\0",name:"identity",encode:t=>Nx(t),decode:t=>Lx(t)});var Vx=Object.freeze({__proto__:null,identity:Hx});const Kx=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Gx=Object.freeze({__proto__:null,base2:Kx});const Zx=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Yx=Object.freeze({__proto__:null,base8:Zx});const Wx=Sc({prefix:"9",name:"base10",alphabet:"0123456789"});var Xx=Object.freeze({__proto__:null,base10:Wx});const Jx=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Qx=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var e$=Object.freeze({__proto__:null,base16:Jx,base16upper:Qx});const t$=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),r$=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),n$=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),s$=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),i$=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),o$=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),a$=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),c$=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),f$=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var l$=Object.freeze({__proto__:null,base32:t$,base32upper:r$,base32pad:n$,base32padupper:s$,base32hex:i$,base32hexupper:o$,base32hexpad:a$,base32hexpadupper:c$,base32z:f$});const u$=Sc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),h$=Sc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var d$=Object.freeze({__proto__:null,base36:u$,base36upper:h$});const p$=Sc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),g$=Sc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var y$=Object.freeze({__proto__:null,base58btc:p$,base58flickr:g$});const b$=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),w$=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),m$=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),v$=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var E$=Object.freeze({__proto__:null,base64:b$,base64pad:w$,base64url:m$,base64urlpad:v$});const mm=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),x$=mm.reduce((t,e,r)=>(t[r]=e,t),[]),$$=mm.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function I$(t){return t.reduce((e,r)=>(e+=x$[r],e),"")}function B$(t){const e=[];for(const r of t){const n=$$[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const A$=_l({prefix:"ðŸš€",name:"base256emoji",encode:I$,decode:B$});var S$=Object.freeze({__proto__:null,base256emoji:A$}),O$=vm,e1=128,_$=-128,F$=Math.pow(2,31);function vm(t,e,r){e=e||[],r=r||0;for(var n=r;t>=F$;)e[r++]=t&255|e1,t/=128;for(;t&_$;)e[r++]=t&255|e1,t>>>=7;return e[r]=t|0,vm.bytes=r-n+1,e}var U$=pd,P$=128,t1=127;function pd(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw pd.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&t1)<<s:(o&t1)*Math.pow(2,s),s+=7}while(o>=P$);return pd.bytes=i-n,r}var C$=Math.pow(2,7),R$=Math.pow(2,14),T$=Math.pow(2,21),L$=Math.pow(2,28),N$=Math.pow(2,35),k$=Math.pow(2,42),D$=Math.pow(2,49),j$=Math.pow(2,56),q$=Math.pow(2,63),z$=function(t){return t<C$?1:t<R$?2:t<T$?3:t<L$?4:t<N$?5:t<k$?6:t<D$?7:t<j$?8:t<q$?9:10},M$={encode:O$,decode:U$,encodingLength:z$},Em=M$;const r1=(t,e,r=0)=>(Em.encode(t,e,r),e),n1=t=>Em.encodingLength(t),gd=(t,e)=>{const r=e.byteLength,n=n1(t),s=n+n1(r),i=new Uint8Array(s+r);return r1(t,i,0),r1(r,i,n),i.set(e,s),new H$(t,r,e,i)};let H$=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};const xm=({name:t,code:e,encode:r})=>new V$(t,e,r);let V$=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?gd(this.code,r):r.then(n=>gd(this.code,n))}else throw Error("Unknown type, must be binary type")}};const $m=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),K$=xm({name:"sha2-256",code:18,encode:$m("SHA-256")}),G$=xm({name:"sha2-512",code:19,encode:$m("SHA-512")});var Z$=Object.freeze({__proto__:null,sha256:K$,sha512:G$});const Im=0,Y$="identity",Bm=bm,W$=t=>gd(Im,Bm(t)),X$={code:Im,name:Y$,encode:Bm,digest:W$};var J$=Object.freeze({__proto__:null,identity:X$});new TextEncoder,new TextDecoder;const s1={...Vx,...Gx,...Yx,...Xx,...e$,...l$,...d$,...y$,...E$,...S$};({...Z$,...J$});function Am(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const i1=Am("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Eu=Am("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=gm(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Sm={utf8:i1,"utf-8":i1,hex:s1.base16,latin1:Eu,ascii:Eu,binary:Eu,...s1};function Fl(t,e="utf8"){const r=Sm[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function wa(t,e="utf8"){const r=Sm[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?c0(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function o1(t){return Wf(Fl(wa(t,Ol),dm))}function Qf(t){return Fl(wa(Xp(t),dm),Ol)}function Q$(t){const e=wa(Ux,Qg),r=Fx+Fl(ym([e,t]),Qg);return[Ox,_x,r].join(Sx)}function e7(t){return Fl(t,Ol)}function t7(t){return wa(t,Ol)}function r7(t){return wa([Qf(t.header),Qf(t.payload)].join(Jf),pm)}function n7(t){return[Qf(t.header),Qf(t.payload),e7(t.signature)].join(Jf)}function eQ(t){const e=t.split(Jf),r=o1(e[0]),n=o1(e[1]),s=t7(e[2]),i=wa(e.slice(0,2).join(Jf),pm);return{header:r,payload:n,signature:s,data:i}}function tQ(t=rm(Px)){const e=hm.getPublicKey(t);return{secretKey:ym([t,e]),publicKey:e}}async function rQ(t,e,r,n,s=Z.fromMiliseconds(Date.now())){const i={alg:Bx,typ:Ax},o=Q$(n.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},f=r7({header:i,payload:c}),l=hm.sign(f,n.secretKey.slice(0,32));return n7({header:i,payload:c,signature:l})}var sn={exports:{}};function s7(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var i7=o7;function o7(t,e,r){var n=r&&r.stringify||s7,s=1;if(typeof t=="object"&&t!==null){var i=e.length+s;if(i===1)return t;var o=new Array(i);o[0]=n(t);for(var a=1;a<i;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var f="",l=1-s,h=-1,u=t&&t.length||0,d=0;d<u;){if(t.charCodeAt(d)===37&&d+1<u){switch(h=h>-1?h:0,t.charCodeAt(d+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<d&&(f+=t.slice(h,d)),f+=Number(e[l]),h=d+2,d++;break;case 105:if(l>=c||e[l]==null)break;h<d&&(f+=t.slice(h,d)),f+=Math.floor(Number(e[l])),h=d+2,d++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<d&&(f+=t.slice(h,d));var g=typeof e[l];if(g==="string"){f+="'"+e[l]+"'",h=d+2,d++;break}if(g==="function"){f+=e[l].name||"<anonymous>",h=d+2,d++;break}f+=n(e[l]),h=d+2,d++;break;case 115:if(l>=c)break;h<d&&(f+=t.slice(h,d)),f+=String(e[l]),h=d+2,d++;break;case 37:h<d&&(f+=t.slice(h,d)),f+="%",h=d+2,d++,l--;break}++l}++d}return h===-1?t:(h<u&&(f+=t.slice(h)),f)}const a1=i7;sn.exports=zn;const hc=E7().console||{},a7={mapHttpRequest:Gc,mapHttpResponse:Gc,wrapRequestSerializer:xu,wrapResponseSerializer:xu,wrapErrorSerializer:xu,req:Gc,res:Gc,err:f1,errWithCause:f1};function Js(t,e){return t==="silent"?1/0:e.levels.values[t]}const f0=Symbol("pino.logFuncs"),yd=Symbol("pino.hierarchy"),c7={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function c1(t,e){const r={logger:e,parent:t[yd]};e[yd]=r}function f7(t,e,r){const n={};e.forEach(s=>{n[s]=r[s]?r[s]:hc[s]||hc[c7[s]||"log"]||Ho}),t[f0]=n}function l7(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function zn(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||hc;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},s=l7(t.browser.serialize,n);let i=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(i=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(b){r[b]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",f=Object.create(r);f.log||(f.log=Ho),f7(f,a,r),c1({},f),Object.defineProperty(f,"levelVal",{get:h}),Object.defineProperty(f,"level",{get:u,set:d});const l={transmit:e,serialize:s,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:w7(t),messageKey:t.messageKey||"msg",onChild:t.onChild||Ho};f.levels=u7(t),f.level=c,f.isLevelEnabled=function(b){return this.levels.values[b]?this.levels.values[b]>=this.levels.values[this.level]:!1},f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=Ho,f.serializers=n,f._serialize=s,f._stdErrSerialize=i,f.child=function(...b){return g.call(this,l,...b)},e&&(f._logEvent=bd());function h(){return Js(this.level,this)}function u(){return this._level}function d(b){if(b!=="silent"&&!this.levels.values[b])throw Error("unknown level "+b);this._level=b,_i(this,l,f,"error"),_i(this,l,f,"fatal"),_i(this,l,f,"warn"),_i(this,l,f,"info"),_i(this,l,f,"debug"),_i(this,l,f,"trace"),o.forEach(E=>{_i(this,l,f,E)})}function g(b,E,U){if(!E)throw new Error("missing bindings for child Pino");U=U||{},s&&E.serializers&&(U.serializers=E.serializers);const L=U.serializers;if(s&&L){var $=Object.assign({},n,L),F=t.browser.serialize===!0?Object.keys($):s;delete E.serializers,l0([E],F,$,this._stdErrSerialize)}function P(T){this._childLevel=(T._childLevel|0)+1,this.bindings=E,$&&(this.serializers=$,this._serialize=F),e&&(this._logEvent=bd([].concat(T._logEvent.bindings,E)))}P.prototype=this;const C=new P(this);return c1(this,C),C.child=function(...T){return g.call(this,b,...T)},C.level=U.level||this.level,b.onChild(C),C}return f}function u7(t){const e=t.customLevels||{},r=Object.assign({},zn.levels.values,e),n=Object.assign({},zn.levels.labels,h7(e));return{values:r,labels:n}}function h7(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}zn.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},zn.stdSerializers=a7,zn.stdTimeFunctions=Object.assign({},{nullTime:Om,epochTime:_m,unixTime:m7,isoTime:v7});function d7(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[yd];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function _i(t,e,r,n){if(Object.defineProperty(t,n,{value:Js(t.level,r)>Js(n,r)?Ho:r[f0][n],writable:!0,enumerable:!0,configurable:!0}),t[n]===Ho){if(!e.transmit)return;const i=e.transmit.level||t.level,o=Js(i,r);if(Js(n,r)<o)return}t[n]=g7(t,e,r,n);const s=d7(t);s.length!==0&&(t[n]=p7(s,t[n]))}function p7(t,e){return function(){return e.apply(this,[...t,...arguments])}}function g7(t,e,r,n){return(function(s){return function(){const i=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===hc?hc:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var f=!1;if(e.serialize&&(l0(o,this._serialize,this.serializers,this._stdErrSerialize),f=!0),e.asObject||e.formatters?s.call(a,...y7(this,n,o,i,e)):s.apply(a,o),e.transmit){const l=e.transmit.level||t._level,h=Js(l,r),u=Js(n,r);if(u<h)return;b7(this,{ts:i,methodLevel:n,methodValue:u,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Js(t._level,r)},o,f)}}})(t[f0][n])}function y7(t,e,r,n,s){const{level:i,log:o=h=>h}=s.formatters||{},a=r.slice();let c=a[0];const f={};let l=(t._childLevel|0)+1;if(l<1&&(l=1),n&&(f.time=n),i){const h=i(e,t.levels.values[e]);Object.assign(f,h)}else f.level=t.levels.values[e];if(s.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;l--&&typeof a[0]=="object";)Object.assign(f,a.shift());return[o(f),...a]}else{if(c!==null&&typeof c=="object"){for(;l--&&typeof a[0]=="object";)Object.assign(f,a.shift());c=a.length?a1(a.shift(),a):void 0}else typeof c=="string"&&(c=a1(a.shift(),a));return c!==void 0&&(f[s.messageKey]=c),[o(f)]}}function l0(t,e,r,n){for(const s in t)if(n&&t[s]instanceof Error)t[s]=zn.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s])&&e)for(const i in t[s])e.indexOf(i)>-1&&i in r&&(t[s][i]=r[i](t[s][i]))}function b7(t,e,r,n=!1){const s=e.send,i=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,f=t._logEvent.bindings;n||l0(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=i,t._logEvent.messages=r.filter(function(l){return f.indexOf(l)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,s(o,t._logEvent,c),t._logEvent=bd(f)}function bd(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function f1(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function w7(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Om:_m}function Gc(){return{}}function xu(t){return t}function Ho(){}function Om(){return!1}function _m(){return Date.now()}function m7(){return Math.round(Date.now()/1e3)}function v7(){return new Date(Date.now()).toISOString()}function E7(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}sn.exports.default=zn;sn.exports.pino=zn;const x7={level:"info"},Ul="custom_context",u0=1e3*1024;var $7=Object.defineProperty,I7=(t,e,r)=>e in t?$7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Hs=(t,e,r)=>I7(t,typeof e!="symbol"?e+"":e,r);let B7=class{constructor(e){Hs(this,"nodeValue"),Hs(this,"sizeInBytes"),Hs(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},l1=class{constructor(e){Hs(this,"lengthInNodes"),Hs(this,"sizeInBytes"),Hs(this,"head"),Hs(this,"tail"),Hs(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new B7(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const A7=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function u1(t){return typeof t=="string"?t:A7(t)||""}var S7=Object.defineProperty,O7=(t,e,r)=>e in t?S7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zc=(t,e,r)=>O7(t,typeof e!="symbol"?e+"":e,r);let Fm=class{constructor(e,r=u0){Zc(this,"logs"),Zc(this,"level"),Zc(this,"levelValue"),Zc(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=sn.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new l1(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===sn.exports.levels.values.error?console.error(e):r===sn.exports.levels.values.warn?console.warn(e):r===sn.exports.levels.values.debug?console.debug(e):r===sn.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(u1({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new l1(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(u1({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var _7=Object.defineProperty,F7=(t,e,r)=>e in t?_7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,U7=(t,e,r)=>F7(t,e+"",r);let P7=class{constructor(e,r=u0){U7(this,"baseChunkLogger"),this.baseChunkLogger=new Fm(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}};var C7=Object.defineProperty,R7=(t,e,r)=>e in t?C7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,T7=(t,e,r)=>R7(t,e+"",r);let L7=class{constructor(e,r=u0){T7(this,"baseChunkLogger"),this.baseChunkLogger=new Fm(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var N7=Object.defineProperty,k7=Object.defineProperties,D7=Object.getOwnPropertyDescriptors,h1=Object.getOwnPropertySymbols,j7=Object.prototype.hasOwnProperty,q7=Object.prototype.propertyIsEnumerable,d1=(t,e,r)=>e in t?N7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ri=(t,e)=>{for(var r in e||(e={}))j7.call(e,r)&&d1(t,r,e[r]);if(h1)for(var r of h1(e))q7.call(e,r)&&d1(t,r,e[r]);return t},ni=(t,e)=>k7(t,D7(e));function cQ(t){return ni(ri({},t),{level:t?.level||x7.level})}function z7(t,e,r=Ul){return t[r]=e,t}function M7(t,e=Ul){return t[e]||""}function H7(t,e,r=Ul){const n=M7(t,r);return n.trim()?`${n}/${e}`:e}function fQ(t,e,r=Ul){const n=H7(t,e,r),s=t.child({context:n});return z7(s,n,r)}function V7(t){var e,r;const n=new P7((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:sn.exports(ni(ri({},t.opts),{level:"trace",browser:ni(ri({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})})),chunkLoggerController:n}}function K7(t){var e,r;const n=new L7((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:sn.exports(ni(ri({},t.opts),{level:"trace",browser:ni(ri({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})}),n),chunkLoggerController:n}}function lQ(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const r=ni(ri({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?V7(ni(ri({},t),{opts:r})):K7(ni(ri({},t),{opts:r}))}function p1(t,e=[]){const r=[];return Object.keys(t).forEach(n=>{if(e.length&&!e.includes(n))return;const s=t[n];r.push(...s.accounts)}),r}const Yc=BigInt(2**32-1),g1=BigInt(32);function Um(t,e=!1){return e?{h:Number(t&Yc),l:Number(t>>g1&Yc)}:{h:Number(t>>g1&Yc)|0,l:Number(t&Yc)|0}}function Pm(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=Um(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const y1=(t,e,r)=>t>>>r,b1=(t,e,r)=>t<<32-r|e>>>r,Ps=(t,e,r)=>t>>>r|e<<32-r,Cs=(t,e,r)=>t<<32-r|e>>>r,Va=(t,e,r)=>t<<64-r|e>>>r-32,Ka=(t,e,r)=>t>>>r-32|e<<64-r,G7=(t,e)=>e,Z7=(t,e)=>t,Y7=(t,e,r)=>t<<r|e>>>32-r,W7=(t,e,r)=>e<<r|t>>>32-r,X7=(t,e,r)=>e<<r-32|t>>>64-r,J7=(t,e,r)=>t<<r-32|e>>>64-r;function _r(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const h0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),d0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,Q7=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),e9=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,t9=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),r9=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,mo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Pl(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function li(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Lr(t,...e){if(!Pl(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Cm(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");li(t.outputLen),li(t.blockLen)}function ui(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function p0(t,e){Lr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function dc(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Nr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function $u(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Vr(t,e){return t<<32-e|t>>>e}const Rm=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Tm(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const An=Rm?t=>t:t=>Tm(t);function n9(t){for(let e=0;e<t.length;e++)t[e]=Tm(t[e]);return t}const Rs=Rm?t=>t:n9,Lm=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",s9=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Vo(t){if(Lr(t),Lm)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=s9[t[r]];return e}const dn={_0:48,_9:57,A:65,F:70,a:97,f:102};function w1(t){if(t>=dn._0&&t<=dn._9)return t-dn._0;if(t>=dn.A&&t<=dn.F)return t-(dn.A-10);if(t>=dn.a&&t<=dn.f)return t-(dn.a-10)}function el(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Lm)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=w1(t.charCodeAt(i)),a=w1(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function Nm(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Mn(t){return typeof t=="string"&&(t=Nm(t)),Lr(t),t}function Vs(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];Lr(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}let Cl=class{};function Oc(t){const e=n=>t().update(Mn(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function i9(t){const e=(n,s)=>t(s).update(Mn(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function g0(t=32){if(mo&&typeof mo.getRandomValues=="function")return mo.getRandomValues(new Uint8Array(t));if(mo&&typeof mo.randomBytes=="function")return Uint8Array.from(mo.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const o9=BigInt(0),$a=BigInt(1),a9=BigInt(2),c9=BigInt(7),f9=BigInt(256),l9=BigInt(113),km=[],Dm=[],jm=[];for(let t=0,e=$a,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],km.push(2*(5*n+r)),Dm.push((t+1)*(t+2)/2%64);let s=o9;for(let i=0;i<7;i++)e=(e<<$a^(e>>c9)*l9)%f9,e&a9&&(s^=$a<<($a<<BigInt(i))-$a);jm.push(s)}const qm=Pm(jm,!0),u9=qm[0],h9=qm[1],m1=(t,e,r)=>r>32?X7(t,e,r):Y7(t,e,r),v1=(t,e,r)=>r>32?J7(t,e,r):W7(t,e,r);function d9(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=r[c],l=r[c+1],h=m1(f,l,1)^r[a],u=v1(f,l,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=u}let s=t[2],i=t[3];for(let o=0;o<24;o++){const a=Dm[o],c=m1(s,i,a),f=v1(s,i,a),l=km[o];s=t[l],i=t[l+1],t[l]=c,t[l+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=u9[n],t[1]^=h9[n]}Nr(r)}let p9=class zm extends Cl{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,li(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=dc(this.state)}clone(){return this._cloneInto()}keccak(){Rs(this.state32),d9(this.state32,this.rounds),Rs(this.state32),this.posOut=0,this.pos=0}update(e){ui(this),e=Mn(e),Lr(e);const{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){ui(this,!1),Lr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return li(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(p0(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Nr(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new zm(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const g9=(t,e,r)=>Oc(()=>new p9(e,t,r));g9(1,136,256/8);function y9(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function b9(t,e,r){return t&e^~t&r}function w9(t,e,r){return t&e^t&r^e&r}let Mm=class extends Cl{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=$u(this.buffer)}update(e){ui(this),e=Mn(e),Lr(e);const{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=$u(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ui(this),p0(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,Nr(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;y9(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=$u(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const Qn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),st=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),it=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),m9=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),es=new Uint32Array(64);let v9=class extends Mm{constructor(e=32){super(64,e,8,!1),this.A=Qn[0]|0,this.B=Qn[1]|0,this.C=Qn[2]|0,this.D=Qn[3]|0,this.E=Qn[4]|0,this.F=Qn[5]|0,this.G=Qn[6]|0,this.H=Qn[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)es[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const u=es[h-15],d=es[h-2],g=Vr(u,7)^Vr(u,18)^u>>>3,b=Vr(d,17)^Vr(d,19)^d>>>10;es[h]=b+es[h-7]+g+es[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:f,H:l}=this;for(let h=0;h<64;h++){const u=Vr(a,6)^Vr(a,11)^Vr(a,25),d=l+u+b9(a,c,f)+m9[h]+es[h]|0,g=(Vr(n,2)^Vr(n,13)^Vr(n,22))+w9(n,s,i)|0;l=f,f=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(n,s,i,o,a,c,f,l)}roundClean(){Nr(es)}destroy(){this.set(0,0,0,0,0,0,0,0),Nr(this.buffer)}};const Hm=Pm(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),E9=Hm[0],x9=Hm[1],ts=new Uint32Array(80),rs=new Uint32Array(80);let y0=class extends Mm{constructor(e=64){super(128,e,16,!1),this.Ah=it[0]|0,this.Al=it[1]|0,this.Bh=it[2]|0,this.Bl=it[3]|0,this.Ch=it[4]|0,this.Cl=it[5]|0,this.Dh=it[6]|0,this.Dl=it[7]|0,this.Eh=it[8]|0,this.El=it[9]|0,this.Fh=it[10]|0,this.Fl=it[11]|0,this.Gh=it[12]|0,this.Gl=it[13]|0,this.Hh=it[14]|0,this.Hl=it[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:f,El:l,Fh:h,Fl:u,Gh:d,Gl:g,Hh:b,Hl:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=l|0,this.Fh=h|0,this.Fl=u|0,this.Gh=d|0,this.Gl=g|0,this.Hh=b|0,this.Hl=E|0}process(e,r){for(let $=0;$<16;$++,r+=4)ts[$]=e.getUint32(r),rs[$]=e.getUint32(r+=4);for(let $=16;$<80;$++){const F=ts[$-15]|0,P=rs[$-15]|0,C=Ps(F,P,1)^Ps(F,P,8)^y1(F,P,7),T=Cs(F,P,1)^Cs(F,P,8)^b1(F,P,7),R=ts[$-2]|0,A=rs[$-2]|0,j=Ps(R,A,19)^Va(R,A,61)^y1(R,A,6),q=Cs(R,A,19)^Ka(R,A,61)^b1(R,A,6),S=Q7(T,q,rs[$-7],rs[$-16]),m=e9(S,C,j,ts[$-7],ts[$-16]);ts[$]=m|0,rs[$]=S|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:f,Dl:l,Eh:h,El:u,Fh:d,Fl:g,Gh:b,Gl:E,Hh:U,Hl:L}=this;for(let $=0;$<80;$++){const F=Ps(h,u,14)^Ps(h,u,18)^Va(h,u,41),P=Cs(h,u,14)^Cs(h,u,18)^Ka(h,u,41),C=h&d^~h&b,T=u&g^~u&E,R=t9(L,P,T,x9[$],rs[$]),A=r9(R,U,F,C,E9[$],ts[$]),j=R|0,q=Ps(n,s,28)^Va(n,s,34)^Va(n,s,39),S=Cs(n,s,28)^Ka(n,s,34)^Ka(n,s,39),m=n&i^n&a^i&a,x=s&o^s&c^o&c;U=b|0,L=E|0,b=d|0,E=g|0,d=h|0,g=u|0,{h,l:u}=_r(f|0,l|0,A|0,j|0),f=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const y=h0(j,S,x);n=d0(y,A,q,m),s=y|0}({h:n,l:s}=_r(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=_r(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=_r(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l}=_r(this.Dh|0,this.Dl|0,f|0,l|0),{h,l:u}=_r(this.Eh|0,this.El|0,h|0,u|0),{h:d,l:g}=_r(this.Fh|0,this.Fl|0,d|0,g|0),{h:b,l:E}=_r(this.Gh|0,this.Gl|0,b|0,E|0),{h:U,l:L}=_r(this.Hh|0,this.Hl|0,U|0,L|0),this.set(n,s,i,o,a,c,f,l,h,u,d,g,b,E,U,L)}roundClean(){Nr(ts,rs)}destroy(){Nr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},$9=class extends y0{constructor(){super(48),this.Ah=st[0]|0,this.Al=st[1]|0,this.Bh=st[2]|0,this.Bl=st[3]|0,this.Ch=st[4]|0,this.Cl=st[5]|0,this.Dh=st[6]|0,this.Dl=st[7]|0,this.Eh=st[8]|0,this.El=st[9]|0,this.Fh=st[10]|0,this.Fl=st[11]|0,this.Gh=st[12]|0,this.Gl=st[13]|0,this.Hh=st[14]|0,this.Hl=st[15]|0}};const ot=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);let I9=class extends y0{constructor(){super(32),this.Ah=ot[0]|0,this.Al=ot[1]|0,this.Bh=ot[2]|0,this.Bl=ot[3]|0,this.Ch=ot[4]|0,this.Cl=ot[5]|0,this.Dh=ot[6]|0,this.Dl=ot[7]|0,this.Eh=ot[8]|0,this.El=ot[9]|0,this.Fh=ot[10]|0,this.Fl=ot[11]|0,this.Gh=ot[12]|0,this.Gl=ot[13]|0,this.Hh=ot[14]|0,this.Hl=ot[15]|0}};const B9=Oc(()=>new v9),A9=Oc(()=>new y0),S9=Oc(()=>new $9);Oc(()=>new I9);const O9=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Oe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Y=new Uint32Array(32);function ns(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=Y[2*t],f=Y[2*t+1],l=Y[2*e],h=Y[2*e+1],u=Y[2*r],d=Y[2*r+1],g=Y[2*n],b=Y[2*n+1],E=h0(c,l,o);f=d0(E,f,h,a),c=E|0,{Dh:b,Dl:g}={Dh:b^f,Dl:g^c},{Dh:b,Dl:g}={Dh:G7(b,g),Dl:Z7(b)},{h:d,l:u}=_r(d,u,b,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^u},{Bh:h,Bl:l}={Bh:Ps(h,l,24),Bl:Cs(h,l,24)},Y[2*t]=c,Y[2*t+1]=f,Y[2*e]=l,Y[2*e+1]=h,Y[2*r]=u,Y[2*r+1]=d,Y[2*n]=g,Y[2*n+1]=b}function ss(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=Y[2*t],f=Y[2*t+1],l=Y[2*e],h=Y[2*e+1],u=Y[2*r],d=Y[2*r+1],g=Y[2*n],b=Y[2*n+1],E=h0(c,l,o);f=d0(E,f,h,a),c=E|0,{Dh:b,Dl:g}={Dh:b^f,Dl:g^c},{Dh:b,Dl:g}={Dh:Ps(b,g,16),Dl:Cs(b,g,16)},{h:d,l:u}=_r(d,u,b,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^u},{Bh:h,Bl:l}={Bh:Va(h,l,63),Bl:Ka(h,l,63)},Y[2*t]=c,Y[2*t+1]=f,Y[2*e]=l,Y[2*e+1]=h,Y[2*r]=u,Y[2*r+1]=d,Y[2*n]=g,Y[2*n+1]=b}function _9(t,e={},r,n,s){if(li(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}let F9=class extends Cl{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,li(e),li(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=dc(this.buffer)}update(e){ui(this),e=Mn(e),Lr(e);const{blockLen:r,buffer:n,buffer32:s}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===r&&(Rs(s),this.compress(s,0,!1),Rs(s),this.pos=0);const f=Math.min(r-this.pos,i-c),l=o+c;if(f===r&&!(l%4)&&c+f<i){const h=new Uint32Array(a,l,Math.floor((i-c)/4));Rs(h);for(let u=0;c+r<i;u+=s.length,c+=r)this.length+=r,this.compress(h,u,!1);Rs(h);continue}n.set(e.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(e){ui(this),p0(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,Nr(this.buffer.subarray(r)),Rs(n),this.compress(n,0,!0),Rs(n);const s=dc(e);this.get().forEach((i,o)=>s[o]=An(i))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:s,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=i,e.finished=s,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},U9=class extends F9{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Oe[0]|0,this.v0h=Oe[1]|0,this.v1l=Oe[2]|0,this.v1h=Oe[3]|0,this.v2l=Oe[4]|0,this.v2h=Oe[5]|0,this.v3l=Oe[6]|0,this.v3h=Oe[7]|0,this.v4l=Oe[8]|0,this.v4h=Oe[9]|0,this.v5l=Oe[10]|0,this.v5h=Oe[11]|0,this.v6l=Oe[12]|0,this.v6h=Oe[13]|0,this.v7l=Oe[14]|0,this.v7h=Oe[15]|0,_9(r,e,64,16,16);let{key:n,personalization:s,salt:i}=e,o=0;if(n!==void 0&&(n=Mn(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=Mn(i);const a=dc(i);this.v4l^=An(a[0]),this.v4h^=An(a[1]),this.v5l^=An(a[2]),this.v5h^=An(a[3])}if(s!==void 0){s=Mn(s);const a=dc(s);this.v6l^=An(a[0]),this.v6h^=An(a[1]),this.v7l^=An(a[2]),this.v7h^=An(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:s,v2l:i,v2h:o,v3l:a,v3h:c,v4l:f,v4h:l,v5l:h,v5h:u,v6l:d,v6h:g,v7l:b,v7h:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=l|0,this.v5l=h|0,this.v5h=u|0,this.v6l=d|0,this.v6h=g|0,this.v7l=b|0,this.v7h=E|0}compress(e,r,n){this.get().forEach((c,f)=>Y[f]=c),Y.set(Oe,16);let{h:s,l:i}=Um(BigInt(this.length));Y[24]=Oe[8]^i,Y[25]=Oe[9]^s,n&&(Y[28]=~Y[28],Y[29]=~Y[29]);let o=0;const a=O9;for(let c=0;c<12;c++)ns(0,4,8,12,e,r+2*a[o++]),ss(0,4,8,12,e,r+2*a[o++]),ns(1,5,9,13,e,r+2*a[o++]),ss(1,5,9,13,e,r+2*a[o++]),ns(2,6,10,14,e,r+2*a[o++]),ss(2,6,10,14,e,r+2*a[o++]),ns(3,7,11,15,e,r+2*a[o++]),ss(3,7,11,15,e,r+2*a[o++]),ns(0,5,10,15,e,r+2*a[o++]),ss(0,5,10,15,e,r+2*a[o++]),ns(1,6,11,12,e,r+2*a[o++]),ss(1,6,11,12,e,r+2*a[o++]),ns(2,7,8,13,e,r+2*a[o++]),ss(2,7,8,13,e,r+2*a[o++]),ns(3,4,9,14,e,r+2*a[o++]),ss(3,4,9,14,e,r+2*a[o++]);this.v0l^=Y[0]^Y[16],this.v0h^=Y[1]^Y[17],this.v1l^=Y[2]^Y[18],this.v1h^=Y[3]^Y[19],this.v2l^=Y[4]^Y[20],this.v2h^=Y[5]^Y[21],this.v3l^=Y[6]^Y[22],this.v3h^=Y[7]^Y[23],this.v4l^=Y[8]^Y[24],this.v4h^=Y[9]^Y[25],this.v5l^=Y[10]^Y[26],this.v5h^=Y[11]^Y[27],this.v6l^=Y[12]^Y[28],this.v6h^=Y[13]^Y[29],this.v7l^=Y[14]^Y[30],this.v7h^=Y[15]^Y[31],Nr(Y)}destroy(){this.destroyed=!0,Nr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};i9(t=>new U9(t));function Vm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function wd(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Iu(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Rt(t,...e){if(!Vm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function E1(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function P9(t,e){Rt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function si(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ia(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function C9(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const R9=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function T9(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function md(t){if(typeof t=="string")t=T9(t);else if(Vm(t))t=vd(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function L9(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function N9(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const k9=(t,e)=>{function r(n,...s){if(Rt(n),!R9)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const f=s[0];if(!f)throw new Error("nonce / iv required");t.varSizeNonce?Rt(f):Rt(f,t.nonceLength)}const i=t.tagLength;i&&s[1]!==void 0&&Rt(s[1]);const o=e(n,...s),a=(f,l)=>{if(l!==void 0){if(f!==2)throw new Error("cipher output not supported");Rt(l)}};let c=!1;return{encrypt(f,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Rt(f),a(o.encrypt.length,l),o.encrypt(f,l)},decrypt(f,l){if(Rt(f),i&&f.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,l),o.decrypt(f,l)}}}return Object.assign(r,t),r};function x1(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!j9(e))throw new Error("invalid output, must be aligned");return e}function $1(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function D9(t,e,r){wd(r);const n=new Uint8Array(16),s=C9(n);return $1(s,0,BigInt(e),r),$1(s,8,BigInt(t),r),n}function j9(t){return t.byteOffset%4===0}function vd(t){return Uint8Array.from(t)}const Km=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),q9=Km("expand 16-byte k"),z9=Km("expand 32-byte k"),M9=si(q9),H9=si(z9);function ue(t,e){return t<<e|t>>>32-e}function Ed(t){return t.byteOffset%4===0}const Wc=64,V9=16,Gm=2**32-1,I1=new Uint32Array;function K9(t,e,r,n,s,i,o,a){const c=s.length,f=new Uint8Array(Wc),l=si(f),h=Ed(s)&&Ed(i),u=h?si(s):I1,d=h?si(i):I1;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=Gm)throw new Error("arx: counter overflow");const b=Math.min(Wc,c-g);if(h&&b===Wc){const E=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let U=0,L;U<V9;U++)L=E+U,d[L]=u[L]^l[U];g+=Wc;continue}for(let E=0,U;E<b;E++)U=g+E,i[U]=s[U]^f[E];g+=b}}function G9(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=L9({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Iu(s),Iu(o),wd(i),wd(r),(a,c,f,l,h=0)=>{Rt(a),Rt(c),Rt(f);const u=f.length;if(l===void 0&&(l=new Uint8Array(u)),Rt(l),Iu(h),h<0||h>=Gm)throw new Error("arx: counter overflow");if(l.length<u)throw new Error(`arx: output (${l.length}) is shorter than data (${u})`);const d=[];let g=a.length,b,E;if(g===32)d.push(b=vd(a)),E=H9;else if(g===16&&r)b=new Uint8Array(32),b.set(a),b.set(a,16),E=M9,d.push(b);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Ed(c)||d.push(c=vd(c));const U=si(b);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(E,U,si(c.subarray(0,16)),U),c=c.subarray(16)}const L=16-s;if(L!==c.length)throw new Error(`arx: nonce must be ${L} or 16 bytes`);if(L!==12){const F=new Uint8Array(12);F.set(c,i?0:12-c.length),c=F,d.push(c)}const $=si(c);return K9(t,E,U,$,f,l,h,o),ia(...d),l}}const He=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let Z9=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=md(e),Rt(e,32);const r=He(e,0),n=He(e,2),s=He(e,4),i=He(e,6),o=He(e,8),a=He(e,10),c=He(e,12),f=He(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let l=0;l<8;l++)this.pad[l]=He(e,16+2*l)}process(e,r,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],f=o[2],l=o[3],h=o[4],u=o[5],d=o[6],g=o[7],b=o[8],E=o[9],U=He(e,r+0),L=He(e,r+2),$=He(e,r+4),F=He(e,r+6),P=He(e,r+8),C=He(e,r+10),T=He(e,r+12),R=He(e,r+14);let A=i[0]+(U&8191),j=i[1]+((U>>>13|L<<3)&8191),q=i[2]+((L>>>10|$<<6)&8191),S=i[3]+(($>>>7|F<<9)&8191),m=i[4]+((F>>>4|P<<12)&8191),x=i[5]+(P>>>1&8191),y=i[6]+((P>>>14|C<<2)&8191),p=i[7]+((C>>>11|T<<5)&8191),v=i[8]+((T>>>8|R<<8)&8191),I=i[9]+(R>>>5|s),w=0,B=w+A*a+j*(5*E)+q*(5*b)+S*(5*g)+m*(5*d);w=B>>>13,B&=8191,B+=x*(5*u)+y*(5*h)+p*(5*l)+v*(5*f)+I*(5*c),w+=B>>>13,B&=8191;let O=w+A*c+j*a+q*(5*E)+S*(5*b)+m*(5*g);w=O>>>13,O&=8191,O+=x*(5*d)+y*(5*u)+p*(5*h)+v*(5*l)+I*(5*f),w+=O>>>13,O&=8191;let _=w+A*f+j*c+q*a+S*(5*E)+m*(5*b);w=_>>>13,_&=8191,_+=x*(5*g)+y*(5*d)+p*(5*u)+v*(5*h)+I*(5*l),w+=_>>>13,_&=8191;let k=w+A*l+j*f+q*c+S*a+m*(5*E);w=k>>>13,k&=8191,k+=x*(5*b)+y*(5*g)+p*(5*d)+v*(5*u)+I*(5*h),w+=k>>>13,k&=8191;let D=w+A*h+j*l+q*f+S*c+m*a;w=D>>>13,D&=8191,D+=x*(5*E)+y*(5*b)+p*(5*g)+v*(5*d)+I*(5*u),w+=D>>>13,D&=8191;let N=w+A*u+j*h+q*l+S*f+m*c;w=N>>>13,N&=8191,N+=x*a+y*(5*E)+p*(5*b)+v*(5*g)+I*(5*d),w+=N>>>13,N&=8191;let z=w+A*d+j*u+q*h+S*l+m*f;w=z>>>13,z&=8191,z+=x*c+y*a+p*(5*E)+v*(5*b)+I*(5*g),w+=z>>>13,z&=8191;let H=w+A*g+j*d+q*u+S*h+m*l;w=H>>>13,H&=8191,H+=x*f+y*c+p*a+v*(5*E)+I*(5*b),w+=H>>>13,H&=8191;let V=w+A*b+j*g+q*d+S*u+m*h;w=V>>>13,V&=8191,V+=x*l+y*f+p*c+v*a+I*(5*E),w+=V>>>13,V&=8191;let M=w+A*E+j*b+q*g+S*d+m*u;w=M>>>13,M&=8191,M+=x*h+y*l+p*f+v*c+I*a,w+=M>>>13,M&=8191,w=(w<<2)+w|0,w=w+B|0,B=w&8191,w=w>>>13,O+=w,i[0]=B,i[1]=O,i[2]=_,i[3]=k,i[4]=D,i[5]=N,i[6]=z,i[7]=H,i[8]=V,i[9]=M}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;ia(n)}update(e){E1(this),e=md(e),Rt(e);const{buffer:r,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){ia(this.h,this.r,this.buffer,this.pad)}digestInto(e){E1(this),P9(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}};function Y9(t){const e=(n,s)=>t(s).update(md(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const W9=Y9(t=>new Z9(t));function X9(t,e,r,n,s,i=20){let o=t[0],a=t[1],c=t[2],f=t[3],l=e[0],h=e[1],u=e[2],d=e[3],g=e[4],b=e[5],E=e[6],U=e[7],L=s,$=r[0],F=r[1],P=r[2],C=o,T=a,R=c,A=f,j=l,q=h,S=u,m=d,x=g,y=b,p=E,v=U,I=L,w=$,B=F,O=P;for(let k=0;k<i;k+=2)C=C+j|0,I=ue(I^C,16),x=x+I|0,j=ue(j^x,12),C=C+j|0,I=ue(I^C,8),x=x+I|0,j=ue(j^x,7),T=T+q|0,w=ue(w^T,16),y=y+w|0,q=ue(q^y,12),T=T+q|0,w=ue(w^T,8),y=y+w|0,q=ue(q^y,7),R=R+S|0,B=ue(B^R,16),p=p+B|0,S=ue(S^p,12),R=R+S|0,B=ue(B^R,8),p=p+B|0,S=ue(S^p,7),A=A+m|0,O=ue(O^A,16),v=v+O|0,m=ue(m^v,12),A=A+m|0,O=ue(O^A,8),v=v+O|0,m=ue(m^v,7),C=C+q|0,O=ue(O^C,16),p=p+O|0,q=ue(q^p,12),C=C+q|0,O=ue(O^C,8),p=p+O|0,q=ue(q^p,7),T=T+S|0,I=ue(I^T,16),v=v+I|0,S=ue(S^v,12),T=T+S|0,I=ue(I^T,8),v=v+I|0,S=ue(S^v,7),R=R+m|0,w=ue(w^R,16),x=x+w|0,m=ue(m^x,12),R=R+m|0,w=ue(w^R,8),x=x+w|0,m=ue(m^x,7),A=A+j|0,B=ue(B^A,16),y=y+B|0,j=ue(j^y,12),A=A+j|0,B=ue(B^A,8),y=y+B|0,j=ue(j^y,7);let _=0;n[_++]=o+C|0,n[_++]=a+T|0,n[_++]=c+R|0,n[_++]=f+A|0,n[_++]=l+j|0,n[_++]=h+q|0,n[_++]=u+S|0,n[_++]=d+m|0,n[_++]=g+x|0,n[_++]=b+y|0,n[_++]=E+p|0,n[_++]=U+v|0,n[_++]=L+I|0,n[_++]=$+w|0,n[_++]=F+B|0,n[_++]=P+O|0}const J9=G9(X9,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Q9=new Uint8Array(16),B1=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(Q9.subarray(r))},eI=new Uint8Array(32);function A1(t,e,r,n,s){const i=t(e,r,eI),o=W9.create(i);s&&B1(o,s),B1(o,n);const a=D9(n.length,s?s.length:0,!0);o.update(a);const c=o.digest();return ia(i,a),c}const tI=t=>(e,r,n)=>({encrypt(s,i){const o=s.length;i=x1(o+16,i,!1),i.set(s);const a=i.subarray(0,-16);t(e,r,a,a,1);const c=A1(t,e,r,a,n);return i.set(c,o),ia(c),i},decrypt(s,i){i=x1(s.length-16,i,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=A1(t,e,r,o,n);if(!N9(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),t(e,r,i,i,1),ia(c),i}});k9({blockSize:64,nonceLength:12,tagLength:16},tI(J9));let Zm=class extends Cl{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Cm(e);const n=Mn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Nr(i)}update(e){return ui(this),this.iHash.update(e),this}digestInto(e){ui(this),Lr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Ym=(t,e,r)=>new Zm(t,e).update(r).digest();Ym.create=(t,e)=>new Zm(t,e);Uint8Array.from([0]);const b0=BigInt(0),xd=BigInt(1);function tl(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Hi(t,e,r=""){const n=Pl(t),s=t?.length,i=e!==void 0;if(!n||i&&s!==e){const o=r&&`"${r}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Xc(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Wm(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?b0:BigInt("0x"+t)}function Rl(t){return Wm(Vo(t))}function rl(t){return Lr(t),Wm(Vo(Uint8Array.from(t).reverse()))}function w0(t,e){return el(t.toString(16).padStart(e*2,"0"))}function m0(t,e){return w0(t,e).reverse()}function bt(t,e,r){let n;if(typeof e=="string")try{n=el(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Pl(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}const Bu=t=>typeof t=="bigint"&&b0<=t;function rI(t,e,r){return Bu(t)&&Bu(e)&&Bu(r)&&e<=t&&t<r}function $d(t,e,r,n){if(!rI(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Xm(t){let e;for(e=0;t>b0;t>>=xd,e+=1);return e}const _c=t=>(xd<<BigInt(t))-xd;function nI(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=u=>new Uint8Array(u),s=u=>Uint8Array.of(u);let i=n(t),o=n(t),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},f=(...u)=>r(o,i,...u),l=(u=n(0))=>{o=f(s(0),u),i=f(),u.length!==0&&(o=f(s(1),u),i=f())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){i=f();const g=i.slice();d.push(g),u+=i.length}return Vs(...d)};return(u,d)=>{c(),l(u);let g;for(;!(g=d(h()));)l();return c(),g}}function Tl(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(s,i,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([s,i])=>n(s,i,!1)),Object.entries(r).forEach(([s,i])=>n(s,i,!0))}function S1(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const Dt=BigInt(0),xt=BigInt(1),Vi=BigInt(2),Jm=BigInt(3),Qm=BigInt(4),e3=BigInt(5),sI=BigInt(7),t3=BigInt(8),iI=BigInt(9),r3=BigInt(16);function Yt(t,e){const r=t%e;return r>=Dt?r:e+r}function Br(t,e,r){let n=t;for(;e-- >Dt;)n*=n,n%=r;return n}function O1(t,e){if(t===Dt)throw new Error("invert: expected non-zero number");if(e<=Dt)throw new Error("invert: expected positive modulus, got "+e);let r=Yt(t,e),n=e,s=Dt,i=xt;for(;r!==Dt;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==xt)throw new Error("invert: does not exist");return Yt(s,e)}function v0(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function n3(t,e){const r=(t.ORDER+xt)/Qm,n=t.pow(e,r);return v0(t,n,e),n}function oI(t,e){const r=(t.ORDER-e3)/t3,n=t.mul(e,Vi),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,Vi),s),a=t.mul(i,t.sub(o,t.ONE));return v0(t,a,e),a}function aI(t){const e=mi(t),r=s3(t),n=r(e,e.neg(e.ONE)),s=r(e,n),i=r(e,e.neg(n)),o=(t+sI)/r3;return(a,c)=>{let f=a.pow(c,o),l=a.mul(f,n);const h=a.mul(f,s),u=a.mul(f,i),d=a.eql(a.sqr(l),c),g=a.eql(a.sqr(h),c);f=a.cmov(f,l,d),l=a.cmov(u,h,g);const b=a.eql(a.sqr(l),c),E=a.cmov(f,l,b);return v0(a,E,c),E}}function s3(t){if(t<Jm)throw new Error("sqrt is not defined for small field");let e=t-xt,r=0;for(;e%Vi===Dt;)e/=Vi,r++;let n=Vi;const s=mi(t);for(;_1(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return n3;let i=s.pow(n,e);const o=(e+xt)/Vi;return function(a,c){if(a.is0(c))return c;if(_1(a,c)!==1)throw new Error("Cannot find square root");let f=r,l=a.mul(a.ONE,i),h=a.pow(c,e),u=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,g=a.sqr(h);for(;!a.eql(g,a.ONE);)if(d++,g=a.sqr(g),d===f)throw new Error("Cannot find square root");const b=xt<<BigInt(f-d-1),E=a.pow(l,b);f=d,l=a.sqr(E),h=a.mul(h,l),u=a.mul(u,E)}return u}}function cI(t){return t%Qm===Jm?n3:t%t3===e3?oI:t%r3===iI?aI(t):s3(t)}const fI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function lI(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=fI.reduce((n,s)=>(n[s]="function",n),e);return Tl(t,r),t}function uI(t,e,r){if(r<Dt)throw new Error("invalid exponent, negatives unsupported");if(r===Dt)return t.ONE;if(r===xt)return e;let n=t.ONE,s=e;for(;r>Dt;)r&xt&&(n=t.mul(n,s)),s=t.sqr(s),r>>=xt;return n}function i3(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function _1(t,e){const r=(t.ORDER-xt)/Vi,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function o3(t,e){e!==void 0&&li(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function mi(t,e,r=!1,n={}){if(t<=Dt)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const u=e;u.BITS&&(s=u.BITS),u.sqrt&&(i=u.sqrt),typeof u.isLE=="boolean"&&(r=u.isLE),typeof u.modFromBytes=="boolean"&&(o=u.modFromBytes),a=u.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:f}=o3(t,s);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:f,MASK:_c(c),ZERO:Dt,ONE:xt,allowedLengths:a,create:u=>Yt(u,t),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return Dt<=u&&u<t},is0:u=>u===Dt,isValidNot0:u=>!h.is0(u)&&h.isValid(u),isOdd:u=>(u&xt)===xt,neg:u=>Yt(-u,t),eql:(u,d)=>u===d,sqr:u=>Yt(u*u,t),add:(u,d)=>Yt(u+d,t),sub:(u,d)=>Yt(u-d,t),mul:(u,d)=>Yt(u*d,t),pow:(u,d)=>uI(h,u,d),div:(u,d)=>Yt(u*O1(d,t),t),sqrN:u=>u*u,addN:(u,d)=>u+d,subN:(u,d)=>u-d,mulN:(u,d)=>u*d,inv:u=>O1(u,t),sqrt:i||(u=>(l||(l=cI(t)),l(h,u))),toBytes:u=>r?m0(u,f):w0(u,f),fromBytes:(u,d=!0)=>{if(a){if(!a.includes(u.length)||u.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);const b=new Uint8Array(f);b.set(u,r?0:b.length-u.length),u=b}if(u.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+u.length);let g=r?rl(u):Rl(u);if(o&&(g=Yt(g,t)),!d&&!h.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:u=>i3(h,u),cmov:(u,d,g)=>g?d:u});return Object.freeze(h)}function a3(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function c3(t){const e=a3(t);return e+Math.ceil(e/2)}function hI(t,e,r=!1){const n=t.length,s=a3(e),i=c3(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?rl(t):Rl(t),a=Yt(o,e-xt)+xt;return r?m0(a,s):w0(a,s)}const oa=BigInt(0),Ki=BigInt(1);function nl(t,e){const r=e.negate();return t?r:e}function Au(t,e){const r=i3(t.Fp,e.map(n=>n.Z));return e.map((n,s)=>t.fromAffine(n.toAffine(r[s])))}function f3(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Su(t,e){f3(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=_c(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function F1(t,e,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=Ki);const f=e*n,l=f+Math.abs(a)-1,h=a===0,u=a<0,d=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:u,isNegF:d,offsetF:f}}function dI(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function pI(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Ou=new WeakMap,l3=new WeakMap;function _u(t){return l3.get(t)||1}function U1(t){if(t!==oa)throw new Error("invalid wNAF")}let gI=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let s=e;for(;r>oa;)r&Ki&&(n=n.add(s)),s=s.double(),r>>=Ki;return n}precomputeWindow(e,r){const{windows:n,windowSize:s}=Su(r,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let f=1;f<s;f++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=Su(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:l,isNeg:h,isNegF:u,offsetF:d}=F1(n,a,o);n=c,l?i=i.add(nl(u,r[d])):s=s.add(nl(h,r[f]))}return U1(n),{p:s,f:i}}wNAFUnsafe(e,r,n,s=this.ZERO){const i=Su(e,this.bits);for(let o=0;o<i.windows&&n!==oa;o++){const{nextN:a,offset:c,isZero:f,isNeg:l}=F1(n,o,i);if(n=a,!f){const h=r[c];s=s.add(l?h.negate():h)}}return U1(n),s}getPrecomputes(e,r,n){let s=Ou.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(s=n(s)),Ou.set(r,s))),s}cached(e,r,n){const s=_u(e);return this.wNAF(s,this.getPrecomputes(s,e,n),r)}unsafe(e,r,n,s){const i=_u(e);return i===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),r,s)}createCache(e,r){f3(r,this.bits),l3.set(e,r),Ou.delete(e)}hasCache(e){return _u(e)!==1}};function yI(t,e,r,n){let s=e,i=t.ZERO,o=t.ZERO;for(;r>oa||n>oa;)r&Ki&&(i=i.add(s)),n&Ki&&(o=o.add(s)),s=s.double(),r>>=Ki,n>>=Ki;return{p1:i,p2:o}}function bI(t,e,r,n){dI(r,t),pI(n,e);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Xm(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=_c(c),l=new Array(Number(f)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let u=o;for(let d=h;d>=0;d-=c){l.fill(o);for(let b=0;b<i;b++){const E=n[b],U=Number(E>>BigInt(d)&f);l[U]=l[U].add(r[b])}let g=o;for(let b=l.length-1,E=o;b>0;b--)E=E.add(l[b]),g=g.add(E);if(u=u.add(g),d!==0)for(let b=0;b<c;b++)u=u.double()}return u}function P1(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return lI(e),e}else return mi(t,{isLE:r})}function wI(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>oa))throw new Error(`CURVE.${a} must be positive bigint`)}const s=P1(e.p,r.Fp,n),i=P1(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Nm("HashToScalar-");const Ia=BigInt(0),vo=BigInt(1),Jc=BigInt(2);function mI(t){return Tl(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function vI(t){const e=mI(t),{P:r,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||g0,f=a?255:448,l=a?32:56,h=BigInt(a?9:5),u=BigInt(a?121665:39081),d=a?Jc**BigInt(254):Jc**BigInt(447),g=a?BigInt(8)*Jc**BigInt(251)-vo:BigInt(4)*Jc**BigInt(445)-vo,b=d+g+vo,E=S=>Yt(S,r),U=L(h);function L(S){return m0(E(S),l)}function $(S){const m=bt("u coordinate",S,l);return a&&(m[31]&=127),E(rl(m))}function F(S){return rl(s(bt("scalar",S,l)))}function P(S,m){const x=R($(m),F(S));if(x===Ia)throw new Error("invalid private or public key received");return L(x)}function C(S){return P(S,U)}function T(S,m,x){const y=E(S*(m-x));return m=E(m-y),x=E(x+y),{x_2:m,x_3:x}}function R(S,m){$d("u",S,Ia,r),$d("scalar",m,d,b);const x=m,y=S;let p=vo,v=Ia,I=S,w=vo,B=Ia;for(let _=BigInt(f-1);_>=Ia;_--){const k=x>>_&vo;B^=k,{x_2:p,x_3:I}=T(B,p,I),{x_2:v,x_3:w}=T(B,v,w),B=k;const D=p+v,N=E(D*D),z=p-v,H=E(z*z),V=N-H,M=I+w,K=I-w,Q=E(K*D),te=E(M*z),re=Q+te,le=Q-te;I=E(re*re),w=E(y*E(le*le)),p=E(N*H),v=E(V*(N+E(u*V)))}({x_2:p,x_3:I}=T(B,p,I)),{x_2:v,x_3:w}=T(B,v,w);const O=i(v);return E(p*O)}const A={secretKey:l,publicKey:l,seed:l},j=(S=c(l))=>(Lr(S,A.seed),S);function q(S){const m=j(S);return{secretKey:m,publicKey:C(m)}}return{keygen:q,getSharedSecret:(S,m)=>P(S,m),getPublicKey:S=>C(S),scalarMult:P,scalarMultBase:C,utils:{randomSecretKey:j,randomPrivateKey:j},GuBytes:U.slice(),lengths:A}}const EI=BigInt(1),C1=BigInt(2),xI=BigInt(3),$I=BigInt(5);BigInt(8);const u3=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),II={p:u3,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function BI(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=u3,o=t*t%i*t%i,a=Br(o,C1,i)*o%i,c=Br(a,EI,i)*t%i,f=Br(c,$I,i)*c%i,l=Br(f,e,i)*f%i,h=Br(l,r,i)*l%i,u=Br(h,n,i)*h%i,d=Br(u,s,i)*u%i,g=Br(d,s,i)*u%i,b=Br(g,e,i)*f%i;return{pow_p_5_8:Br(b,C1,i)*t%i,b2:o}}function AI(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const SI=mi(II.p,{isLE:!0});(()=>{const t=SI.ORDER;return vI({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=BI(e);return Yt(Br(r,xI,t)*n,t)},adjustScalarBytes:AI})})();const R1=(t,e)=>(t+(t>=0?e:-e)/h3)/e;function OI(t,e,r){const[[n,s],[i,o]]=e,a=R1(o*t,r),c=R1(-s*t,r);let f=t-a*n-c*i,l=-a*s-c*o;const h=f<kn,u=l<kn;h&&(f=-f),u&&(l=-l);const d=_c(Math.ceil(Xm(r)/2))+Ko;if(f<kn||f>=d||l<kn||l>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:f,k2neg:u,k2:l}}function Id(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Fu(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return tl(r.lowS,"lowS"),tl(r.prehash,"prehash"),r.format!==void 0&&Id(r.format),r}let _I=class extends Error{constructor(e=""){super(e)}};const Pn={Err:_I,_tlv:{encode:(t,e)=>{const{Err:r}=Pn;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=Xc(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?Xc(s.length/2|128):"";return Xc(t)+i+s+e},decode(t,e){const{Err:r}=Pn;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of f)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Pn;if(t<kn)throw new e("integer: negative integers are not allowed");let r=Xc(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Pn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Rl(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Pn,s=bt("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:f,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=Pn,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}},kn=BigInt(0),Ko=BigInt(1),h3=BigInt(2),Qc=BigInt(3),FI=BigInt(4);function No(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let s=bt("private key",e);try{n=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function UI(t,e={}){const r=wI("weierstrass",t,e),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:o,n:a}=i;Tl(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=p3(n,s);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(S,m,x){const{x:y,y:p}=m.toAffine(),v=n.toBytes(y);if(tl(x,"isCompressed"),x){l();const I=!n.isOdd(p);return Vs(d3(I),v)}else return Vs(Uint8Array.of(4),v,n.toBytes(p))}function u(S){Hi(S,void 0,"Point");const{publicKey:m,publicKeyUncompressed:x}=f,y=S.length,p=S[0],v=S.subarray(1);if(y===m&&(p===2||p===3)){const I=n.fromBytes(v);if(!n.isValid(I))throw new Error("bad point: is not on curve, wrong x");const w=b(I);let B;try{B=n.sqrt(w)}catch(_){const k=_ instanceof Error?": "+_.message:"";throw new Error("bad point: is not on curve, sqrt error"+k)}l();const O=n.isOdd(B);return(p&1)===1!==O&&(B=n.neg(B)),{x:I,y:B}}else if(y===x&&p===4){const I=n.BYTES,w=n.fromBytes(v.subarray(0,I)),B=n.fromBytes(v.subarray(I,I*2));if(!E(w,B))throw new Error("bad point: is not on curve");return{x:w,y:B}}else throw new Error(`bad point: got length ${y}, expected compressed=${m} or uncompressed=${x}`)}const d=e.toBytes||h,g=e.fromBytes||u;function b(S){const m=n.sqr(S),x=n.mul(m,S);return n.add(n.add(x,n.mul(S,i.a)),i.b)}function E(S,m){const x=n.sqr(m),y=b(S);return n.eql(x,y)}if(!E(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const U=n.mul(n.pow(i.a,Qc),FI),L=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(U,L)))throw new Error("bad curve params: a or b");function $(S,m,x=!1){if(!n.isValid(m)||x&&n.is0(m))throw new Error(`bad point coordinate ${S}`);return m}function F(S){if(!(S instanceof A))throw new Error("ProjectivePoint expected")}function P(S){if(!c||!c.basises)throw new Error("no endo");return OI(S,c.basises,s.ORDER)}const C=S1((S,m)=>{const{X:x,Y:y,Z:p}=S;if(n.eql(p,n.ONE))return{x,y};const v=S.is0();m==null&&(m=v?n.ONE:n.inv(p));const I=n.mul(x,m),w=n.mul(y,m),B=n.mul(p,m);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(B,n.ONE))throw new Error("invZ was invalid");return{x:I,y:w}}),T=S1(S=>{if(S.is0()){if(e.allowInfinityPoint&&!n.is0(S.Y))return;throw new Error("bad point: ZERO")}const{x:m,y:x}=S.toAffine();if(!n.isValid(m)||!n.isValid(x))throw new Error("bad point: x or y not field elements");if(!E(m,x))throw new Error("bad point: equation left != right");if(!S.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(S,m,x,y,p){return x=new A(n.mul(x.X,S),x.Y,x.Z),m=nl(y,m),x=nl(p,x),m.add(x)}class A{constructor(m,x,y){this.X=$("x",m),this.Y=$("y",x,!0),this.Z=$("z",y),Object.freeze(this)}static CURVE(){return i}static fromAffine(m){const{x,y}=m||{};if(!m||!n.isValid(x)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof A)throw new Error("projective point not allowed");return n.is0(x)&&n.is0(y)?A.ZERO:new A(x,y,n.ONE)}static fromBytes(m){const x=A.fromAffine(g(Hi(m,void 0,"point")));return x.assertValidity(),x}static fromHex(m){return A.fromBytes(bt("pointHex",m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,x=!0){return q.createCache(this,m),x||this.multiply(Qc),this}assertValidity(){T(this)}hasEvenY(){const{y:m}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(m)}equals(m){F(m);const{X:x,Y:y,Z:p}=this,{X:v,Y:I,Z:w}=m,B=n.eql(n.mul(x,w),n.mul(v,p)),O=n.eql(n.mul(y,w),n.mul(I,p));return B&&O}negate(){return new A(this.X,n.neg(this.Y),this.Z)}double(){const{a:m,b:x}=i,y=n.mul(x,Qc),{X:p,Y:v,Z:I}=this;let w=n.ZERO,B=n.ZERO,O=n.ZERO,_=n.mul(p,p),k=n.mul(v,v),D=n.mul(I,I),N=n.mul(p,v);return N=n.add(N,N),O=n.mul(p,I),O=n.add(O,O),w=n.mul(m,O),B=n.mul(y,D),B=n.add(w,B),w=n.sub(k,B),B=n.add(k,B),B=n.mul(w,B),w=n.mul(N,w),O=n.mul(y,O),D=n.mul(m,D),N=n.sub(_,D),N=n.mul(m,N),N=n.add(N,O),O=n.add(_,_),_=n.add(O,_),_=n.add(_,D),_=n.mul(_,N),B=n.add(B,_),D=n.mul(v,I),D=n.add(D,D),_=n.mul(D,N),w=n.sub(w,_),O=n.mul(D,k),O=n.add(O,O),O=n.add(O,O),new A(w,B,O)}add(m){F(m);const{X:x,Y:y,Z:p}=this,{X:v,Y:I,Z:w}=m;let B=n.ZERO,O=n.ZERO,_=n.ZERO;const k=i.a,D=n.mul(i.b,Qc);let N=n.mul(x,v),z=n.mul(y,I),H=n.mul(p,w),V=n.add(x,y),M=n.add(v,I);V=n.mul(V,M),M=n.add(N,z),V=n.sub(V,M),M=n.add(x,p);let K=n.add(v,w);return M=n.mul(M,K),K=n.add(N,H),M=n.sub(M,K),K=n.add(y,p),B=n.add(I,w),K=n.mul(K,B),B=n.add(z,H),K=n.sub(K,B),_=n.mul(k,M),B=n.mul(D,H),_=n.add(B,_),B=n.sub(z,_),_=n.add(z,_),O=n.mul(B,_),z=n.add(N,N),z=n.add(z,N),H=n.mul(k,H),M=n.mul(D,M),z=n.add(z,H),H=n.sub(N,H),H=n.mul(k,H),M=n.add(M,H),N=n.mul(z,M),O=n.add(O,N),N=n.mul(K,M),B=n.mul(V,B),B=n.sub(B,N),N=n.mul(V,z),_=n.mul(K,_),_=n.add(_,N),new A(B,O,_)}subtract(m){return this.add(m.negate())}is0(){return this.equals(A.ZERO)}multiply(m){const{endo:x}=e;if(!s.isValidNot0(m))throw new Error("invalid scalar: out of range");let y,p;const v=I=>q.cached(this,I,w=>Au(A,w));if(x){const{k1neg:I,k1:w,k2neg:B,k2:O}=P(m),{p:_,f:k}=v(w),{p:D,f:N}=v(O);p=k.add(N),y=R(x.beta,_,D,I,B)}else{const{p:I,f:w}=v(m);y=I,p=w}return Au(A,[y,p])[0]}multiplyUnsafe(m){const{endo:x}=e,y=this;if(!s.isValid(m))throw new Error("invalid scalar: out of range");if(m===kn||y.is0())return A.ZERO;if(m===Ko)return y;if(q.hasCache(this))return this.multiply(m);if(x){const{k1neg:p,k1:v,k2neg:I,k2:w}=P(m),{p1:B,p2:O}=yI(A,y,v,w);return R(x.beta,B,O,p,I)}else return q.unsafe(y,m)}multiplyAndAddUnsafe(m,x,y){const p=this.multiplyUnsafe(x).add(m.multiplyUnsafe(y));return p.is0()?void 0:p}toAffine(m){return C(this,m)}isTorsionFree(){const{isTorsionFree:m}=e;return o===Ko?!0:m?m(A,this):q.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:m}=e;return o===Ko?this:m?m(A,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(m=!0){return tl(m,"isCompressed"),this.assertValidity(),d(A,this,m)}toHex(m=!0){return Vo(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(m=!0){return this.toBytes(m)}_setWindowSize(m){this.precompute(m)}static normalizeZ(m){return Au(A,m)}static msm(m,x){return bI(A,s,m,x)}static fromPrivateKey(m){return A.BASE.multiply(No(s,m))}}A.BASE=new A(i.Gx,i.Gy,n.ONE),A.ZERO=new A(n.ZERO,n.ONE,n.ZERO),A.Fp=n,A.Fn=s;const j=s.BITS,q=new gI(A,e.endo?Math.ceil(j/2):j);return A.BASE.precompute(8),A}function d3(t){return Uint8Array.of(t?2:3)}function p3(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function PI(t,e={}){const{Fn:r}=t,n=e.randomBytes||g0,s=Object.assign(p3(t.Fp,r),{seed:c3(r.ORDER)});function i(u){try{return!!No(r,u)}catch{return!1}}function o(u,d){const{publicKey:g,publicKeyUncompressed:b}=s;try{const E=u.length;return d===!0&&E!==g||d===!1&&E!==b?!1:!!t.fromBytes(u)}catch{return!1}}function a(u=n(s.seed)){return hI(Hi(u,s.seed,"seed"),r.ORDER)}function c(u,d=!0){return t.BASE.multiply(No(r,u)).toBytes(d)}function f(u){const d=a(u);return{secretKey:d,publicKey:c(d)}}function l(u){if(typeof u=="bigint")return!1;if(u instanceof t)return!0;const{secretKey:d,publicKey:g,publicKeyUncompressed:b}=s;if(r.allowedLengths||d===g)return;const E=bt("key",u).length;return E===g||E===b}function h(u,d,g=!0){if(l(u)===!0)throw new Error("first arg must be private key");if(l(d)===!1)throw new Error("second arg must be public key");const b=No(r,u);return t.fromHex(d).multiply(b).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:f,Point:t,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:u=>No(r,u),precompute(u=8,d=t.BASE){return d.precompute(u,!1)}},lengths:s})}function CI(t,e,r={}){Cm(e),Tl(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||g0,s=r.hmac||((x,...y)=>Ym(e,x,Vs(...y))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:d}=PI(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},b="compact";function E(x){const y=a>>Ko;return x>y}function U(x,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${x}: out of range 1..Point.Fn.ORDER`);return y}function L(x,y){Id(y);const p=d.signature,v=y==="compact"?p:y==="recovered"?p+1:void 0;return Hi(x,v,`${y} signature`)}class ${constructor(y,p,v){this.r=U("r",y),this.s=U("s",p),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(y,p=b){L(y,p);let v;if(p==="der"){const{r:O,s:_}=Pn.toSig(Hi(y));return new $(O,_)}p==="recovered"&&(v=y[0],p="compact",y=y.subarray(1));const I=o.BYTES,w=y.subarray(0,I),B=y.subarray(I,I*2);return new $(o.fromBytes(w),o.fromBytes(B),v)}static fromHex(y,p){return this.fromBytes(el(y),p)}addRecoveryBit(y){return new $(this.r,this.s,y)}recoverPublicKey(y){const p=i.ORDER,{r:v,s:I,recovery:w}=this;if(w==null||![0,1,2,3].includes(w))throw new Error("recovery id invalid");if(a*h3<p&&w>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=w===2||w===3?v+a:v;if(!i.isValid(B))throw new Error("recovery id 2 or 3 invalid");const O=i.toBytes(B),_=t.fromBytes(Vs(d3((w&1)===0),O)),k=o.inv(B),D=P(bt("msgHash",y)),N=o.create(-D*k),z=o.create(I*k),H=t.BASE.multiplyUnsafe(N).add(_.multiplyUnsafe(z));if(H.is0())throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return E(this.s)}toBytes(y=b){if(Id(y),y==="der")return el(Pn.hexFromSig(this));const p=o.toBytes(this.r),v=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Vs(Uint8Array.of(this.recovery),p,v)}return Vs(p,v)}toHex(y){return Vo(this.toBytes(y))}assertValidity(){}static fromCompact(y){return $.fromBytes(bt("sig",y),"compact")}static fromDER(y){return $.fromBytes(bt("sig",y),"der")}normalizeS(){return this.hasHighS()?new $(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Vo(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Vo(this.toBytes("compact"))}}const F=r.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");const y=Rl(x),p=x.length*8-c;return p>0?y>>BigInt(p):y},P=r.bits2int_modN||function(x){return o.create(F(x))},C=_c(c);function T(x){return $d("num < 2^"+c,x,kn,C),o.toBytes(x)}function R(x,y){return Hi(x,void 0,"message"),y?Hi(e(x),void 0,"prehashed message"):x}function A(x,y,p){if(["recovered","canonical"].some(z=>z in p))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:I,extraEntropy:w}=Fu(p,g);x=R(x,I);const B=P(x),O=No(o,y),_=[T(O),T(B)];if(w!=null&&w!==!1){const z=w===!0?n(d.secretKey):w;_.push(bt("extraEntropy",z))}const k=Vs(..._),D=B;function N(z){const H=F(z);if(!o.isValidNot0(H))return;const V=o.inv(H),M=t.BASE.multiply(H).toAffine(),K=o.create(M.x);if(K===kn)return;const Q=o.create(V*o.create(D+K*O));if(Q===kn)return;let te=(M.x===K?0:2)|Number(M.y&Ko),re=Q;return v&&E(Q)&&(re=o.neg(Q),te^=1),new $(K,re,te)}return{seed:k,k2sig:N}}function j(x,y,p={}){x=bt("message",x);const{seed:v,k2sig:I}=A(x,y,p);return nI(e.outputLen,o.BYTES,s)(v,I)}function q(x){let y;const p=typeof x=="string"||Pl(x),v=!p&&x!==null&&typeof x=="object"&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!p&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)y=new $(x.r,x.s);else if(p){try{y=$.fromBytes(bt("sig",x),"der")}catch(I){if(!(I instanceof Pn.Err))throw I}if(!y)try{y=$.fromBytes(bt("sig",x),"compact")}catch{return!1}}return y||!1}function S(x,y,p,v={}){const{lowS:I,prehash:w,format:B}=Fu(v,g);if(p=bt("publicKey",p),y=R(bt("message",y),w),"strict"in v)throw new Error("options.strict was renamed to lowS");const O=B===void 0?q(x):$.fromBytes(bt("sig",x),B);if(O===!1)return!1;try{const _=t.fromBytes(p);if(I&&O.hasHighS())return!1;const{r:k,s:D}=O,N=P(y),z=o.inv(D),H=o.create(N*z),V=o.create(k*z),M=t.BASE.multiplyUnsafe(H).add(_.multiplyUnsafe(V));return M.is0()?!1:o.create(M.x)===k}catch{return!1}}function m(x,y,p={}){const{prehash:v}=Fu(p,g);return y=R(y,v),$.fromBytes(x,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:d,Point:t,sign:j,verify:S,recoverPublicKey:m,Signature:$,hash:e})}function RI(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=mi(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),i={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function TI(t){const{CURVE:e,curveOpts:r}=RI(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function LI(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,o3(r.Fn.ORDER,r.Fn.BITS))})}function NI(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:s}=TI(t),i=UI(e,r),o=CI(i,n,s);return LI(t,o)}function Bd(t,e){const r=n=>NI({...t,hash:n});return{...r(e),create:r}}const g3={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},y3={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},b3={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},kI=mi(g3.p),DI=mi(y3.p),jI=mi(b3.p);Bd({...g3,Fp:kI,lowS:!1},B9);Bd({...y3,Fp:DI,lowS:!1},S9),Bd({...b3,Fp:jI,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},A9);const qI={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function zI(t,e){const{message:r,code:n}=qI[t];return{message:r,code:n}}function Ad(t,e){return!!Array.isArray(t)}var on={exports:{}};function MI(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var HI=VI;function VI(t,e,r){var n=r&&r.stringify||MI,s=1;if(typeof t=="object"&&t!==null){var i=e.length+s;if(i===1)return t;var o=new Array(i);o[0]=n(t);for(var a=1;a<i;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var f="",l=1-s,h=-1,u=t&&t.length||0,d=0;d<u;){if(t.charCodeAt(d)===37&&d+1<u){switch(h=h>-1?h:0,t.charCodeAt(d+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<d&&(f+=t.slice(h,d)),f+=Number(e[l]),h=d+2,d++;break;case 105:if(l>=c||e[l]==null)break;h<d&&(f+=t.slice(h,d)),f+=Math.floor(Number(e[l])),h=d+2,d++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<d&&(f+=t.slice(h,d));var g=typeof e[l];if(g==="string"){f+="'"+e[l]+"'",h=d+2,d++;break}if(g==="function"){f+=e[l].name||"<anonymous>",h=d+2,d++;break}f+=n(e[l]),h=d+2,d++;break;case 115:if(l>=c)break;h<d&&(f+=t.slice(h,d)),f+=String(e[l]),h=d+2,d++;break;case 37:h<d&&(f+=t.slice(h,d)),f+="%",h=d+2,d++,l--;break}++l}++d}return h===-1?t:(h<u&&(f+=t.slice(h)),f)}const T1=HI;on.exports=Hn;const pc=oB().console||{},KI={mapHttpRequest:ef,mapHttpResponse:ef,wrapRequestSerializer:Uu,wrapResponseSerializer:Uu,wrapErrorSerializer:Uu,req:ef,res:ef,err:N1,errWithCause:N1};function Qs(t,e){return t==="silent"?1/0:e.levels.values[t]}const E0=Symbol("pino.logFuncs"),Sd=Symbol("pino.hierarchy"),GI={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function L1(t,e){const r={logger:e,parent:t[Sd]};e[Sd]=r}function ZI(t,e,r){const n={};e.forEach(s=>{n[s]=r[s]?r[s]:pc[s]||pc[GI[s]||"log"]||Go}),t[E0]=n}function YI(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Hn(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||pc;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},s=YI(t.browser.serialize,n);let i=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(i=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(b){r[b]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",f=Object.create(r);f.log||(f.log=Go),ZI(f,a,r),L1({},f),Object.defineProperty(f,"levelVal",{get:h}),Object.defineProperty(f,"level",{get:u,set:d});const l={transmit:e,serialize:s,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:nB(t),messageKey:t.messageKey||"msg",onChild:t.onChild||Go};f.levels=WI(t),f.level=c,f.isLevelEnabled=function(b){return this.levels.values[b]?this.levels.values[b]>=this.levels.values[this.level]:!1},f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=Go,f.serializers=n,f._serialize=s,f._stdErrSerialize=i,f.child=function(...b){return g.call(this,l,...b)},e&&(f._logEvent=Od());function h(){return Qs(this.level,this)}function u(){return this._level}function d(b){if(b!=="silent"&&!this.levels.values[b])throw Error("unknown level "+b);this._level=b,Fi(this,l,f,"error"),Fi(this,l,f,"fatal"),Fi(this,l,f,"warn"),Fi(this,l,f,"info"),Fi(this,l,f,"debug"),Fi(this,l,f,"trace"),o.forEach(E=>{Fi(this,l,f,E)})}function g(b,E,U){if(!E)throw new Error("missing bindings for child Pino");U=U||{},s&&E.serializers&&(U.serializers=E.serializers);const L=U.serializers;if(s&&L){var $=Object.assign({},n,L),F=t.browser.serialize===!0?Object.keys($):s;delete E.serializers,x0([E],F,$,this._stdErrSerialize)}function P(T){this._childLevel=(T._childLevel|0)+1,this.bindings=E,$&&(this.serializers=$,this._serialize=F),e&&(this._logEvent=Od([].concat(T._logEvent.bindings,E)))}P.prototype=this;const C=new P(this);return L1(this,C),C.child=function(...T){return g.call(this,b,...T)},C.level=U.level||this.level,b.onChild(C),C}return f}function WI(t){const e=t.customLevels||{},r=Object.assign({},Hn.levels.values,e),n=Object.assign({},Hn.levels.labels,XI(e));return{values:r,labels:n}}function XI(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}Hn.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},Hn.stdSerializers=KI,Hn.stdTimeFunctions=Object.assign({},{nullTime:w3,epochTime:m3,unixTime:sB,isoTime:iB});function JI(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[Sd];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function Fi(t,e,r,n){if(Object.defineProperty(t,n,{value:Qs(t.level,r)>Qs(n,r)?Go:r[E0][n],writable:!0,enumerable:!0,configurable:!0}),t[n]===Go){if(!e.transmit)return;const i=e.transmit.level||t.level,o=Qs(i,r);if(Qs(n,r)<o)return}t[n]=eB(t,e,r,n);const s=JI(t);s.length!==0&&(t[n]=QI(s,t[n]))}function QI(t,e){return function(){return e.apply(this,[...t,...arguments])}}function eB(t,e,r,n){return(function(s){return function(){const i=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===pc?pc:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var f=!1;if(e.serialize&&(x0(o,this._serialize,this.serializers,this._stdErrSerialize),f=!0),e.asObject||e.formatters?s.call(a,...tB(this,n,o,i,e)):s.apply(a,o),e.transmit){const l=e.transmit.level||t._level,h=Qs(l,r),u=Qs(n,r);if(u<h)return;rB(this,{ts:i,methodLevel:n,methodValue:u,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Qs(t._level,r)},o,f)}}})(t[E0][n])}function tB(t,e,r,n,s){const{level:i,log:o=h=>h}=s.formatters||{},a=r.slice();let c=a[0];const f={};let l=(t._childLevel|0)+1;if(l<1&&(l=1),n&&(f.time=n),i){const h=i(e,t.levels.values[e]);Object.assign(f,h)}else f.level=t.levels.values[e];if(s.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;l--&&typeof a[0]=="object";)Object.assign(f,a.shift());return[o(f),...a]}else{if(c!==null&&typeof c=="object"){for(;l--&&typeof a[0]=="object";)Object.assign(f,a.shift());c=a.length?T1(a.shift(),a):void 0}else typeof c=="string"&&(c=T1(a.shift(),a));return c!==void 0&&(f[s.messageKey]=c),[o(f)]}}function x0(t,e,r,n){for(const s in t)if(n&&t[s]instanceof Error)t[s]=Hn.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s])&&e)for(const i in t[s])e.indexOf(i)>-1&&i in r&&(t[s][i]=r[i](t[s][i]))}function rB(t,e,r,n=!1){const s=e.send,i=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,f=t._logEvent.bindings;n||x0(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=i,t._logEvent.messages=r.filter(function(l){return f.indexOf(l)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,s(o,t._logEvent,c),t._logEvent=Od(f)}function Od(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function N1(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function nB(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?w3:m3}function ef(){return{}}function Uu(t){return t}function Go(){}function w3(){return!1}function m3(){return Date.now()}function sB(){return Math.round(Date.now()/1e3)}function iB(){return new Date(Date.now()).toISOString()}function oB(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}on.exports.default=Hn;on.exports.pino=Hn;const aB={level:"info"},Ll="custom_context",$0=1e3*1024;var cB=Object.defineProperty,fB=(t,e,r)=>e in t?cB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ks=(t,e,r)=>fB(t,typeof e!="symbol"?e+"":e,r);let lB=class{constructor(e){Ks(this,"nodeValue"),Ks(this,"sizeInBytes"),Ks(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},k1=class{constructor(e){Ks(this,"lengthInNodes"),Ks(this,"sizeInBytes"),Ks(this,"head"),Ks(this,"tail"),Ks(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new lB(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const uB=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function D1(t){return typeof t=="string"?t:uB(t)||""}var hB=Object.defineProperty,dB=(t,e,r)=>e in t?hB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tf=(t,e,r)=>dB(t,typeof e!="symbol"?e+"":e,r);let v3=class{constructor(e,r=$0){tf(this,"logs"),tf(this,"level"),tf(this,"levelValue"),tf(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=on.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new k1(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===on.exports.levels.values.error?console.error(e):r===on.exports.levels.values.warn?console.warn(e):r===on.exports.levels.values.debug?console.debug(e):r===on.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(D1({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new k1(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(D1({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var pB=Object.defineProperty,gB=(t,e,r)=>e in t?pB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yB=(t,e,r)=>gB(t,e+"",r);let bB=class{constructor(e,r=$0){yB(this,"baseChunkLogger"),this.baseChunkLogger=new v3(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}};var wB=Object.defineProperty,mB=(t,e,r)=>e in t?wB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vB=(t,e,r)=>mB(t,e+"",r);let EB=class{constructor(e,r=$0){vB(this,"baseChunkLogger"),this.baseChunkLogger=new v3(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var xB=Object.defineProperty,$B=Object.defineProperties,IB=Object.getOwnPropertyDescriptors,j1=Object.getOwnPropertySymbols,BB=Object.prototype.hasOwnProperty,AB=Object.prototype.propertyIsEnumerable,q1=(t,e,r)=>e in t?xB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ii=(t,e)=>{for(var r in e||(e={}))BB.call(e,r)&&q1(t,r,e[r]);if(j1)for(var r of j1(e))AB.call(e,r)&&q1(t,r,e[r]);return t},oi=(t,e)=>$B(t,IB(e));function SB(t){return oi(ii({},t),{level:t?.level||aB.level})}function OB(t,e,r=Ll){return t[r]=e,t}function rr(t,e=Ll){return t[e]||""}function _B(t,e,r=Ll){const n=rr(t,r);return n.trim()?`${n}/${e}`:e}function nr(t,e,r=Ll){const n=_B(t,e,r),s=t.child({context:n});return OB(s,n,r)}function FB(t){var e,r;const n=new bB((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:on.exports(oi(ii({},t.opts),{level:"trace",browser:oi(ii({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})})),chunkLoggerController:n}}function UB(t){var e,r;const n=new EB((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:on.exports(oi(ii({},t.opts),{level:"trace",browser:oi(ii({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})}),n),chunkLoggerController:n}}function E3(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const r=oi(ii({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?FB(oi(ii({},t),{opts:r})):UB(oi(ii({},t),{opts:r}))}var PB=Object.defineProperty,CB=(t,e,r)=>e in t?PB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,z1=(t,e,r)=>CB(t,typeof e!="symbol"?e+"":e,r);class RB extends ya{constructor(e){super(),this.opts=e,z1(this,"protocol","wc"),z1(this,"version",2)}}var TB=Object.defineProperty,LB=(t,e,r)=>e in t?TB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,NB=(t,e,r)=>LB(t,e+"",r);let kB=class extends ya{constructor(e,r){super(),this.core=e,this.logger=r,NB(this,"records",new Map)}},DB=class{constructor(e,r){this.logger=e,this.core=r}},jB=class extends ya{constructor(e,r){super(),this.relayer=e,this.logger=r}},qB=class extends ya{constructor(e){super()}},zB=class{constructor(e,r,n,s){this.core=e,this.logger=r,this.name=n}},MB=class extends ya{constructor(e,r){super(),this.relayer=e,this.logger=r}},HB=class extends ya{constructor(e,r){super(),this.core=e,this.logger=r}},VB=class{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}},KB=class{constructor(e,r){this.projectId=e,this.logger=r}},GB=class{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}};function ZB(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function x3(t,...e){if(!ZB(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function M1(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function YB(t,e){x3(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Eo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Pu=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function WB(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function $3(t){return typeof t=="string"&&(t=WB(t)),x3(t),t}let XB=class{clone(){return this._cloneInto()}};function JB(t){const e=n=>t().update($3(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function I3(t=32){if(Eo&&typeof Eo.getRandomValues=="function")return Eo.getRandomValues(new Uint8Array(t));if(Eo&&typeof Eo.randomBytes=="function")return Eo.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function QB(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}let eA=class extends XB{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Pu(this.buffer)}update(e){M1(this);const{view:r,buffer:n,blockLen:s}=this;e=$3(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=Pu(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){M1(this),YB(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;QB(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=Pu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%r&&e.buffer.set(n),e}};const rf=BigInt(2**32-1),_d=BigInt(32);function B3(t,e=!1){return e?{h:Number(t&rf),l:Number(t>>_d&rf)}:{h:Number(t>>_d&rf)|0,l:Number(t&rf)|0}}function tA(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:i,l:o}=B3(t[s],e);[r[s],n[s]]=[i,o]}return[r,n]}const rA=(t,e)=>BigInt(t>>>0)<<_d|BigInt(e>>>0),nA=(t,e,r)=>t>>>r,sA=(t,e,r)=>t<<32-r|e>>>r,iA=(t,e,r)=>t>>>r|e<<32-r,oA=(t,e,r)=>t<<32-r|e>>>r,aA=(t,e,r)=>t<<64-r|e>>>r-32,cA=(t,e,r)=>t>>>r-32|e<<64-r,fA=(t,e)=>e,lA=(t,e)=>t,uA=(t,e,r)=>t<<r|e>>>32-r,hA=(t,e,r)=>e<<r|t>>>32-r,dA=(t,e,r)=>e<<r-32|t>>>64-r,pA=(t,e,r)=>t<<r-32|e>>>64-r;function gA(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const yA=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),bA=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,wA=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),mA=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,vA=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),EA=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,se={fromBig:B3,split:tA,toBig:rA,shrSH:nA,shrSL:sA,rotrSH:iA,rotrSL:oA,rotrBH:aA,rotrBL:cA,rotr32H:fA,rotr32L:lA,rotlSH:uA,rotlSL:hA,rotlBH:dA,rotlBL:pA,add:gA,add3L:yA,add3H:bA,add4L:wA,add4H:mA,add5H:EA,add5L:vA},[xA,$A]=se.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),is=new Uint32Array(80),os=new Uint32Array(80);let IA=class extends eA{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:f,El:l,Fh:h,Fl:u,Gh:d,Gl:g,Hh:b,Hl:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=l|0,this.Fh=h|0,this.Fl=u|0,this.Gh=d|0,this.Gl=g|0,this.Hh=b|0,this.Hl=E|0}process(e,r){for(let $=0;$<16;$++,r+=4)is[$]=e.getUint32(r),os[$]=e.getUint32(r+=4);for(let $=16;$<80;$++){const F=is[$-15]|0,P=os[$-15]|0,C=se.rotrSH(F,P,1)^se.rotrSH(F,P,8)^se.shrSH(F,P,7),T=se.rotrSL(F,P,1)^se.rotrSL(F,P,8)^se.shrSL(F,P,7),R=is[$-2]|0,A=os[$-2]|0,j=se.rotrSH(R,A,19)^se.rotrBH(R,A,61)^se.shrSH(R,A,6),q=se.rotrSL(R,A,19)^se.rotrBL(R,A,61)^se.shrSL(R,A,6),S=se.add4L(T,q,os[$-7],os[$-16]),m=se.add4H(S,C,j,is[$-7],is[$-16]);is[$]=m|0,os[$]=S|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:f,Dl:l,Eh:h,El:u,Fh:d,Fl:g,Gh:b,Gl:E,Hh:U,Hl:L}=this;for(let $=0;$<80;$++){const F=se.rotrSH(h,u,14)^se.rotrSH(h,u,18)^se.rotrBH(h,u,41),P=se.rotrSL(h,u,14)^se.rotrSL(h,u,18)^se.rotrBL(h,u,41),C=h&d^~h&b,T=u&g^~u&E,R=se.add5L(L,P,T,$A[$],os[$]),A=se.add5H(R,U,F,C,xA[$],is[$]),j=R|0,q=se.rotrSH(n,s,28)^se.rotrBH(n,s,34)^se.rotrBH(n,s,39),S=se.rotrSL(n,s,28)^se.rotrBL(n,s,34)^se.rotrBL(n,s,39),m=n&i^n&a^i&a,x=s&o^s&c^o&c;U=b|0,L=E|0,b=d|0,E=g|0,d=h|0,g=u|0,{h,l:u}=se.add(f|0,l|0,A|0,j|0),f=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const y=se.add3L(j,S,x);n=se.add3H(y,A,q,m),s=y|0}({h:n,l:s}=se.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=se.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=se.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l}=se.add(this.Dh|0,this.Dl|0,f|0,l|0),{h,l:u}=se.add(this.Eh|0,this.El|0,h|0,u|0),{h:d,l:g}=se.add(this.Fh|0,this.Fl|0,d|0,g|0),{h:b,l:E}=se.add(this.Gh|0,this.Gl|0,b|0,E|0),{h:U,l:L}=se.add(this.Hh|0,this.Hl|0,U|0,L|0),this.set(n,s,i,o,a,c,f,l,h,u,d,g,b,E,U,L)}roundClean(){is.fill(0),os.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const BA=JB(()=>new IA);const I0=BigInt(0),A3=BigInt(1),AA=BigInt(2);function B0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function A0(t){if(!B0(t))throw new Error("Uint8Array expected")}function Cu(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const SA=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function S0(t){A0(t);let e="";for(let r=0;r<t.length;r++)e+=SA[t[r]];return e}function S3(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?I0:BigInt("0x"+t)}const pn={_0:48,_9:57,A:65,F:70,a:97,f:102};function H1(t){if(t>=pn._0&&t<=pn._9)return t-pn._0;if(t>=pn.A&&t<=pn.F)return t-(pn.A-10);if(t>=pn.a&&t<=pn.f)return t-(pn.a-10)}function O3(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=H1(t.charCodeAt(i)),a=H1(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function OA(t){return S3(S0(t))}function zf(t){return A0(t),S3(S0(Uint8Array.from(t).reverse()))}function _3(t,e){return O3(t.toString(16).padStart(e*2,"0"))}function Fd(t,e){return _3(t,e).reverse()}function gn(t,e,r){let n;if(typeof e=="string")try{n=O3(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(B0(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function V1(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];A0(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}const Ru=t=>typeof t=="bigint"&&I0<=t;function _A(t,e,r){return Ru(t)&&Ru(e)&&Ru(r)&&e<=t&&t<r}function Ba(t,e,r,n){if(!_A(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function FA(t){let e;for(e=0;t>I0;t>>=A3,e+=1);return e}const UA=t=>(AA<<BigInt(t-1))-A3,PA={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||B0(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function O0(t,e,r={}){const n=(s,i,o)=>{const a=PA[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(r))n(s,i,!0);return t}function K1(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const qe=BigInt(0),Ie=BigInt(1),Di=BigInt(2),CA=BigInt(3),Ud=BigInt(4),G1=BigInt(5),Z1=BigInt(8);function Ce(t,e){const r=t%e;return r>=qe?r:e+r}function RA(t,e,r){if(e<qe)throw new Error("invalid exponent, negatives unsupported");if(r<=qe)throw new Error("invalid modulus");if(r===Ie)return qe;let n=Ie;for(;e>qe;)e&Ie&&(n=n*t%r),t=t*t%r,e>>=Ie;return n}function Kr(t,e,r){let n=t;for(;e-- >qe;)n*=n,n%=r;return n}function Y1(t,e){if(t===qe)throw new Error("invert: expected non-zero number");if(e<=qe)throw new Error("invert: expected positive modulus, got "+e);let r=Ce(t,e),n=e,s=qe,i=Ie;for(;r!==qe;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==Ie)throw new Error("invert: does not exist");return Ce(s,e)}function TA(t){const e=(t-Ie)/Di;let r,n,s;for(r=t-Ie,n=0;r%Di===qe;r/=Di,n++);for(s=Di;s<t&&RA(s,e,t)!==t-Ie;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+Ie)/Ud;return function(a,c){const f=a.pow(c,o);if(!a.eql(a.sqr(f),c))throw new Error("Cannot find square root");return f}}const i=(r+Ie)/Di;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,f=o.pow(o.mul(o.ONE,s),r),l=o.pow(a,i),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let u=1;for(let g=o.sqr(h);u<c&&!o.eql(g,o.ONE);u++)g=o.sqr(g);const d=o.pow(f,Ie<<BigInt(c-u-1));f=o.sqr(d),l=o.mul(l,d),h=o.mul(h,f),c=u}return l}}function LA(t){if(t%Ud===CA){const e=(t+Ie)/Ud;return function(r,n){const s=r.pow(n,e);if(!r.eql(r.sqr(s),n))throw new Error("Cannot find square root");return s}}if(t%Z1===G1){const e=(t-G1)/Z1;return function(r,n){const s=r.mul(n,Di),i=r.pow(s,e),o=r.mul(n,i),a=r.mul(r.mul(o,Di),i),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return TA(t)}const NA=(t,e)=>(Ce(t,e)&Ie)===Ie,kA=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function DA(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=kA.reduce((n,s)=>(n[s]="function",n),e);return O0(t,r)}function jA(t,e,r){if(r<qe)throw new Error("invalid exponent, negatives unsupported");if(r===qe)return t.ONE;if(r===Ie)return e;let n=t.ONE,s=e;for(;r>qe;)r&Ie&&(n=t.mul(n,s)),s=t.sqr(s),r>>=Ie;return n}function qA(t,e){const r=new Array(e.length),n=e.reduce((i,o,a)=>t.is0(o)?i:(r[a]=i,t.mul(i,o)),t.ONE),s=t.inv(n);return e.reduceRight((i,o,a)=>t.is0(o)?i:(r[a]=t.mul(i,r[a]),t.mul(i,o)),s),r}function F3(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function U3(t,e,r=!1,n={}){if(t<=qe)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:i}=F3(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:UA(s),ZERO:qe,ONE:Ie,create:c=>Ce(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return qe<=c&&c<t},is0:c=>c===qe,isOdd:c=>(c&Ie)===Ie,neg:c=>Ce(-c,t),eql:(c,f)=>c===f,sqr:c=>Ce(c*c,t),add:(c,f)=>Ce(c+f,t),sub:(c,f)=>Ce(c-f,t),mul:(c,f)=>Ce(c*f,t),pow:(c,f)=>jA(a,c,f),div:(c,f)=>Ce(c*Y1(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>Y1(c,t),sqrt:n.sqrt||(c=>(o||(o=LA(t)),o(a,c))),invertBatch:c=>qA(a,c),cmov:(c,f,l)=>l?f:c,toBytes:c=>r?Fd(c,i):_3(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?zf(c):OA(c)}});return Object.freeze(a)}const W1=BigInt(0),nf=BigInt(1);function Tu(t,e){const r=e.negate();return t?r:e}function P3(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Lu(t,e){P3(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function zA(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function MA(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Nu=new WeakMap,C3=new WeakMap;function ku(t){return C3.get(t)||1}function HA(t,e){return{constTimeNegate:Tu,hasPrecomputes(r){return ku(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>W1;)n&nf&&(s=s.add(i)),i=i.double(),n>>=nf;return s},precomputeWindow(r,n){const{windows:s,windowSize:i}=Lu(n,e),o=[];let a=r,c=a;for(let f=0;f<s;f++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){const{windows:i,windowSize:o}=Lu(r,e);let a=t.ZERO,c=t.BASE;const f=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let u=0;u<i;u++){const d=u*o;let g=Number(s&f);s>>=h,g>o&&(g-=l,s+=nf);const b=d,E=d+Math.abs(g)-1,U=u%2!==0,L=g<0;g===0?c=c.add(Tu(U,n[b])):a=a.add(Tu(L,n[E]))}return{p:a,f:c}},wNAFUnsafe(r,n,s,i=t.ZERO){const{windows:o,windowSize:a}=Lu(r,e),c=BigInt(2**r-1),f=2**r,l=BigInt(r);for(let h=0;h<o;h++){const u=h*a;if(s===W1)break;let d=Number(s&c);if(s>>=l,d>a&&(d-=f,s+=nf),d===0)continue;let g=n[u+Math.abs(d)-1];d<0&&(g=g.negate()),i=i.add(g)}return i},getPrecomputes(r,n,s){let i=Nu.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&Nu.set(n,s(i))),i},wNAFCached(r,n,s){const i=ku(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){const o=ku(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){P3(n,e),C3.set(r,n),Nu.delete(r)}}}function VA(t,e,r,n){if(zA(r,t),MA(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,i=FA(BigInt(r.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),f=Math.floor((e.BITS-1)/o)*o;let l=s;for(let h=f;h>=0;h-=o){c.fill(s);for(let d=0;d<n.length;d++){const g=n[d],b=Number(g>>BigInt(h)&BigInt(a));c[b]=c[b].add(r[d])}let u=s;for(let d=c.length-1,g=s;d>0;d--)g=g.add(c[d]),u=u.add(g);if(l=l.add(u),h!==0)for(let d=0;d<o;d++)l=l.double()}return l}function KA(t){return DA(t.Fp),O0(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...F3(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const mr=BigInt(0),_t=BigInt(1),sf=BigInt(2),GA=BigInt(8),ZA={zip215:!0};function YA(t){const e=KA(t);return O0(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function WA(t){const e=YA(t),{Fp:r,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,f=sf<<BigInt(a*8)-_t,l=r.create,h=U3(e.n,e.nBitLength),u=e.uvRatio||((y,p)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(p))}}catch{return{isValid:!1,value:mr}}}),d=e.adjustScalarBytes||(y=>y),g=e.domain||((y,p,v)=>{if(Cu("phflag",v),p.length||v)throw new Error("Contexts/pre-hash are not supported");return y});function b(y,p){Ba("coordinate "+y,p,mr,f)}function E(y){if(!(y instanceof $))throw new Error("ExtendedPoint expected")}const U=K1((y,p)=>{const{ex:v,ey:I,ez:w}=y,B=y.is0();p==null&&(p=B?GA:r.inv(w));const O=l(v*p),_=l(I*p),k=l(w*p);if(B)return{x:mr,y:_t};if(k!==_t)throw new Error("invZ was invalid");return{x:O,y:_}}),L=K1(y=>{const{a:p,d:v}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:I,ey:w,ez:B,et:O}=y,_=l(I*I),k=l(w*w),D=l(B*B),N=l(D*D),z=l(_*p),H=l(D*l(z+k)),V=l(N+l(v*l(_*k)));if(H!==V)throw new Error("bad point: equation left != right (1)");const M=l(I*w),K=l(B*O);if(M!==K)throw new Error("bad point: equation left != right (2)");return!0});class ${constructor(p,v,I,w){this.ex=p,this.ey=v,this.ez=I,this.et=w,b("x",p),b("y",v),b("z",I),b("t",w),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(p){if(p instanceof $)throw new Error("extended point not allowed");const{x:v,y:I}=p||{};return b("x",v),b("y",I),new $(v,I,_t,l(v*I))}static normalizeZ(p){const v=r.invertBatch(p.map(I=>I.ez));return p.map((I,w)=>I.toAffine(v[w])).map($.fromAffine)}static msm(p,v){return VA($,h,p,v)}_setWindowSize(p){C.setWindowSize(this,p)}assertValidity(){L(this)}equals(p){E(p);const{ex:v,ey:I,ez:w}=this,{ex:B,ey:O,ez:_}=p,k=l(v*_),D=l(B*w),N=l(I*_),z=l(O*w);return k===D&&N===z}is0(){return this.equals($.ZERO)}negate(){return new $(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:p}=e,{ex:v,ey:I,ez:w}=this,B=l(v*v),O=l(I*I),_=l(sf*l(w*w)),k=l(p*B),D=v+I,N=l(l(D*D)-B-O),z=k+O,H=z-_,V=k-O,M=l(N*H),K=l(z*V),Q=l(N*V),te=l(H*z);return new $(M,K,te,Q)}add(p){E(p);const{a:v,d:I}=e,{ex:w,ey:B,ez:O,et:_}=this,{ex:k,ey:D,ez:N,et:z}=p;if(v===BigInt(-1)){const ur=l((B-w)*(D+k)),hr=l((B+w)*(D-k)),Et=l(hr-ur);if(Et===mr)return this.double();const dr=l(O*sf*z),pr=l(_*sf*N),gr=pr+dr,yr=hr+ur,br=pr-dr,Bi=l(gr*Et),Ai=l(yr*br),Si=l(gr*br),Oi=l(Et*yr);return new $(Bi,Ai,Oi,Si)}const H=l(w*k),V=l(B*D),M=l(_*I*z),K=l(O*N),Q=l((w+B)*(k+D)-H-V),te=K-M,re=K+M,le=l(V-v*H),nt=l(Q*te),Mr=l(re*le),$i=l(Q*le),Ii=l(te*re);return new $(nt,Mr,Ii,$i)}subtract(p){return this.add(p.negate())}wNAF(p){return C.wNAFCached(this,p,$.normalizeZ)}multiply(p){const v=p;Ba("scalar",v,_t,n);const{p:I,f:w}=this.wNAF(v);return $.normalizeZ([I,w])[0]}multiplyUnsafe(p,v=$.ZERO){const I=p;return Ba("scalar",I,mr,n),I===mr?P:this.is0()||I===_t?this:C.wNAFCachedUnsafe(this,I,$.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return C.unsafeLadder(this,n).is0()}toAffine(p){return U(this,p)}clearCofactor(){const{h:p}=e;return p===_t?this:this.multiplyUnsafe(p)}static fromHex(p,v=!1){const{d:I,a:w}=e,B=r.BYTES;p=gn("pointHex",p,B),Cu("zip215",v);const O=p.slice(),_=p[B-1];O[B-1]=_&-129;const k=zf(O),D=v?f:r.ORDER;Ba("pointHex.y",k,mr,D);const N=l(k*k),z=l(N-_t),H=l(I*N-w);let{isValid:V,value:M}=u(z,H);if(!V)throw new Error("Point.fromHex: invalid y coordinate");const K=(M&_t)===_t,Q=(_&128)!==0;if(!v&&M===mr&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==K&&(M=l(-M)),$.fromAffine({x:M,y:k})}static fromPrivateKey(p){return A(p).point}toRawBytes(){const{x:p,y:v}=this.toAffine(),I=Fd(v,r.BYTES);return I[I.length-1]|=p&_t?128:0,I}toHex(){return S0(this.toRawBytes())}}$.BASE=new $(e.Gx,e.Gy,_t,l(e.Gx*e.Gy)),$.ZERO=new $(mr,_t,_t,mr);const{BASE:F,ZERO:P}=$,C=HA($,a*8);function T(y){return Ce(y,n)}function R(y){return T(zf(y))}function A(y){const p=r.BYTES;y=gn("private key",y,p);const v=gn("hashed private key",i(y),2*p),I=d(v.slice(0,p)),w=v.slice(p,2*p),B=R(I),O=F.multiply(B),_=O.toRawBytes();return{head:I,prefix:w,scalar:B,point:O,pointBytes:_}}function j(y){return A(y).pointBytes}function q(y=new Uint8Array,...p){const v=V1(...p);return R(i(g(v,gn("context",y),!!s)))}function S(y,p,v={}){y=gn("message",y),s&&(y=s(y));const{prefix:I,scalar:w,pointBytes:B}=A(p),O=q(v.context,I,y),_=F.multiply(O).toRawBytes(),k=q(v.context,_,B,y),D=T(O+k*w);Ba("signature.s",D,mr,n);const N=V1(_,Fd(D,r.BYTES));return gn("result",N,r.BYTES*2)}const m=ZA;function x(y,p,v,I=m){const{context:w,zip215:B}=I,O=r.BYTES;y=gn("signature",y,2*O),p=gn("message",p),v=gn("publicKey",v,O),B!==void 0&&Cu("zip215",B),s&&(p=s(p));const _=zf(y.slice(O,2*O));let k,D,N;try{k=$.fromHex(v,B),D=$.fromHex(y.slice(0,O),B),N=F.multiplyUnsafe(_)}catch{return!1}if(!B&&k.isSmallOrder())return!1;const z=q(w,D.toRawBytes(),k.toRawBytes(),p);return D.add(k.multiplyUnsafe(z)).subtract(N).clearCofactor().equals($.ZERO)}return F._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:S,verify:x,ExtendedPoint:$,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,p=$.BASE){return p._setWindowSize(y),p.multiply(BigInt(3)),p}}}}BigInt(0),BigInt(1);const _0=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),X1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const XA=BigInt(1),J1=BigInt(2);BigInt(3);const JA=BigInt(5),QA=BigInt(8);function eS(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=_0,o=t*t%i*t%i,a=Kr(o,J1,i)*o%i,c=Kr(a,XA,i)*t%i,f=Kr(c,JA,i)*c%i,l=Kr(f,e,i)*f%i,h=Kr(l,r,i)*l%i,u=Kr(h,n,i)*h%i,d=Kr(u,s,i)*u%i,g=Kr(d,s,i)*u%i,b=Kr(g,e,i)*f%i;return{pow_p_5_8:Kr(b,J1,i)*t%i,b2:o}}function tS(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function rS(t,e){const r=_0,n=Ce(e*e*e,r),s=Ce(n*n*e,r),i=eS(t*s).pow_p_5_8;let o=Ce(t*n*i,r);const a=Ce(e*o*o,r),c=o,f=Ce(o*X1,r),l=a===t,h=a===Ce(-t,r),u=a===Ce(-t*X1,r);return l&&(o=c),(h||u)&&(o=f),NA(o,r)&&(o=Ce(-o,r)),{isValid:l||h,value:o}}const nS=U3(_0,void 0,!0),sS={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:nS,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:QA,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:BA,randomBytes:I3,adjustScalarBytes:tS,uvRatio:rS},R3=WA(sS),iS="EdDSA",oS="JWT",sl=".",Nl="base64url",T3="utf8",L3="utf8",aS=":",cS="did",fS="key",Q1="base58btc",lS="z",uS="K36",hS=32;function F0(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function N3(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?F0(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function k3(t,e){e||(e=t.reduce((s,i)=>s+i.length,0));const r=N3(e);let n=0;for(const s of t)r.set(s,n),n+=s.length;return F0(r)}function dS(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var b=0,E=0,U=0,L=g.length;U!==L&&g[U]===0;)U++,b++;for(var $=(L-U)*l+1>>>0,F=new Uint8Array($);U!==L;){for(var P=g[U],C=0,T=$-1;(P!==0||C<E)&&T!==-1;T--,C++)P+=256*F[T]>>>0,F[T]=P%a>>>0,P=P/a>>>0;if(P!==0)throw new Error("Non-zero carry");E=C,U++}for(var R=$-E;R!==$&&F[R]===0;)R++;for(var A=c.repeat(b);R<$;++R)A+=t.charAt(F[R]);return A}function u(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var b=0;if(g[b]!==" "){for(var E=0,U=0;g[b]===c;)E++,b++;for(var L=(g.length-b)*f+1>>>0,$=new Uint8Array(L);g[b];){var F=r[g.charCodeAt(b)];if(F===255)return;for(var P=0,C=L-1;(F!==0||P<U)&&C!==-1;C--,P++)F+=a*$[C]>>>0,$[C]=F%256>>>0,F=F/256>>>0;if(F!==0)throw new Error("Non-zero carry");U=P,b++}if(g[b]!==" "){for(var T=L-U;T!==L&&$[T]===0;)T++;for(var R=new Uint8Array(E+(L-T)),A=E;T!==L;)R[A++]=$[T++];return R}}}function d(g){var b=u(g);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:u,decode:d}}var pS=dS,gS=pS;const D3=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},yS=t=>new TextEncoder().encode(t),bS=t=>new TextDecoder().decode(t);let wS=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},mS=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return j3(this,e)}},vS=class{constructor(e){this.decoders=e}or(e){return j3(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const j3=(t,e)=>new vS({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let ES=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new wS(e,r,n),this.decoder=new mS(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const kl=({name:t,prefix:e,encode:r,decode:n})=>new ES(t,e,r,n),Fc=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:s}=gS(r,e);return kl({prefix:t,name:e,encode:n,decode:i=>D3(s(i))})},xS=(t,e,r,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,f=0;for(let l=0;l<i;++l){const h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},$S=(t,e,r)=>{const n=e[e.length-1]==="=",s=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},Qe=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>kl({prefix:e,name:t,encode(s){return $S(s,n,r)},decode(s){return xS(s,n,r,t)}}),IS=kl({prefix:"\0",name:"identity",encode:t=>bS(t),decode:t=>yS(t)});var BS=Object.freeze({__proto__:null,identity:IS});const AS=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var SS=Object.freeze({__proto__:null,base2:AS});const OS=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var _S=Object.freeze({__proto__:null,base8:OS});const FS=Fc({prefix:"9",name:"base10",alphabet:"0123456789"});var US=Object.freeze({__proto__:null,base10:FS});const PS=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),CS=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var RS=Object.freeze({__proto__:null,base16:PS,base16upper:CS});const TS=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),LS=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),NS=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),kS=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),DS=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),jS=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),qS=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zS=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),MS=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var HS=Object.freeze({__proto__:null,base32:TS,base32upper:LS,base32pad:NS,base32padupper:kS,base32hex:DS,base32hexupper:jS,base32hexpad:qS,base32hexpadupper:zS,base32z:MS});const VS=Fc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),KS=Fc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var GS=Object.freeze({__proto__:null,base36:VS,base36upper:KS});const ZS=Fc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),YS=Fc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var WS=Object.freeze({__proto__:null,base58btc:ZS,base58flickr:YS});const XS=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),JS=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),QS=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),eO=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var tO=Object.freeze({__proto__:null,base64:XS,base64pad:JS,base64url:QS,base64urlpad:eO});const q3=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),rO=q3.reduce((t,e,r)=>(t[r]=e,t),[]),nO=q3.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function sO(t){return t.reduce((e,r)=>(e+=rO[r],e),"")}function iO(t){const e=[];for(const r of t){const n=nO[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const oO=kl({prefix:"ðŸš€",name:"base256emoji",encode:sO,decode:iO});var aO=Object.freeze({__proto__:null,base256emoji:oO}),cO=z3,ey=128,fO=-128,lO=Math.pow(2,31);function z3(t,e,r){e=e||[],r=r||0;for(var n=r;t>=lO;)e[r++]=t&255|ey,t/=128;for(;t&fO;)e[r++]=t&255|ey,t>>>=7;return e[r]=t|0,z3.bytes=r-n+1,e}var uO=Pd,hO=128,ty=127;function Pd(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw Pd.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&ty)<<s:(o&ty)*Math.pow(2,s),s+=7}while(o>=hO);return Pd.bytes=i-n,r}var dO=Math.pow(2,7),pO=Math.pow(2,14),gO=Math.pow(2,21),yO=Math.pow(2,28),bO=Math.pow(2,35),wO=Math.pow(2,42),mO=Math.pow(2,49),vO=Math.pow(2,56),EO=Math.pow(2,63),xO=function(t){return t<dO?1:t<pO?2:t<gO?3:t<yO?4:t<bO?5:t<wO?6:t<mO?7:t<vO?8:t<EO?9:10},$O={encode:cO,decode:uO,encodingLength:xO},M3=$O;const ry=(t,e,r=0)=>(M3.encode(t,e,r),e),ny=t=>M3.encodingLength(t),Cd=(t,e)=>{const r=e.byteLength,n=ny(t),s=n+ny(r),i=new Uint8Array(s+r);return ry(t,i,0),ry(r,i,n),i.set(e,s),new IO(t,r,e,i)};let IO=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};const H3=({name:t,code:e,encode:r})=>new BO(t,e,r);let BO=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Cd(this.code,r):r.then(n=>Cd(this.code,n))}else throw Error("Unknown type, must be binary type")}};const V3=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),AO=H3({name:"sha2-256",code:18,encode:V3("SHA-256")}),SO=H3({name:"sha2-512",code:19,encode:V3("SHA-512")});var OO=Object.freeze({__proto__:null,sha256:AO,sha512:SO});const K3=0,_O="identity",G3=D3,FO=t=>Cd(K3,G3(t)),UO={code:K3,name:_O,encode:G3,digest:FO};var PO=Object.freeze({__proto__:null,identity:UO});new TextEncoder,new TextDecoder;const sy={...BS,...SS,..._S,...US,...RS,...HS,...GS,...WS,...tO,...aO};({...OO,...PO});function Z3(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const iy=Z3("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Du=Z3("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=N3(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Y3={utf8:iy,"utf-8":iy,hex:sy.base16,latin1:Du,ascii:Du,binary:Du,...sy};function Dl(t,e="utf8"){const r=Y3[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function ma(t,e="utf8"){const r=Y3[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?F0(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function oy(t){return Wf(Dl(ma(t,Nl),T3))}function il(t){return Dl(ma(Xp(t),T3),Nl)}function W3(t){const e=ma(uS,Q1),r=lS+Dl(k3([e,t]),Q1);return[cS,fS,r].join(aS)}function CO(t){return Dl(t,Nl)}function RO(t){return ma(t,Nl)}function TO(t){return ma([il(t.header),il(t.payload)].join(sl),L3)}function LO(t){return[il(t.header),il(t.payload),CO(t.signature)].join(sl)}function Rd(t){const e=t.split(sl),r=oy(e[0]),n=oy(e[1]),s=RO(e[2]),i=ma(e.slice(0,2).join(sl),L3);return{header:r,payload:n,signature:s,data:i}}function ay(t=I3(hS)){const e=R3.getPublicKey(t);return{secretKey:k3([t,e]),publicKey:e}}async function NO(t,e,r,n,s=Z.fromMiliseconds(Date.now())){const i={alg:iS,typ:oS},o=W3(n.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},f=TO({header:i,payload:c}),l=R3.sign(f,n.secretKey.slice(0,32));return LO({header:i,payload:c,signature:l})}function U0(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function X3(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?U0(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function nc(t,e){e||(e=t.reduce((s,i)=>s+i.length,0));const r=X3(e);let n=0;for(const s of t)r.set(s,n),n+=s.length;return U0(r)}function J3(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const cy=J3("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ju=J3("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=X3(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Q3={utf8:cy,"utf-8":cy,hex:Xf.base16,latin1:ju,ascii:ju,binary:ju,...Xf};function fr(t,e="utf8"){const r=Q3[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?U0(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Ht(t,e="utf8"){const r=Q3[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var kO={};const DO="ReactNative",Rr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},jO="js";function ol(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function go(){return!tr.getDocument()&&!!tr.getNavigator()&&navigator.product===DO}function qO(){return go()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function zO(){return go()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Uc(){return!ol()&&!!tr.getNavigator()&&!!tr.getDocument()}function jl(){return go()?Rr.reactNative:ol()?Rr.node:Uc()?Rr.browser:Rr.unknown}function fy(){var t;try{return go()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function MO(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!=null&&r.set(n,String(s))}),r.toString()}function HO(){return X2.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function VO(){if(jl()===Rr.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=a5();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function KO(){var t;const e=jl();return e===Rr.browser?[e,((t=tr.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function ev(t,e,r){const n=VO(),s=KO();return[[t,e].join("-"),[jO,r].join("-"),n,s].join("/")}function GO({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:s,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){const f=r.split("?"),l=ev(t,e,n),h={auth:s,ua:l,projectId:i,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},u=MO(f[1]||"",h);return f[0]+"?"+u}function Td(t){return Object.fromEntries(t.entries())}function Ld(t){return new Map(Object.entries(t))}function ZO(t=Z.FIVE_MINUTES,e){const r=Z.toMiliseconds(t||Z.FIVE_MINUTES);let n,s,i,o;return{resolve:a=>{i&&n&&(clearTimeout(i),n(a),o=Promise.resolve(a))},reject:a=>{i&&s&&(clearTimeout(i),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{const f=new Error(e);o=Promise.reject(f),c(f)},r),n=a,s=c})}}function fn(t,e,r){return new Promise(async(n,s)=>{const i=setTimeout(()=>s(new Error(r)),e);try{const o=await t;n(o)}catch(o){s(o)}clearTimeout(i)})}function tv(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function YO(t){return tv("topic",t)}function WO(t){return tv("id",t)}function XO(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function sc(t,e){return Z.fromMiliseconds(Date.now()+Z.toMiliseconds(t))}function ly(t){return Date.now()>=Z.toMiliseconds(t)}function qu(t,e){return`${t}${e?`:${e}`:""}`}function uy(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function rv(){return typeof process<"u"&&kO.IS_VITEST==="true"}function nv(t){return Buffer.from(t,"base64").toString("utf-8")}function JO(t){return new Promise(e=>setTimeout(e,t))}const of=BigInt(2**32-1),hy=BigInt(32);function sv(t,e=!1){return e?{h:Number(t&of),l:Number(t>>hy&of)}:{h:Number(t>>hy&of)|0,l:Number(t&of)|0}}function iv(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=sv(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const dy=(t,e,r)=>t>>>r,py=(t,e,r)=>t<<32-r|e>>>r,Ts=(t,e,r)=>t>>>r|e<<32-r,Ls=(t,e,r)=>t<<32-r|e>>>r,Ga=(t,e,r)=>t<<64-r|e>>>r-32,Za=(t,e,r)=>t>>>r-32|e<<64-r,QO=(t,e)=>e,e_=(t,e)=>t,t_=(t,e,r)=>t<<r|e>>>32-r,r_=(t,e,r)=>e<<r|t>>>32-r,n_=(t,e,r)=>e<<r-32|t>>>64-r,s_=(t,e,r)=>t<<r-32|e>>>64-r;function Fr(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const P0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),C0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,i_=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),o_=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,a_=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),c_=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,xo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ql(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Yn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function kr(t,...e){if(!ql(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function zl(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Yn(t.outputLen),Yn(t.blockLen)}function hi(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function R0(t,e){kr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function gc(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function lr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function zu(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Gr(t,e){return t<<32-e|t>>>e}const ov=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function av(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Sn=ov?t=>t:t=>av(t);function f_(t){for(let e=0;e<t.length;e++)t[e]=av(t[e]);return t}const Ns=ov?t=>t:f_,cv=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",l_=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Zo(t){if(kr(t),cv)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=l_[t[r]];return e}const yn={_0:48,_9:57,A:65,F:70,a:97,f:102};function gy(t){if(t>=yn._0&&t<=yn._9)return t-yn._0;if(t>=yn.A&&t<=yn.F)return t-(yn.A-10);if(t>=yn.a&&t<=yn.f)return t-(yn.a-10)}function al(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(cv)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=gy(t.charCodeAt(i)),a=gy(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function fv(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Tr(t){return typeof t=="string"&&(t=fv(t)),kr(t),t}function Gs(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];kr(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}let Ml=class{};function Pc(t){const e=n=>t().update(Tr(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function u_(t){const e=(n,s)=>t(s).update(Tr(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function yo(t=32){if(xo&&typeof xo.getRandomValues=="function")return xo.getRandomValues(new Uint8Array(t));if(xo&&typeof xo.randomBytes=="function")return Uint8Array.from(xo.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const h_=BigInt(0),Aa=BigInt(1),d_=BigInt(2),p_=BigInt(7),g_=BigInt(256),y_=BigInt(113),lv=[],uv=[],hv=[];for(let t=0,e=Aa,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],lv.push(2*(5*n+r)),uv.push((t+1)*(t+2)/2%64);let s=h_;for(let i=0;i<7;i++)e=(e<<Aa^(e>>p_)*y_)%g_,e&d_&&(s^=Aa<<(Aa<<BigInt(i))-Aa);hv.push(s)}const dv=iv(hv,!0),b_=dv[0],w_=dv[1],yy=(t,e,r)=>r>32?n_(t,e,r):t_(t,e,r),by=(t,e,r)=>r>32?s_(t,e,r):r_(t,e,r);function m_(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=r[c],l=r[c+1],h=yy(f,l,1)^r[a],u=by(f,l,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=u}let s=t[2],i=t[3];for(let o=0;o<24;o++){const a=uv[o],c=yy(s,i,a),f=by(s,i,a),l=lv[o];s=t[l],i=t[l+1],t[l]=c,t[l+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=b_[n],t[1]^=w_[n]}lr(r)}let v_=class pv extends Ml{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,Yn(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=gc(this.state)}clone(){return this._cloneInto()}keccak(){Ns(this.state32),m_(this.state32,this.rounds),Ns(this.state32),this.posOut=0,this.pos=0}update(e){hi(this),e=Tr(e),kr(e);const{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){hi(this,!1),kr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Yn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(R0(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,lr(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new pv(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const E_=(t,e,r)=>Pc(()=>new v_(e,t,r));E_(1,136,256/8);function x_(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function $_(t,e,r){return t&e^~t&r}function I_(t,e,r){return t&e^t&r^e&r}let gv=class extends Ml{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=zu(this.buffer)}update(e){hi(this),e=Tr(e),kr(e);const{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=zu(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){hi(this),R0(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,lr(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;x_(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=zu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const as=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),at=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),ct=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),B_=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),cs=new Uint32Array(64);let A_=class extends gv{constructor(e=32){super(64,e,8,!1),this.A=as[0]|0,this.B=as[1]|0,this.C=as[2]|0,this.D=as[3]|0,this.E=as[4]|0,this.F=as[5]|0,this.G=as[6]|0,this.H=as[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)cs[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const u=cs[h-15],d=cs[h-2],g=Gr(u,7)^Gr(u,18)^u>>>3,b=Gr(d,17)^Gr(d,19)^d>>>10;cs[h]=b+cs[h-7]+g+cs[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:f,H:l}=this;for(let h=0;h<64;h++){const u=Gr(a,6)^Gr(a,11)^Gr(a,25),d=l+u+$_(a,c,f)+B_[h]+cs[h]|0,g=(Gr(n,2)^Gr(n,13)^Gr(n,22))+I_(n,s,i)|0;l=f,f=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(n,s,i,o,a,c,f,l)}roundClean(){lr(cs)}destroy(){this.set(0,0,0,0,0,0,0,0),lr(this.buffer)}};const yv=iv(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),S_=yv[0],O_=yv[1],fs=new Uint32Array(80),ls=new Uint32Array(80);let T0=class extends gv{constructor(e=64){super(128,e,16,!1),this.Ah=ct[0]|0,this.Al=ct[1]|0,this.Bh=ct[2]|0,this.Bl=ct[3]|0,this.Ch=ct[4]|0,this.Cl=ct[5]|0,this.Dh=ct[6]|0,this.Dl=ct[7]|0,this.Eh=ct[8]|0,this.El=ct[9]|0,this.Fh=ct[10]|0,this.Fl=ct[11]|0,this.Gh=ct[12]|0,this.Gl=ct[13]|0,this.Hh=ct[14]|0,this.Hl=ct[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:f,El:l,Fh:h,Fl:u,Gh:d,Gl:g,Hh:b,Hl:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=l|0,this.Fh=h|0,this.Fl=u|0,this.Gh=d|0,this.Gl=g|0,this.Hh=b|0,this.Hl=E|0}process(e,r){for(let $=0;$<16;$++,r+=4)fs[$]=e.getUint32(r),ls[$]=e.getUint32(r+=4);for(let $=16;$<80;$++){const F=fs[$-15]|0,P=ls[$-15]|0,C=Ts(F,P,1)^Ts(F,P,8)^dy(F,P,7),T=Ls(F,P,1)^Ls(F,P,8)^py(F,P,7),R=fs[$-2]|0,A=ls[$-2]|0,j=Ts(R,A,19)^Ga(R,A,61)^dy(R,A,6),q=Ls(R,A,19)^Za(R,A,61)^py(R,A,6),S=i_(T,q,ls[$-7],ls[$-16]),m=o_(S,C,j,fs[$-7],fs[$-16]);fs[$]=m|0,ls[$]=S|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:f,Dl:l,Eh:h,El:u,Fh:d,Fl:g,Gh:b,Gl:E,Hh:U,Hl:L}=this;for(let $=0;$<80;$++){const F=Ts(h,u,14)^Ts(h,u,18)^Ga(h,u,41),P=Ls(h,u,14)^Ls(h,u,18)^Za(h,u,41),C=h&d^~h&b,T=u&g^~u&E,R=a_(L,P,T,O_[$],ls[$]),A=c_(R,U,F,C,S_[$],fs[$]),j=R|0,q=Ts(n,s,28)^Ga(n,s,34)^Ga(n,s,39),S=Ls(n,s,28)^Za(n,s,34)^Za(n,s,39),m=n&i^n&a^i&a,x=s&o^s&c^o&c;U=b|0,L=E|0,b=d|0,E=g|0,d=h|0,g=u|0,{h,l:u}=Fr(f|0,l|0,A|0,j|0),f=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const y=P0(j,S,x);n=C0(y,A,q,m),s=y|0}({h:n,l:s}=Fr(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Fr(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Fr(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l}=Fr(this.Dh|0,this.Dl|0,f|0,l|0),{h,l:u}=Fr(this.Eh|0,this.El|0,h|0,u|0),{h:d,l:g}=Fr(this.Fh|0,this.Fl|0,d|0,g|0),{h:b,l:E}=Fr(this.Gh|0,this.Gl|0,b|0,E|0),{h:U,l:L}=Fr(this.Hh|0,this.Hl|0,U|0,L|0),this.set(n,s,i,o,a,c,f,l,h,u,d,g,b,E,U,L)}roundClean(){lr(fs,ls)}destroy(){lr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},__=class extends T0{constructor(){super(48),this.Ah=at[0]|0,this.Al=at[1]|0,this.Bh=at[2]|0,this.Bl=at[3]|0,this.Ch=at[4]|0,this.Cl=at[5]|0,this.Dh=at[6]|0,this.Dl=at[7]|0,this.Eh=at[8]|0,this.El=at[9]|0,this.Fh=at[10]|0,this.Fl=at[11]|0,this.Gh=at[12]|0,this.Gl=at[13]|0,this.Hh=at[14]|0,this.Hl=at[15]|0}};const ft=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);let F_=class extends T0{constructor(){super(32),this.Ah=ft[0]|0,this.Al=ft[1]|0,this.Bh=ft[2]|0,this.Bl=ft[3]|0,this.Ch=ft[4]|0,this.Cl=ft[5]|0,this.Dh=ft[6]|0,this.Dl=ft[7]|0,this.Eh=ft[8]|0,this.El=ft[9]|0,this.Fh=ft[10]|0,this.Fl=ft[11]|0,this.Gh=ft[12]|0,this.Gl=ft[13]|0,this.Hh=ft[14]|0,this.Hl=ft[15]|0}};const bv=Pc(()=>new A_),U_=Pc(()=>new T0),P_=Pc(()=>new __);Pc(()=>new F_);const C_=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),_e=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),W=new Uint32Array(32);function us(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=W[2*t],f=W[2*t+1],l=W[2*e],h=W[2*e+1],u=W[2*r],d=W[2*r+1],g=W[2*n],b=W[2*n+1],E=P0(c,l,o);f=C0(E,f,h,a),c=E|0,{Dh:b,Dl:g}={Dh:b^f,Dl:g^c},{Dh:b,Dl:g}={Dh:QO(b,g),Dl:e_(b)},{h:d,l:u}=Fr(d,u,b,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^u},{Bh:h,Bl:l}={Bh:Ts(h,l,24),Bl:Ls(h,l,24)},W[2*t]=c,W[2*t+1]=f,W[2*e]=l,W[2*e+1]=h,W[2*r]=u,W[2*r+1]=d,W[2*n]=g,W[2*n+1]=b}function hs(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=W[2*t],f=W[2*t+1],l=W[2*e],h=W[2*e+1],u=W[2*r],d=W[2*r+1],g=W[2*n],b=W[2*n+1],E=P0(c,l,o);f=C0(E,f,h,a),c=E|0,{Dh:b,Dl:g}={Dh:b^f,Dl:g^c},{Dh:b,Dl:g}={Dh:Ts(b,g,16),Dl:Ls(b,g,16)},{h:d,l:u}=Fr(d,u,b,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^u},{Bh:h,Bl:l}={Bh:Ga(h,l,63),Bl:Za(h,l,63)},W[2*t]=c,W[2*t+1]=f,W[2*e]=l,W[2*e+1]=h,W[2*r]=u,W[2*r+1]=d,W[2*n]=g,W[2*n+1]=b}function R_(t,e={},r,n,s){if(Yn(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}let T_=class extends Ml{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Yn(e),Yn(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=gc(this.buffer)}update(e){hi(this),e=Tr(e),kr(e);const{blockLen:r,buffer:n,buffer32:s}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===r&&(Ns(s),this.compress(s,0,!1),Ns(s),this.pos=0);const f=Math.min(r-this.pos,i-c),l=o+c;if(f===r&&!(l%4)&&c+f<i){const h=new Uint32Array(a,l,Math.floor((i-c)/4));Ns(h);for(let u=0;c+r<i;u+=s.length,c+=r)this.length+=r,this.compress(h,u,!1);Ns(h);continue}n.set(e.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(e){hi(this),R0(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,lr(this.buffer.subarray(r)),Ns(n),this.compress(n,0,!0),Ns(n);const s=gc(e);this.get().forEach((i,o)=>s[o]=Sn(i))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:s,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=i,e.finished=s,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},L_=class extends T_{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=_e[0]|0,this.v0h=_e[1]|0,this.v1l=_e[2]|0,this.v1h=_e[3]|0,this.v2l=_e[4]|0,this.v2h=_e[5]|0,this.v3l=_e[6]|0,this.v3h=_e[7]|0,this.v4l=_e[8]|0,this.v4h=_e[9]|0,this.v5l=_e[10]|0,this.v5h=_e[11]|0,this.v6l=_e[12]|0,this.v6h=_e[13]|0,this.v7l=_e[14]|0,this.v7h=_e[15]|0,R_(r,e,64,16,16);let{key:n,personalization:s,salt:i}=e,o=0;if(n!==void 0&&(n=Tr(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=Tr(i);const a=gc(i);this.v4l^=Sn(a[0]),this.v4h^=Sn(a[1]),this.v5l^=Sn(a[2]),this.v5h^=Sn(a[3])}if(s!==void 0){s=Tr(s);const a=gc(s);this.v6l^=Sn(a[0]),this.v6h^=Sn(a[1]),this.v7l^=Sn(a[2]),this.v7h^=Sn(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:s,v2l:i,v2h:o,v3l:a,v3h:c,v4l:f,v4h:l,v5l:h,v5h:u,v6l:d,v6h:g,v7l:b,v7h:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=l|0,this.v5l=h|0,this.v5h=u|0,this.v6l=d|0,this.v6h=g|0,this.v7l=b|0,this.v7h=E|0}compress(e,r,n){this.get().forEach((c,f)=>W[f]=c),W.set(_e,16);let{h:s,l:i}=sv(BigInt(this.length));W[24]=_e[8]^i,W[25]=_e[9]^s,n&&(W[28]=~W[28],W[29]=~W[29]);let o=0;const a=C_;for(let c=0;c<12;c++)us(0,4,8,12,e,r+2*a[o++]),hs(0,4,8,12,e,r+2*a[o++]),us(1,5,9,13,e,r+2*a[o++]),hs(1,5,9,13,e,r+2*a[o++]),us(2,6,10,14,e,r+2*a[o++]),hs(2,6,10,14,e,r+2*a[o++]),us(3,7,11,15,e,r+2*a[o++]),hs(3,7,11,15,e,r+2*a[o++]),us(0,5,10,15,e,r+2*a[o++]),hs(0,5,10,15,e,r+2*a[o++]),us(1,6,11,12,e,r+2*a[o++]),hs(1,6,11,12,e,r+2*a[o++]),us(2,7,8,13,e,r+2*a[o++]),hs(2,7,8,13,e,r+2*a[o++]),us(3,4,9,14,e,r+2*a[o++]),hs(3,4,9,14,e,r+2*a[o++]);this.v0l^=W[0]^W[16],this.v0h^=W[1]^W[17],this.v1l^=W[2]^W[18],this.v1h^=W[3]^W[19],this.v2l^=W[4]^W[20],this.v2h^=W[5]^W[21],this.v3l^=W[6]^W[22],this.v3h^=W[7]^W[23],this.v4l^=W[8]^W[24],this.v4h^=W[9]^W[25],this.v5l^=W[10]^W[26],this.v5h^=W[11]^W[27],this.v6l^=W[12]^W[28],this.v6h^=W[13]^W[29],this.v7l^=W[14]^W[30],this.v7h^=W[15]^W[31],lr(W)}destroy(){this.destroyed=!0,lr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};u_(t=>new L_(t));function wv(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Nd(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Mu(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Tt(t,...e){if(!wv(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function wy(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function N_(t,e){Tt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ai(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function aa(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function k_(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const D_=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function j_(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function kd(t){if(typeof t=="string")t=j_(t);else if(wv(t))t=Dd(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function q_(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function z_(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const M_=(t,e)=>{function r(n,...s){if(Tt(n),!D_)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const f=s[0];if(!f)throw new Error("nonce / iv required");t.varSizeNonce?Tt(f):Tt(f,t.nonceLength)}const i=t.tagLength;i&&s[1]!==void 0&&Tt(s[1]);const o=e(n,...s),a=(f,l)=>{if(l!==void 0){if(f!==2)throw new Error("cipher output not supported");Tt(l)}};let c=!1;return{encrypt(f,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Tt(f),a(o.encrypt.length,l),o.encrypt(f,l)},decrypt(f,l){if(Tt(f),i&&f.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,l),o.decrypt(f,l)}}}return Object.assign(r,t),r};function my(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!V_(e))throw new Error("invalid output, must be aligned");return e}function vy(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function H_(t,e,r){Nd(r);const n=new Uint8Array(16),s=k_(n);return vy(s,0,BigInt(e),r),vy(s,8,BigInt(t),r),n}function V_(t){return t.byteOffset%4===0}function Dd(t){return Uint8Array.from(t)}const mv=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),K_=mv("expand 16-byte k"),G_=mv("expand 32-byte k"),Z_=ai(K_),Y_=ai(G_);function he(t,e){return t<<e|t>>>32-e}function jd(t){return t.byteOffset%4===0}const af=64,W_=16,vv=2**32-1,Ey=new Uint32Array;function X_(t,e,r,n,s,i,o,a){const c=s.length,f=new Uint8Array(af),l=ai(f),h=jd(s)&&jd(i),u=h?ai(s):Ey,d=h?ai(i):Ey;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=vv)throw new Error("arx: counter overflow");const b=Math.min(af,c-g);if(h&&b===af){const E=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let U=0,L;U<W_;U++)L=E+U,d[L]=u[L]^l[U];g+=af;continue}for(let E=0,U;E<b;E++)U=g+E,i[U]=s[U]^f[E];g+=b}}function J_(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=q_({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Mu(s),Mu(o),Nd(i),Nd(r),(a,c,f,l,h=0)=>{Tt(a),Tt(c),Tt(f);const u=f.length;if(l===void 0&&(l=new Uint8Array(u)),Tt(l),Mu(h),h<0||h>=vv)throw new Error("arx: counter overflow");if(l.length<u)throw new Error(`arx: output (${l.length}) is shorter than data (${u})`);const d=[];let g=a.length,b,E;if(g===32)d.push(b=Dd(a)),E=Y_;else if(g===16&&r)b=new Uint8Array(32),b.set(a),b.set(a,16),E=Z_,d.push(b);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);jd(c)||d.push(c=Dd(c));const U=ai(b);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(E,U,ai(c.subarray(0,16)),U),c=c.subarray(16)}const L=16-s;if(L!==c.length)throw new Error(`arx: nonce must be ${L} or 16 bytes`);if(L!==12){const F=new Uint8Array(12);F.set(c,i?0:12-c.length),c=F,d.push(c)}const $=ai(c);return X_(t,E,U,$,f,l,h,o),aa(...d),l}}const Ve=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let Q_=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=kd(e),Tt(e,32);const r=Ve(e,0),n=Ve(e,2),s=Ve(e,4),i=Ve(e,6),o=Ve(e,8),a=Ve(e,10),c=Ve(e,12),f=Ve(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Ve(e,16+2*l)}process(e,r,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],f=o[2],l=o[3],h=o[4],u=o[5],d=o[6],g=o[7],b=o[8],E=o[9],U=Ve(e,r+0),L=Ve(e,r+2),$=Ve(e,r+4),F=Ve(e,r+6),P=Ve(e,r+8),C=Ve(e,r+10),T=Ve(e,r+12),R=Ve(e,r+14);let A=i[0]+(U&8191),j=i[1]+((U>>>13|L<<3)&8191),q=i[2]+((L>>>10|$<<6)&8191),S=i[3]+(($>>>7|F<<9)&8191),m=i[4]+((F>>>4|P<<12)&8191),x=i[5]+(P>>>1&8191),y=i[6]+((P>>>14|C<<2)&8191),p=i[7]+((C>>>11|T<<5)&8191),v=i[8]+((T>>>8|R<<8)&8191),I=i[9]+(R>>>5|s),w=0,B=w+A*a+j*(5*E)+q*(5*b)+S*(5*g)+m*(5*d);w=B>>>13,B&=8191,B+=x*(5*u)+y*(5*h)+p*(5*l)+v*(5*f)+I*(5*c),w+=B>>>13,B&=8191;let O=w+A*c+j*a+q*(5*E)+S*(5*b)+m*(5*g);w=O>>>13,O&=8191,O+=x*(5*d)+y*(5*u)+p*(5*h)+v*(5*l)+I*(5*f),w+=O>>>13,O&=8191;let _=w+A*f+j*c+q*a+S*(5*E)+m*(5*b);w=_>>>13,_&=8191,_+=x*(5*g)+y*(5*d)+p*(5*u)+v*(5*h)+I*(5*l),w+=_>>>13,_&=8191;let k=w+A*l+j*f+q*c+S*a+m*(5*E);w=k>>>13,k&=8191,k+=x*(5*b)+y*(5*g)+p*(5*d)+v*(5*u)+I*(5*h),w+=k>>>13,k&=8191;let D=w+A*h+j*l+q*f+S*c+m*a;w=D>>>13,D&=8191,D+=x*(5*E)+y*(5*b)+p*(5*g)+v*(5*d)+I*(5*u),w+=D>>>13,D&=8191;let N=w+A*u+j*h+q*l+S*f+m*c;w=N>>>13,N&=8191,N+=x*a+y*(5*E)+p*(5*b)+v*(5*g)+I*(5*d),w+=N>>>13,N&=8191;let z=w+A*d+j*u+q*h+S*l+m*f;w=z>>>13,z&=8191,z+=x*c+y*a+p*(5*E)+v*(5*b)+I*(5*g),w+=z>>>13,z&=8191;let H=w+A*g+j*d+q*u+S*h+m*l;w=H>>>13,H&=8191,H+=x*f+y*c+p*a+v*(5*E)+I*(5*b),w+=H>>>13,H&=8191;let V=w+A*b+j*g+q*d+S*u+m*h;w=V>>>13,V&=8191,V+=x*l+y*f+p*c+v*a+I*(5*E),w+=V>>>13,V&=8191;let M=w+A*E+j*b+q*g+S*d+m*u;w=M>>>13,M&=8191,M+=x*h+y*l+p*f+v*c+I*a,w+=M>>>13,M&=8191,w=(w<<2)+w|0,w=w+B|0,B=w&8191,w=w>>>13,O+=w,i[0]=B,i[1]=O,i[2]=_,i[3]=k,i[4]=D,i[5]=N,i[6]=z,i[7]=H,i[8]=V,i[9]=M}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;aa(n)}update(e){wy(this),e=kd(e),Tt(e);const{buffer:r,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){aa(this.h,this.r,this.buffer,this.pad)}digestInto(e){wy(this),N_(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}};function eF(t){const e=(n,s)=>t(s).update(kd(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const tF=eF(t=>new Q_(t));function rF(t,e,r,n,s,i=20){let o=t[0],a=t[1],c=t[2],f=t[3],l=e[0],h=e[1],u=e[2],d=e[3],g=e[4],b=e[5],E=e[6],U=e[7],L=s,$=r[0],F=r[1],P=r[2],C=o,T=a,R=c,A=f,j=l,q=h,S=u,m=d,x=g,y=b,p=E,v=U,I=L,w=$,B=F,O=P;for(let k=0;k<i;k+=2)C=C+j|0,I=he(I^C,16),x=x+I|0,j=he(j^x,12),C=C+j|0,I=he(I^C,8),x=x+I|0,j=he(j^x,7),T=T+q|0,w=he(w^T,16),y=y+w|0,q=he(q^y,12),T=T+q|0,w=he(w^T,8),y=y+w|0,q=he(q^y,7),R=R+S|0,B=he(B^R,16),p=p+B|0,S=he(S^p,12),R=R+S|0,B=he(B^R,8),p=p+B|0,S=he(S^p,7),A=A+m|0,O=he(O^A,16),v=v+O|0,m=he(m^v,12),A=A+m|0,O=he(O^A,8),v=v+O|0,m=he(m^v,7),C=C+q|0,O=he(O^C,16),p=p+O|0,q=he(q^p,12),C=C+q|0,O=he(O^C,8),p=p+O|0,q=he(q^p,7),T=T+S|0,I=he(I^T,16),v=v+I|0,S=he(S^v,12),T=T+S|0,I=he(I^T,8),v=v+I|0,S=he(S^v,7),R=R+m|0,w=he(w^R,16),x=x+w|0,m=he(m^x,12),R=R+m|0,w=he(w^R,8),x=x+w|0,m=he(m^x,7),A=A+j|0,B=he(B^A,16),y=y+B|0,j=he(j^y,12),A=A+j|0,B=he(B^A,8),y=y+B|0,j=he(j^y,7);let _=0;n[_++]=o+C|0,n[_++]=a+T|0,n[_++]=c+R|0,n[_++]=f+A|0,n[_++]=l+j|0,n[_++]=h+q|0,n[_++]=u+S|0,n[_++]=d+m|0,n[_++]=g+x|0,n[_++]=b+y|0,n[_++]=E+p|0,n[_++]=U+v|0,n[_++]=L+I|0,n[_++]=$+w|0,n[_++]=F+B|0,n[_++]=P+O|0}const nF=J_(rF,{counterRight:!1,counterLength:4,allowShortKeys:!1}),sF=new Uint8Array(16),xy=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(sF.subarray(r))},iF=new Uint8Array(32);function $y(t,e,r,n,s){const i=t(e,r,iF),o=tF.create(i);s&&xy(o,s),xy(o,n);const a=H_(n.length,s?s.length:0,!0);o.update(a);const c=o.digest();return aa(i,a),c}const oF=t=>(e,r,n)=>({encrypt(s,i){const o=s.length;i=my(o+16,i,!1),i.set(s);const a=i.subarray(0,-16);t(e,r,a,a,1);const c=$y(t,e,r,a,n);return i.set(c,o),aa(c),i},decrypt(s,i){i=my(s.length-16,i,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=$y(t,e,r,o,n);if(!z_(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),t(e,r,i,i,1),aa(c),i}}),Ev=M_({blockSize:64,nonceLength:12,tagLength:16},oF(nF));let xv=class extends Ml{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,zl(e);const n=Tr(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),lr(i)}update(e){return hi(this),this.iHash.update(e),this}digestInto(e){hi(this),kr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Hl=(t,e,r)=>new xv(t,e).update(r).digest();Hl.create=(t,e)=>new xv(t,e);function aF(t,e,r){return zl(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Hl(t,Tr(r),Tr(e))}const Hu=Uint8Array.from([0]),Iy=Uint8Array.of();function cF(t,e,r,n=32){zl(t),Yn(n);const s=t.outputLen;if(n>255*s)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/s);r===void 0&&(r=Iy);const o=new Uint8Array(i*s),a=Hl.create(t,e),c=a._cloneInto(),f=new Uint8Array(a.outputLen);for(let l=0;l<i;l++)Hu[0]=l+1,c.update(l===0?Iy:f).update(r).update(Hu).digestInto(f),o.set(f,s*l),a._cloneInto(c);return a.destroy(),c.destroy(),lr(f,Hu),o.slice(0,n)}const fF=(t,e,r,n,s)=>cF(t,aF(t,e,r),n,s),Vl=bv,L0=BigInt(0),qd=BigInt(1);function cl(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Gi(t,e,r=""){const n=ql(t),s=t?.length,i=e!==void 0;if(!n||i&&s!==e){const o=r&&`"${r}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function cf(t){const e=t.toString(16);return e.length&1?"0"+e:e}function $v(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?L0:BigInt("0x"+t)}function Kl(t){return $v(Zo(t))}function fl(t){return kr(t),$v(Zo(Uint8Array.from(t).reverse()))}function N0(t,e){return al(t.toString(16).padStart(e*2,"0"))}function k0(t,e){return N0(t,e).reverse()}function wt(t,e,r){let n;if(typeof e=="string")try{n=al(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(ql(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}const Vu=t=>typeof t=="bigint"&&L0<=t;function lF(t,e,r){return Vu(t)&&Vu(e)&&Vu(r)&&e<=t&&t<r}function zd(t,e,r,n){if(!lF(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Iv(t){let e;for(e=0;t>L0;t>>=qd,e+=1);return e}const Cc=t=>(qd<<BigInt(t))-qd;function uF(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=u=>new Uint8Array(u),s=u=>Uint8Array.of(u);let i=n(t),o=n(t),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},f=(...u)=>r(o,i,...u),l=(u=n(0))=>{o=f(s(0),u),i=f(),u.length!==0&&(o=f(s(1),u),i=f())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){i=f();const g=i.slice();d.push(g),u+=i.length}return Gs(...d)};return(u,d)=>{c(),l(u);let g;for(;!(g=d(h()));)l();return c(),g}}function Gl(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(s,i,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([s,i])=>n(s,i,!1)),Object.entries(r).forEach(([s,i])=>n(s,i,!0))}function By(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const jt=BigInt(0),$t=BigInt(1),Zi=BigInt(2),Bv=BigInt(3),Av=BigInt(4),Sv=BigInt(5),hF=BigInt(7),Ov=BigInt(8),dF=BigInt(9),_v=BigInt(16);function Wt(t,e){const r=t%e;return r>=jt?r:e+r}function Ar(t,e,r){let n=t;for(;e-- >jt;)n*=n,n%=r;return n}function Ay(t,e){if(t===jt)throw new Error("invert: expected non-zero number");if(e<=jt)throw new Error("invert: expected positive modulus, got "+e);let r=Wt(t,e),n=e,s=jt,i=$t;for(;r!==jt;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==$t)throw new Error("invert: does not exist");return Wt(s,e)}function D0(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Fv(t,e){const r=(t.ORDER+$t)/Av,n=t.pow(e,r);return D0(t,n,e),n}function pF(t,e){const r=(t.ORDER-Sv)/Ov,n=t.mul(e,Zi),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,Zi),s),a=t.mul(i,t.sub(o,t.ONE));return D0(t,a,e),a}function gF(t){const e=vi(t),r=Uv(t),n=r(e,e.neg(e.ONE)),s=r(e,n),i=r(e,e.neg(n)),o=(t+hF)/_v;return(a,c)=>{let f=a.pow(c,o),l=a.mul(f,n);const h=a.mul(f,s),u=a.mul(f,i),d=a.eql(a.sqr(l),c),g=a.eql(a.sqr(h),c);f=a.cmov(f,l,d),l=a.cmov(u,h,g);const b=a.eql(a.sqr(l),c),E=a.cmov(f,l,b);return D0(a,E,c),E}}function Uv(t){if(t<Bv)throw new Error("sqrt is not defined for small field");let e=t-$t,r=0;for(;e%Zi===jt;)e/=Zi,r++;let n=Zi;const s=vi(t);for(;Sy(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Fv;let i=s.pow(n,e);const o=(e+$t)/Zi;return function(a,c){if(a.is0(c))return c;if(Sy(a,c)!==1)throw new Error("Cannot find square root");let f=r,l=a.mul(a.ONE,i),h=a.pow(c,e),u=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,g=a.sqr(h);for(;!a.eql(g,a.ONE);)if(d++,g=a.sqr(g),d===f)throw new Error("Cannot find square root");const b=$t<<BigInt(f-d-1),E=a.pow(l,b);f=d,l=a.sqr(E),h=a.mul(h,l),u=a.mul(u,E)}return u}}function yF(t){return t%Av===Bv?Fv:t%Ov===Sv?pF:t%_v===dF?gF(t):Uv(t)}const bF=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function wF(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=bF.reduce((n,s)=>(n[s]="function",n),e);return Gl(t,r),t}function mF(t,e,r){if(r<jt)throw new Error("invalid exponent, negatives unsupported");if(r===jt)return t.ONE;if(r===$t)return e;let n=t.ONE,s=e;for(;r>jt;)r&$t&&(n=t.mul(n,s)),s=t.sqr(s),r>>=$t;return n}function Pv(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function Sy(t,e){const r=(t.ORDER-$t)/Zi,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function Cv(t,e){e!==void 0&&Yn(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function vi(t,e,r=!1,n={}){if(t<=jt)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const u=e;u.BITS&&(s=u.BITS),u.sqrt&&(i=u.sqrt),typeof u.isLE=="boolean"&&(r=u.isLE),typeof u.modFromBytes=="boolean"&&(o=u.modFromBytes),a=u.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:f}=Cv(t,s);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:f,MASK:Cc(c),ZERO:jt,ONE:$t,allowedLengths:a,create:u=>Wt(u,t),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return jt<=u&&u<t},is0:u=>u===jt,isValidNot0:u=>!h.is0(u)&&h.isValid(u),isOdd:u=>(u&$t)===$t,neg:u=>Wt(-u,t),eql:(u,d)=>u===d,sqr:u=>Wt(u*u,t),add:(u,d)=>Wt(u+d,t),sub:(u,d)=>Wt(u-d,t),mul:(u,d)=>Wt(u*d,t),pow:(u,d)=>mF(h,u,d),div:(u,d)=>Wt(u*Ay(d,t),t),sqrN:u=>u*u,addN:(u,d)=>u+d,subN:(u,d)=>u-d,mulN:(u,d)=>u*d,inv:u=>Ay(u,t),sqrt:i||(u=>(l||(l=yF(t)),l(h,u))),toBytes:u=>r?k0(u,f):N0(u,f),fromBytes:(u,d=!0)=>{if(a){if(!a.includes(u.length)||u.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);const b=new Uint8Array(f);b.set(u,r?0:b.length-u.length),u=b}if(u.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+u.length);let g=r?fl(u):Kl(u);if(o&&(g=Wt(g,t)),!d&&!h.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:u=>Pv(h,u),cmov:(u,d,g)=>g?d:u});return Object.freeze(h)}function Rv(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Tv(t){const e=Rv(t);return e+Math.ceil(e/2)}function vF(t,e,r=!1){const n=t.length,s=Rv(e),i=Tv(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?fl(t):Kl(t),a=Wt(o,e-$t)+$t;return r?k0(a,s):N0(a,s)}const ca=BigInt(0),Yi=BigInt(1);function ll(t,e){const r=e.negate();return t?r:e}function Ku(t,e){const r=Pv(t.Fp,e.map(n=>n.Z));return e.map((n,s)=>t.fromAffine(n.toAffine(r[s])))}function Lv(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Gu(t,e){Lv(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=Cc(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function Oy(t,e,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=Yi);const f=e*n,l=f+Math.abs(a)-1,h=a===0,u=a<0,d=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:u,isNegF:d,offsetF:f}}function EF(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function xF(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Zu=new WeakMap,Nv=new WeakMap;function Yu(t){return Nv.get(t)||1}function _y(t){if(t!==ca)throw new Error("invalid wNAF")}let $F=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let s=e;for(;r>ca;)r&Yi&&(n=n.add(s)),s=s.double(),r>>=Yi;return n}precomputeWindow(e,r){const{windows:n,windowSize:s}=Gu(r,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let f=1;f<s;f++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=Gu(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:l,isNeg:h,isNegF:u,offsetF:d}=Oy(n,a,o);n=c,l?i=i.add(ll(u,r[d])):s=s.add(ll(h,r[f]))}return _y(n),{p:s,f:i}}wNAFUnsafe(e,r,n,s=this.ZERO){const i=Gu(e,this.bits);for(let o=0;o<i.windows&&n!==ca;o++){const{nextN:a,offset:c,isZero:f,isNeg:l}=Oy(n,o,i);if(n=a,!f){const h=r[c];s=s.add(l?h.negate():h)}}return _y(n),s}getPrecomputes(e,r,n){let s=Zu.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(s=n(s)),Zu.set(r,s))),s}cached(e,r,n){const s=Yu(e);return this.wNAF(s,this.getPrecomputes(s,e,n),r)}unsafe(e,r,n,s){const i=Yu(e);return i===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),r,s)}createCache(e,r){Lv(r,this.bits),Nv.set(e,r),Zu.delete(e)}hasCache(e){return Yu(e)!==1}};function IF(t,e,r,n){let s=e,i=t.ZERO,o=t.ZERO;for(;r>ca||n>ca;)r&Yi&&(i=i.add(s)),n&Yi&&(o=o.add(s)),s=s.double(),r>>=Yi,n>>=Yi;return{p1:i,p2:o}}function BF(t,e,r,n){EF(r,t),xF(n,e);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Iv(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=Cc(c),l=new Array(Number(f)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let u=o;for(let d=h;d>=0;d-=c){l.fill(o);for(let b=0;b<i;b++){const E=n[b],U=Number(E>>BigInt(d)&f);l[U]=l[U].add(r[b])}let g=o;for(let b=l.length-1,E=o;b>0;b--)E=E.add(l[b]),g=g.add(E);if(u=u.add(g),d!==0)for(let b=0;b<c;b++)u=u.double()}return u}function Fy(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return wF(e),e}else return vi(t,{isLE:r})}function AF(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>ca))throw new Error(`CURVE.${a} must be positive bigint`)}const s=Fy(e.p,r.Fp,n),i=Fy(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),fv("HashToScalar-");const Sa=BigInt(0),$o=BigInt(1),ff=BigInt(2);function SF(t){return Gl(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function OF(t){const e=SF(t),{P:r,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||yo,f=a?255:448,l=a?32:56,h=BigInt(a?9:5),u=BigInt(a?121665:39081),d=a?ff**BigInt(254):ff**BigInt(447),g=a?BigInt(8)*ff**BigInt(251)-$o:BigInt(4)*ff**BigInt(445)-$o,b=d+g+$o,E=S=>Wt(S,r),U=L(h);function L(S){return k0(E(S),l)}function $(S){const m=wt("u coordinate",S,l);return a&&(m[31]&=127),E(fl(m))}function F(S){return fl(s(wt("scalar",S,l)))}function P(S,m){const x=R($(m),F(S));if(x===Sa)throw new Error("invalid private or public key received");return L(x)}function C(S){return P(S,U)}function T(S,m,x){const y=E(S*(m-x));return m=E(m-y),x=E(x+y),{x_2:m,x_3:x}}function R(S,m){zd("u",S,Sa,r),zd("scalar",m,d,b);const x=m,y=S;let p=$o,v=Sa,I=S,w=$o,B=Sa;for(let _=BigInt(f-1);_>=Sa;_--){const k=x>>_&$o;B^=k,{x_2:p,x_3:I}=T(B,p,I),{x_2:v,x_3:w}=T(B,v,w),B=k;const D=p+v,N=E(D*D),z=p-v,H=E(z*z),V=N-H,M=I+w,K=I-w,Q=E(K*D),te=E(M*z),re=Q+te,le=Q-te;I=E(re*re),w=E(y*E(le*le)),p=E(N*H),v=E(V*(N+E(u*V)))}({x_2:p,x_3:I}=T(B,p,I)),{x_2:v,x_3:w}=T(B,v,w);const O=i(v);return E(p*O)}const A={secretKey:l,publicKey:l,seed:l},j=(S=c(l))=>(kr(S,A.seed),S);function q(S){const m=j(S);return{secretKey:m,publicKey:C(m)}}return{keygen:q,getSharedSecret:(S,m)=>P(S,m),getPublicKey:S=>C(S),scalarMult:P,scalarMultBase:C,utils:{randomSecretKey:j,randomPrivateKey:j},GuBytes:U.slice(),lengths:A}}const _F=BigInt(1),Uy=BigInt(2),FF=BigInt(3),UF=BigInt(5);BigInt(8);const kv=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),PF={p:kv,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function CF(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=kv,o=t*t%i*t%i,a=Ar(o,Uy,i)*o%i,c=Ar(a,_F,i)*t%i,f=Ar(c,UF,i)*c%i,l=Ar(f,e,i)*f%i,h=Ar(l,r,i)*l%i,u=Ar(h,n,i)*h%i,d=Ar(u,s,i)*u%i,g=Ar(d,s,i)*u%i,b=Ar(g,e,i)*f%i;return{pow_p_5_8:Ar(b,Uy,i)*t%i,b2:o}}function RF(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const TF=vi(PF.p,{isLE:!0}),Md=(()=>{const t=TF.ORDER;return OF({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=CF(e);return Wt(Ar(r,FF,t)*n,t)},adjustScalarBytes:RF})})(),Py=(t,e)=>(t+(t>=0?e:-e)/Dv)/e;function LF(t,e,r){const[[n,s],[i,o]]=e,a=Py(o*t,r),c=Py(-s*t,r);let f=t-a*n-c*i,l=-a*s-c*o;const h=f<Dn,u=l<Dn;h&&(f=-f),u&&(l=-l);const d=Cc(Math.ceil(Iv(r)/2))+Yo;if(f<Dn||f>=d||l<Dn||l>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:f,k2neg:u,k2:l}}function Hd(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Wu(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return cl(r.lowS,"lowS"),cl(r.prehash,"prehash"),r.format!==void 0&&Hd(r.format),r}let NF=class extends Error{constructor(e=""){super(e)}};const Cn={Err:NF,_tlv:{encode:(t,e)=>{const{Err:r}=Cn;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=cf(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?cf(s.length/2|128):"";return cf(t)+i+s+e},decode(t,e){const{Err:r}=Cn;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of f)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Cn;if(t<Dn)throw new e("integer: negative integers are not allowed");let r=cf(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Cn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Kl(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Cn,s=wt("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:f,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=Cn,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}},Dn=BigInt(0),Yo=BigInt(1),Dv=BigInt(2),lf=BigInt(3),kF=BigInt(4);function ko(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let s=wt("private key",e);try{n=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function DF(t,e={}){const r=AF("weierstrass",t,e),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:o,n:a}=i;Gl(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=qv(n,s);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(S,m,x){const{x:y,y:p}=m.toAffine(),v=n.toBytes(y);if(cl(x,"isCompressed"),x){l();const I=!n.isOdd(p);return Gs(jv(I),v)}else return Gs(Uint8Array.of(4),v,n.toBytes(p))}function u(S){Gi(S,void 0,"Point");const{publicKey:m,publicKeyUncompressed:x}=f,y=S.length,p=S[0],v=S.subarray(1);if(y===m&&(p===2||p===3)){const I=n.fromBytes(v);if(!n.isValid(I))throw new Error("bad point: is not on curve, wrong x");const w=b(I);let B;try{B=n.sqrt(w)}catch(_){const k=_ instanceof Error?": "+_.message:"";throw new Error("bad point: is not on curve, sqrt error"+k)}l();const O=n.isOdd(B);return(p&1)===1!==O&&(B=n.neg(B)),{x:I,y:B}}else if(y===x&&p===4){const I=n.BYTES,w=n.fromBytes(v.subarray(0,I)),B=n.fromBytes(v.subarray(I,I*2));if(!E(w,B))throw new Error("bad point: is not on curve");return{x:w,y:B}}else throw new Error(`bad point: got length ${y}, expected compressed=${m} or uncompressed=${x}`)}const d=e.toBytes||h,g=e.fromBytes||u;function b(S){const m=n.sqr(S),x=n.mul(m,S);return n.add(n.add(x,n.mul(S,i.a)),i.b)}function E(S,m){const x=n.sqr(m),y=b(S);return n.eql(x,y)}if(!E(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const U=n.mul(n.pow(i.a,lf),kF),L=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(U,L)))throw new Error("bad curve params: a or b");function $(S,m,x=!1){if(!n.isValid(m)||x&&n.is0(m))throw new Error(`bad point coordinate ${S}`);return m}function F(S){if(!(S instanceof A))throw new Error("ProjectivePoint expected")}function P(S){if(!c||!c.basises)throw new Error("no endo");return LF(S,c.basises,s.ORDER)}const C=By((S,m)=>{const{X:x,Y:y,Z:p}=S;if(n.eql(p,n.ONE))return{x,y};const v=S.is0();m==null&&(m=v?n.ONE:n.inv(p));const I=n.mul(x,m),w=n.mul(y,m),B=n.mul(p,m);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(B,n.ONE))throw new Error("invZ was invalid");return{x:I,y:w}}),T=By(S=>{if(S.is0()){if(e.allowInfinityPoint&&!n.is0(S.Y))return;throw new Error("bad point: ZERO")}const{x:m,y:x}=S.toAffine();if(!n.isValid(m)||!n.isValid(x))throw new Error("bad point: x or y not field elements");if(!E(m,x))throw new Error("bad point: equation left != right");if(!S.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(S,m,x,y,p){return x=new A(n.mul(x.X,S),x.Y,x.Z),m=ll(y,m),x=ll(p,x),m.add(x)}class A{constructor(m,x,y){this.X=$("x",m),this.Y=$("y",x,!0),this.Z=$("z",y),Object.freeze(this)}static CURVE(){return i}static fromAffine(m){const{x,y}=m||{};if(!m||!n.isValid(x)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof A)throw new Error("projective point not allowed");return n.is0(x)&&n.is0(y)?A.ZERO:new A(x,y,n.ONE)}static fromBytes(m){const x=A.fromAffine(g(Gi(m,void 0,"point")));return x.assertValidity(),x}static fromHex(m){return A.fromBytes(wt("pointHex",m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,x=!0){return q.createCache(this,m),x||this.multiply(lf),this}assertValidity(){T(this)}hasEvenY(){const{y:m}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(m)}equals(m){F(m);const{X:x,Y:y,Z:p}=this,{X:v,Y:I,Z:w}=m,B=n.eql(n.mul(x,w),n.mul(v,p)),O=n.eql(n.mul(y,w),n.mul(I,p));return B&&O}negate(){return new A(this.X,n.neg(this.Y),this.Z)}double(){const{a:m,b:x}=i,y=n.mul(x,lf),{X:p,Y:v,Z:I}=this;let w=n.ZERO,B=n.ZERO,O=n.ZERO,_=n.mul(p,p),k=n.mul(v,v),D=n.mul(I,I),N=n.mul(p,v);return N=n.add(N,N),O=n.mul(p,I),O=n.add(O,O),w=n.mul(m,O),B=n.mul(y,D),B=n.add(w,B),w=n.sub(k,B),B=n.add(k,B),B=n.mul(w,B),w=n.mul(N,w),O=n.mul(y,O),D=n.mul(m,D),N=n.sub(_,D),N=n.mul(m,N),N=n.add(N,O),O=n.add(_,_),_=n.add(O,_),_=n.add(_,D),_=n.mul(_,N),B=n.add(B,_),D=n.mul(v,I),D=n.add(D,D),_=n.mul(D,N),w=n.sub(w,_),O=n.mul(D,k),O=n.add(O,O),O=n.add(O,O),new A(w,B,O)}add(m){F(m);const{X:x,Y:y,Z:p}=this,{X:v,Y:I,Z:w}=m;let B=n.ZERO,O=n.ZERO,_=n.ZERO;const k=i.a,D=n.mul(i.b,lf);let N=n.mul(x,v),z=n.mul(y,I),H=n.mul(p,w),V=n.add(x,y),M=n.add(v,I);V=n.mul(V,M),M=n.add(N,z),V=n.sub(V,M),M=n.add(x,p);let K=n.add(v,w);return M=n.mul(M,K),K=n.add(N,H),M=n.sub(M,K),K=n.add(y,p),B=n.add(I,w),K=n.mul(K,B),B=n.add(z,H),K=n.sub(K,B),_=n.mul(k,M),B=n.mul(D,H),_=n.add(B,_),B=n.sub(z,_),_=n.add(z,_),O=n.mul(B,_),z=n.add(N,N),z=n.add(z,N),H=n.mul(k,H),M=n.mul(D,M),z=n.add(z,H),H=n.sub(N,H),H=n.mul(k,H),M=n.add(M,H),N=n.mul(z,M),O=n.add(O,N),N=n.mul(K,M),B=n.mul(V,B),B=n.sub(B,N),N=n.mul(V,z),_=n.mul(K,_),_=n.add(_,N),new A(B,O,_)}subtract(m){return this.add(m.negate())}is0(){return this.equals(A.ZERO)}multiply(m){const{endo:x}=e;if(!s.isValidNot0(m))throw new Error("invalid scalar: out of range");let y,p;const v=I=>q.cached(this,I,w=>Ku(A,w));if(x){const{k1neg:I,k1:w,k2neg:B,k2:O}=P(m),{p:_,f:k}=v(w),{p:D,f:N}=v(O);p=k.add(N),y=R(x.beta,_,D,I,B)}else{const{p:I,f:w}=v(m);y=I,p=w}return Ku(A,[y,p])[0]}multiplyUnsafe(m){const{endo:x}=e,y=this;if(!s.isValid(m))throw new Error("invalid scalar: out of range");if(m===Dn||y.is0())return A.ZERO;if(m===Yo)return y;if(q.hasCache(this))return this.multiply(m);if(x){const{k1neg:p,k1:v,k2neg:I,k2:w}=P(m),{p1:B,p2:O}=IF(A,y,v,w);return R(x.beta,B,O,p,I)}else return q.unsafe(y,m)}multiplyAndAddUnsafe(m,x,y){const p=this.multiplyUnsafe(x).add(m.multiplyUnsafe(y));return p.is0()?void 0:p}toAffine(m){return C(this,m)}isTorsionFree(){const{isTorsionFree:m}=e;return o===Yo?!0:m?m(A,this):q.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:m}=e;return o===Yo?this:m?m(A,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(m=!0){return cl(m,"isCompressed"),this.assertValidity(),d(A,this,m)}toHex(m=!0){return Zo(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(m=!0){return this.toBytes(m)}_setWindowSize(m){this.precompute(m)}static normalizeZ(m){return Ku(A,m)}static msm(m,x){return BF(A,s,m,x)}static fromPrivateKey(m){return A.BASE.multiply(ko(s,m))}}A.BASE=new A(i.Gx,i.Gy,n.ONE),A.ZERO=new A(n.ZERO,n.ONE,n.ZERO),A.Fp=n,A.Fn=s;const j=s.BITS,q=new $F(A,e.endo?Math.ceil(j/2):j);return A.BASE.precompute(8),A}function jv(t){return Uint8Array.of(t?2:3)}function qv(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function jF(t,e={}){const{Fn:r}=t,n=e.randomBytes||yo,s=Object.assign(qv(t.Fp,r),{seed:Tv(r.ORDER)});function i(u){try{return!!ko(r,u)}catch{return!1}}function o(u,d){const{publicKey:g,publicKeyUncompressed:b}=s;try{const E=u.length;return d===!0&&E!==g||d===!1&&E!==b?!1:!!t.fromBytes(u)}catch{return!1}}function a(u=n(s.seed)){return vF(Gi(u,s.seed,"seed"),r.ORDER)}function c(u,d=!0){return t.BASE.multiply(ko(r,u)).toBytes(d)}function f(u){const d=a(u);return{secretKey:d,publicKey:c(d)}}function l(u){if(typeof u=="bigint")return!1;if(u instanceof t)return!0;const{secretKey:d,publicKey:g,publicKeyUncompressed:b}=s;if(r.allowedLengths||d===g)return;const E=wt("key",u).length;return E===g||E===b}function h(u,d,g=!0){if(l(u)===!0)throw new Error("first arg must be private key");if(l(d)===!1)throw new Error("second arg must be public key");const b=ko(r,u);return t.fromHex(d).multiply(b).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:f,Point:t,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:u=>ko(r,u),precompute(u=8,d=t.BASE){return d.precompute(u,!1)}},lengths:s})}function qF(t,e,r={}){zl(e),Gl(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||yo,s=r.hmac||((x,...y)=>Hl(e,x,Gs(...y))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:d}=jF(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},b="compact";function E(x){const y=a>>Yo;return x>y}function U(x,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${x}: out of range 1..Point.Fn.ORDER`);return y}function L(x,y){Hd(y);const p=d.signature,v=y==="compact"?p:y==="recovered"?p+1:void 0;return Gi(x,v,`${y} signature`)}class ${constructor(y,p,v){this.r=U("r",y),this.s=U("s",p),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(y,p=b){L(y,p);let v;if(p==="der"){const{r:O,s:_}=Cn.toSig(Gi(y));return new $(O,_)}p==="recovered"&&(v=y[0],p="compact",y=y.subarray(1));const I=o.BYTES,w=y.subarray(0,I),B=y.subarray(I,I*2);return new $(o.fromBytes(w),o.fromBytes(B),v)}static fromHex(y,p){return this.fromBytes(al(y),p)}addRecoveryBit(y){return new $(this.r,this.s,y)}recoverPublicKey(y){const p=i.ORDER,{r:v,s:I,recovery:w}=this;if(w==null||![0,1,2,3].includes(w))throw new Error("recovery id invalid");if(a*Dv<p&&w>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=w===2||w===3?v+a:v;if(!i.isValid(B))throw new Error("recovery id 2 or 3 invalid");const O=i.toBytes(B),_=t.fromBytes(Gs(jv((w&1)===0),O)),k=o.inv(B),D=P(wt("msgHash",y)),N=o.create(-D*k),z=o.create(I*k),H=t.BASE.multiplyUnsafe(N).add(_.multiplyUnsafe(z));if(H.is0())throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return E(this.s)}toBytes(y=b){if(Hd(y),y==="der")return al(Cn.hexFromSig(this));const p=o.toBytes(this.r),v=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Gs(Uint8Array.of(this.recovery),p,v)}return Gs(p,v)}toHex(y){return Zo(this.toBytes(y))}assertValidity(){}static fromCompact(y){return $.fromBytes(wt("sig",y),"compact")}static fromDER(y){return $.fromBytes(wt("sig",y),"der")}normalizeS(){return this.hasHighS()?new $(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Zo(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Zo(this.toBytes("compact"))}}const F=r.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");const y=Kl(x),p=x.length*8-c;return p>0?y>>BigInt(p):y},P=r.bits2int_modN||function(x){return o.create(F(x))},C=Cc(c);function T(x){return zd("num < 2^"+c,x,Dn,C),o.toBytes(x)}function R(x,y){return Gi(x,void 0,"message"),y?Gi(e(x),void 0,"prehashed message"):x}function A(x,y,p){if(["recovered","canonical"].some(z=>z in p))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:I,extraEntropy:w}=Wu(p,g);x=R(x,I);const B=P(x),O=ko(o,y),_=[T(O),T(B)];if(w!=null&&w!==!1){const z=w===!0?n(d.secretKey):w;_.push(wt("extraEntropy",z))}const k=Gs(..._),D=B;function N(z){const H=F(z);if(!o.isValidNot0(H))return;const V=o.inv(H),M=t.BASE.multiply(H).toAffine(),K=o.create(M.x);if(K===Dn)return;const Q=o.create(V*o.create(D+K*O));if(Q===Dn)return;let te=(M.x===K?0:2)|Number(M.y&Yo),re=Q;return v&&E(Q)&&(re=o.neg(Q),te^=1),new $(K,re,te)}return{seed:k,k2sig:N}}function j(x,y,p={}){x=wt("message",x);const{seed:v,k2sig:I}=A(x,y,p);return uF(e.outputLen,o.BYTES,s)(v,I)}function q(x){let y;const p=typeof x=="string"||ql(x),v=!p&&x!==null&&typeof x=="object"&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!p&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)y=new $(x.r,x.s);else if(p){try{y=$.fromBytes(wt("sig",x),"der")}catch(I){if(!(I instanceof Cn.Err))throw I}if(!y)try{y=$.fromBytes(wt("sig",x),"compact")}catch{return!1}}return y||!1}function S(x,y,p,v={}){const{lowS:I,prehash:w,format:B}=Wu(v,g);if(p=wt("publicKey",p),y=R(wt("message",y),w),"strict"in v)throw new Error("options.strict was renamed to lowS");const O=B===void 0?q(x):$.fromBytes(wt("sig",x),B);if(O===!1)return!1;try{const _=t.fromBytes(p);if(I&&O.hasHighS())return!1;const{r:k,s:D}=O,N=P(y),z=o.inv(D),H=o.create(N*z),V=o.create(k*z),M=t.BASE.multiplyUnsafe(H).add(_.multiplyUnsafe(V));return M.is0()?!1:o.create(M.x)===k}catch{return!1}}function m(x,y,p={}){const{prehash:v}=Wu(p,g);return y=R(y,v),$.fromBytes(x,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:d,Point:t,sign:j,verify:S,recoverPublicKey:m,Signature:$,hash:e})}function zF(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=vi(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),i={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function MF(t){const{CURVE:e,curveOpts:r}=zF(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function HF(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,Cv(r.Fn.ORDER,r.Fn.BITS))})}function VF(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:s}=MF(t),i=DF(e,r),o=qF(i,n,s);return HF(t,o)}function Vd(t,e){const r=n=>VF({...t,hash:n});return{...r(e),create:r}}const zv={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Mv={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Hv={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},KF=vi(zv.p),GF=vi(Mv.p),ZF=vi(Hv.p),YF=Vd({...zv,Fp:KF,lowS:!1},bv);Vd({...Mv,Fp:GF,lowS:!1},P_),Vd({...Hv,Fp:ZF,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},U_);const WF=YF,Vv="base10",It="base16",so="base64pad",j0="base64url",Rc="utf8",Kv=0,va=1,Zl=2,XF=0,Cy=1,ic=12,q0=32;function JF(){const t=Md.utils.randomPrivateKey(),e=Md.getPublicKey(t);return{privateKey:Ht(t,It),publicKey:Ht(e,It)}}function Kd(){const t=yo(q0);return Ht(t,It)}function QF(t,e){const r=Md.getSharedSecret(fr(t,It),fr(e,It)),n=fF(Vl,r,void 0,void 0,q0);return Ht(n,It)}function eU(t){const e=Vl(fr(t,It));return Ht(e,It)}function Mf(t){const e=Vl(fr(t,Rc));return Ht(e,It)}function Gv(t){return fr(`${t}`,Vv)}function uo(t){return Number(Ht(t,Vv))}function Zv(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Yv(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function tU(t){const e=Gv(typeof t.type<"u"?t.type:Kv);if(uo(e)===va&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?fr(t.senderPublicKey,It):void 0,n=typeof t.iv<"u"?fr(t.iv,It):yo(ic),s=fr(t.symKey,It),i=Ev(s,n).encrypt(fr(t.message,Rc)),o=Wv({type:e,sealed:i,iv:n,senderPublicKey:r});return t.encoding===j0?Zv(o):o}function rU(t){const e=fr(t.symKey,It),{sealed:r,iv:n}=yc({encoded:t.encoded,encoding:t.encoding}),s=Ev(e,n).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return Ht(s,Rc)}function nU(t,e){const r=Gv(Zl),n=yo(ic),s=fr(t,Rc),i=Wv({type:r,sealed:s,iv:n});return e===j0?Zv(i):i}function sU(t,e){const{sealed:r}=yc({encoded:t,encoding:e});return Ht(r,Rc)}function Wv(t){if(uo(t.type)===Zl)return Ht(nc([t.type,t.sealed]),so);if(uo(t.type)===va){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Ht(nc([t.type,t.senderPublicKey,t.iv,t.sealed]),so)}return Ht(nc([t.type,t.iv,t.sealed]),so)}function yc(t){const e=(t.encoding||so)===j0?Yv(t.encoded):t.encoded,r=fr(e,so),n=r.slice(XF,Cy),s=Cy;if(uo(n)===va){const c=s+q0,f=c+ic,l=r.slice(s,c),h=r.slice(c,f),u=r.slice(f);return{type:n,sealed:u,iv:h,senderPublicKey:l}}if(uo(n)===Zl){const c=r.slice(s),f=yo(ic);return{type:n,sealed:c,iv:f}}const i=s+ic,o=r.slice(s,i),a=r.slice(i);return{type:n,sealed:a,iv:o}}function iU(t,e){const r=yc({encoded:t,encoding:e?.encoding});return Xv({type:uo(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Ht(r.senderPublicKey,It):void 0,receiverPublicKey:e?.receiverPublicKey})}function Xv(t){const e=t?.type||Kv;if(e===va){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Ry(t){return t.type===va&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Ty(t){return t.type===Zl}function oU(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return nc([new Uint8Array([4]),e,r])}function aU(t,e){const[r,n,s]=t.split("."),i=Buffer.from(Yv(s),"base64");if(i.length!==64)throw new Error("Invalid signature length");const o=i.slice(0,32),a=i.slice(32,64),c=`${r}.${n}`,f=Vl(c),l=oU(e);if(!WF.verify(nc([o,a]),f,l))throw new Error("Invalid signature");return Rd(t).payload}const cU="irn";function ul(t){return t?.relay||{protocol:cU}}function Do(t){const e=o5[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var fU=Object.defineProperty,lU=Object.defineProperties,uU=Object.getOwnPropertyDescriptors,Ly=Object.getOwnPropertySymbols,hU=Object.prototype.hasOwnProperty,dU=Object.prototype.propertyIsEnumerable,Ny=(t,e,r)=>e in t?fU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xu=(t,e)=>{for(var r in e||(e={}))hU.call(e,r)&&Ny(t,r,e[r]);if(Ly)for(var r of Ly(e))dU.call(e,r)&&Ny(t,r,e[r]);return t},pU=(t,e)=>lU(t,uU(e));function gU(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(n)){const i=s.replace(n,""),o=t[s];r[i]=o}}),r}function ky(t){if(!t.includes("wc:")){const f=nv(t);f!=null&&f.includes("wc:")&&(t=f)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),s=t.substring(e+1,r).split("@"),i=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(i),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:yU(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:gU(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function yU(t){return t.startsWith("//")?t.substring(2):t}function bU(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(s=>{const i=s,o=r+e+i;t[i]&&(n[o]=t[i])}),n}function Dy(t){const e=new URLSearchParams,r=Xu(Xu(pU(Xu({},bU(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!==void 0&&e.append(n,String(s))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}const wU={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},mU={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ye(t,e){const{message:r,code:n}=mU[t];return{message:e?`${r} ${e}`:r,code:n}}function Ya(t,e){const{message:r,code:n}=wU[t];return{message:e?`${r} ${e}`:r,code:n}}function Wa(t){return typeof t>"u"}function Jv(t,e){return typeof t=="string"&&!!t.trim().length}function vU(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(Jv(t,!1)){if(e(t))return!0;const r=nv(t);return e(r)}}catch{}return!1}function EU(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function xU(t){return t?.topic}function Ju(t){return typeof t<"u"&&typeof t!==null}function jy(){const t=jl();return new Promise(e=>{switch(t){case Rr.browser:e($U());break;case Rr.reactNative:e(IU());break;case Rr.node:e(BU());break;default:e(!0)}})}function $U(){return Uc()&&navigator?.onLine}async function IU(){return go()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function BU(){return!0}function AU(t){switch(jl()){case Rr.browser:SU(t);break;case Rr.reactNative:OU(t);break}}function SU(t){!go()&&Uc()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function OU(t){go()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function _U(){var t;return Uc()&&tr.getDocument()?((t=tr.getDocument())==null?void 0:t.visibilityState)==="visible":!0}function FU({logger:t,name:e}){const r=typeof t=="string"?E3({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}var UU={};const Qv="wc",eE=2,Gd="core",ln=`${Qv}@2:${Gd}:`,PU={logger:"error"},CU={database:":memory:"},RU="crypto",qy="client_ed25519_seed",TU=Z.ONE_DAY,LU="keychain",NU="0.3",kU="messages",DU="0.3",jU=Z.SIX_HOURS,qU="publisher",tE="irn",zU="error",rE="wss://relay.walletconnect.org",MU="relayer",xe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},HU="_subscription",sr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},VU=.1,Zd="2.23.5",ve={link_mode:"link_mode",relay:"relay"},Hf={inbound:"inbound",outbound:"outbound"},KU="0.3",GU="WALLETCONNECT_CLIENT_ID",zy="WALLETCONNECT_LINK_MODE_APPS",Zt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},ZU="subscription",YU="0.3",WU="pairing",XU="0.3",Oa={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},ji={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},vr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},JU="history",QU="0.3",eP="expirer",ar={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},tP="0.3",rP="verify-api",nP="https://verify.walletconnect.com",nE="https://verify.walletconnect.org",oc=nE,sP=`${oc}/v3`,iP=[nP,nE],oP="echo",aP="https://echo.walletconnect.com",tn={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},On={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Er={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Ui={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Pi={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},_a={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},cP=.1,fP="event-client",lP=86400,uP="https://pulse.walletconnect.org/batch";function hP(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var b=0,E=0,U=0,L=g.length;U!==L&&g[U]===0;)U++,b++;for(var $=(L-U)*l+1>>>0,F=new Uint8Array($);U!==L;){for(var P=g[U],C=0,T=$-1;(P!==0||C<E)&&T!==-1;T--,C++)P+=256*F[T]>>>0,F[T]=P%a>>>0,P=P/a>>>0;if(P!==0)throw new Error("Non-zero carry");E=C,U++}for(var R=$-E;R!==$&&F[R]===0;)R++;for(var A=c.repeat(b);R<$;++R)A+=t.charAt(F[R]);return A}function u(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var b=0;if(g[b]!==" "){for(var E=0,U=0;g[b]===c;)E++,b++;for(var L=(g.length-b)*f+1>>>0,$=new Uint8Array(L);g[b];){var F=r[g.charCodeAt(b)];if(F===255)return;for(var P=0,C=L-1;(F!==0||P<U)&&C!==-1;C--,P++)F+=a*$[C]>>>0,$[C]=F%256>>>0,F=F/256>>>0;if(F!==0)throw new Error("Non-zero carry");U=P,b++}if(g[b]!==" "){for(var T=L-U;T!==L&&$[T]===0;)T++;for(var R=new Uint8Array(E+(L-T)),A=E;T!==L;)R[A++]=$[T++];return R}}}function d(g){var b=u(g);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:u,decode:d}}var dP=hP,pP=dP;const sE=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},gP=t=>new TextEncoder().encode(t),yP=t=>new TextDecoder().decode(t);let bP=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},wP=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return iE(this,e)}},mP=class{constructor(e){this.decoders=e}or(e){return iE(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const iE=(t,e)=>new mP({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let vP=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new bP(e,r,n),this.decoder=new wP(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Yl=({name:t,prefix:e,encode:r,decode:n})=>new vP(t,e,r,n),Tc=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:s}=pP(r,e);return Yl({prefix:t,name:e,encode:n,decode:i=>sE(s(i))})},EP=(t,e,r,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,f=0;for(let l=0;l<i;++l){const h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},xP=(t,e,r)=>{const n=e[e.length-1]==="=",s=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},et=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Yl({prefix:e,name:t,encode(s){return xP(s,n,r)},decode(s){return EP(s,n,r,t)}}),$P=Yl({prefix:"\0",name:"identity",encode:t=>yP(t),decode:t=>gP(t)});var IP=Object.freeze({__proto__:null,identity:$P});const BP=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var AP=Object.freeze({__proto__:null,base2:BP});const SP=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var OP=Object.freeze({__proto__:null,base8:SP});const _P=Tc({prefix:"9",name:"base10",alphabet:"0123456789"});var FP=Object.freeze({__proto__:null,base10:_P});const UP=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),PP=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var CP=Object.freeze({__proto__:null,base16:UP,base16upper:PP});const RP=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),TP=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),LP=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),NP=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),kP=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),DP=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),jP=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),qP=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),zP=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var MP=Object.freeze({__proto__:null,base32:RP,base32upper:TP,base32pad:LP,base32padupper:NP,base32hex:kP,base32hexupper:DP,base32hexpad:jP,base32hexpadupper:qP,base32z:zP});const HP=Tc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),VP=Tc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var KP=Object.freeze({__proto__:null,base36:HP,base36upper:VP});const GP=Tc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ZP=Tc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var YP=Object.freeze({__proto__:null,base58btc:GP,base58flickr:ZP});const WP=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),XP=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),JP=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),QP=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var eC=Object.freeze({__proto__:null,base64:WP,base64pad:XP,base64url:JP,base64urlpad:QP});const oE=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),tC=oE.reduce((t,e,r)=>(t[r]=e,t),[]),rC=oE.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function nC(t){return t.reduce((e,r)=>(e+=tC[r],e),"")}function sC(t){const e=[];for(const r of t){const n=rC[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const iC=Yl({prefix:"ðŸš€",name:"base256emoji",encode:nC,decode:sC});var oC=Object.freeze({__proto__:null,base256emoji:iC}),aC=aE,My=128,cC=-128,fC=Math.pow(2,31);function aE(t,e,r){e=e||[],r=r||0;for(var n=r;t>=fC;)e[r++]=t&255|My,t/=128;for(;t&cC;)e[r++]=t&255|My,t>>>=7;return e[r]=t|0,aE.bytes=r-n+1,e}var lC=Yd,uC=128,Hy=127;function Yd(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw Yd.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&Hy)<<s:(o&Hy)*Math.pow(2,s),s+=7}while(o>=uC);return Yd.bytes=i-n,r}var hC=Math.pow(2,7),dC=Math.pow(2,14),pC=Math.pow(2,21),gC=Math.pow(2,28),yC=Math.pow(2,35),bC=Math.pow(2,42),wC=Math.pow(2,49),mC=Math.pow(2,56),vC=Math.pow(2,63),EC=function(t){return t<hC?1:t<dC?2:t<pC?3:t<gC?4:t<yC?5:t<bC?6:t<wC?7:t<mC?8:t<vC?9:10},xC={encode:aC,decode:lC,encodingLength:EC},cE=xC;const Vy=(t,e,r=0)=>(cE.encode(t,e,r),e),Ky=t=>cE.encodingLength(t),Wd=(t,e)=>{const r=e.byteLength,n=Ky(t),s=n+Ky(r),i=new Uint8Array(s+r);return Vy(t,i,0),Vy(r,i,n),i.set(e,s),new $C(t,r,e,i)};let $C=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};const fE=({name:t,code:e,encode:r})=>new IC(t,e,r);let IC=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Wd(this.code,r):r.then(n=>Wd(this.code,n))}else throw Error("Unknown type, must be binary type")}};const lE=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),BC=fE({name:"sha2-256",code:18,encode:lE("SHA-256")}),AC=fE({name:"sha2-512",code:19,encode:lE("SHA-512")});var SC=Object.freeze({__proto__:null,sha256:BC,sha512:AC});const uE=0,OC="identity",hE=sE,_C=t=>Wd(uE,hE(t)),FC={code:uE,name:OC,encode:hE,digest:_C};var UC=Object.freeze({__proto__:null,identity:FC});new TextEncoder,new TextDecoder;const Gy={...IP,...AP,...OP,...FP,...CP,...MP,...KP,...YP,...eC,...oC};({...SC,...UC});function dE(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function PC(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?dE(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function pE(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Zy=pE("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Qu=pE("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=PC(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),CC={utf8:Zy,"utf-8":Zy,hex:Gy.base16,latin1:Qu,ascii:Qu,binary:Qu,...Gy};function RC(t,e="utf8"){const r=CC[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?dE(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var TC=Object.defineProperty,LC=(t,e,r)=>e in t?TC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zr=(t,e,r)=>LC(t,typeof e!="symbol"?e+"":e,r);let NC=class{constructor(e,r){this.core=e,this.logger=r,Zr(this,"keychain",new Map),Zr(this,"name",LU),Zr(this,"version",NU),Zr(this,"initialized",!1),Zr(this,"storagePrefix",ln),Zr(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),Zr(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),Zr(this,"set",async(n,s)=>{this.isInitialized(),this.keychain.set(n,s),await this.persist()}),Zr(this,"get",n=>{this.isInitialized();const s=this.keychain.get(n);if(typeof s>"u"){const{message:i}=ye("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(i)}return s}),Zr(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=nr(r,this.name)}get context(){return rr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Td(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ld(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=ye("NOT_INITIALIZED",this.name);throw new Error(e)}}};var kC=Object.defineProperty,DC=(t,e,r)=>e in t?kC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Le=(t,e,r)=>DC(t,typeof e!="symbol"?e+"":e,r);class jC{constructor(e,r,n){this.core=e,this.logger=r,Le(this,"name",RU),Le(this,"keychain"),Le(this,"randomSessionIdentifier",Kd()),Le(this,"initialized",!1),Le(this,"clientId"),Le(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Le(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),Le(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const s=await this.getClientSeed(),i=ay(s),o=W3(i.publicKey);return this.clientId=o,o}),Le(this,"generateKeyPair",()=>{this.isInitialized();const s=JF();return this.setPrivateKey(s.publicKey,s.privateKey)}),Le(this,"signJWT",async s=>{this.isInitialized();const i=await this.getClientSeed(),o=ay(i),a=this.randomSessionIdentifier;return await NO(a,s,TU,o)}),Le(this,"generateSharedKey",(s,i,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=QF(a,i);return this.setSymKey(c,o)}),Le(this,"setSymKey",async(s,i)=>{this.isInitialized();const o=i||eU(s);return await this.keychain.set(o,s),o}),Le(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),Le(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),Le(this,"encode",async(s,i,o)=>{this.isInitialized();const a=Xv(o),c=Xp(i);if(Ty(a))return nU(c,o?.encoding);if(Ry(a)){const u=a.senderPublicKey,d=a.receiverPublicKey;s=await this.generateSharedKey(u,d)}const f=this.getSymKey(s),{type:l,senderPublicKey:h}=a;return tU({type:l,symKey:f,message:c,senderPublicKey:h,encoding:o?.encoding})}),Le(this,"decode",async(s,i,o)=>{this.isInitialized();const a=iU(i,o);if(Ty(a)){const c=sU(i,o?.encoding);return Wf(c)}if(Ry(a)){const c=a.receiverPublicKey,f=a.senderPublicKey;s=await this.generateSharedKey(c,f)}try{const c=this.getSymKey(s),f=rU({symKey:c,encoded:i,encoding:o?.encoding});return Wf(f)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Le(this,"getPayloadType",(s,i=so)=>{const o=yc({encoded:s,encoding:i});return uo(o.type)}),Le(this,"getPayloadSenderPublicKey",(s,i=so)=>{const o=yc({encoded:s,encoding:i});return o.senderPublicKey?Ht(o.senderPublicKey,It):void 0}),this.core=e,this.logger=nr(r,this.name),this.keychain=n||new NC(this.core,this.logger)}get context(){return rr(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(qy)}catch{e=Kd(),await this.keychain.set(qy,e)}return RC(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=ye("NOT_INITIALIZED",this.name);throw new Error(e)}}}var qC=Object.defineProperty,zC=Object.defineProperties,MC=Object.getOwnPropertyDescriptors,Yy=Object.getOwnPropertySymbols,HC=Object.prototype.hasOwnProperty,VC=Object.prototype.propertyIsEnumerable,Xd=(t,e,r)=>e in t?qC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,KC=(t,e)=>{for(var r in e||(e={}))HC.call(e,r)&&Xd(t,r,e[r]);if(Yy)for(var r of Yy(e))VC.call(e,r)&&Xd(t,r,e[r]);return t},GC=(t,e)=>zC(t,MC(e)),Vt=(t,e,r)=>Xd(t,typeof e!="symbol"?e+"":e,r);class ZC extends DB{constructor(e,r){super(e,r),this.logger=e,this.core=r,Vt(this,"messages",new Map),Vt(this,"messagesWithoutClientAck",new Map),Vt(this,"name",kU),Vt(this,"version",DU),Vt(this,"initialized",!1),Vt(this,"storagePrefix",ln),Vt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),Vt(this,"set",async(n,s,i)=>{this.isInitialized();const o=Mf(s);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(n,a),i===Hf.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,GC(KC({},c),{[o]:s}))}return await this.persist(),o}),Vt(this,"get",n=>{this.isInitialized();let s=this.messages.get(n);return typeof s>"u"&&(s={}),s}),Vt(this,"getWithoutAck",n=>{this.isInitialized();const s={};for(const i of n){const o=this.messagesWithoutClientAck.get(i)||{};s[i]=Object.values(o)}return s}),Vt(this,"has",(n,s)=>{this.isInitialized();const i=this.get(n),o=Mf(s);return typeof i[o]<"u"}),Vt(this,"ack",async(n,s)=>{this.isInitialized();const i=this.messagesWithoutClientAck.get(n);if(typeof i>"u")return;const o=Mf(s);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,i),await this.persist()}),Vt(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=nr(e,this.name),this.core=r}get context(){return rr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Td(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Td(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ld(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Ld(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=ye("NOT_INITIALIZED",this.name);throw new Error(e)}}}var YC=Object.defineProperty,WC=Object.defineProperties,XC=Object.getOwnPropertyDescriptors,Wy=Object.getOwnPropertySymbols,JC=Object.prototype.hasOwnProperty,QC=Object.prototype.propertyIsEnumerable,Jd=(t,e,r)=>e in t?YC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Io=(t,e)=>{for(var r in e||(e={}))JC.call(e,r)&&Jd(t,r,e[r]);if(Wy)for(var r of Wy(e))QC.call(e,r)&&Jd(t,r,e[r]);return t},Xy=(t,e)=>WC(t,XC(e)),ir=(t,e,r)=>Jd(t,typeof e!="symbol"?e+"":e,r);let eR=class extends jB{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ir(this,"events",new wi.EventEmitter),ir(this,"name",qU),ir(this,"queue",new Map),ir(this,"publishTimeout",Z.toMiliseconds(Z.ONE_MINUTE)),ir(this,"initialPublishTimeout",Z.toMiliseconds(Z.ONE_SECOND*15)),ir(this,"needsTransportRestart",!1),ir(this,"publish",async(n,s,i)=>{var o,a,c,f,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:i}});const h=i?.ttl||jU,u=i?.prompt||!1,d=i?.tag||0,g=i?.id||Mi().toString(),b=Do(ul().protocol),E={id:g,method:i?.publishMethod||b.publish,params:Io({topic:n,message:s,ttl:h,prompt:u,tag:d,attestation:i?.attestation},i?.tvf)},U=`Failed to publish payload, please try again. id:${g} tag:${d}`;try{Wa((o=E.params)==null?void 0:o.prompt)&&((a=E.params)==null||delete a.prompt),Wa((c=E.params)==null?void 0:c.tag)&&((f=E.params)==null||delete f.tag);const L=new Promise(async $=>{const F=({id:C})=>{var T;((T=E.id)==null?void 0:T.toString())===C.toString()&&(this.removeRequestFromQueue(C),this.relayer.events.removeListener(xe.publish,F),$())};this.relayer.events.on(xe.publish,F);const P=fn(new Promise((C,T)=>{this.rpcPublish(E,i).then(C).catch(R=>{this.logger.warn(R,R?.message),T(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${g} tag:${d}`);try{await P,this.events.removeListener(xe.publish,F)}catch(C){this.queue.set(g,{request:E,opts:i,attempt:1}),this.logger.warn(C,C?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:g,topic:n,message:s,opts:i}}),await fn(L,this.publishTimeout,U)}catch(L){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(L),(l=i?.internal)!=null&&l.throwOnFailedPublish)throw L}finally{this.queue.delete(g)}}),ir(this,"publishCustom",async n=>{var s,i,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:f,opts:l={}}=n,{attestation:h,tvf:u,publishMethod:d,prompt:g,tag:b,ttl:E=Z.FIVE_MINUTES}=l,U=l.id||Mi().toString(),L=Do(ul().protocol),$=d||L.publish,F={id:U,method:$,params:Io(Xy(Io({},f),{ttl:E,prompt:g,tag:b,attestation:h}),u)},P=`Failed to publish custom payload, please try again. id:${U} tag:${b}`;try{Wa((s=F.params)==null?void 0:s.prompt)&&((i=F.params)==null||delete i.prompt),Wa((o=F.params)==null?void 0:o.tag)&&((a=F.params)==null||delete a.tag);const C=new Promise(async T=>{const R=({id:j})=>{var q;((q=F.id)==null?void 0:q.toString())===j.toString()&&(this.removeRequestFromQueue(j),this.relayer.events.removeListener(xe.publish,R),T())};this.relayer.events.on(xe.publish,R);const A=fn(new Promise((j,q)=>{this.rpcPublish(F,l).then(j).catch(S=>{this.logger.warn(S,S?.message),q(S)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${$} id:${U} tag:${b}`);try{await A,this.events.removeListener(xe.publish,R)}catch(j){this.queue.set(U,{request:F,opts:l,attempt:1}),this.logger.warn(j,j?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:U,payload:f,opts:l}}),await fn(C,this.publishTimeout,P)}catch(C){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(C),(c=l?.internal)!=null&&c.throwOnFailedPublish)throw C}finally{this.queue.delete(U)}}),ir(this,"on",(n,s)=>{this.events.on(n,s)}),ir(this,"once",(n,s)=>{this.events.once(n,s)}),ir(this,"off",(n,s)=>{this.events.off(n,s)}),ir(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.relayer=e,this.logger=nr(r,this.name),this.registerEventListeners()}get context(){return rr(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(xe.publish,Io(Io({},e),r)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var n;const s=e.attempt+1;this.queue.set(r,Xy(Io({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(ba.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(xe.connection_stalled);return}this.checkQueue()}),this.relayer.on(xe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}};var tR=Object.defineProperty,rR=(t,e,r)=>e in t?tR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bo=(t,e,r)=>rR(t,typeof e!="symbol"?e+"":e,r);let nR=class{constructor(){Bo(this,"map",new Map),Bo(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),Bo(this,"get",e=>this.map.get(e)||[]),Bo(this,"exists",(e,r)=>this.get(e).includes(r)),Bo(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const s=n.filter(i=>i!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Bo(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}};var sR=Object.defineProperty,iR=Object.defineProperties,oR=Object.getOwnPropertyDescriptors,Jy=Object.getOwnPropertySymbols,aR=Object.prototype.hasOwnProperty,cR=Object.prototype.propertyIsEnumerable,Qd=(t,e,r)=>e in t?sR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fa=(t,e)=>{for(var r in e||(e={}))aR.call(e,r)&&Qd(t,r,e[r]);if(Jy)for(var r of Jy(e))cR.call(e,r)&&Qd(t,r,e[r]);return t},eh=(t,e)=>iR(t,oR(e)),be=(t,e,r)=>Qd(t,typeof e!="symbol"?e+"":e,r);class fR extends MB{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,be(this,"subscriptions",new Map),be(this,"topicMap",new nR),be(this,"events",new wi.EventEmitter),be(this,"name",ZU),be(this,"version",YU),be(this,"pending",new Map),be(this,"cached",[]),be(this,"initialized",!1),be(this,"storagePrefix",ln),be(this,"subscribeTimeout",Z.toMiliseconds(Z.ONE_MINUTE)),be(this,"initialSubscribeTimeout",Z.toMiliseconds(Z.ONE_SECOND*15)),be(this,"clientId"),be(this,"batchSubscribeTopicsLimit",500),be(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),be(this,"subscribe",async(n,s)=>{var i;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}});try{const o=ul(s),a={topic:n,relay:o,transportType:s?.transportType};(i=s?.internal)!=null&&i.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),be(this,"unsubscribe",async(n,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(n,s.id,s):await this.unsubscribeByTopic(n,s)}),be(this,"isSubscribed",n=>new Promise(s=>{s(this.topicMap.topics.includes(n))})),be(this,"isKnownTopic",n=>new Promise(s=>{s(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(i=>i.topic===n))})),be(this,"on",(n,s)=>{this.events.on(n,s)}),be(this,"once",(n,s)=>{this.events.once(n,s)}),be(this,"off",(n,s)=>{this.events.off(n,s)}),be(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),be(this,"start",async()=>{await this.onConnect()}),be(this,"stop",async()=>{await this.onDisconnect()}),be(this,"restart",async()=>{await this.restore(),await this.onRestart()}),be(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(s=>{n.push(s)}),await this.batchSubscribe(n)}),be(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(ba.pulse,async()=>{await this.checkPending()}),this.events.on(Zt.created,async n=>{const s=Zt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()}),this.events.on(Zt.deleted,async n=>{const s=Zt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()})}),this.relayer=e,this.logger=nr(r,this.name),this.clientId=""}get context(){return rr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const s=ul(n);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const i=Ya("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,n){var s,i;const o=await this.getSubscriptionId(e);if((s=n?.internal)!=null&&s.skipSubscribe)return o;(!n||n?.transportType===ve.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:Do(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(i=n?.internal)==null?void 0:i.throwOnFailedPublish;try{if(n?.transportType===ve.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},Z.toMiliseconds(Z.ONE_SECOND)),o;const f=new Promise(async h=>{const u=d=>{d.topic===e&&(this.events.removeListener(Zt.created,u),h(d.id))};this.events.on(Zt.created,u);try{const d=await fn(new Promise((g,b)=>{this.relayer.request(a).catch(E=>{this.logger.warn(E,E?.message),b(E)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Zt.created,u),h(d)}catch{}}),l=await fn(f,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(f){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(xe.connection_stalled),c)throw f}return null}async rpcBatchSubscribe(e){if(!e.length)return!0;const r=e[0].relay,n={method:Do(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await fn(new Promise((s,i)=>{this.relayer.request(n).then(s).catch(o=>{this.logger.warn(o),i(o)})}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again"),!0}catch{return this.relayer.events.emit(xe.connection_stalled),!1}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:Do(r.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let s;try{s=await await fn(new Promise((i,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(xe.connection_stalled)}return s}rpcUnsubscribe(e,r,n){const s={method:Do(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,eh(Fa({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Fa({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Fa({},r)),this.topicMap.set(r.topic,e),this.events.emit(Zt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=ye("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Zt.deleted,eh(Fa({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Zt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Zt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var n;return r.topic===((n=this.subscriptions.get(r.id))==null?void 0:n.topic)})){const{message:r}=ye("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(e.length){if(!await this.rpcBatchSubscribe(e)){this.logger.warn(`Batch subscribe failed for ${e.length} topics, adding to pending for retry`),e.forEach(r=>{this.pending.set(r.topic,r)});return}this.onBatchSubscribe(await Promise.all(e.map(async r=>eh(Fa({},r),{id:await this.getSubscriptionId(r.topic)}))))}}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await JO(Z.toMiliseconds(Z.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=ye("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Mf(e+await this.getClientId())}}var lR=Object.defineProperty,Qy=Object.getOwnPropertySymbols,uR=Object.prototype.hasOwnProperty,hR=Object.prototype.propertyIsEnumerable,ep=(t,e,r)=>e in t?lR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,eb=(t,e)=>{for(var r in e||(e={}))uR.call(e,r)&&ep(t,r,e[r]);if(Qy)for(var r of Qy(e))hR.call(e,r)&&ep(t,r,e[r]);return t},ae=(t,e,r)=>ep(t,typeof e!="symbol"?e+"":e,r);let dR=class extends qB{constructor(e){var r;super(e),ae(this,"protocol","wc"),ae(this,"version",2),ae(this,"core"),ae(this,"logger"),ae(this,"events",new wi.EventEmitter),ae(this,"provider"),ae(this,"messages"),ae(this,"subscriber"),ae(this,"publisher"),ae(this,"name",MU),ae(this,"transportExplicitlyClosed",!1),ae(this,"initialized",!1),ae(this,"connectionAttemptInProgress",!1),ae(this,"relayUrl"),ae(this,"projectId"),ae(this,"packageName"),ae(this,"bundleId"),ae(this,"hasExperiencedNetworkDisruption",!1),ae(this,"pingTimeout"),ae(this,"heartBeatTimeout",Z.toMiliseconds(Z.THIRTY_SECONDS+Z.FIVE_SECONDS)),ae(this,"reconnectTimeout"),ae(this,"connectPromise"),ae(this,"reconnectInProgress",!1),ae(this,"requestsInFlight",[]),ae(this,"connectTimeout",Z.toMiliseconds(Z.ONE_SECOND*15)),ae(this,"stalledRestartInProgress",!1),ae(this,"stalledRestartTimeout"),ae(this,"stalledRestartBackoff",0),ae(this,"stalledRestartBaseInterval",Z.toMiliseconds(Z.ONE_SECOND*2)),ae(this,"stalledRestartMaxInterval",Z.toMiliseconds(Z.THIRTY_SECONDS)),ae(this,"request",async n=>{var s,i;this.logger.debug("Publishing Request Payload");const o=n.id||Mi().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:n.method,topic:(s=n.params)==null?void 0:s.topic},"relayer.request - publishing...");const a=`${o}:${((i=n.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(f=>f!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),ae(this,"resetPingTimeout",()=>{ol()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,s,i,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null?void 0:i.terminate)==null||o.call(i)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),ae(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),ae(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected ðŸ›œ"),this.startPingTimeout(),this.events.emit(xe.connect)}),ae(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected ðŸ›‘"),this.requestsInFlight=[],this.onProviderDisconnect()}),ae(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(xe.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportExplicitlyClosed=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,this.reconnectInProgress=!1,this.transportClose().catch(s=>this.logger.warn(s))}),ae(this,"registerProviderListeners",()=>{this.provider.on(sr.payload,this.onPayloadHandler),this.provider.on(sr.connect,this.onConnectHandler),this.provider.on(sr.disconnect,this.onDisconnectHandler),this.provider.on(sr.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=FU({logger:(r=e.logger)!=null?r:zU,name:this.name}),this.messages=new ZC(this.logger,e.core),this.subscriber=new fR(this,this.logger),this.publisher=new eR(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||rE,qO()?this.packageName=fy():zO()&&(this.bundleId=fy()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return rr(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ve.relay},Hf.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var n,s,i;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((n=r?.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(s=r?.internal)==null?void 0:s.throwOnFailedPublish;let a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c;const f=l=>{l.topic===e&&(this.subscriber.off(Zt.created,f),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(Zt.created,f)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,eb({internal:{throwOnFailedPublish:o}},r)).catch(u=>{o&&h(u)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await fn(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,clearTimeout(this.stalledRestartTimeout),this.stalledRestartInProgress=!1,this.stalledRestartBackoff=0,await this.resetTransport()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.resetTransport(),await this.transportOpen())}async resetTransport(){this.reconnectInProgress=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,await this.transportDisconnect(),await this.subscriber.stop(),this.reconnectInProgress=!1}async confirmOnlineStateOrThrow(){if(!await jy())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,s)=>n.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const s=sc(Z.FIVE_MINUTES),i={topic:n,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,i)}this.events.emit(xe.message,e),await this.recordMessageEvent(e,Hf.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,s)=>{const i=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(sr.disconnect,i),await fn(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(sr.disconnect,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(sr.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(sr.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const s=n;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,Z.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,s,i;if(ol())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Jp(new l5(GO({sdkVersion:Zd,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:s}=e;await this.messages.set(n,s,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=this.messages.has(r,n);return s&&this.logger.warn(`Ignoring duplicate message: ${n}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Qp(e)){if(!e.method.endsWith(HU))return;const r=e.params,{topic:n,message:s,publishedAt:i,attestation:o}=r.data,a={topic:n,message:s,publishedAt:i,transportType:ve.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(eb({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else e0(e)&&this.events.emit(xe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Hf.inbound),this.events.emit(xe.message,e))}async acknowledgePayload(e){const r=uc(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(sr.payload,this.onPayloadHandler),this.provider.off(sr.connect,this.onConnectHandler),this.provider.off(sr.disconnect,this.onDisconnectHandler),this.provider.off(sr.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await jy();AU(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(ba.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&_U())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}}),this.events.on(xe.connection_stalled,()=>{if(this.transportExplicitlyClosed||this.stalledRestartInProgress)return;this.stalledRestartInProgress=!0;const r=this.stalledRestartBackoff===0?0:Math.min(Math.pow(2,this.stalledRestartBackoff-1)*this.stalledRestartBaseInterval,this.stalledRestartMaxInterval);this.stalledRestartBackoff++,this.logger.warn(`Connection stalled, restarting transport${r?` in ${r}ms`:""}...`),this.stalledRestartTimeout=setTimeout(async()=>{try{if(this.transportExplicitlyClosed)return;await this.restartTransport()}catch(n){this.logger.error(n,n?.message)}finally{this.stalledRestartInProgress=!1}},r)})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(xe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},Z.toMiliseconds(VU)))))}isInitialized(){if(!this.initialized){const{message:e}=ye("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function pR(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function tb(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function rb(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const gR="[object RegExp]",yR="[object String]",bR="[object Number]",wR="[object Boolean]",nb="[object Arguments]",mR="[object Symbol]",vR="[object Date]",ER="[object Map]",xR="[object Set]",$R="[object Array]",IR="[object Function]",BR="[object ArrayBuffer]",th="[object Object]",AR="[object Error]",SR="[object DataView]",OR="[object Uint8Array]",_R="[object Uint8ClampedArray]",FR="[object Uint16Array]",UR="[object Uint32Array]",PR="[object BigUint64Array]",CR="[object Int8Array]",RR="[object Int16Array]",TR="[object Int32Array]",LR="[object BigInt64Array]",NR="[object Float32Array]",kR="[object Float64Array]";function sb(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function DR(t,e,r){return Xa(t,e,void 0,void 0,void 0,void 0,r)}function Xa(t,e,r,n,s,i,o){const a=o(t,e,r,n,s,i);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return ac(t,e,i,o)}return ac(t,e,i,o)}function ac(t,e,r,n){if(Object.is(t,e))return!0;let s=rb(t),i=rb(e);if(s===nb&&(s=th),i===nb&&(i=th),s!==i)return!1;switch(s){case yR:return t.toString()===e.toString();case bR:{const c=t.valueOf(),f=e.valueOf();return pR(c,f)}case wR:case vR:case mR:return Object.is(t.valueOf(),e.valueOf());case gR:return t.source===e.source&&t.flags===e.flags;case IR:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case ER:{if(t.size!==e.size)return!1;for(const[c,f]of t.entries())if(!e.has(c)||!Xa(f,e.get(c),c,t,e,r,n))return!1;return!0}case xR:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),f=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],u=f.findIndex(d=>Xa(h,d,void 0,t,e,r,n));if(u===-1)return!1;f.splice(u,1)}return!0}case $R:case OR:case _R:case FR:case UR:case PR:case CR:case RR:case TR:case LR:case NR:case kR:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Xa(t[c],e[c],c,t,e,r,n))return!1;return!0}case BR:return t.byteLength!==e.byteLength?!1:ac(new Uint8Array(t),new Uint8Array(e),r,n);case SR:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:ac(new Uint8Array(t),new Uint8Array(e),r,n);case AR:return t.name===e.name&&t.message===e.message;case th:{if(!(ac(t.constructor,e.constructor,r,n)||sb(t)&&sb(e)))return!1;const c=[...Object.keys(t),...tb(t)],f=[...Object.keys(e),...tb(e)];if(c.length!==f.length)return!1;for(let l=0;l<c.length;l++){const h=c[l],u=t[h];if(!Object.hasOwn(e,h))return!1;const d=e[h];if(!Xa(u,d,h,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function jR(){}function qR(t,e){return DR(t,e,jR)}var zR=Object.defineProperty,ib=Object.getOwnPropertySymbols,MR=Object.prototype.hasOwnProperty,HR=Object.prototype.propertyIsEnumerable,tp=(t,e,r)=>e in t?zR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ob=(t,e)=>{for(var r in e||(e={}))MR.call(e,r)&&tp(t,r,e[r]);if(ib)for(var r of ib(e))HR.call(e,r)&&tp(t,r,e[r]);return t},Ft=(t,e,r)=>tp(t,typeof e!="symbol"?e+"":e,r);let bo=class extends zB{constructor(e,r,n,s=ln,i=void 0){super(e,r,n,s),this.core=e,this.logger=r,this.name=n,Ft(this,"map",new Map),Ft(this,"version",KU),Ft(this,"cached",[]),Ft(this,"initialized",!1),Ft(this,"getKey"),Ft(this,"storagePrefix",ln),Ft(this,"recentlyDeleted",[]),Ft(this,"recentlyDeletedLimit",200),Ft(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Wa(o)?this.map.set(this.getKey(o),o):EU(o)?this.map.set(o.id,o):xU(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ft(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ft(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ft(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>qR(a[c],o[c]))):this.values)),Ft(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=ob(ob({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ft(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=nr(r,this.name),this.storagePrefix=s,this.getKey=i}get context(){return rr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=ye("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:n}=ye("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=ye("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=ye("NOT_INITIALIZED",this.name);throw new Error(e)}}};var VR=Object.defineProperty,KR=(t,e,r)=>e in t?VR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ce=(t,e,r)=>KR(t,typeof e!="symbol"?e+"":e,r);let GR=class{constructor(e,r){this.core=e,this.logger=r,ce(this,"name",WU),ce(this,"version",XU),ce(this,"events",new t0),ce(this,"pairings"),ce(this,"initialized",!1),ce(this,"storagePrefix",ln),ce(this,"ignoredPayloadTypes",[va]),ce(this,"registeredMethods",[]),ce(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ce(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),ce(this,"create",async n=>{this.isInitialized();const s=Kd(),i=await this.core.crypto.setSymKey(s),o=sc(Z.FIVE_MINUTES),a={protocol:tE},c={topic:i,expiry:o,relay:a,active:!1,methods:n?.methods},f=Dy({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:s,relay:a,expiryTimestamp:o,methods:n?.methods});return this.events.emit(ji.create,c),this.core.expirer.set(i,o),await this.pairings.set(i,c),await this.core.relayer.subscribe(i,{transportType:n?.transportType,internal:n?.internal}),{topic:i,uri:f}}),ce(this,"pair",async n=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:n?.uri,trace:[tn.pairing_started]}});this.isValidPair(n,s);const{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:f}=ky(n.uri);s.props.properties.topic=i,s.addTrace(tn.pairing_uri_validation_success),s.addTrace(tn.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(i)){if(l=this.pairings.get(i),s.addTrace(tn.existing_pairing),l.active)throw s.setError(On.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);s.addTrace(tn.pairing_not_expired)}const h=c||sc(Z.FIVE_MINUTES),u={topic:i,relay:a,expiry:h,active:!1,methods:f};this.core.expirer.set(i,h),await this.pairings.set(i,u),s.addTrace(tn.store_new_pairing),n.activatePairing&&await this.activate({topic:i}),this.events.emit(ji.create,u),s.addTrace(tn.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(o,i),s.addTrace(tn.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(On.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:a})}catch(d){throw s.setError(On.subscribe_pairing_topic_failure),d}return s.addTrace(tn.subscribe_pairing_topic_success),u}),ce(this,"activate",async({topic:n})=>{this.isInitialized();const s=sc(Z.FIVE_MINUTES);this.core.expirer.set(n,s),await this.pairings.update(n,{active:!0,expiry:s})}),ce(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=n;if(this.pairings.keys.includes(s)){const i=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=ZO();this.events.once(qu("pairing_ping",i),({error:f})=>{f?c(f):a()}),await o()}}),ce(this,"updateExpiry",async({topic:n,expiry:s})=>{this.isInitialized(),await this.pairings.update(n,{expiry:s})}),ce(this,"updateMetadata",async({topic:n,metadata:s})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:s})}),ce(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ce(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:s}=n;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Ya("USER_DISCONNECTED")),await this.deletePairing(s))}),ce(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:s,relay:i,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(s);return Dy({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),ce(this,"sendRequest",async(n,s,i)=>{const o=nn(s,i),a=await this.core.crypto.encode(n,o),c=Oa[s].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),ce(this,"sendResult",async(n,s,i)=>{const o=uc(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,f=Oa[c].res;await this.core.relayer.publish(s,a,f),await this.core.history.resolve(o)}),ce(this,"sendError",async(n,s,i)=>{const o=J2(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,f=Oa[c]?Oa[c].res:Oa.unregistered_method.res;await this.core.relayer.publish(s,a,f),await this.core.history.resolve(o)}),ce(this,"deletePairing",async(n,s)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Ya("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),s?Promise.resolve():this.core.expirer.del(n)])}),ce(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(s=>ly(s.expiry));await Promise.all(n.map(s=>this.deletePairing(s.topic)))}),ce(this,"onRelayEventRequest",async n=>{const{topic:s,payload:i}=n;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,i);default:return await this.onUnknownRpcMethodRequest(s,i)}}),ce(this,"onRelayEventResponse",async n=>{const{topic:s,payload:i}=n,o=(await this.core.history.get(s,i.id)).request.method;return o==="wc_pairingPing"?this.onPairingPingResponse(s,i):this.onUnknownRpcMethodResponse(o)}),ce(this,"onPairingPingRequest",async(n,s)=>{const{id:i}=s;try{this.isValidPing({topic:n}),await this.sendResult(i,n,!0),this.events.emit(ji.ping,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),ce(this,"onPairingPingResponse",(n,s)=>{const{id:i}=s;setTimeout(()=>{Bn(s)?this.events.emit(qu("pairing_ping",i),{}):rn(s)&&this.events.emit(qu("pairing_ping",i),{error:s.error})},500)}),ce(this,"onPairingDeleteRequest",async(n,s)=>{const{id:i}=s;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(ji.delete,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),ce(this,"onUnknownRpcMethodRequest",async(n,s)=>{const{id:i,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=Ya("WC_METHOD_UNSUPPORTED",o);await this.sendError(i,n,a),this.logger.error(a)}catch(a){await this.sendError(i,n,a),this.logger.error(a)}}),ce(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(Ya("WC_METHOD_UNSUPPORTED",n))}),ce(this,"isValidPair",(n,s)=>{var i;if(!Ju(n)){const{message:a}=ye("MISSING_OR_INVALID",`pair() params: ${n}`);throw s.setError(On.malformed_pairing_uri),new Error(a)}if(!vU(n.uri)){const{message:a}=ye("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw s.setError(On.malformed_pairing_uri),new Error(a)}const o=ky(n?.uri);if(!((i=o?.relay)!=null&&i.protocol)){const{message:a}=ye("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(On.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=ye("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(On.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&Z.toMiliseconds(o?.expiryTimestamp)<Date.now()){s.setError(On.pairing_expired);const{message:a}=ye("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ce(this,"isValidPing",async n=>{if(!Ju(n)){const{message:i}=ye("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),ce(this,"isValidDisconnect",async n=>{if(!Ju(n)){const{message:i}=ye("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),ce(this,"isValidPairingTopic",async n=>{if(!Jv(n)){const{message:s}=ye("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(s)}if(!this.pairings.keys.includes(n)){const{message:s}=ye("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(s)}if(ly(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:s}=ye("EXPIRED",`pairing topic: ${n}`);throw new Error(s)}}),this.core=e,this.logger=nr(r,this.name),this.pairings=new bo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return rr(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=ye("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(xe.message,async e=>{const{topic:r,message:n,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==ve.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const i=await this.core.crypto.decode(r,n);Qp(i)?(this.core.history.set(r,i),await this.onRelayEventRequest({topic:r,payload:i})):e0(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:r,payload:i}),this.core.history.delete(r,i.id)),await this.core.relayer.messages.ack(r,n)}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(ar.expired,async e=>{const{topic:r}=XO(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(ji.expire,{topic:r}))})}};var ZR=Object.defineProperty,YR=(t,e,r)=>e in t?ZR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ke=(t,e,r)=>YR(t,typeof e!="symbol"?e+"":e,r);let WR=class extends kB{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ke(this,"records",new Map),Ke(this,"events",new wi.EventEmitter),Ke(this,"name",JU),Ke(this,"version",QU),Ke(this,"cached",[]),Ke(this,"initialized",!1),Ke(this,"storagePrefix",ln),Ke(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ke(this,"set",(n,s,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:s,chainId:i}),this.records.has(s.id))return;const o={id:s.id,topic:n,request:{method:s.method,params:s.params||null},chainId:i,expiry:sc(Z.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(vr.created,o)}),Ke(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const s=await this.getRecord(n.id);typeof s.response>"u"&&(s.response=rn(n)?{error:n.error}:{result:n.result},this.records.set(s.id,s),this.persist(),this.events.emit(vr.updated,s))}),Ke(this,"get",async(n,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:s}),await this.getRecord(s))),Ke(this,"delete",(n,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(i=>{if(i.topic===n){if(typeof s<"u"&&i.id!==s)return;this.records.delete(i.id),this.events.emit(vr.deleted,i)}}),this.persist()}),Ke(this,"exists",async(n,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===n:!1)),Ke(this,"on",(n,s)=>{this.events.on(n,s)}),Ke(this,"once",(n,s)=>{this.events.once(n,s)}),Ke(this,"off",(n,s)=>{this.events.off(n,s)}),Ke(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=nr(r,this.name)}get context(){return rr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:nn(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=ye("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(vr.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=ye("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(vr.created,e=>{const r=vr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(vr.updated,e=>{const r=vr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(vr.deleted,e=>{const r=vr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(ba.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{Z.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(vr.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=ye("NOT_INITIALIZED",this.name);throw new Error(e)}}};var XR=Object.defineProperty,JR=(t,e,r)=>e in t?XR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lt=(t,e,r)=>JR(t,typeof e!="symbol"?e+"":e,r);let QR=class extends HB{constructor(e,r){super(e,r),this.core=e,this.logger=r,lt(this,"expirations",new Map),lt(this,"events",new wi.EventEmitter),lt(this,"name",eP),lt(this,"version",tP),lt(this,"cached",[]),lt(this,"initialized",!1),lt(this,"storagePrefix",ln),lt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),lt(this,"has",n=>{try{const s=this.formatTarget(n);return typeof this.getExpiration(s)<"u"}catch{return!1}}),lt(this,"set",(n,s)=>{this.isInitialized();const i=this.formatTarget(n),o={target:i,expiry:s};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(ar.created,{target:i,expiration:o})}),lt(this,"get",n=>{this.isInitialized();const s=this.formatTarget(n);return this.getExpiration(s)}),lt(this,"del",n=>{if(this.isInitialized(),this.has(n)){const s=this.formatTarget(n),i=this.getExpiration(s);this.expirations.delete(s),this.events.emit(ar.deleted,{target:s,expiration:i})}}),lt(this,"on",(n,s)=>{this.events.on(n,s)}),lt(this,"once",(n,s)=>{this.events.once(n,s)}),lt(this,"off",(n,s)=>{this.events.off(n,s)}),lt(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=nr(r,this.name)}get context(){return rr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return YO(e);if(typeof e=="number")return WO(e);const{message:r}=ye("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ar.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=ye("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=ye("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;Z.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ar.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(ba.pulse,()=>this.checkExpirations()),this.events.on(ar.created,e=>{const r=ar.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ar.expired,e=>{const r=ar.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ar.deleted,e=>{const r=ar.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=ye("NOT_INITIALIZED",this.name);throw new Error(e)}}};var eT=Object.defineProperty,tT=(t,e,r)=>e in t?eT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Se=(t,e,r)=>tT(t,typeof e!="symbol"?e+"":e,r);class rT extends VB{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,Se(this,"name",rP),Se(this,"abortController"),Se(this,"isDevEnv"),Se(this,"verifyUrlV3",sP),Se(this,"storagePrefix",ln),Se(this,"version",eE),Se(this,"publicKey"),Se(this,"fetchPromise"),Se(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&Z.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Se(this,"register",async s=>{if(!Uc()||this.isDevEnv)return;const i=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{const f=tr.getDocument(),l=this.startAbortTimer(Z.ONE_SECOND*5),h=await new Promise((u,d)=>{const g=()=>{window.removeEventListener("message",E),f.body.removeChild(b),d("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const b=f.createElement("iframe");b.src=c,b.style.display="none",b.addEventListener("error",g,{signal:this.abortController.signal});const E=U=>{if(U.data&&typeof U.data=="string")try{const L=JSON.parse(U.data);if(L.type==="verify_attestation"){if(Rd(L.attestation).payload.id!==o)return;clearInterval(l),f.body.removeChild(b),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",E),u(L.attestation===null?"":L.attestation)}}catch(L){this.logger.warn(L)}};f.body.appendChild(b),window.addEventListener("message",E,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(f){this.logger.warn(f)}return""}),Se(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:i,hash:o,encryptedId:a}=s;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(Rd(i).payload.id!==a)return;const f=await this.isValidJwtAttestation(i);if(f){if(!f.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return f}}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),Se(this,"fetchAttestation",async(s,i)=>{this.logger.debug(`resolving attestation: ${s} from url: ${i}`);const o=this.startAbortTimer(Z.ONE_SECOND*5),a=await fetch(`${i}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Se(this,"getVerifyUrl",s=>{let i=s||oc;return iP.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${oc}`),i=oc),i}),Se(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(Z.FIVE_SECONDS),i=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await i.json()}catch(s){this.logger.warn(s)}}),Se(this,"persistPublicKey",async s=>{this.logger.debug(s,"persisting public key to local storage"),await this.store.setItem(this.storeKey,s),this.publicKey=s}),Se(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Se(this,"isValidJwtAttestation",async s=>{const i=await this.getPublicKey();try{if(i)return this.validateAttestation(s,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Se(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Se(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async i=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),i(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),Se(this,"validateAttestation",(s,i)=>{const o=aU(s,i.publicKey),a={hasExpired:Z.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=nr(r,this.name),this.abortController=new AbortController,this.isDevEnv=rv(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return rr(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),Z.toMiliseconds(e))}}var nT=Object.defineProperty,sT=(t,e,r)=>e in t?nT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ab=(t,e,r)=>sT(t,typeof e!="symbol"?e+"":e,r);let iT=class extends KB{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,ab(this,"context",oP),ab(this,"registerDeviceToken",async n=>{const{clientId:s,token:i,notificationType:o,enableEncrypted:a=!1}=n,c=`${aP}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:i,always_raw:a})})}),this.logger=nr(r,this.context)}};var oT=Object.defineProperty,cb=Object.getOwnPropertySymbols,aT=Object.prototype.hasOwnProperty,cT=Object.prototype.propertyIsEnumerable,rp=(t,e,r)=>e in t?oT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ua=(t,e)=>{for(var r in e||(e={}))aT.call(e,r)&&rp(t,r,e[r]);if(cb)for(var r of cb(e))cT.call(e,r)&&rp(t,r,e[r]);return t},Ne=(t,e,r)=>rp(t,typeof e!="symbol"?e+"":e,r);let fT=class extends GB{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,Ne(this,"context",fP),Ne(this,"storagePrefix",ln),Ne(this,"storageVersion",cP),Ne(this,"events",new Map),Ne(this,"shouldPersist",!1),Ne(this,"init",async()=>{if(!rv())try{const s={eventId:uy(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:ev(this.core.relayer.protocol,this.core.relayer.version,Zd)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),Ne(this,"createEvent",s=>{const{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=s,f=uy(),l=this.core.projectId||"",h=Date.now(),u=Ua({eventId:f,timestamp:h,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,u),this.shouldPersist=!0),u}),Ne(this,"getEvent",s=>{const{eventId:i,topic:o}=s;if(i)return this.events.get(i);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ua(Ua({},a),this.setMethods(a.eventId))}),Ne(this,"deleteEvent",s=>{const{eventId:i}=s;this.events.delete(i),this.shouldPersist=!0}),Ne(this,"setEventListeners",()=>{this.core.heartbeat.on(ba.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{Z.fromMiliseconds(Date.now())-Z.fromMiliseconds(s.timestamp)>lP&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),Ne(this,"setMethods",s=>({addTrace:i=>this.addTrace(s,i),setError:i=>this.setError(s,i)})),Ne(this,"addTrace",(s,i)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(i),this.events.set(s,o),this.shouldPersist=!0)}),Ne(this,"setError",(s,i)=>{const o=this.events.get(s);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),Ne(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ne(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(i=>{this.events.set(i.eventId,Ua(Ua({},i),this.setMethods(i.eventId)))})}catch(s){this.logger.warn(s)}}),Ne(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[i,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const i of s)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}}),Ne(this,"sendEvent",async s=>{const i=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${uP}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Zd}${i}`,{method:"POST",body:JSON.stringify(s)})}),Ne(this,"getAppDomain",()=>HO().url),this.logger=nr(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}};var lT=Object.defineProperty,fb=Object.getOwnPropertySymbols,uT=Object.prototype.hasOwnProperty,hT=Object.prototype.propertyIsEnumerable,np=(t,e,r)=>e in t?lT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lb=(t,e)=>{for(var r in e||(e={}))uT.call(e,r)&&np(t,r,e[r]);if(fb)for(var r of fb(e))hT.call(e,r)&&np(t,r,e[r]);return t},we=(t,e,r)=>np(t,typeof e!="symbol"?e+"":e,r);let dT=class gE extends RB{constructor(e){var r;super(e),we(this,"protocol",Qv),we(this,"version",eE),we(this,"name",Gd),we(this,"relayUrl"),we(this,"projectId"),we(this,"customStoragePrefix"),we(this,"events",new wi.EventEmitter),we(this,"logger"),we(this,"heartbeat"),we(this,"relayer"),we(this,"crypto"),we(this,"storage"),we(this,"history"),we(this,"expirer"),we(this,"pairing"),we(this,"verify"),we(this,"echoClient"),we(this,"linkModeSupportedApps"),we(this,"eventClient"),we(this,"initialized",!1),we(this,"logChunkController"),we(this,"on",(a,c)=>this.events.on(a,c)),we(this,"once",(a,c)=>this.events.once(a,c)),we(this,"off",(a,c)=>this.events.off(a,c)),we(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),we(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:f})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:ve.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:f})});const n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||rE,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=SB({level:typeof e?.logger=="string"&&e.logger?e.logger:PU.logger,name:Gd}),{logger:i,chunkLoggerController:o}=E3({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=nr(i,this.name),this.heartbeat=new c5,this.crypto=new jC(this,this.logger,e?.keychain),this.history=new WR(this,this.logger),this.expirer=new QR(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new f5(lb(lb({},CU),e?.storageOptions)),this.relayer=new dR({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new GR(this,this.logger),this.verify=new rT(this,this.logger,this.storage),this.echoClient=new iT(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new fT(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new gE(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(GU,n),r}get context(){return rr(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(zy,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(zy)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&UU.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const pT=dT;var gT=Object.defineProperty,yT=(t,e,r)=>e in t?gT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ub=(t,e,r)=>yT(t,typeof e!="symbol"?e+"":e,r);let bT=class{constructor(e){this.opts=e,ub(this,"protocol","wc"),ub(this,"version",2)}},wT=class{constructor(e){this.client=e}};const mT="0.1.1";function vT(){return mT}class Ee extends Error{constructor(e,r={}){const n=(()=>{if(r.cause instanceof Ee){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),s=r.cause instanceof Ee&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${s??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||s?["",n?`Details: ${n}`:void 0,s?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${vT()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=s,this.shortMessage=e}walk(e){return yE(this,e)}}function yE(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?yE(t.cause,e):e?null:t}const Ao=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ET(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function bc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ho(t,...e){if(!ET(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function xT(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");bc(t.outputLen),bc(t.blockLen)}function fa(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function bE(t,e){ho(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function $T(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function la(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function rh(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Yr(t,e){return t<<32-e|t>>>e}const IT=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function BT(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function AT(t){for(let e=0;e<t.length;e++)t[e]=BT(t[e]);return t}const hb=IT?t=>t:AT;function ST(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Wl(t){return typeof t=="string"&&(t=ST(t)),ho(t),t}function OT(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];ho(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}class z0{}function wE(t){const e=n=>t().update(Wl(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function _T(t=32){if(Ao&&typeof Ao.getRandomValues=="function")return Ao.getRandomValues(new Uint8Array(t));if(Ao&&typeof Ao.randomBytes=="function")return Uint8Array.from(Ao.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function FT(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function UT(t,e,r){return t&e^~t&r}function PT(t,e,r){return t&e^t&r^e&r}class CT extends z0{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=rh(this.buffer)}update(e){fa(this),e=Wl(e),ho(e);const{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=rh(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){fa(this),bE(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,la(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;FT(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=rh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const ds=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),uf=BigInt(2**32-1),db=BigInt(32);function RT(t,e=!1){return e?{h:Number(t&uf),l:Number(t>>db&uf)}:{h:Number(t>>db&uf)|0,l:Number(t&uf)|0}}function TT(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=RT(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const LT=(t,e,r)=>t<<r|e>>>32-r,NT=(t,e,r)=>e<<r|t>>>32-r,kT=(t,e,r)=>e<<r-32|t>>>64-r,DT=(t,e,r)=>t<<r-32|e>>>64-r,jT=BigInt(0),Pa=BigInt(1),qT=BigInt(2),zT=BigInt(7),MT=BigInt(256),HT=BigInt(113),mE=[],vE=[],EE=[];for(let t=0,e=Pa,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],mE.push(2*(5*n+r)),vE.push((t+1)*(t+2)/2%64);let s=jT;for(let i=0;i<7;i++)e=(e<<Pa^(e>>zT)*HT)%MT,e&qT&&(s^=Pa<<(Pa<<BigInt(i))-Pa);EE.push(s)}const xE=TT(EE,!0),VT=xE[0],KT=xE[1],pb=(t,e,r)=>r>32?kT(t,e,r):LT(t,e,r),gb=(t,e,r)=>r>32?DT(t,e,r):NT(t,e,r);function GT(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=r[c],l=r[c+1],h=pb(f,l,1)^r[a],u=gb(f,l,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=u}let s=t[2],i=t[3];for(let o=0;o<24;o++){const a=vE[o],c=pb(s,i,a),f=gb(s,i,a),l=mE[o];s=t[l],i=t[l+1],t[l]=c,t[l+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=VT[n],t[1]^=KT[n]}la(r)}class M0 extends z0{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,bc(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=$T(this.state)}clone(){return this._cloneInto()}keccak(){hb(this.state32),GT(this.state32,this.rounds),hb(this.state32),this.posOut=0,this.pos=0}update(e){fa(this),e=Wl(e),ho(e);const{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){fa(this,!1),ho(e),this.finish();const r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return bc(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(bE(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,la(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new M0(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const ZT=(t,e,r)=>wE(()=>new M0(e,t,r)),YT=ZT(1,136,256/8),WT=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ps=new Uint32Array(64);class XT extends CT{constructor(e=32){super(64,e,8,!1),this.A=ds[0]|0,this.B=ds[1]|0,this.C=ds[2]|0,this.D=ds[3]|0,this.E=ds[4]|0,this.F=ds[5]|0,this.G=ds[6]|0,this.H=ds[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)ps[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const u=ps[h-15],d=ps[h-2],g=Yr(u,7)^Yr(u,18)^u>>>3,b=Yr(d,17)^Yr(d,19)^d>>>10;ps[h]=b+ps[h-7]+g+ps[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:f,H:l}=this;for(let h=0;h<64;h++){const u=Yr(a,6)^Yr(a,11)^Yr(a,25),d=l+u+UT(a,c,f)+WT[h]+ps[h]|0,b=(Yr(n,2)^Yr(n,13)^Yr(n,22))+PT(n,s,i)|0;l=f,f=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+b|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(n,s,i,o,a,c,f,l)}roundClean(){la(ps)}destroy(){this.set(0,0,0,0,0,0,0,0),la(this.buffer)}}const JT=wE(()=>new XT);const H0=BigInt(0),sp=BigInt(1);function Lc(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function V0(t){if(!Lc(t))throw new Error("Uint8Array expected")}function wc(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function hf(t){const e=t.toString(16);return e.length&1?"0"+e:e}function $E(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?H0:BigInt("0x"+t)}const IE=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",QT=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function mc(t){if(V0(t),IE)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=QT[t[r]];return e}const bn={_0:48,_9:57,A:65,F:70,a:97,f:102};function yb(t){if(t>=bn._0&&t<=bn._9)return t-bn._0;if(t>=bn.A&&t<=bn.F)return t-(bn.A-10);if(t>=bn.a&&t<=bn.f)return t-(bn.a-10)}function hl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(IE)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=yb(t.charCodeAt(i)),a=yb(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function io(t){return $E(mc(t))}function BE(t){return V0(t),$E(mc(Uint8Array.from(t).reverse()))}function Nc(t,e){return hl(t.toString(16).padStart(e*2,"0"))}function AE(t,e){return Nc(t,e).reverse()}function cr(t,e,r){let n;if(typeof e=="string")try{n=hl(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Lc(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function dl(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];V0(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}const nh=t=>typeof t=="bigint"&&H0<=t;function K0(t,e,r){return nh(t)&&nh(e)&&nh(r)&&e<=t&&t<r}function Wo(t,e,r,n){if(!K0(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function eL(t){let e;for(e=0;t>H0;t>>=sp,e+=1);return e}const Xl=t=>(sp<<BigInt(t))-sp,sh=t=>new Uint8Array(t),bb=t=>Uint8Array.from(t);function tL(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=sh(t),s=sh(t),i=0;const o=()=>{n.fill(1),s.fill(0),i=0},a=(...h)=>r(s,n,...h),c=(h=sh(0))=>{s=a(bb([0]),h),n=a(),h.length!==0&&(s=a(bb([1]),h),n=a())},f=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const u=[];for(;h<e;){n=a();const d=n.slice();u.push(d),h+=n.length}return dl(...u)};return(h,u)=>{o(),c(h);let d;for(;!(d=u(f()));)c();return o(),d}}const rL={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Lc(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Jl(t,e,r={}){const n=(s,i,o)=>{const a=rL[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(r))n(s,i,!0);return t}function wb(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}function nL(t,e){if(xb(t)>e)throw new IL({givenSize:xb(t),maxSize:e})}const wn={zero:48,nine:57,A:65,F:70,a:97,f:102};function mb(t){if(t>=wn.zero&&t<=wn.nine)return t-wn.zero;if(t>=wn.A&&t<=wn.F)return t-(wn.A-10);if(t>=wn.a&&t<=wn.f)return t-(wn.a-10)}function sL(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new BL({size:t.length,targetSize:n,type:"Bytes"});const s=new Uint8Array(n);for(let i=0;i<n;i++){const o=r==="right";s[o?i:n-i-1]=t[o?i:t.length-i-1]}return s}function SE(t,e){if(di(t)>e)throw new pL({givenSize:di(t),maxSize:e})}function iL(t,e){if(typeof e=="number"&&e>0&&e>di(t)-1)throw new FE({offset:e,position:"start",size:di(t)})}function oL(t,e,r){if(typeof e=="number"&&typeof r=="number"&&di(t)!==r-e)throw new FE({offset:r,position:"end",size:di(t)})}function OE(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const s=t.replace("0x","");if(s.length>n*2)throw new gL({size:Math.ceil(s.length/2),targetSize:n,type:"Hex"});return`0x${s[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const aL="#__bigint";function G0(t,e,r){return JSON.stringify(t,(n,s)=>typeof s=="bigint"?s.toString()+aL:s,r)}const cL=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function fL(t,e={}){const{strict:r=!1}=e;if(!t)throw new vb(t);if(typeof t!="string")throw new vb(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new Eb(t);if(!t.startsWith("0x"))throw new Eb(t)}function lL(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Z0(t){return t instanceof Uint8Array?pl(t):Array.isArray(t)?pl(new Uint8Array(t)):t}function pl(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=cL[t[s]];const n=`0x${r}`;return typeof e.size=="number"?(SE(n,e.size),_E(n,e.size)):n}function ih(t,e={}){const{signed:r,size:n}=e,s=BigInt(t);let i;n?r?i=(1n<<BigInt(n)*8n-1n)-1n:i=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&r?-i-1n:0;if(i&&s>i||s<o){const f=typeof t=="bigint"?"n":"";throw new dL({max:i?`${i}${f}`:void 0,min:`${o}${f}`,signed:r,size:n,value:`${t}${f}`})}const c=`0x${(r&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?uL(c,n):c}function uL(t,e){return OE(t,{dir:"left",size:e})}function _E(t,e){return OE(t,{dir:"right",size:e})}function Un(t,e,r,n={}){const{strict:s}=n;iL(t,e);const i=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return s&&oL(i,e,r),i}function di(t){return Math.ceil((t.length-2)/2)}function hL(t,e={}){const{strict:r=!1}=e;try{return fL(t,{strict:r}),!0}catch{return!1}}class dL extends Ee{constructor({max:e,min:r,signed:n,size:s,value:i}){super(`Number \`${i}\` is not in safe${s?` ${s*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class vb extends Ee{constructor(e){super(`Value \`${typeof e=="object"?G0(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class Eb extends Ee{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let pL=class extends Ee{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class FE extends Ee{constructor({offset:e,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let gL=class extends Ee{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const yL=new TextEncoder;function bL(t){if(!(t instanceof Uint8Array)){if(!t)throw new df(t);if(typeof t!="object")throw new df(t);if(!("BYTES_PER_ELEMENT"in t))throw new df(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new df(t)}}function wL(t){return t instanceof Uint8Array?t:typeof t=="string"?vL(t):mL(t)}function mL(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function vL(t,e={}){const{size:r}=e;let n=t;r&&(SE(t,r),n=_E(t,r));let s=n.slice(2);s.length%2&&(s=`0${s}`);const i=s.length/2,o=new Uint8Array(i);for(let a=0,c=0;a<i;a++){const f=mb(s.charCodeAt(c++)),l=mb(s.charCodeAt(c++));if(f===void 0||l===void 0)throw new Ee(`Invalid byte sequence ("${s[c-2]}${s[c-1]}" in "${s}").`);o[a]=f*16+l}return o}function EL(t,e={}){const{size:r}=e,n=yL.encode(t);return typeof r=="number"?(nL(n,r),xL(n,r)):n}function xL(t,e){return sL(t,{dir:"right",size:e})}function xb(t){return t.length}function $L(t){try{return bL(t),!0}catch{return!1}}class df extends Ee{constructor(e){super(`Value \`${typeof e=="object"?G0(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class IL extends Ee{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class BL extends Ee{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function UE(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=YT(wL(t));return r==="Bytes"?n:pl(n)}class AL extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const SL={checksum:new AL(8192)},oh=SL.checksum;function PE(t,e={}){const{compressed:r}=e,{prefix:n,x:s,y:i}=t;if(r===!1||typeof s=="bigint"&&typeof i=="bigint"){if(n!==4)throw new $b({prefix:n,cause:new CL});return}if(r===!0||typeof s=="bigint"&&typeof i>"u"){if(n!==3&&n!==2)throw new $b({prefix:n,cause:new PL});return}throw new UL({publicKey:t})}function OL(t){const e=(()=>{if(hL(t))return CE(t);if($L(t))return _L(t);const{prefix:r,x:n,y:s}=t;return typeof n=="bigint"&&typeof s=="bigint"?{prefix:r??4,x:n,y:s}:{prefix:r,x:n}})();return PE(e),e}function _L(t){return CE(pl(t))}function CE(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new RL({publicKey:t});if(t.length===130){const n=BigInt(Un(t,0,32)),s=BigInt(Un(t,32,64));return{prefix:4,x:n,y:s}}if(t.length===132){const n=Number(Un(t,0,1)),s=BigInt(Un(t,1,33)),i=BigInt(Un(t,33,65));return{prefix:n,x:s,y:i}}const e=Number(Un(t,0,1)),r=BigInt(Un(t,1,33));return{prefix:e,x:r}}function FL(t,e={}){PE(t);const{prefix:r,x:n,y:s}=t,{includePrefix:i=!0}=e;return lL(i?ih(r,{size:1}):"0x",ih(n,{size:32}),typeof s=="bigint"?ih(s,{size:32}):"0x")}class UL extends Ee{constructor({publicKey:e}){super(`Value \`${G0(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class $b extends Ee{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class PL extends Ee{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class CL extends Ee{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let RL=class extends Ee{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${di(Z0(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const TL=/^0x[a-fA-F0-9]{40}$/;function RE(t,e={}){const{strict:r=!0}=e;if(!TL.test(t))throw new Ib({address:t,cause:new kL});if(r){if(t.toLowerCase()===t)return;if(TE(t)!==t)throw new Ib({address:t,cause:new DL})}}function TE(t){if(oh.has(t))return oh.get(t);RE(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=UE(EL(e),{as:"Bytes"}),n=e.split("");for(let i=0;i<40;i+=2)r[i>>1]>>4>=8&&n[i]&&(n[i]=n[i].toUpperCase()),(r[i>>1]&15)>=8&&n[i+1]&&(n[i+1]=n[i+1].toUpperCase());const s=`0x${n.join("")}`;return oh.set(t,s),s}function LL(t,e={}){const{checksum:r=!1}=e;return RE(t),r?TE(t):t}function NL(t,e={}){const r=UE(`0x${FL(t).slice(4)}`).substring(26);return LL(`0x${r}`,e)}class Ib extends Ee{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class kL extends Ee{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class DL extends Ee{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class LE extends z0{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,xT(e);const n=Wl(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),la(i)}update(e){return fa(this),this.iHash.update(e),this}digestInto(e){fa(this),ho(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const NE=(t,e,r)=>new LE(t,e).update(r).digest();NE.create=(t,e)=>new LE(t,e);const qt=BigInt(0),Bt=BigInt(1),Wi=BigInt(2),jL=BigInt(3),kE=BigInt(4),DE=BigInt(5),jE=BigInt(8);function Lt(t,e){const r=t%e;return r>=qt?r:e+r}function or(t,e,r){let n=t;for(;e-- >qt;)n*=n,n%=r;return n}function ip(t,e){if(t===qt)throw new Error("invert: expected non-zero number");if(e<=qt)throw new Error("invert: expected positive modulus, got "+e);let r=Lt(t,e),n=e,s=qt,i=Bt;for(;r!==qt;){const a=n/r,c=n%r,f=s-i*a;n=r,r=c,s=i,i=f}if(n!==Bt)throw new Error("invert: does not exist");return Lt(s,e)}function qE(t,e){const r=(t.ORDER+Bt)/kE,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function qL(t,e){const r=(t.ORDER-DE)/jE,n=t.mul(e,Wi),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,Wi),s),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function zL(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Bt,r=0;for(;e%Wi===qt;)e/=Wi,r++;let n=Wi;const s=Y0(t);for(;Bb(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return qE;let i=s.pow(n,e);const o=(e+Bt)/Wi;return function(c,f){if(c.is0(f))return f;if(Bb(c,f)!==1)throw new Error("Cannot find square root");let l=r,h=c.mul(c.ONE,i),u=c.pow(f,e),d=c.pow(f,o);for(;!c.eql(u,c.ONE);){if(c.is0(u))return c.ZERO;let g=1,b=c.sqr(u);for(;!c.eql(b,c.ONE);)if(g++,b=c.sqr(b),g===l)throw new Error("Cannot find square root");const E=Bt<<BigInt(l-g-1),U=c.pow(h,E);l=g,h=c.sqr(U),u=c.mul(u,h),d=c.mul(d,U)}return d}}function ML(t){return t%kE===jL?qE:t%jE===DE?qL:zL(t)}const HL=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function VL(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=HL.reduce((n,s)=>(n[s]="function",n),e);return Jl(t,r)}function KL(t,e,r){if(r<qt)throw new Error("invalid exponent, negatives unsupported");if(r===qt)return t.ONE;if(r===Bt)return e;let n=t.ONE,s=e;for(;r>qt;)r&Bt&&(n=t.mul(n,s)),s=t.sqr(s),r>>=Bt;return n}function zE(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function Bb(t,e){const r=(t.ORDER-Bt)/Wi,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function ME(t,e){e!==void 0&&bc(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Y0(t,e,r=!1,n={}){if(t<=qt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:i}=ME(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:Xl(s),ZERO:qt,ONE:Bt,create:c=>Lt(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return qt<=c&&c<t},is0:c=>c===qt,isOdd:c=>(c&Bt)===Bt,neg:c=>Lt(-c,t),eql:(c,f)=>c===f,sqr:c=>Lt(c*c,t),add:(c,f)=>Lt(c+f,t),sub:(c,f)=>Lt(c-f,t),mul:(c,f)=>Lt(c*f,t),pow:(c,f)=>KL(a,c,f),div:(c,f)=>Lt(c*ip(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>ip(c,t),sqrt:n.sqrt||(c=>(o||(o=ML(t)),o(a,c))),toBytes:c=>r?AE(c,i):Nc(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?BE(c):io(c)},invertBatch:c=>zE(a,c),cmov:(c,f,l)=>l?f:c});return Object.freeze(a)}function HE(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function VE(t){const e=HE(t);return e+Math.ceil(e/2)}function GL(t,e,r=!1){const n=t.length,s=HE(e),i=VE(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?BE(t):io(t),a=Lt(o,e-Bt)+Bt;return r?AE(a,s):Nc(a,s)}const Ab=BigInt(0),op=BigInt(1);function ah(t,e){const r=e.negate();return t?r:e}function KE(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ch(t,e){KE(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=Xl(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function Sb(t,e,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=op);const f=e*n,l=f+Math.abs(a)-1,h=a===0,u=a<0,d=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:u,isNegF:d,offsetF:f}}function ZL(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function YL(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const fh=new WeakMap,GE=new WeakMap;function lh(t){return GE.get(t)||1}function WL(t,e){return{constTimeNegate:ah,hasPrecomputes(r){return lh(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>Ab;)n&op&&(s=s.add(i)),i=i.double(),n>>=op;return s},precomputeWindow(r,n){const{windows:s,windowSize:i}=ch(n,e),o=[];let a=r,c=a;for(let f=0;f<s;f++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){let i=t.ZERO,o=t.BASE;const a=ch(r,e);for(let c=0;c<a.windows;c++){const{nextN:f,offset:l,isZero:h,isNeg:u,isNegF:d,offsetF:g}=Sb(s,c,a);s=f,h?o=o.add(ah(d,n[g])):i=i.add(ah(u,n[l]))}return{p:i,f:o}},wNAFUnsafe(r,n,s,i=t.ZERO){const o=ch(r,e);for(let a=0;a<o.windows&&s!==Ab;a++){const{nextN:c,offset:f,isZero:l,isNeg:h}=Sb(s,a,o);if(s=c,!l){const u=n[f];i=i.add(h?u.negate():u)}}return i},getPrecomputes(r,n,s){let i=fh.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&fh.set(n,s(i))),i},wNAFCached(r,n,s){const i=lh(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){const o=lh(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){KE(n,e),GE.set(r,n),fh.delete(r)}}}function XL(t,e,r,n){ZL(r,t),YL(n,e);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=eL(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=Xl(c),l=new Array(Number(f)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let u=o;for(let d=h;d>=0;d-=c){l.fill(o);for(let b=0;b<i;b++){const E=n[b],U=Number(E>>BigInt(d)&f);l[U]=l[U].add(r[b])}let g=o;for(let b=l.length-1,E=o;b>0;b--)E=E.add(l[b]),g=g.add(E);if(u=u.add(g),d!==0)for(let b=0;b<c;b++)u=u.double()}return u}function ZE(t){return VL(t.Fp),Jl(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ME(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Ob(t){t.lowS!==void 0&&wc("lowS",t.lowS),t.prehash!==void 0&&wc("prehash",t.prehash)}function JL(t){const e=ZE(t);Jl(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:s}=e;if(r){if(!n.eql(s,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class QL extends Error{constructor(e=""){super(e)}}const Rn={Err:QL,_tlv:{encode:(t,e)=>{const{Err:r}=Rn;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=hf(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?hf(s.length/2|128):"";return hf(t)+i+s+e},decode(t,e){const{Err:r}=Rn;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of f)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Rn;if(t<Nn)throw new e("integer: negative integers are not allowed");let r=hf(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Rn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return io(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Rn,s=cr("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:f,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=Rn,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}};function uh(t,e){return mc(Nc(t,e))}const Nn=BigInt(0),ke=BigInt(1);BigInt(2);const hh=BigInt(3),eN=BigInt(4);function tN(t){const e=JL(t),{Fp:r}=e,n=Y0(e.n,e.nBitLength),s=e.toBytes||(($,F,P)=>{const C=F.toAffine();return dl(Uint8Array.from([4]),r.toBytes(C.x),r.toBytes(C.y))}),i=e.fromBytes||($=>{const F=$.subarray(1),P=r.fromBytes(F.subarray(0,r.BYTES)),C=r.fromBytes(F.subarray(r.BYTES,2*r.BYTES));return{x:P,y:C}});function o($){const{a:F,b:P}=e,C=r.sqr($),T=r.mul(C,$);return r.add(r.add(T,r.mul($,F)),P)}function a($,F){const P=r.sqr(F),C=o($);return r.eql(P,C)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,hh),eN),f=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,f)))throw new Error("bad curve params: a or b");function l($){return K0($,ke,e.n)}function h($){const{allowedPrivateKeyLengths:F,nByteLength:P,wrapPrivateKey:C,n:T}=e;if(F&&typeof $!="bigint"){if(Lc($)&&($=mc($)),typeof $!="string"||!F.includes($.length))throw new Error("invalid private key");$=$.padStart(P*2,"0")}let R;try{R=typeof $=="bigint"?$:io(cr("private key",$,P))}catch{throw new Error("invalid private key, expected hex or "+P+" bytes, got "+typeof $)}return C&&(R=Lt(R,T)),Wo("private key",R,ke,T),R}function u($){if(!($ instanceof b))throw new Error("ProjectivePoint expected")}const d=wb(($,F)=>{const{px:P,py:C,pz:T}=$;if(r.eql(T,r.ONE))return{x:P,y:C};const R=$.is0();F==null&&(F=R?r.ONE:r.inv(T));const A=r.mul(P,F),j=r.mul(C,F),q=r.mul(T,F);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(q,r.ONE))throw new Error("invZ was invalid");return{x:A,y:j}}),g=wb($=>{if($.is0()){if(e.allowInfinityPoint&&!r.is0($.py))return;throw new Error("bad point: ZERO")}const{x:F,y:P}=$.toAffine();if(!r.isValid(F)||!r.isValid(P))throw new Error("bad point: x or y not FE");if(!a(F,P))throw new Error("bad point: equation left != right");if(!$.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class b{constructor(F,P,C){if(F==null||!r.isValid(F))throw new Error("x required");if(P==null||!r.isValid(P)||r.is0(P))throw new Error("y required");if(C==null||!r.isValid(C))throw new Error("z required");this.px=F,this.py=P,this.pz=C,Object.freeze(this)}static fromAffine(F){const{x:P,y:C}=F||{};if(!F||!r.isValid(P)||!r.isValid(C))throw new Error("invalid affine point");if(F instanceof b)throw new Error("projective point not allowed");const T=R=>r.eql(R,r.ZERO);return T(P)&&T(C)?b.ZERO:new b(P,C,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(F){const P=zE(r,F.map(C=>C.pz));return F.map((C,T)=>C.toAffine(P[T])).map(b.fromAffine)}static fromHex(F){const P=b.fromAffine(i(cr("pointHex",F)));return P.assertValidity(),P}static fromPrivateKey(F){return b.BASE.multiply(h(F))}static msm(F,P){return XL(b,n,F,P)}_setWindowSize(F){L.setWindowSize(this,F)}assertValidity(){g(this)}hasEvenY(){const{y:F}=this.toAffine();if(r.isOdd)return!r.isOdd(F);throw new Error("Field doesn't support isOdd")}equals(F){u(F);const{px:P,py:C,pz:T}=this,{px:R,py:A,pz:j}=F,q=r.eql(r.mul(P,j),r.mul(R,T)),S=r.eql(r.mul(C,j),r.mul(A,T));return q&&S}negate(){return new b(this.px,r.neg(this.py),this.pz)}double(){const{a:F,b:P}=e,C=r.mul(P,hh),{px:T,py:R,pz:A}=this;let j=r.ZERO,q=r.ZERO,S=r.ZERO,m=r.mul(T,T),x=r.mul(R,R),y=r.mul(A,A),p=r.mul(T,R);return p=r.add(p,p),S=r.mul(T,A),S=r.add(S,S),j=r.mul(F,S),q=r.mul(C,y),q=r.add(j,q),j=r.sub(x,q),q=r.add(x,q),q=r.mul(j,q),j=r.mul(p,j),S=r.mul(C,S),y=r.mul(F,y),p=r.sub(m,y),p=r.mul(F,p),p=r.add(p,S),S=r.add(m,m),m=r.add(S,m),m=r.add(m,y),m=r.mul(m,p),q=r.add(q,m),y=r.mul(R,A),y=r.add(y,y),m=r.mul(y,p),j=r.sub(j,m),S=r.mul(y,x),S=r.add(S,S),S=r.add(S,S),new b(j,q,S)}add(F){u(F);const{px:P,py:C,pz:T}=this,{px:R,py:A,pz:j}=F;let q=r.ZERO,S=r.ZERO,m=r.ZERO;const x=e.a,y=r.mul(e.b,hh);let p=r.mul(P,R),v=r.mul(C,A),I=r.mul(T,j),w=r.add(P,C),B=r.add(R,A);w=r.mul(w,B),B=r.add(p,v),w=r.sub(w,B),B=r.add(P,T);let O=r.add(R,j);return B=r.mul(B,O),O=r.add(p,I),B=r.sub(B,O),O=r.add(C,T),q=r.add(A,j),O=r.mul(O,q),q=r.add(v,I),O=r.sub(O,q),m=r.mul(x,B),q=r.mul(y,I),m=r.add(q,m),q=r.sub(v,m),m=r.add(v,m),S=r.mul(q,m),v=r.add(p,p),v=r.add(v,p),I=r.mul(x,I),B=r.mul(y,B),v=r.add(v,I),I=r.sub(p,I),I=r.mul(x,I),B=r.add(B,I),p=r.mul(v,B),S=r.add(S,p),p=r.mul(O,B),q=r.mul(w,q),q=r.sub(q,p),p=r.mul(w,v),m=r.mul(O,m),m=r.add(m,p),new b(q,S,m)}subtract(F){return this.add(F.negate())}is0(){return this.equals(b.ZERO)}wNAF(F){return L.wNAFCached(this,F,b.normalizeZ)}multiplyUnsafe(F){const{endo:P,n:C}=e;Wo("scalar",F,Nn,C);const T=b.ZERO;if(F===Nn)return T;if(this.is0()||F===ke)return this;if(!P||L.hasPrecomputes(this))return L.wNAFCachedUnsafe(this,F,b.normalizeZ);let{k1neg:R,k1:A,k2neg:j,k2:q}=P.splitScalar(F),S=T,m=T,x=this;for(;A>Nn||q>Nn;)A&ke&&(S=S.add(x)),q&ke&&(m=m.add(x)),x=x.double(),A>>=ke,q>>=ke;return R&&(S=S.negate()),j&&(m=m.negate()),m=new b(r.mul(m.px,P.beta),m.py,m.pz),S.add(m)}multiply(F){const{endo:P,n:C}=e;Wo("scalar",F,ke,C);let T,R;if(P){const{k1neg:A,k1:j,k2neg:q,k2:S}=P.splitScalar(F);let{p:m,f:x}=this.wNAF(j),{p:y,f:p}=this.wNAF(S);m=L.constTimeNegate(A,m),y=L.constTimeNegate(q,y),y=new b(r.mul(y.px,P.beta),y.py,y.pz),T=m.add(y),R=x.add(p)}else{const{p:A,f:j}=this.wNAF(F);T=A,R=j}return b.normalizeZ([T,R])[0]}multiplyAndAddUnsafe(F,P,C){const T=b.BASE,R=(j,q)=>q===Nn||q===ke||!j.equals(T)?j.multiplyUnsafe(q):j.multiply(q),A=R(this,P).add(R(F,C));return A.is0()?void 0:A}toAffine(F){return d(this,F)}isTorsionFree(){const{h:F,isTorsionFree:P}=e;if(F===ke)return!0;if(P)return P(b,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:F,clearCofactor:P}=e;return F===ke?this:P?P(b,this):this.multiplyUnsafe(e.h)}toRawBytes(F=!0){return wc("isCompressed",F),this.assertValidity(),s(b,this,F)}toHex(F=!0){return wc("isCompressed",F),mc(this.toRawBytes(F))}}b.BASE=new b(e.Gx,e.Gy,r.ONE),b.ZERO=new b(r.ZERO,r.ONE,r.ZERO);const{endo:E,nBitLength:U}=e,L=WL(b,E?Math.ceil(U/2):U);return{CURVE:e,ProjectivePoint:b,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function rN(t){const e=ZE(t);return Jl(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function nN(t){const e=rN(t),{Fp:r,n,nByteLength:s,nBitLength:i}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(y){return Lt(y,n)}function f(y){return ip(y,n)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:u,isWithinCurveOrder:d}=tN({...e,toBytes(y,p,v){const I=p.toAffine(),w=r.toBytes(I.x),B=dl;return wc("isCompressed",v),v?B(Uint8Array.from([p.hasEvenY()?2:3]),w):B(Uint8Array.from([4]),w,r.toBytes(I.y))},fromBytes(y){const p=y.length,v=y[0],I=y.subarray(1);if(p===o&&(v===2||v===3)){const w=io(I);if(!K0(w,ke,r.ORDER))throw new Error("Point is not on curve");const B=u(w);let O;try{O=r.sqrt(B)}catch(D){const N=D instanceof Error?": "+D.message:"";throw new Error("Point is not on curve"+N)}const _=(O&ke)===ke;return(v&1)===1!==_&&(O=r.neg(O)),{x:w,y:O}}else if(p===a&&v===4){const w=r.fromBytes(I.subarray(0,r.BYTES)),B=r.fromBytes(I.subarray(r.BYTES,2*r.BYTES));return{x:w,y:B}}else{const w=o,B=a;throw new Error("invalid Point, expected length of "+w+", or uncompressed "+B+", got "+p)}}});function g(y){const p=n>>ke;return y>p}function b(y){return g(y)?c(-y):y}const E=(y,p,v)=>io(y.slice(p,v));class U{constructor(p,v,I){Wo("r",p,ke,n),Wo("s",v,ke,n),this.r=p,this.s=v,I!=null&&(this.recovery=I),Object.freeze(this)}static fromCompact(p){const v=s;return p=cr("compactSignature",p,v*2),new U(E(p,0,v),E(p,v,2*v))}static fromDER(p){const{r:v,s:I}=Rn.toSig(cr("DER",p));return new U(v,I)}assertValidity(){}addRecoveryBit(p){return new U(this.r,this.s,p)}recoverPublicKey(p){const{r:v,s:I,recovery:w}=this,B=T(cr("msgHash",p));if(w==null||![0,1,2,3].includes(w))throw new Error("recovery id invalid");const O=w===2||w===3?v+e.n:v;if(O>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const _=(w&1)===0?"02":"03",k=l.fromHex(_+uh(O,r.BYTES)),D=f(O),N=c(-B*D),z=c(I*D),H=l.BASE.multiplyAndAddUnsafe(k,N,z);if(!H)throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new U(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return hl(this.toDERHex())}toDERHex(){return Rn.hexFromSig(this)}toCompactRawBytes(){return hl(this.toCompactHex())}toCompactHex(){const p=s;return uh(this.r,p)+uh(this.s,p)}}const L={isValidPrivateKey(y){try{return h(y),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const y=VE(e.n);return GL(e.randomBytes(y),e.n)},precompute(y=8,p=l.BASE){return p._setWindowSize(y),p.multiply(BigInt(3)),p}};function $(y,p=!0){return l.fromPrivateKey(y).toRawBytes(p)}function F(y){if(typeof y=="bigint")return!1;if(y instanceof l)return!0;const v=cr("key",y).length,I=r.BYTES,w=I+1,B=2*I+1;if(!(e.allowedPrivateKeyLengths||s===w))return v===w||v===B}function P(y,p,v=!0){if(F(y)===!0)throw new Error("first arg must be private key");if(F(p)===!1)throw new Error("second arg must be public key");return l.fromHex(p).multiply(h(y)).toRawBytes(v)}const C=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");const p=io(y),v=y.length*8-i;return v>0?p>>BigInt(v):p},T=e.bits2int_modN||function(y){return c(C(y))},R=Xl(i);function A(y){return Wo("num < 2^"+i,y,Nn,R),Nc(y,s)}function j(y,p,v=q){if(["recovered","canonical"].some(M=>M in v))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:w}=e;let{lowS:B,prehash:O,extraEntropy:_}=v;B==null&&(B=!0),y=cr("msgHash",y),Ob(v),O&&(y=cr("prehashed msgHash",I(y)));const k=T(y),D=h(p),N=[A(D),A(k)];if(_!=null&&_!==!1){const M=_===!0?w(r.BYTES):_;N.push(cr("extraEntropy",M))}const z=dl(...N),H=k;function V(M){const K=C(M);if(!d(K))return;const Q=f(K),te=l.BASE.multiply(K).toAffine(),re=c(te.x);if(re===Nn)return;const le=c(Q*c(H+re*D));if(le===Nn)return;let nt=(te.x===re?0:2)|Number(te.y&ke),Mr=le;return B&&g(le)&&(Mr=b(le),nt^=1),new U(re,Mr,nt)}return{seed:z,k2sig:V}}const q={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};function m(y,p,v=q){const{seed:I,k2sig:w}=j(y,p,v),B=e;return tL(B.hash.outputLen,B.nByteLength,B.hmac)(I,w)}l.BASE._setWindowSize(8);function x(y,p,v,I=S){const w=y;p=cr("msgHash",p),v=cr("publicKey",v);const{lowS:B,prehash:O,format:_}=I;if(Ob(I),"strict"in I)throw new Error("options.strict was renamed to lowS");if(_!==void 0&&_!=="compact"&&_!=="der")throw new Error("format must be compact or der");const k=typeof w=="string"||Lc(w),D=!k&&!_&&typeof w=="object"&&w!==null&&typeof w.r=="bigint"&&typeof w.s=="bigint";if(!k&&!D)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let N,z;try{if(D&&(N=new U(w.r,w.s)),k){try{_!=="compact"&&(N=U.fromDER(w))}catch(nt){if(!(nt instanceof Rn.Err))throw nt}!N&&_!=="der"&&(N=U.fromCompact(w))}z=l.fromHex(v)}catch{return!1}if(!N||B&&N.hasHighS())return!1;O&&(p=e.hash(p));const{r:H,s:V}=N,M=T(p),K=f(V),Q=c(M*K),te=c(H*K),re=l.BASE.multiplyAndAddUnsafe(z,Q,te)?.toAffine();return re?c(re.x)===H:!1}return{CURVE:e,getPublicKey:$,getSharedSecret:P,sign:m,verify:x,ProjectivePoint:l,Signature:U,utils:L}}function sN(t){return{hash:t,hmac:(e,...r)=>NE(t,e,OT(...r)),randomBytes:_T}}function iN(t,e){const r=n=>nN({...t,...sN(n)});return{...r(e),create:r}}const YE=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),_b=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),oN=BigInt(0),aN=BigInt(1),ap=BigInt(2),Fb=(t,e)=>(t+e/ap)/e;function cN(t){const e=YE,r=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),f=t*t*t%e,l=f*f*t%e,h=or(l,r,e)*l%e,u=or(h,r,e)*l%e,d=or(u,ap,e)*f%e,g=or(d,s,e)*d%e,b=or(g,i,e)*g%e,E=or(b,a,e)*b%e,U=or(E,c,e)*E%e,L=or(U,a,e)*b%e,$=or(L,r,e)*l%e,F=or($,o,e)*g%e,P=or(F,n,e)*f%e,C=or(P,ap,e);if(!cp.eql(cp.sqr(C),t))throw new Error("Cannot find square root");return C}const cp=Y0(YE,void 0,void 0,{sqrt:cN}),fN=iN({a:oN,b:BigInt(7),Fp:cp,n:_b,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=_b,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-aN*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=r,o=BigInt("0x100000000000000000000000000000000"),a=Fb(i*t,e),c=Fb(-n*t,e);let f=Lt(t-a*r-c*s,e),l=Lt(-a*n-c*i,e);const h=f>o,u=l>o;if(h&&(f=e-f),u&&(l=e-l),f>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:f,k2neg:u,k2:l}}}},JT);function lN(t){if(t.length!==130&&t.length!==132)throw new hN({signature:t});const e=BigInt(Un(t,0,32)),r=BigInt(Un(t,32,64)),n=(()=>{const s=+`0x${t.slice(130)}`;if(!Number.isNaN(s))try{return uN(s)}catch{throw new dN({value:s})}})();return typeof n>"u"?{r:e,s:r}:{r:e,s:r,yParity:n}}function uN(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new pN({value:t})}class hN extends Ee{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${di(Z0(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class dN extends Ee{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class pN extends Ee{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function gN(t){return NL(yN(t))}function yN(t){const{payload:e,signature:r}=t,{r:n,s,yParity:i}=r,a=new fN.Signature(BigInt(n),BigInt(s)).addRecoveryBit(i).recoverPublicKey(Z0(e).substring(2));return OL(a)}function bN(t){const e=t.length;let r=0,n=0;for(;n<e;){let s=t.charCodeAt(n++);if((s&4294967168)===0){r++;continue}else if((s&4294965248)===0)r+=2;else{if(s>=55296&&s<=56319&&n<e){const i=t.charCodeAt(n);(i&64512)===56320&&(++n,s=((s&1023)<<10)+(i&1023)+65536)}(s&4294901760)===0?r+=3:r+=4}}return r}function wN(t,e,r){const n=t.length;let s=r,i=0;for(;i<n;){let o=t.charCodeAt(i++);if((o&4294967168)===0){e[s++]=o;continue}else if((o&4294965248)===0)e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&i<n){const a=t.charCodeAt(i);(a&64512)===56320&&(++i,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128):(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128)}e[s++]=o&63|128}}const mN=new TextEncoder,vN=50;function EN(t,e,r){mN.encodeInto(t,e.subarray(r))}function xN(t,e,r){t.length>vN?EN(t,e,r):wN(t,e,r)}const $N=4096;function WE(t,e,r){let n=e;const s=n+r,i=[];let o="";for(;n<s;){const a=t[n++];if((a&128)===0)i.push(a);else if((a&224)===192){const c=t[n++]&63;i.push((a&31)<<6|c)}else if((a&240)===224){const c=t[n++]&63,f=t[n++]&63;i.push((a&31)<<12|c<<6|f)}else if((a&248)===240){const c=t[n++]&63,f=t[n++]&63,l=t[n++]&63;let h=(a&7)<<18|c<<12|f<<6|l;h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|h&1023),i.push(h)}else i.push(a);i.length>=$N&&(o+=String.fromCharCode(...i),i.length=0)}return i.length>0&&(o+=String.fromCharCode(...i)),o}const IN=new TextDecoder,BN=200;function AN(t,e,r){const n=t.subarray(e,e+r);return IN.decode(n)}function SN(t,e,r){return r>BN?AN(t,e,r):WE(t,e,r)}class pf{type;data;constructor(e,r){this.type=e,this.data=r}}class Xt extends Error{constructor(e){super(e);const r=Object.create(Xt.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:Xt.name})}}const Ca=4294967295;function ON(t,e,r){const n=r/4294967296,s=r;t.setUint32(e,n),t.setUint32(e+4,s)}function XE(t,e,r){const n=Math.floor(r/4294967296),s=r;t.setUint32(e,n),t.setUint32(e+4,s)}function JE(t,e){const r=t.getInt32(e),n=t.getUint32(e+4);return r*4294967296+n}function _N(t,e){const r=t.getUint32(e),n=t.getUint32(e+4);return r*4294967296+n}const FN=-1,UN=4294967296-1,PN=17179869184-1;function CN({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=PN)if(e===0&&t<=UN){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,n=t&4294967295,s=new Uint8Array(8),i=new DataView(s.buffer);return i.setUint32(0,e<<2|r&3),i.setUint32(4,n),s}else{const r=new Uint8Array(12),n=new DataView(r.buffer);return n.setUint32(0,e),XE(n,4,t),r}}function RN(t){const e=t.getTime(),r=Math.floor(e/1e3),n=(e-r*1e3)*1e6,s=Math.floor(n/1e9);return{sec:r+s,nsec:n-s*1e9}}function TN(t){if(t instanceof Date){const e=RN(t);return CN(e)}else return null}function LN(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),n=e.getUint32(4),s=(r&3)*4294967296+n,i=r>>>2;return{sec:s,nsec:i}}case 12:{const r=JE(e,4),n=e.getUint32(0);return{sec:r,nsec:n}}default:throw new Xt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function NN(t){const e=LN(t);return new Date(e.sec*1e3+e.nsec/1e6)}const kN={type:FN,encode:TN,decode:NN};class Ql{static defaultCodec=new Ql;__brand;builtInEncoders=[];builtInDecoders=[];encoders=[];decoders=[];constructor(){this.register(kN)}register({type:e,encode:r,decode:n}){if(e>=0)this.encoders[e]=r,this.decoders[e]=n;else{const s=-1-e;this.builtInEncoders[s]=r,this.builtInDecoders[s]=n}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){const s=this.builtInEncoders[n];if(s!=null){const i=s(e,r);if(i!=null){const o=-1-n;return new pf(o,i)}}}for(let n=0;n<this.encoders.length;n++){const s=this.encoders[n];if(s!=null){const i=s(e,r);if(i!=null){const o=n;return new pf(o,i)}}}return e instanceof pf?e:null}decode(e,r,n){const s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,n):new pf(r,e)}}function DN(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function fp(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):DN(t)?new Uint8Array(t):Uint8Array.from(t)}const jN=100,qN=2048;class W0{extensionCodec;context;useBigInt64;maxDepth;initialBufferSize;sortKeys;forceFloat32;ignoreUndefined;forceIntegerToFloat;pos;view;bytes;entered=!1;constructor(e){this.extensionCodec=e?.extensionCodec??Ql.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??jN,this.initialBufferSize=e?.initialBufferSize??qN,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new W0({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),n=new Uint8Array(r),s=new DataView(r);n.set(this.bytes),this.view=s,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=bN(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),xN(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,r){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const n=fp(e);this.writeU8a(n)}encodeArray(e,r){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const s of e)this.doEncode(s,r+1)}countWithoutUndefined(e,r){let n=0;for(const s of r)e[s]!==void 0&&n++;return n}encodeMap(e,r){const n=Object.keys(e);this.sortKeys&&n.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const i of n){const o=e[i];this.ignoreUndefined&&o===void 0||(this.encodeString(i),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),s=n.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(n);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),ON(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),XE(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function zN(t,e){return new W0(e).encodeSharedRef(t)}function dh(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const MN=16,HN=16;class VN{hit=0;miss=0;caches;maxKeyLength;maxLengthPerKey;constructor(e=MN,r=HN){this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,n){const s=this.caches[n-1];e:for(const i of s){const o=i.bytes;for(let a=0;a<n;a++)if(o[a]!==e[r+a])continue e;return i.str}return null}store(e,r){const n=this.caches[e.length-1],s={bytes:e,str:r};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=s:n.push(s)}decode(e,r,n){const s=this.find(e,r,n);if(s!=null)return this.hit++,s;this.miss++;const i=WE(e,r,n),o=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(o,i),i}}const lp="array",cc="map_key",QE="map_value",KN=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new Xt("The type of key must be string or number but "+typeof t)};class GN{stack=[];stackHeadPosition=-1;get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=lp,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=cc,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===lp){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===cc||e.type===QE){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Ra=-1,X0=new DataView(new ArrayBuffer(0)),ZN=new Uint8Array(X0.buffer);try{X0.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Ub=new RangeError("Insufficient data"),YN=new VN;class J0{extensionCodec;context;useBigInt64;rawStrings;maxStrLength;maxBinLength;maxArrayLength;maxMapLength;maxExtLength;keyDecoder;mapKeyConverter;totalPos=0;pos=0;view=X0;bytes=ZN;headByte=Ra;stack=new GN;entered=!1;constructor(e){this.extensionCodec=e?.extensionCodec??Ql.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??Ca,this.maxBinLength=e?.maxBinLength??Ca,this.maxArrayLength=e?.maxArrayLength??Ca,this.maxMapLength=e?.maxMapLength??Ca,this.maxExtLength=e?.maxExtLength??Ca,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:YN,this.mapKeyConverter=e?.mapKeyConverter??KN}clone(){return new J0({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Ra,this.stack.reset()}setBuffer(e){const r=fp(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Ra&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),n=fp(e),s=new Uint8Array(r.length+n.length);s.set(r),s.set(n,r.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:n}=this;return new RangeError(`Extra ${r.byteLength-n} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,n;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:s,pos:i,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${dh(s)} at ${o} (${i} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let n=r,s=-1;for await(const i of e){if(r&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),n&&(s=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else{const s=e-160;r=this.decodeString(s,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const s=this.lookU8();r=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();r=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();r=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===196){const s=this.lookU8();r=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();r=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();r=this.decodeBinary(s,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();r=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();r=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();r=this.decodeExtension(s,4)}else throw new Xt(`Unrecognized type byte: ${dh(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const s=n.top();if(s.type===lp)if(s.array[s.position]=r,s.position++,s.position===s.size)r=s.array,n.release(s);else continue e;else if(s.type===cc){if(r==="__proto__")throw new Xt("The key __proto__ is not allowed");s.key=this.mapKeyConverter(r),s.type=QE;continue e}else if(s.map[s.key]=r,s.readCount++,s.readCount===s.size)r=s.map,n.release(s);else{s.key=null,s.type=cc;continue e}}return r}}readHeadByte(){return this.headByte===Ra&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Ra}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Xt(`Unrecognized array type byte: ${dh(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new Xt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new Xt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new Xt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw Ub;const n=this.pos+r;let s;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?s=this.keyDecoder.decode(this.bytes,n,e):s=SN(this.bytes,n,e),this.pos+=r+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===cc:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new Xt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw Ub;const n=this.pos+r,s=this.bytes.subarray(n,n+e);return this.pos+=r+e,s}decodeExtension(e,r){if(e>this.maxExtLength)throw new Xt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+r),s=this.decodeBinary(e,r+1);return this.extensionCodec.decode(s,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=_N(this.view,this.pos);return this.pos+=8,e}readI64(){const e=JE(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function WN(t,e){return new J0(e).decode(t)}function XN(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function e8(t,...e){if(!XN(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Pb(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function JN(t,e){e8(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const So=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const ph=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function QN(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function t8(t){return typeof t=="string"&&(t=QN(t)),e8(t),t}let ek=class{clone(){return this._cloneInto()}};function tk(t){const e=n=>t().update(t8(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function rk(t=32){if(So&&typeof So.getRandomValues=="function")return So.getRandomValues(new Uint8Array(t));if(So&&typeof So.randomBytes=="function")return So.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function nk(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}let sk=class extends ek{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ph(this.buffer)}update(e){Pb(this);const{view:r,buffer:n,blockLen:s}=this;e=t8(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=ph(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Pb(this),JN(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;nk(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=ph(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%r&&e.buffer.set(n),e}};const gf=BigInt(2**32-1),up=BigInt(32);function r8(t,e=!1){return e?{h:Number(t&gf),l:Number(t>>up&gf)}:{h:Number(t>>up&gf)|0,l:Number(t&gf)|0}}function ik(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:i,l:o}=r8(t[s],e);[r[s],n[s]]=[i,o]}return[r,n]}const ok=(t,e)=>BigInt(t>>>0)<<up|BigInt(e>>>0),ak=(t,e,r)=>t>>>r,ck=(t,e,r)=>t<<32-r|e>>>r,fk=(t,e,r)=>t>>>r|e<<32-r,lk=(t,e,r)=>t<<32-r|e>>>r,uk=(t,e,r)=>t<<64-r|e>>>r-32,hk=(t,e,r)=>t>>>r-32|e<<64-r,dk=(t,e)=>e,pk=(t,e)=>t,gk=(t,e,r)=>t<<r|e>>>32-r,yk=(t,e,r)=>e<<r|t>>>32-r,bk=(t,e,r)=>e<<r-32|t>>>64-r,wk=(t,e,r)=>t<<r-32|e>>>64-r;function mk(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const vk=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Ek=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,xk=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),$k=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,Ik=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),Bk=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,ie={fromBig:r8,split:ik,toBig:ok,shrSH:ak,shrSL:ck,rotrSH:fk,rotrSL:lk,rotrBH:uk,rotrBL:hk,rotr32H:dk,rotr32L:pk,rotlSH:gk,rotlSL:yk,rotlBH:bk,rotlBL:wk,add:mk,add3L:vk,add3H:Ek,add4L:xk,add4H:$k,add5H:Bk,add5L:Ik},[Ak,Sk]=ie.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),gs=new Uint32Array(80),ys=new Uint32Array(80);let Ok=class extends sk{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:f,El:l,Fh:h,Fl:u,Gh:d,Gl:g,Hh:b,Hl:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=l|0,this.Fh=h|0,this.Fl=u|0,this.Gh=d|0,this.Gl=g|0,this.Hh=b|0,this.Hl=E|0}process(e,r){for(let $=0;$<16;$++,r+=4)gs[$]=e.getUint32(r),ys[$]=e.getUint32(r+=4);for(let $=16;$<80;$++){const F=gs[$-15]|0,P=ys[$-15]|0,C=ie.rotrSH(F,P,1)^ie.rotrSH(F,P,8)^ie.shrSH(F,P,7),T=ie.rotrSL(F,P,1)^ie.rotrSL(F,P,8)^ie.shrSL(F,P,7),R=gs[$-2]|0,A=ys[$-2]|0,j=ie.rotrSH(R,A,19)^ie.rotrBH(R,A,61)^ie.shrSH(R,A,6),q=ie.rotrSL(R,A,19)^ie.rotrBL(R,A,61)^ie.shrSL(R,A,6),S=ie.add4L(T,q,ys[$-7],ys[$-16]),m=ie.add4H(S,C,j,gs[$-7],gs[$-16]);gs[$]=m|0,ys[$]=S|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:f,Dl:l,Eh:h,El:u,Fh:d,Fl:g,Gh:b,Gl:E,Hh:U,Hl:L}=this;for(let $=0;$<80;$++){const F=ie.rotrSH(h,u,14)^ie.rotrSH(h,u,18)^ie.rotrBH(h,u,41),P=ie.rotrSL(h,u,14)^ie.rotrSL(h,u,18)^ie.rotrBL(h,u,41),C=h&d^~h&b,T=u&g^~u&E,R=ie.add5L(L,P,T,Sk[$],ys[$]),A=ie.add5H(R,U,F,C,Ak[$],gs[$]),j=R|0,q=ie.rotrSH(n,s,28)^ie.rotrBH(n,s,34)^ie.rotrBH(n,s,39),S=ie.rotrSL(n,s,28)^ie.rotrBL(n,s,34)^ie.rotrBL(n,s,39),m=n&i^n&a^i&a,x=s&o^s&c^o&c;U=b|0,L=E|0,b=d|0,E=g|0,d=h|0,g=u|0,{h,l:u}=ie.add(f|0,l|0,A|0,j|0),f=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const y=ie.add3L(j,S,x);n=ie.add3H(y,A,q,m),s=y|0}({h:n,l:s}=ie.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=ie.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=ie.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l}=ie.add(this.Dh|0,this.Dl|0,f|0,l|0),{h,l:u}=ie.add(this.Eh|0,this.El|0,h|0,u|0),{h:d,l:g}=ie.add(this.Fh|0,this.Fl|0,d|0,g|0),{h:b,l:E}=ie.add(this.Gh|0,this.Gl|0,b|0,E|0),{h:U,l:L}=ie.add(this.Hh|0,this.Hl|0,U|0,L|0),this.set(n,s,i,o,a,c,f,l,h,u,d,g,b,E,U,L)}roundClean(){gs.fill(0),ys.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const _k=tk(()=>new Ok);const Q0=BigInt(0),n8=BigInt(1),Fk=BigInt(2);function eg(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function tg(t){if(!eg(t))throw new Error("Uint8Array expected")}function gh(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Uk=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function rg(t){tg(t);let e="";for(let r=0;r<t.length;r++)e+=Uk[t[r]];return e}function s8(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Q0:BigInt("0x"+t)}const mn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Cb(t){if(t>=mn._0&&t<=mn._9)return t-mn._0;if(t>=mn.A&&t<=mn.F)return t-(mn.A-10);if(t>=mn.a&&t<=mn.f)return t-(mn.a-10)}function i8(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=Cb(t.charCodeAt(i)),a=Cb(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function Pk(t){return s8(rg(t))}function Vf(t){return tg(t),s8(rg(Uint8Array.from(t).reverse()))}function o8(t,e){return i8(t.toString(16).padStart(e*2,"0"))}function hp(t,e){return o8(t,e).reverse()}function vn(t,e,r){let n;if(typeof e=="string")try{n=i8(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(eg(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function Rb(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];tg(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}const yh=t=>typeof t=="bigint"&&Q0<=t;function Ck(t,e,r){return yh(t)&&yh(e)&&yh(r)&&e<=t&&t<r}function Ta(t,e,r,n){if(!Ck(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Rk(t){let e;for(e=0;t>Q0;t>>=n8,e+=1);return e}const Tk=t=>(Fk<<BigInt(t-1))-n8,Lk={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||eg(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ng(t,e,r={}){const n=(s,i,o)=>{const a=Lk[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(r))n(s,i,!0);return t}function Tb(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const ze=BigInt(0),Be=BigInt(1),qi=BigInt(2),Nk=BigInt(3),dp=BigInt(4),Lb=BigInt(5),Nb=BigInt(8);function Re(t,e){const r=t%e;return r>=ze?r:e+r}function kk(t,e,r){if(e<ze)throw new Error("invalid exponent, negatives unsupported");if(r<=ze)throw new Error("invalid modulus");if(r===Be)return ze;let n=Be;for(;e>ze;)e&Be&&(n=n*t%r),t=t*t%r,e>>=Be;return n}function Wr(t,e,r){let n=t;for(;e-- >ze;)n*=n,n%=r;return n}function kb(t,e){if(t===ze)throw new Error("invert: expected non-zero number");if(e<=ze)throw new Error("invert: expected positive modulus, got "+e);let r=Re(t,e),n=e,s=ze,i=Be;for(;r!==ze;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==Be)throw new Error("invert: does not exist");return Re(s,e)}function Dk(t){const e=(t-Be)/qi;let r,n,s;for(r=t-Be,n=0;r%qi===ze;r/=qi,n++);for(s=qi;s<t&&kk(s,e,t)!==t-Be;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+Be)/dp;return function(a,c){const f=a.pow(c,o);if(!a.eql(a.sqr(f),c))throw new Error("Cannot find square root");return f}}const i=(r+Be)/qi;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,f=o.pow(o.mul(o.ONE,s),r),l=o.pow(a,i),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let u=1;for(let g=o.sqr(h);u<c&&!o.eql(g,o.ONE);u++)g=o.sqr(g);const d=o.pow(f,Be<<BigInt(c-u-1));f=o.sqr(d),l=o.mul(l,d),h=o.mul(h,f),c=u}return l}}function jk(t){if(t%dp===Nk){const e=(t+Be)/dp;return function(r,n){const s=r.pow(n,e);if(!r.eql(r.sqr(s),n))throw new Error("Cannot find square root");return s}}if(t%Nb===Lb){const e=(t-Lb)/Nb;return function(r,n){const s=r.mul(n,qi),i=r.pow(s,e),o=r.mul(n,i),a=r.mul(r.mul(o,qi),i),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return Dk(t)}const qk=(t,e)=>(Re(t,e)&Be)===Be,zk=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Mk(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=zk.reduce((n,s)=>(n[s]="function",n),e);return ng(t,r)}function Hk(t,e,r){if(r<ze)throw new Error("invalid exponent, negatives unsupported");if(r===ze)return t.ONE;if(r===Be)return e;let n=t.ONE,s=e;for(;r>ze;)r&Be&&(n=t.mul(n,s)),s=t.sqr(s),r>>=Be;return n}function Vk(t,e){const r=new Array(e.length),n=e.reduce((i,o,a)=>t.is0(o)?i:(r[a]=i,t.mul(i,o)),t.ONE),s=t.inv(n);return e.reduceRight((i,o,a)=>t.is0(o)?i:(r[a]=t.mul(i,r[a]),t.mul(i,o)),s),r}function a8(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function c8(t,e,r=!1,n={}){if(t<=ze)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:i}=a8(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:Tk(s),ZERO:ze,ONE:Be,create:c=>Re(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ze<=c&&c<t},is0:c=>c===ze,isOdd:c=>(c&Be)===Be,neg:c=>Re(-c,t),eql:(c,f)=>c===f,sqr:c=>Re(c*c,t),add:(c,f)=>Re(c+f,t),sub:(c,f)=>Re(c-f,t),mul:(c,f)=>Re(c*f,t),pow:(c,f)=>Hk(a,c,f),div:(c,f)=>Re(c*kb(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>kb(c,t),sqrt:n.sqrt||(c=>(o||(o=jk(t)),o(a,c))),invertBatch:c=>Vk(a,c),cmov:(c,f,l)=>l?f:c,toBytes:c=>r?hp(c,i):o8(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?Vf(c):Pk(c)}});return Object.freeze(a)}const Db=BigInt(0),yf=BigInt(1);function bh(t,e){const r=e.negate();return t?r:e}function f8(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function wh(t,e){f8(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function Kk(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Gk(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const mh=new WeakMap,l8=new WeakMap;function vh(t){return l8.get(t)||1}function Zk(t,e){return{constTimeNegate:bh,hasPrecomputes(r){return vh(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>Db;)n&yf&&(s=s.add(i)),i=i.double(),n>>=yf;return s},precomputeWindow(r,n){const{windows:s,windowSize:i}=wh(n,e),o=[];let a=r,c=a;for(let f=0;f<s;f++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){const{windows:i,windowSize:o}=wh(r,e);let a=t.ZERO,c=t.BASE;const f=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let u=0;u<i;u++){const d=u*o;let g=Number(s&f);s>>=h,g>o&&(g-=l,s+=yf);const b=d,E=d+Math.abs(g)-1,U=u%2!==0,L=g<0;g===0?c=c.add(bh(U,n[b])):a=a.add(bh(L,n[E]))}return{p:a,f:c}},wNAFUnsafe(r,n,s,i=t.ZERO){const{windows:o,windowSize:a}=wh(r,e),c=BigInt(2**r-1),f=2**r,l=BigInt(r);for(let h=0;h<o;h++){const u=h*a;if(s===Db)break;let d=Number(s&c);if(s>>=l,d>a&&(d-=f,s+=yf),d===0)continue;let g=n[u+Math.abs(d)-1];d<0&&(g=g.negate()),i=i.add(g)}return i},getPrecomputes(r,n,s){let i=mh.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&mh.set(n,s(i))),i},wNAFCached(r,n,s){const i=vh(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){const o=vh(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){f8(n,e),l8.set(r,n),mh.delete(r)}}}function Yk(t,e,r,n){if(Kk(r,t),Gk(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,i=Rk(BigInt(r.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),f=Math.floor((e.BITS-1)/o)*o;let l=s;for(let h=f;h>=0;h-=o){c.fill(s);for(let d=0;d<n.length;d++){const g=n[d],b=Number(g>>BigInt(h)&BigInt(a));c[b]=c[b].add(r[d])}let u=s;for(let d=c.length-1,g=s;d>0;d--)g=g.add(c[d]),u=u.add(g);if(l=l.add(u),h!==0)for(let d=0;d<o;d++)l=l.double()}return l}function Wk(t){return Mk(t.Fp),ng(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...a8(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const xr=BigInt(0),Ut=BigInt(1),bf=BigInt(2),Xk=BigInt(8),Jk={zip215:!0};function Qk(t){const e=Wk(t);return ng(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function eD(t){const e=Qk(t),{Fp:r,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,f=bf<<BigInt(a*8)-Ut,l=r.create,h=c8(e.n,e.nBitLength),u=e.uvRatio||((y,p)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(p))}}catch{return{isValid:!1,value:xr}}}),d=e.adjustScalarBytes||(y=>y),g=e.domain||((y,p,v)=>{if(gh("phflag",v),p.length||v)throw new Error("Contexts/pre-hash are not supported");return y});function b(y,p){Ta("coordinate "+y,p,xr,f)}function E(y){if(!(y instanceof $))throw new Error("ExtendedPoint expected")}const U=Tb((y,p)=>{const{ex:v,ey:I,ez:w}=y,B=y.is0();p==null&&(p=B?Xk:r.inv(w));const O=l(v*p),_=l(I*p),k=l(w*p);if(B)return{x:xr,y:Ut};if(k!==Ut)throw new Error("invZ was invalid");return{x:O,y:_}}),L=Tb(y=>{const{a:p,d:v}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:I,ey:w,ez:B,et:O}=y,_=l(I*I),k=l(w*w),D=l(B*B),N=l(D*D),z=l(_*p),H=l(D*l(z+k)),V=l(N+l(v*l(_*k)));if(H!==V)throw new Error("bad point: equation left != right (1)");const M=l(I*w),K=l(B*O);if(M!==K)throw new Error("bad point: equation left != right (2)");return!0});class ${constructor(p,v,I,w){this.ex=p,this.ey=v,this.ez=I,this.et=w,b("x",p),b("y",v),b("z",I),b("t",w),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(p){if(p instanceof $)throw new Error("extended point not allowed");const{x:v,y:I}=p||{};return b("x",v),b("y",I),new $(v,I,Ut,l(v*I))}static normalizeZ(p){const v=r.invertBatch(p.map(I=>I.ez));return p.map((I,w)=>I.toAffine(v[w])).map($.fromAffine)}static msm(p,v){return Yk($,h,p,v)}_setWindowSize(p){C.setWindowSize(this,p)}assertValidity(){L(this)}equals(p){E(p);const{ex:v,ey:I,ez:w}=this,{ex:B,ey:O,ez:_}=p,k=l(v*_),D=l(B*w),N=l(I*_),z=l(O*w);return k===D&&N===z}is0(){return this.equals($.ZERO)}negate(){return new $(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:p}=e,{ex:v,ey:I,ez:w}=this,B=l(v*v),O=l(I*I),_=l(bf*l(w*w)),k=l(p*B),D=v+I,N=l(l(D*D)-B-O),z=k+O,H=z-_,V=k-O,M=l(N*H),K=l(z*V),Q=l(N*V),te=l(H*z);return new $(M,K,te,Q)}add(p){E(p);const{a:v,d:I}=e,{ex:w,ey:B,ez:O,et:_}=this,{ex:k,ey:D,ez:N,et:z}=p;if(v===BigInt(-1)){const ur=l((B-w)*(D+k)),hr=l((B+w)*(D-k)),Et=l(hr-ur);if(Et===xr)return this.double();const dr=l(O*bf*z),pr=l(_*bf*N),gr=pr+dr,yr=hr+ur,br=pr-dr,Bi=l(gr*Et),Ai=l(yr*br),Si=l(gr*br),Oi=l(Et*yr);return new $(Bi,Ai,Oi,Si)}const H=l(w*k),V=l(B*D),M=l(_*I*z),K=l(O*N),Q=l((w+B)*(k+D)-H-V),te=K-M,re=K+M,le=l(V-v*H),nt=l(Q*te),Mr=l(re*le),$i=l(Q*le),Ii=l(te*re);return new $(nt,Mr,Ii,$i)}subtract(p){return this.add(p.negate())}wNAF(p){return C.wNAFCached(this,p,$.normalizeZ)}multiply(p){const v=p;Ta("scalar",v,Ut,n);const{p:I,f:w}=this.wNAF(v);return $.normalizeZ([I,w])[0]}multiplyUnsafe(p,v=$.ZERO){const I=p;return Ta("scalar",I,xr,n),I===xr?P:this.is0()||I===Ut?this:C.wNAFCachedUnsafe(this,I,$.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return C.unsafeLadder(this,n).is0()}toAffine(p){return U(this,p)}clearCofactor(){const{h:p}=e;return p===Ut?this:this.multiplyUnsafe(p)}static fromHex(p,v=!1){const{d:I,a:w}=e,B=r.BYTES;p=vn("pointHex",p,B),gh("zip215",v);const O=p.slice(),_=p[B-1];O[B-1]=_&-129;const k=Vf(O),D=v?f:r.ORDER;Ta("pointHex.y",k,xr,D);const N=l(k*k),z=l(N-Ut),H=l(I*N-w);let{isValid:V,value:M}=u(z,H);if(!V)throw new Error("Point.fromHex: invalid y coordinate");const K=(M&Ut)===Ut,Q=(_&128)!==0;if(!v&&M===xr&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==K&&(M=l(-M)),$.fromAffine({x:M,y:k})}static fromPrivateKey(p){return A(p).point}toRawBytes(){const{x:p,y:v}=this.toAffine(),I=hp(v,r.BYTES);return I[I.length-1]|=p&Ut?128:0,I}toHex(){return rg(this.toRawBytes())}}$.BASE=new $(e.Gx,e.Gy,Ut,l(e.Gx*e.Gy)),$.ZERO=new $(xr,Ut,Ut,xr);const{BASE:F,ZERO:P}=$,C=Zk($,a*8);function T(y){return Re(y,n)}function R(y){return T(Vf(y))}function A(y){const p=r.BYTES;y=vn("private key",y,p);const v=vn("hashed private key",i(y),2*p),I=d(v.slice(0,p)),w=v.slice(p,2*p),B=R(I),O=F.multiply(B),_=O.toRawBytes();return{head:I,prefix:w,scalar:B,point:O,pointBytes:_}}function j(y){return A(y).pointBytes}function q(y=new Uint8Array,...p){const v=Rb(...p);return R(i(g(v,vn("context",y),!!s)))}function S(y,p,v={}){y=vn("message",y),s&&(y=s(y));const{prefix:I,scalar:w,pointBytes:B}=A(p),O=q(v.context,I,y),_=F.multiply(O).toRawBytes(),k=q(v.context,_,B,y),D=T(O+k*w);Ta("signature.s",D,xr,n);const N=Rb(_,hp(D,r.BYTES));return vn("result",N,r.BYTES*2)}const m=Jk;function x(y,p,v,I=m){const{context:w,zip215:B}=I,O=r.BYTES;y=vn("signature",y,2*O),p=vn("message",p),v=vn("publicKey",v,O),B!==void 0&&gh("zip215",B),s&&(p=s(p));const _=Vf(y.slice(O,2*O));let k,D,N;try{k=$.fromHex(v,B),D=$.fromHex(y.slice(0,O),B),N=F.multiplyUnsafe(_)}catch{return!1}if(!B&&k.isSmallOrder())return!1;const z=q(w,D.toRawBytes(),k.toRawBytes(),p);return D.add(k.multiplyUnsafe(z)).subtract(N).clearCofactor().equals($.ZERO)}return F._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:S,verify:x,ExtendedPoint:$,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,p=$.BASE){return p._setWindowSize(y),p.multiply(BigInt(3)),p}}}}BigInt(0),BigInt(1);const sg=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),jb=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const tD=BigInt(1),qb=BigInt(2);BigInt(3);const rD=BigInt(5),nD=BigInt(8);function sD(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=sg,o=t*t%i*t%i,a=Wr(o,qb,i)*o%i,c=Wr(a,tD,i)*t%i,f=Wr(c,rD,i)*c%i,l=Wr(f,e,i)*f%i,h=Wr(l,r,i)*l%i,u=Wr(h,n,i)*h%i,d=Wr(u,s,i)*u%i,g=Wr(d,s,i)*u%i,b=Wr(g,e,i)*f%i;return{pow_p_5_8:Wr(b,qb,i)*t%i,b2:o}}function iD(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function oD(t,e){const r=sg,n=Re(e*e*e,r),s=Re(n*n*e,r),i=sD(t*s).pow_p_5_8;let o=Re(t*n*i,r);const a=Re(e*o*o,r),c=o,f=Re(o*jb,r),l=a===t,h=a===Re(-t,r),u=a===Re(-t*jb,r);return l&&(o=c),(h||u)&&(o=f),qk(o,r)&&(o=Re(-o,r)),{isValid:l||h,value:o}}const aD=c8(sg,void 0,!0),cD={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:aD,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:nD,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:_k,randomBytes:rk,adjustScalarBytes:iD,uvRatio:oD};eD(cD);function fD(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var b=0,E=0,U=0,L=g.length;U!==L&&g[U]===0;)U++,b++;for(var $=(L-U)*l+1>>>0,F=new Uint8Array($);U!==L;){for(var P=g[U],C=0,T=$-1;(P!==0||C<E)&&T!==-1;T--,C++)P+=256*F[T]>>>0,F[T]=P%a>>>0,P=P/a>>>0;if(P!==0)throw new Error("Non-zero carry");E=C,U++}for(var R=$-E;R!==$&&F[R]===0;)R++;for(var A=c.repeat(b);R<$;++R)A+=t.charAt(F[R]);return A}function u(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var b=0;if(g[b]!==" "){for(var E=0,U=0;g[b]===c;)E++,b++;for(var L=(g.length-b)*f+1>>>0,$=new Uint8Array(L);g[b];){var F=r[g.charCodeAt(b)];if(F===255)return;for(var P=0,C=L-1;(F!==0||P<U)&&C!==-1;C--,P++)F+=a*$[C]>>>0,$[C]=F%256>>>0,F=F/256>>>0;if(F!==0)throw new Error("Non-zero carry");U=P,b++}if(g[b]!==" "){for(var T=L-U;T!==L&&$[T]===0;)T++;for(var R=new Uint8Array(E+(L-T)),A=E;T!==L;)R[A++]=$[T++];return R}}}function d(g){var b=u(g);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:u,decode:d}}var lD=fD,uD=lD;const u8=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},hD=t=>new TextEncoder().encode(t),dD=t=>new TextDecoder().decode(t);let pD=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},gD=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return h8(this,e)}},yD=class{constructor(e){this.decoders=e}or(e){return h8(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const h8=(t,e)=>new yD({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let bD=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new pD(e,r,n),this.decoder=new gD(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const eu=({name:t,prefix:e,encode:r,decode:n})=>new bD(t,e,r,n),kc=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:s}=uD(r,e);return eu({prefix:t,name:e,encode:n,decode:i=>u8(s(i))})},wD=(t,e,r,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,f=0;for(let l=0;l<i;++l){const h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},mD=(t,e,r)=>{const n=e[e.length-1]==="=",s=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},tt=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>eu({prefix:e,name:t,encode(s){return mD(s,n,r)},decode(s){return wD(s,n,r,t)}}),vD=eu({prefix:"\0",name:"identity",encode:t=>dD(t),decode:t=>hD(t)});var ED=Object.freeze({__proto__:null,identity:vD});const xD=tt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var $D=Object.freeze({__proto__:null,base2:xD});const ID=tt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var BD=Object.freeze({__proto__:null,base8:ID});const AD=kc({prefix:"9",name:"base10",alphabet:"0123456789"});var SD=Object.freeze({__proto__:null,base10:AD});const OD=tt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),_D=tt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var FD=Object.freeze({__proto__:null,base16:OD,base16upper:_D});const UD=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),PD=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),CD=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),RD=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),TD=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),LD=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ND=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),kD=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),DD=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var jD=Object.freeze({__proto__:null,base32:UD,base32upper:PD,base32pad:CD,base32padupper:RD,base32hex:TD,base32hexupper:LD,base32hexpad:ND,base32hexpadupper:kD,base32z:DD});const qD=kc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),zD=kc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var MD=Object.freeze({__proto__:null,base36:qD,base36upper:zD});const HD=kc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),VD=kc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var KD=Object.freeze({__proto__:null,base58btc:HD,base58flickr:VD});const GD=tt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ZD=tt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),YD=tt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),WD=tt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var XD=Object.freeze({__proto__:null,base64:GD,base64pad:ZD,base64url:YD,base64urlpad:WD});const d8=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),JD=d8.reduce((t,e,r)=>(t[r]=e,t),[]),QD=d8.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function ej(t){return t.reduce((e,r)=>(e+=JD[r],e),"")}function tj(t){const e=[];for(const r of t){const n=QD[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const rj=eu({prefix:"ðŸš€",name:"base256emoji",encode:ej,decode:tj});var nj=Object.freeze({__proto__:null,base256emoji:rj}),sj=p8,zb=128,ij=-128,oj=Math.pow(2,31);function p8(t,e,r){e=e||[],r=r||0;for(var n=r;t>=oj;)e[r++]=t&255|zb,t/=128;for(;t&ij;)e[r++]=t&255|zb,t>>>=7;return e[r]=t|0,p8.bytes=r-n+1,e}var aj=pp,cj=128,Mb=127;function pp(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw pp.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&Mb)<<s:(o&Mb)*Math.pow(2,s),s+=7}while(o>=cj);return pp.bytes=i-n,r}var fj=Math.pow(2,7),lj=Math.pow(2,14),uj=Math.pow(2,21),hj=Math.pow(2,28),dj=Math.pow(2,35),pj=Math.pow(2,42),gj=Math.pow(2,49),yj=Math.pow(2,56),bj=Math.pow(2,63),wj=function(t){return t<fj?1:t<lj?2:t<uj?3:t<hj?4:t<dj?5:t<pj?6:t<gj?7:t<yj?8:t<bj?9:10},mj={encode:sj,decode:aj,encodingLength:wj},g8=mj;const Hb=(t,e,r=0)=>(g8.encode(t,e,r),e),Vb=t=>g8.encodingLength(t),gp=(t,e)=>{const r=e.byteLength,n=Vb(t),s=n+Vb(r),i=new Uint8Array(s+r);return Hb(t,i,0),Hb(r,i,n),i.set(e,s),new vj(t,r,e,i)};let vj=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};const y8=({name:t,code:e,encode:r})=>new Ej(t,e,r);let Ej=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?gp(this.code,r):r.then(n=>gp(this.code,n))}else throw Error("Unknown type, must be binary type")}};const b8=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),xj=y8({name:"sha2-256",code:18,encode:b8("SHA-256")}),$j=y8({name:"sha2-512",code:19,encode:b8("SHA-512")});var Ij=Object.freeze({__proto__:null,sha256:xj,sha512:$j});const w8=0,Bj="identity",m8=u8,Aj=t=>gp(w8,m8(t)),Sj={code:w8,name:Bj,encode:m8,digest:Aj};var Oj=Object.freeze({__proto__:null,identity:Sj});new TextEncoder,new TextDecoder;({...ED,...$D,...BD,...SD,...FD,...jD,...MD,...KD,...XD,...nj});({...Ij,...Oj});function v8(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function _j(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?v8(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function E8(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Kb=E8("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Eh=E8("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=_j(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),x8={utf8:Kb,"utf-8":Kb,hex:Xf.base16,latin1:Eh,ascii:Eh,binary:Eh,...Xf};function $8(t,e="utf8"){const r=x8[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?v8(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function I8(t,e="utf8"){const r=x8[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var an={exports:{}};function Fj(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Uj=Pj;function Pj(t,e,r){var n=r&&r.stringify||Fj,s=1;if(typeof t=="object"&&t!==null){var i=e.length+s;if(i===1)return t;var o=new Array(i);o[0]=n(t);for(var a=1;a<i;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var f="",l=1-s,h=-1,u=t&&t.length||0,d=0;d<u;){if(t.charCodeAt(d)===37&&d+1<u){switch(h=h>-1?h:0,t.charCodeAt(d+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<d&&(f+=t.slice(h,d)),f+=Number(e[l]),h=d+2,d++;break;case 105:if(l>=c||e[l]==null)break;h<d&&(f+=t.slice(h,d)),f+=Math.floor(Number(e[l])),h=d+2,d++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<d&&(f+=t.slice(h,d));var g=typeof e[l];if(g==="string"){f+="'"+e[l]+"'",h=d+2,d++;break}if(g==="function"){f+=e[l].name||"<anonymous>",h=d+2,d++;break}f+=n(e[l]),h=d+2,d++;break;case 115:if(l>=c)break;h<d&&(f+=t.slice(h,d)),f+=String(e[l]),h=d+2,d++;break;case 37:h<d&&(f+=t.slice(h,d)),f+="%",h=d+2,d++,l--;break}++l}++d}return h===-1?t:(h<u&&(f+=t.slice(h)),f)}const Gb=Uj;an.exports=Vn;const vc=Gj().console||{},Cj={mapHttpRequest:wf,mapHttpResponse:wf,wrapRequestSerializer:xh,wrapResponseSerializer:xh,wrapErrorSerializer:xh,req:wf,res:wf,err:Yb,errWithCause:Yb};function ei(t,e){return t==="silent"?1/0:e.levels.values[t]}const ig=Symbol("pino.logFuncs"),yp=Symbol("pino.hierarchy"),Rj={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function Zb(t,e){const r={logger:e,parent:t[yp]};e[yp]=r}function Tj(t,e,r){const n={};e.forEach(s=>{n[s]=r[s]?r[s]:vc[s]||vc[Rj[s]||"log"]||Xo}),t[ig]=n}function Lj(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Vn(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||vc;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},s=Lj(t.browser.serialize,n);let i=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(i=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(b){r[b]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",f=Object.create(r);f.log||(f.log=Xo),Tj(f,a,r),Zb({},f),Object.defineProperty(f,"levelVal",{get:h}),Object.defineProperty(f,"level",{get:u,set:d});const l={transmit:e,serialize:s,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:Hj(t),messageKey:t.messageKey||"msg",onChild:t.onChild||Xo};f.levels=Nj(t),f.level=c,f.isLevelEnabled=function(b){return this.levels.values[b]?this.levels.values[b]>=this.levels.values[this.level]:!1},f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=Xo,f.serializers=n,f._serialize=s,f._stdErrSerialize=i,f.child=function(...b){return g.call(this,l,...b)},e&&(f._logEvent=bp());function h(){return ei(this.level,this)}function u(){return this._level}function d(b){if(b!=="silent"&&!this.levels.values[b])throw Error("unknown level "+b);this._level=b,Ci(this,l,f,"error"),Ci(this,l,f,"fatal"),Ci(this,l,f,"warn"),Ci(this,l,f,"info"),Ci(this,l,f,"debug"),Ci(this,l,f,"trace"),o.forEach(E=>{Ci(this,l,f,E)})}function g(b,E,U){if(!E)throw new Error("missing bindings for child Pino");U=U||{},s&&E.serializers&&(U.serializers=E.serializers);const L=U.serializers;if(s&&L){var $=Object.assign({},n,L),F=t.browser.serialize===!0?Object.keys($):s;delete E.serializers,og([E],F,$,this._stdErrSerialize)}function P(T){this._childLevel=(T._childLevel|0)+1,this.bindings=E,$&&(this.serializers=$,this._serialize=F),e&&(this._logEvent=bp([].concat(T._logEvent.bindings,E)))}P.prototype=this;const C=new P(this);return Zb(this,C),C.child=function(...T){return g.call(this,b,...T)},C.level=U.level||this.level,b.onChild(C),C}return f}function Nj(t){const e=t.customLevels||{},r=Object.assign({},Vn.levels.values,e),n=Object.assign({},Vn.levels.labels,kj(e));return{values:r,labels:n}}function kj(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}Vn.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},Vn.stdSerializers=Cj,Vn.stdTimeFunctions=Object.assign({},{nullTime:B8,epochTime:A8,unixTime:Vj,isoTime:Kj});function Dj(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[yp];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function Ci(t,e,r,n){if(Object.defineProperty(t,n,{value:ei(t.level,r)>ei(n,r)?Xo:r[ig][n],writable:!0,enumerable:!0,configurable:!0}),t[n]===Xo){if(!e.transmit)return;const i=e.transmit.level||t.level,o=ei(i,r);if(ei(n,r)<o)return}t[n]=qj(t,e,r,n);const s=Dj(t);s.length!==0&&(t[n]=jj(s,t[n]))}function jj(t,e){return function(){return e.apply(this,[...t,...arguments])}}function qj(t,e,r,n){return(function(s){return function(){const i=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===vc?vc:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var f=!1;if(e.serialize&&(og(o,this._serialize,this.serializers,this._stdErrSerialize),f=!0),e.asObject||e.formatters?s.call(a,...zj(this,n,o,i,e)):s.apply(a,o),e.transmit){const l=e.transmit.level||t._level,h=ei(l,r),u=ei(n,r);if(u<h)return;Mj(this,{ts:i,methodLevel:n,methodValue:u,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:ei(t._level,r)},o,f)}}})(t[ig][n])}function zj(t,e,r,n,s){const{level:i,log:o=h=>h}=s.formatters||{},a=r.slice();let c=a[0];const f={};let l=(t._childLevel|0)+1;if(l<1&&(l=1),n&&(f.time=n),i){const h=i(e,t.levels.values[e]);Object.assign(f,h)}else f.level=t.levels.values[e];if(s.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;l--&&typeof a[0]=="object";)Object.assign(f,a.shift());return[o(f),...a]}else{if(c!==null&&typeof c=="object"){for(;l--&&typeof a[0]=="object";)Object.assign(f,a.shift());c=a.length?Gb(a.shift(),a):void 0}else typeof c=="string"&&(c=Gb(a.shift(),a));return c!==void 0&&(f[s.messageKey]=c),[o(f)]}}function og(t,e,r,n){for(const s in t)if(n&&t[s]instanceof Error)t[s]=Vn.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s])&&e)for(const i in t[s])e.indexOf(i)>-1&&i in r&&(t[s][i]=r[i](t[s][i]))}function Mj(t,e,r,n=!1){const s=e.send,i=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,f=t._logEvent.bindings;n||og(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=i,t._logEvent.messages=r.filter(function(l){return f.indexOf(l)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,s(o,t._logEvent,c),t._logEvent=bp(f)}function bp(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function Yb(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function Hj(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?B8:A8}function wf(){return{}}function xh(t){return t}function Xo(){}function B8(){return!1}function A8(){return Date.now()}function Vj(){return Math.round(Date.now()/1e3)}function Kj(){return new Date(Date.now()).toISOString()}function Gj(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}an.exports.default=Vn;an.exports.pino=Vn;const Zj="custom_context",ag=1e3*1024;var Yj=Object.defineProperty,Wj=(t,e,r)=>e in t?Yj(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zs=(t,e,r)=>Wj(t,typeof e!="symbol"?e+"":e,r);let Xj=class{constructor(e){Zs(this,"nodeValue"),Zs(this,"sizeInBytes"),Zs(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Wb=class{constructor(e){Zs(this,"lengthInNodes"),Zs(this,"sizeInBytes"),Zs(this,"head"),Zs(this,"tail"),Zs(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Xj(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const Jj=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function Xb(t){return typeof t=="string"?t:Jj(t)||""}var Qj=Object.defineProperty,eq=(t,e,r)=>e in t?Qj(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mf=(t,e,r)=>eq(t,typeof e!="symbol"?e+"":e,r);let S8=class{constructor(e,r=ag){mf(this,"logs"),mf(this,"level"),mf(this,"levelValue"),mf(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=an.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Wb(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===an.exports.levels.values.error?console.error(e):r===an.exports.levels.values.warn?console.warn(e):r===an.exports.levels.values.debug?console.debug(e):r===an.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Xb({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Wb(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Xb({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var tq=Object.defineProperty,rq=(t,e,r)=>e in t?tq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nq=(t,e,r)=>rq(t,e+"",r);let sq=class{constructor(e,r=ag){nq(this,"baseChunkLogger"),this.baseChunkLogger=new S8(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}};var iq=Object.defineProperty,oq=(t,e,r)=>e in t?iq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,aq=(t,e,r)=>oq(t,e+"",r);let cq=class{constructor(e,r=ag){aq(this,"baseChunkLogger"),this.baseChunkLogger=new S8(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var fq=Object.defineProperty,lq=Object.defineProperties,uq=Object.getOwnPropertyDescriptors,Jb=Object.getOwnPropertySymbols,hq=Object.prototype.hasOwnProperty,dq=Object.prototype.propertyIsEnumerable,Qb=(t,e,r)=>e in t?fq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oo=(t,e)=>{for(var r in e||(e={}))hq.call(e,r)&&Qb(t,r,e[r]);if(Jb)for(var r of Jb(e))dq.call(e,r)&&Qb(t,r,e[r]);return t},ao=(t,e)=>lq(t,uq(e));function pq(t,e=Zj){return t[e]||""}function gq(t){var e,r;const n=new sq((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:an.exports(ao(oo({},t.opts),{level:"trace",browser:ao(oo({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})})),chunkLoggerController:n}}function yq(t){var e,r;const n=new cq((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:an.exports(ao(oo({},t.opts),{level:"trace",browser:ao(oo({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})}),n),chunkLoggerController:n}}function bq(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const r=ao(oo({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?gq(ao(oo({},t),{opts:r})):yq(ao(oo({},t),{opts:r}))}var wq={};const mq=":";function Kf(t){const[e,r]=t.split(mq);return{namespace:e,reference:r}}function O8(t,e){return t.includes(":")?[t]:e.chains||[]}var vq=Object.defineProperty,Eq=Object.defineProperties,xq=Object.getOwnPropertyDescriptors,ew=Object.getOwnPropertySymbols,$q=Object.prototype.hasOwnProperty,Iq=Object.prototype.propertyIsEnumerable,wp=(t,e,r)=>e in t?vq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tw=(t,e)=>{for(var r in e||(e={}))$q.call(e,r)&&wp(t,r,e[r]);if(ew)for(var r of ew(e))Iq.call(e,r)&&wp(t,r,e[r]);return t},Bq=(t,e)=>Eq(t,xq(e)),rw=(t,e,r)=>wp(t,typeof e!="symbol"?e+"":e,r);const Aq="ReactNative",jo={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function _8(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function F8(){return!tr.getDocument()&&!!tr.getNavigator()&&navigator.product===Aq}function U8(){return!_8()&&!!tr.getNavigator()&&!!tr.getDocument()}function Sq(){return F8()?jo.reactNative:_8()?jo.node:U8()?jo.browser:jo.unknown}function Oq(t){var e,r;const n=_q();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),Bq(tw(tw({},n),t),{url:t?.url||n.url,name:t?.name||n.name,description:t?.description||n.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:n.icons})}catch(s){return console.warn("Error populating app metadata",s),t||n}}function _q(){return X2.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Xi(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Oo(t=Z.FIVE_MINUTES,e){const r=Z.toMiliseconds(t||Z.FIVE_MINUTES);let n,s,i,o;return{resolve:a=>{i&&n&&(clearTimeout(i),n(a),o=Promise.resolve(a))},reject:a=>{i&&s&&(clearTimeout(i),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{const f=new Error(e);o=Promise.reject(f),c(f)},r),n=a,s=c})}}function Fq(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function Pt(t,e){return Z.fromMiliseconds(Date.now()+Z.toMiliseconds(t))}function _o(t){return Date.now()>=Z.toMiliseconds(t)}function me(t,e){return`${t}${e?`:${e}`:""}`}function co(t=[],e=[]){return[...new Set([...t,...e])]}async function Uq({id:t,topic:e,wcDeepLink:r}){var n;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,i=s?.href;if(typeof i!="string")return;const o=Pq(i,t,e),a=Sq();if(a===jo.browser){if(!((n=tr.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Cq(o)}else a===jo.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function Pq(t,e,r){const n=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const i=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${i}${kq(n,!0)}`}else s=`${s}/wc?${n}`;return s}function Cq(t){let e="_self";Nq()?e="_top":(Lq()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function Rq(t,e){let r="";try{if(U8()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(n){console.error(n)}return r}function nw(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),n=r.indexOf(e);return r[n+2]}function Tq(){return typeof process<"u"&&wq.IS_VITEST==="true"}function Lq(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Nq(){try{return window.self!==window.top}catch{return!1}}function kq(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}class Dq{constructor({limit:e}){rw(this,"limit"),rw(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}}const vf=BigInt(2**32-1),sw=BigInt(32);function P8(t,e=!1){return e?{h:Number(t&vf),l:Number(t>>sw&vf)}:{h:Number(t>>sw&vf)|0,l:Number(t&vf)|0}}function C8(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=P8(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const iw=(t,e,r)=>t>>>r,ow=(t,e,r)=>t<<32-r|e>>>r,ks=(t,e,r)=>t>>>r|e<<32-r,Ds=(t,e,r)=>t<<32-r|e>>>r,Ja=(t,e,r)=>t<<64-r|e>>>r-32,Qa=(t,e,r)=>t>>>r-32|e<<64-r,jq=(t,e)=>e,qq=(t,e)=>t,zq=(t,e,r)=>t<<r|e>>>32-r,Mq=(t,e,r)=>e<<r|t>>>32-r,Hq=(t,e,r)=>e<<r-32|t>>>64-r,Vq=(t,e,r)=>t<<r-32|e>>>64-r;function Ur(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const cg=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),fg=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,Kq=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),Gq=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,Zq=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),Yq=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,Fo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function tu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function pi(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Dr(t,...e){if(!tu(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function R8(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");pi(t.outputLen),pi(t.blockLen)}function gi(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function lg(t,e){Dr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ec(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function jr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function $h(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Xr(t,e){return t<<32-e|t>>>e}const T8=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function L8(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const _n=T8?t=>t:t=>L8(t);function Wq(t){for(let e=0;e<t.length;e++)t[e]=L8(t[e]);return t}const js=T8?t=>t:Wq,N8=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Xq=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Jo(t){if(Dr(t),N8)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Xq[t[r]];return e}const En={_0:48,_9:57,A:65,F:70,a:97,f:102};function aw(t){if(t>=En._0&&t<=En._9)return t-En._0;if(t>=En.A&&t<=En.F)return t-(En.A-10);if(t>=En.a&&t<=En.f)return t-(En.a-10)}function gl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(N8)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=aw(t.charCodeAt(i)),a=aw(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function k8(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Kn(t){return typeof t=="string"&&(t=k8(t)),Dr(t),t}function Ys(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];Dr(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}let ru=class{};function Dc(t){const e=n=>t().update(Kn(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Jq(t){const e=(n,s)=>t(s).update(Kn(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function ug(t=32){if(Fo&&typeof Fo.getRandomValues=="function")return Fo.getRandomValues(new Uint8Array(t));if(Fo&&typeof Fo.randomBytes=="function")return Uint8Array.from(Fo.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const Qq=BigInt(0),La=BigInt(1),ez=BigInt(2),tz=BigInt(7),rz=BigInt(256),nz=BigInt(113),D8=[],j8=[],q8=[];for(let t=0,e=La,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],D8.push(2*(5*n+r)),j8.push((t+1)*(t+2)/2%64);let s=Qq;for(let i=0;i<7;i++)e=(e<<La^(e>>tz)*nz)%rz,e&ez&&(s^=La<<(La<<BigInt(i))-La);q8.push(s)}const z8=C8(q8,!0),sz=z8[0],iz=z8[1],cw=(t,e,r)=>r>32?Hq(t,e,r):zq(t,e,r),fw=(t,e,r)=>r>32?Vq(t,e,r):Mq(t,e,r);function oz(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=r[c],l=r[c+1],h=cw(f,l,1)^r[a],u=fw(f,l,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=u}let s=t[2],i=t[3];for(let o=0;o<24;o++){const a=j8[o],c=cw(s,i,a),f=fw(s,i,a),l=D8[o];s=t[l],i=t[l+1],t[l]=c,t[l+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=sz[n],t[1]^=iz[n]}jr(r)}let az=class M8 extends ru{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,pi(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ec(this.state)}clone(){return this._cloneInto()}keccak(){js(this.state32),oz(this.state32,this.rounds),js(this.state32),this.posOut=0,this.pos=0}update(e){gi(this),e=Kn(e),Dr(e);const{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){gi(this,!1),Dr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return pi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(lg(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,jr(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new M8(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const cz=(t,e,r)=>Dc(()=>new az(e,t,r)),fz=cz(1,136,256/8);function lz(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function uz(t,e,r){return t&e^~t&r}function hz(t,e,r){return t&e^t&r^e&r}let H8=class extends ru{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=$h(this.buffer)}update(e){gi(this),e=Kn(e),Dr(e);const{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=$h(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){gi(this),lg(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,jr(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;lz(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=$h(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const bs=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),ht=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),dz=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ws=new Uint32Array(64);let pz=class extends H8{constructor(e=32){super(64,e,8,!1),this.A=bs[0]|0,this.B=bs[1]|0,this.C=bs[2]|0,this.D=bs[3]|0,this.E=bs[4]|0,this.F=bs[5]|0,this.G=bs[6]|0,this.H=bs[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)ws[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const u=ws[h-15],d=ws[h-2],g=Xr(u,7)^Xr(u,18)^u>>>3,b=Xr(d,17)^Xr(d,19)^d>>>10;ws[h]=b+ws[h-7]+g+ws[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:f,H:l}=this;for(let h=0;h<64;h++){const u=Xr(a,6)^Xr(a,11)^Xr(a,25),d=l+u+uz(a,c,f)+dz[h]+ws[h]|0,g=(Xr(n,2)^Xr(n,13)^Xr(n,22))+hz(n,s,i)|0;l=f,f=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(n,s,i,o,a,c,f,l)}roundClean(){jr(ws)}destroy(){this.set(0,0,0,0,0,0,0,0),jr(this.buffer)}};const V8=C8(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),gz=V8[0],yz=V8[1],ms=new Uint32Array(80),vs=new Uint32Array(80);let hg=class extends H8{constructor(e=64){super(128,e,16,!1),this.Ah=ht[0]|0,this.Al=ht[1]|0,this.Bh=ht[2]|0,this.Bl=ht[3]|0,this.Ch=ht[4]|0,this.Cl=ht[5]|0,this.Dh=ht[6]|0,this.Dl=ht[7]|0,this.Eh=ht[8]|0,this.El=ht[9]|0,this.Fh=ht[10]|0,this.Fl=ht[11]|0,this.Gh=ht[12]|0,this.Gl=ht[13]|0,this.Hh=ht[14]|0,this.Hl=ht[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:f,El:l,Fh:h,Fl:u,Gh:d,Gl:g,Hh:b,Hl:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=l|0,this.Fh=h|0,this.Fl=u|0,this.Gh=d|0,this.Gl=g|0,this.Hh=b|0,this.Hl=E|0}process(e,r){for(let $=0;$<16;$++,r+=4)ms[$]=e.getUint32(r),vs[$]=e.getUint32(r+=4);for(let $=16;$<80;$++){const F=ms[$-15]|0,P=vs[$-15]|0,C=ks(F,P,1)^ks(F,P,8)^iw(F,P,7),T=Ds(F,P,1)^Ds(F,P,8)^ow(F,P,7),R=ms[$-2]|0,A=vs[$-2]|0,j=ks(R,A,19)^Ja(R,A,61)^iw(R,A,6),q=Ds(R,A,19)^Qa(R,A,61)^ow(R,A,6),S=Kq(T,q,vs[$-7],vs[$-16]),m=Gq(S,C,j,ms[$-7],ms[$-16]);ms[$]=m|0,vs[$]=S|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:f,Dl:l,Eh:h,El:u,Fh:d,Fl:g,Gh:b,Gl:E,Hh:U,Hl:L}=this;for(let $=0;$<80;$++){const F=ks(h,u,14)^ks(h,u,18)^Ja(h,u,41),P=Ds(h,u,14)^Ds(h,u,18)^Qa(h,u,41),C=h&d^~h&b,T=u&g^~u&E,R=Zq(L,P,T,yz[$],vs[$]),A=Yq(R,U,F,C,gz[$],ms[$]),j=R|0,q=ks(n,s,28)^Ja(n,s,34)^Ja(n,s,39),S=Ds(n,s,28)^Qa(n,s,34)^Qa(n,s,39),m=n&i^n&a^i&a,x=s&o^s&c^o&c;U=b|0,L=E|0,b=d|0,E=g|0,d=h|0,g=u|0,{h,l:u}=Ur(f|0,l|0,A|0,j|0),f=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const y=cg(j,S,x);n=fg(y,A,q,m),s=y|0}({h:n,l:s}=Ur(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Ur(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Ur(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l}=Ur(this.Dh|0,this.Dl|0,f|0,l|0),{h,l:u}=Ur(this.Eh|0,this.El|0,h|0,u|0),{h:d,l:g}=Ur(this.Fh|0,this.Fl|0,d|0,g|0),{h:b,l:E}=Ur(this.Gh|0,this.Gl|0,b|0,E|0),{h:U,l:L}=Ur(this.Hh|0,this.Hl|0,U|0,L|0),this.set(n,s,i,o,a,c,f,l,h,u,d,g,b,E,U,L)}roundClean(){jr(ms,vs)}destroy(){jr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},bz=class extends hg{constructor(){super(48),this.Ah=ut[0]|0,this.Al=ut[1]|0,this.Bh=ut[2]|0,this.Bl=ut[3]|0,this.Ch=ut[4]|0,this.Cl=ut[5]|0,this.Dh=ut[6]|0,this.Dl=ut[7]|0,this.Eh=ut[8]|0,this.El=ut[9]|0,this.Fh=ut[10]|0,this.Fl=ut[11]|0,this.Gh=ut[12]|0,this.Gl=ut[13]|0,this.Hh=ut[14]|0,this.Hl=ut[15]|0}};const dt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);let wz=class extends hg{constructor(){super(32),this.Ah=dt[0]|0,this.Al=dt[1]|0,this.Bh=dt[2]|0,this.Bl=dt[3]|0,this.Ch=dt[4]|0,this.Cl=dt[5]|0,this.Dh=dt[6]|0,this.Dl=dt[7]|0,this.Eh=dt[8]|0,this.El=dt[9]|0,this.Fh=dt[10]|0,this.Fl=dt[11]|0,this.Gh=dt[12]|0,this.Gl=dt[13]|0,this.Hh=dt[14]|0,this.Hl=dt[15]|0}};const nu=Dc(()=>new pz),mz=Dc(()=>new hg),vz=Dc(()=>new bz),Ez=Dc(()=>new wz),xz=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Fe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),X=new Uint32Array(32);function Es(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=X[2*t],f=X[2*t+1],l=X[2*e],h=X[2*e+1],u=X[2*r],d=X[2*r+1],g=X[2*n],b=X[2*n+1],E=cg(c,l,o);f=fg(E,f,h,a),c=E|0,{Dh:b,Dl:g}={Dh:b^f,Dl:g^c},{Dh:b,Dl:g}={Dh:jq(b,g),Dl:qq(b)},{h:d,l:u}=Ur(d,u,b,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^u},{Bh:h,Bl:l}={Bh:ks(h,l,24),Bl:Ds(h,l,24)},X[2*t]=c,X[2*t+1]=f,X[2*e]=l,X[2*e+1]=h,X[2*r]=u,X[2*r+1]=d,X[2*n]=g,X[2*n+1]=b}function xs(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=X[2*t],f=X[2*t+1],l=X[2*e],h=X[2*e+1],u=X[2*r],d=X[2*r+1],g=X[2*n],b=X[2*n+1],E=cg(c,l,o);f=fg(E,f,h,a),c=E|0,{Dh:b,Dl:g}={Dh:b^f,Dl:g^c},{Dh:b,Dl:g}={Dh:ks(b,g,16),Dl:Ds(b,g,16)},{h:d,l:u}=Ur(d,u,b,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^u},{Bh:h,Bl:l}={Bh:Ja(h,l,63),Bl:Qa(h,l,63)},X[2*t]=c,X[2*t+1]=f,X[2*e]=l,X[2*e+1]=h,X[2*r]=u,X[2*r+1]=d,X[2*n]=g,X[2*n+1]=b}function $z(t,e={},r,n,s){if(pi(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}let Iz=class extends ru{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,pi(e),pi(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Ec(this.buffer)}update(e){gi(this),e=Kn(e),Dr(e);const{blockLen:r,buffer:n,buffer32:s}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===r&&(js(s),this.compress(s,0,!1),js(s),this.pos=0);const f=Math.min(r-this.pos,i-c),l=o+c;if(f===r&&!(l%4)&&c+f<i){const h=new Uint32Array(a,l,Math.floor((i-c)/4));js(h);for(let u=0;c+r<i;u+=s.length,c+=r)this.length+=r,this.compress(h,u,!1);js(h);continue}n.set(e.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(e){gi(this),lg(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,jr(this.buffer.subarray(r)),js(n),this.compress(n,0,!0),js(n);const s=Ec(e);this.get().forEach((i,o)=>s[o]=_n(i))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:s,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=i,e.finished=s,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},Bz=class extends Iz{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Fe[0]|0,this.v0h=Fe[1]|0,this.v1l=Fe[2]|0,this.v1h=Fe[3]|0,this.v2l=Fe[4]|0,this.v2h=Fe[5]|0,this.v3l=Fe[6]|0,this.v3h=Fe[7]|0,this.v4l=Fe[8]|0,this.v4h=Fe[9]|0,this.v5l=Fe[10]|0,this.v5h=Fe[11]|0,this.v6l=Fe[12]|0,this.v6h=Fe[13]|0,this.v7l=Fe[14]|0,this.v7h=Fe[15]|0,$z(r,e,64,16,16);let{key:n,personalization:s,salt:i}=e,o=0;if(n!==void 0&&(n=Kn(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=Kn(i);const a=Ec(i);this.v4l^=_n(a[0]),this.v4h^=_n(a[1]),this.v5l^=_n(a[2]),this.v5h^=_n(a[3])}if(s!==void 0){s=Kn(s);const a=Ec(s);this.v6l^=_n(a[0]),this.v6h^=_n(a[1]),this.v7l^=_n(a[2]),this.v7h^=_n(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:s,v2l:i,v2h:o,v3l:a,v3h:c,v4l:f,v4h:l,v5l:h,v5h:u,v6l:d,v6h:g,v7l:b,v7h:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=l|0,this.v5l=h|0,this.v5h=u|0,this.v6l=d|0,this.v6h=g|0,this.v7l=b|0,this.v7h=E|0}compress(e,r,n){this.get().forEach((c,f)=>X[f]=c),X.set(Fe,16);let{h:s,l:i}=P8(BigInt(this.length));X[24]=Fe[8]^i,X[25]=Fe[9]^s,n&&(X[28]=~X[28],X[29]=~X[29]);let o=0;const a=xz;for(let c=0;c<12;c++)Es(0,4,8,12,e,r+2*a[o++]),xs(0,4,8,12,e,r+2*a[o++]),Es(1,5,9,13,e,r+2*a[o++]),xs(1,5,9,13,e,r+2*a[o++]),Es(2,6,10,14,e,r+2*a[o++]),xs(2,6,10,14,e,r+2*a[o++]),Es(3,7,11,15,e,r+2*a[o++]),xs(3,7,11,15,e,r+2*a[o++]),Es(0,5,10,15,e,r+2*a[o++]),xs(0,5,10,15,e,r+2*a[o++]),Es(1,6,11,12,e,r+2*a[o++]),xs(1,6,11,12,e,r+2*a[o++]),Es(2,7,8,13,e,r+2*a[o++]),xs(2,7,8,13,e,r+2*a[o++]),Es(3,4,9,14,e,r+2*a[o++]),xs(3,4,9,14,e,r+2*a[o++]);this.v0l^=X[0]^X[16],this.v0h^=X[1]^X[17],this.v1l^=X[2]^X[18],this.v1h^=X[3]^X[19],this.v2l^=X[4]^X[20],this.v2h^=X[5]^X[21],this.v3l^=X[6]^X[22],this.v3h^=X[7]^X[23],this.v4l^=X[8]^X[24],this.v4h^=X[9]^X[25],this.v5l^=X[10]^X[26],this.v5h^=X[11]^X[27],this.v6l^=X[12]^X[28],this.v6h^=X[13]^X[29],this.v7l^=X[14]^X[30],this.v7h^=X[15]^X[31],jr(X)}destroy(){this.destroyed=!0,jr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Az=Jq(t=>new Bz(t)),Sz="https://rpc.walletconnect.org/v1";function K8(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(fz(r)).toString("hex")}async function Oz(t,e,r,n,s,i){switch(r.t){case"eip191":return await _z(t,e,r.s);case"eip1271":return await Fz(t,e,r.s,n,s,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function _z(t,e,r){const n=lN(r);return gN({payload:K8(e),signature:n}).toLowerCase()===t.toLowerCase()}async function Fz(t,e,r,n,s,i){const o=Kf(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",f=r.substring(2),l=(f.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:K8(e)).substring(2),u=a+h+c+l+f,d=await fetch(`${i||Sz}/?chainId=${n}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Uz(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:u},"latest"]})}),{result:g}=await d.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function Uz(){return Date.now()+Math.floor(Math.random()*1e3)}function Pz(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const n=r[0];if(n===0)throw new Error("No signatures found");const s=1+n*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const i=Buffer.from(t,"base64").slice(1,65);return Ac.encode(i)}function Cz(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),n=new Uint8Array(r.length+e.length);n.set(r),n.set(e,r.length);const s=Az(n,{dkLen:32});return Ac.encode(s)}function lw(t){const e=new Uint8Array(nu(Rz(t)));return Ac.encode(e)}function Rz(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function uw(t){const e=Buffer.from(t,"base64"),r=WN(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const n=zN(r),s=Buffer.from("TX"),i=Buffer.concat([s,Buffer.from(n)]),o=Ez(i);return u5.encode(o).replace(/=+$/,"")}function Ih(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function Tz(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),n=Buffer.from(t.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(Ih(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(Ih(r.length)),s.push(r),s.push(Buffer.from([26])),s.push(Ih(n.length)),s.push(n);const i=Buffer.concat(s),o=nu(i);return Buffer.from(o).toString("hex").toUpperCase()}function Lz(t){var e,r;const n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);const s=(r=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;s&&n.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return n}var Nz=Object.defineProperty,kz=Object.defineProperties,Dz=Object.getOwnPropertyDescriptors,hw=Object.getOwnPropertySymbols,jz=Object.prototype.hasOwnProperty,qz=Object.prototype.propertyIsEnumerable,dw=(t,e,r)=>e in t?Nz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zz=(t,e)=>{for(var r in e||(e={}))jz.call(e,r)&&dw(t,r,e[r]);if(hw)for(var r of hw(e))qz.call(e,r)&&dw(t,r,e[r]);return t},Mz=(t,e)=>kz(t,Dz(e));const G8="did:pkh:",Hz={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},Vz=t=>t?Hz[t]||t:"",su=t=>t?.split(":"),Kz=t=>{const e=t&&su(t);if(e)return t.includes(G8)?e[3]:e[1]},Gz=t=>{const e=t&&su(t);if(e)return t.includes(G8)?e[2]:e[0]},mp=t=>{const e=t&&su(t);if(e)return e[2]+":"+e[3]},yl=t=>{const e=t&&su(t);if(e)return e.pop()};async function pw(t){const{cacao:e,projectId:r}=t,{s:n,p:s}=e,i=Z8(s,s.iss),o=yl(s.iss);return await Oz(o,i,n,mp(s.iss),r)}const Z8=(t,e)=>{const r=Gz(e);if(!r)throw new Error("Invalid issuer: "+e);const n=`${t.domain} wants you to sign in with your ${Vz(r)} account:`,s=yl(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${Kz(e)}`,f=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,u=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,g=t.resources?`Resources:${t.resources.map(E=>`
- ${E}`).join("")}`:void 0,b=Gf(t.resources);if(b){const E=xc(b);i=rM(i,E)}return[n,s,"",i,"",o,a,c,f,l,h,u,d,g].filter(E=>E!=null).join(`
`)};function Zz(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function Yz(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function po(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const n=t.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(s=>{const i=n[s];if(!Array.isArray(i))throw new Error(`Ability limits ${s} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function Wz(t,e,r,n={}){return r?.sort((s,i)=>s.localeCompare(i)),{att:{[t]:Xz(e,r,n)}}}function Xz(t,e,r={}){e=e?.sort((s,i)=>s.localeCompare(i));const n=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...n)}function Y8(t){return po(t),`urn:recap:${Zz(t).replace(/=/g,"")}`}function xc(t){const e=Yz(t.replace("urn:recap:",""));return po(e),e}function Jz(t,e,r){const n=Wz(t,e,r);return Y8(n)}function Qz(t){return t&&t.includes("urn:recap:")}function eM(t,e){const r=xc(t),n=xc(e),s=tM(r,n);return Y8(s)}function tM(t,e){po(t),po(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,i)=>s.localeCompare(i)),n={att:{}};return r.forEach(s=>{var i,o;Object.keys(((i=t.att)==null?void 0:i[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,f;n.att[s]=Mz(zz({},n.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((f=e.att[s])==null?void 0:f[a])})})}),n}function rM(t="",e){po(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const n=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,u)=>h.action.localeCompare(u.action));const f={};c.forEach(h=>{f[h.ability]||(f[h.ability]=[]),f[h.ability].push(h.action)});const l=Object.keys(f).map(h=>(s++,`(${s}) '${h}': '${f[h].join("', '")}' for '${a}'.`));n.push(l.join(", ").replace(".,","."))});const i=n.join(" "),o=`${r}${i}`;return`${t?t+" ":""}${o}`}function gw(t){var e;const r=xc(t);po(r);const n=(e=r.att)==null?void 0:e.eip155;return n?Object.keys(n).map(s=>s.split("/")[1]):[]}function yw(t){const e=xc(t);po(e);const r=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(s=>{var i;(i=s?.[0])!=null&&i.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function Gf(t){if(!t)return;const e=t?.[t.length-1];return Qz(e)?e:void 0}function W8(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function vp(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Bh(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Nt(t,...e){if(!W8(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function bw(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function nM(t,e){Nt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ci(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ua(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function sM(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const iM=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function oM(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Ep(t){if(typeof t=="string")t=oM(t);else if(W8(t))t=xp(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function aM(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function cM(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const fM=(t,e)=>{function r(n,...s){if(Nt(n),!iM)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const f=s[0];if(!f)throw new Error("nonce / iv required");t.varSizeNonce?Nt(f):Nt(f,t.nonceLength)}const i=t.tagLength;i&&s[1]!==void 0&&Nt(s[1]);const o=e(n,...s),a=(f,l)=>{if(l!==void 0){if(f!==2)throw new Error("cipher output not supported");Nt(l)}};let c=!1;return{encrypt(f,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Nt(f),a(o.encrypt.length,l),o.encrypt(f,l)},decrypt(f,l){if(Nt(f),i&&f.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,l),o.decrypt(f,l)}}}return Object.assign(r,t),r};function ww(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!uM(e))throw new Error("invalid output, must be aligned");return e}function mw(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function lM(t,e,r){vp(r);const n=new Uint8Array(16),s=sM(n);return mw(s,0,BigInt(e),r),mw(s,8,BigInt(t),r),n}function uM(t){return t.byteOffset%4===0}function xp(t){return Uint8Array.from(t)}const X8=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),hM=X8("expand 16-byte k"),dM=X8("expand 32-byte k"),pM=ci(hM),gM=ci(dM);function de(t,e){return t<<e|t>>>32-e}function $p(t){return t.byteOffset%4===0}const Ef=64,yM=16,J8=2**32-1,vw=new Uint32Array;function bM(t,e,r,n,s,i,o,a){const c=s.length,f=new Uint8Array(Ef),l=ci(f),h=$p(s)&&$p(i),u=h?ci(s):vw,d=h?ci(i):vw;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=J8)throw new Error("arx: counter overflow");const b=Math.min(Ef,c-g);if(h&&b===Ef){const E=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let U=0,L;U<yM;U++)L=E+U,d[L]=u[L]^l[U];g+=Ef;continue}for(let E=0,U;E<b;E++)U=g+E,i[U]=s[U]^f[E];g+=b}}function wM(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=aM({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Bh(s),Bh(o),vp(i),vp(r),(a,c,f,l,h=0)=>{Nt(a),Nt(c),Nt(f);const u=f.length;if(l===void 0&&(l=new Uint8Array(u)),Nt(l),Bh(h),h<0||h>=J8)throw new Error("arx: counter overflow");if(l.length<u)throw new Error(`arx: output (${l.length}) is shorter than data (${u})`);const d=[];let g=a.length,b,E;if(g===32)d.push(b=xp(a)),E=gM;else if(g===16&&r)b=new Uint8Array(32),b.set(a),b.set(a,16),E=pM,d.push(b);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);$p(c)||d.push(c=xp(c));const U=ci(b);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(E,U,ci(c.subarray(0,16)),U),c=c.subarray(16)}const L=16-s;if(L!==c.length)throw new Error(`arx: nonce must be ${L} or 16 bytes`);if(L!==12){const F=new Uint8Array(12);F.set(c,i?0:12-c.length),c=F,d.push(c)}const $=ci(c);return bM(t,E,U,$,f,l,h,o),ua(...d),l}}const Ge=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let mM=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Ep(e),Nt(e,32);const r=Ge(e,0),n=Ge(e,2),s=Ge(e,4),i=Ge(e,6),o=Ge(e,8),a=Ge(e,10),c=Ge(e,12),f=Ge(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Ge(e,16+2*l)}process(e,r,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],f=o[2],l=o[3],h=o[4],u=o[5],d=o[6],g=o[7],b=o[8],E=o[9],U=Ge(e,r+0),L=Ge(e,r+2),$=Ge(e,r+4),F=Ge(e,r+6),P=Ge(e,r+8),C=Ge(e,r+10),T=Ge(e,r+12),R=Ge(e,r+14);let A=i[0]+(U&8191),j=i[1]+((U>>>13|L<<3)&8191),q=i[2]+((L>>>10|$<<6)&8191),S=i[3]+(($>>>7|F<<9)&8191),m=i[4]+((F>>>4|P<<12)&8191),x=i[5]+(P>>>1&8191),y=i[6]+((P>>>14|C<<2)&8191),p=i[7]+((C>>>11|T<<5)&8191),v=i[8]+((T>>>8|R<<8)&8191),I=i[9]+(R>>>5|s),w=0,B=w+A*a+j*(5*E)+q*(5*b)+S*(5*g)+m*(5*d);w=B>>>13,B&=8191,B+=x*(5*u)+y*(5*h)+p*(5*l)+v*(5*f)+I*(5*c),w+=B>>>13,B&=8191;let O=w+A*c+j*a+q*(5*E)+S*(5*b)+m*(5*g);w=O>>>13,O&=8191,O+=x*(5*d)+y*(5*u)+p*(5*h)+v*(5*l)+I*(5*f),w+=O>>>13,O&=8191;let _=w+A*f+j*c+q*a+S*(5*E)+m*(5*b);w=_>>>13,_&=8191,_+=x*(5*g)+y*(5*d)+p*(5*u)+v*(5*h)+I*(5*l),w+=_>>>13,_&=8191;let k=w+A*l+j*f+q*c+S*a+m*(5*E);w=k>>>13,k&=8191,k+=x*(5*b)+y*(5*g)+p*(5*d)+v*(5*u)+I*(5*h),w+=k>>>13,k&=8191;let D=w+A*h+j*l+q*f+S*c+m*a;w=D>>>13,D&=8191,D+=x*(5*E)+y*(5*b)+p*(5*g)+v*(5*d)+I*(5*u),w+=D>>>13,D&=8191;let N=w+A*u+j*h+q*l+S*f+m*c;w=N>>>13,N&=8191,N+=x*a+y*(5*E)+p*(5*b)+v*(5*g)+I*(5*d),w+=N>>>13,N&=8191;let z=w+A*d+j*u+q*h+S*l+m*f;w=z>>>13,z&=8191,z+=x*c+y*a+p*(5*E)+v*(5*b)+I*(5*g),w+=z>>>13,z&=8191;let H=w+A*g+j*d+q*u+S*h+m*l;w=H>>>13,H&=8191,H+=x*f+y*c+p*a+v*(5*E)+I*(5*b),w+=H>>>13,H&=8191;let V=w+A*b+j*g+q*d+S*u+m*h;w=V>>>13,V&=8191,V+=x*l+y*f+p*c+v*a+I*(5*E),w+=V>>>13,V&=8191;let M=w+A*E+j*b+q*g+S*d+m*u;w=M>>>13,M&=8191,M+=x*h+y*l+p*f+v*c+I*a,w+=M>>>13,M&=8191,w=(w<<2)+w|0,w=w+B|0,B=w&8191,w=w>>>13,O+=w,i[0]=B,i[1]=O,i[2]=_,i[3]=k,i[4]=D,i[5]=N,i[6]=z,i[7]=H,i[8]=V,i[9]=M}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;ua(n)}update(e){bw(this),e=Ep(e),Nt(e);const{buffer:r,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){ua(this.h,this.r,this.buffer,this.pad)}digestInto(e){bw(this),nM(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}};function vM(t){const e=(n,s)=>t(s).update(Ep(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const EM=vM(t=>new mM(t));function xM(t,e,r,n,s,i=20){let o=t[0],a=t[1],c=t[2],f=t[3],l=e[0],h=e[1],u=e[2],d=e[3],g=e[4],b=e[5],E=e[6],U=e[7],L=s,$=r[0],F=r[1],P=r[2],C=o,T=a,R=c,A=f,j=l,q=h,S=u,m=d,x=g,y=b,p=E,v=U,I=L,w=$,B=F,O=P;for(let k=0;k<i;k+=2)C=C+j|0,I=de(I^C,16),x=x+I|0,j=de(j^x,12),C=C+j|0,I=de(I^C,8),x=x+I|0,j=de(j^x,7),T=T+q|0,w=de(w^T,16),y=y+w|0,q=de(q^y,12),T=T+q|0,w=de(w^T,8),y=y+w|0,q=de(q^y,7),R=R+S|0,B=de(B^R,16),p=p+B|0,S=de(S^p,12),R=R+S|0,B=de(B^R,8),p=p+B|0,S=de(S^p,7),A=A+m|0,O=de(O^A,16),v=v+O|0,m=de(m^v,12),A=A+m|0,O=de(O^A,8),v=v+O|0,m=de(m^v,7),C=C+q|0,O=de(O^C,16),p=p+O|0,q=de(q^p,12),C=C+q|0,O=de(O^C,8),p=p+O|0,q=de(q^p,7),T=T+S|0,I=de(I^T,16),v=v+I|0,S=de(S^v,12),T=T+S|0,I=de(I^T,8),v=v+I|0,S=de(S^v,7),R=R+m|0,w=de(w^R,16),x=x+w|0,m=de(m^x,12),R=R+m|0,w=de(w^R,8),x=x+w|0,m=de(m^x,7),A=A+j|0,B=de(B^A,16),y=y+B|0,j=de(j^y,12),A=A+j|0,B=de(B^A,8),y=y+B|0,j=de(j^y,7);let _=0;n[_++]=o+C|0,n[_++]=a+T|0,n[_++]=c+R|0,n[_++]=f+A|0,n[_++]=l+j|0,n[_++]=h+q|0,n[_++]=u+S|0,n[_++]=d+m|0,n[_++]=g+x|0,n[_++]=b+y|0,n[_++]=E+p|0,n[_++]=U+v|0,n[_++]=L+I|0,n[_++]=$+w|0,n[_++]=F+B|0,n[_++]=P+O|0}const $M=wM(xM,{counterRight:!1,counterLength:4,allowShortKeys:!1}),IM=new Uint8Array(16),Ew=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(IM.subarray(r))},BM=new Uint8Array(32);function xw(t,e,r,n,s){const i=t(e,r,BM),o=EM.create(i);s&&Ew(o,s),Ew(o,n);const a=lM(n.length,s?s.length:0,!0);o.update(a);const c=o.digest();return ua(i,a),c}const AM=t=>(e,r,n)=>({encrypt(s,i){const o=s.length;i=ww(o+16,i,!1),i.set(s);const a=i.subarray(0,-16);t(e,r,a,a,1);const c=xw(t,e,r,a,n);return i.set(c,o),ua(c),i},decrypt(s,i){i=ww(s.length-16,i,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=xw(t,e,r,o,n);if(!cM(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),t(e,r,i,i,1),ua(c),i}});fM({blockSize:64,nonceLength:12,tagLength:16},AM($M));let Q8=class extends ru{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,R8(e);const n=Kn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),jr(i)}update(e){return gi(this),this.iHash.update(e),this}digestInto(e){gi(this),Dr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const e4=(t,e,r)=>new Q8(t,e).update(r).digest();e4.create=(t,e)=>new Q8(t,e);Uint8Array.from([0]);const t4=nu,dg=BigInt(0),Ip=BigInt(1);function bl(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Ji(t,e,r=""){const n=tu(t),s=t?.length,i=e!==void 0;if(!n||i&&s!==e){const o=r&&`"${r}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function xf(t){const e=t.toString(16);return e.length&1?"0"+e:e}function r4(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?dg:BigInt("0x"+t)}function iu(t){return r4(Jo(t))}function wl(t){return Dr(t),r4(Jo(Uint8Array.from(t).reverse()))}function pg(t,e){return gl(t.toString(16).padStart(e*2,"0"))}function gg(t,e){return pg(t,e).reverse()}function mt(t,e,r){let n;if(typeof e=="string")try{n=gl(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(tu(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}const Ah=t=>typeof t=="bigint"&&dg<=t;function SM(t,e,r){return Ah(t)&&Ah(e)&&Ah(r)&&e<=t&&t<r}function Bp(t,e,r,n){if(!SM(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function n4(t){let e;for(e=0;t>dg;t>>=Ip,e+=1);return e}const jc=t=>(Ip<<BigInt(t))-Ip;function OM(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=u=>new Uint8Array(u),s=u=>Uint8Array.of(u);let i=n(t),o=n(t),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},f=(...u)=>r(o,i,...u),l=(u=n(0))=>{o=f(s(0),u),i=f(),u.length!==0&&(o=f(s(1),u),i=f())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){i=f();const g=i.slice();d.push(g),u+=i.length}return Ys(...d)};return(u,d)=>{c(),l(u);let g;for(;!(g=d(h()));)l();return c(),g}}function ou(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(s,i,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([s,i])=>n(s,i,!1)),Object.entries(r).forEach(([s,i])=>n(s,i,!0))}function $w(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const zt=BigInt(0),At=BigInt(1),Qi=BigInt(2),s4=BigInt(3),i4=BigInt(4),o4=BigInt(5),_M=BigInt(7),a4=BigInt(8),FM=BigInt(9),c4=BigInt(16);function Jt(t,e){const r=t%e;return r>=zt?r:e+r}function Sr(t,e,r){let n=t;for(;e-- >zt;)n*=n,n%=r;return n}function Iw(t,e){if(t===zt)throw new Error("invert: expected non-zero number");if(e<=zt)throw new Error("invert: expected positive modulus, got "+e);let r=Jt(t,e),n=e,s=zt,i=At;for(;r!==zt;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==At)throw new Error("invert: does not exist");return Jt(s,e)}function yg(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function f4(t,e){const r=(t.ORDER+At)/i4,n=t.pow(e,r);return yg(t,n,e),n}function UM(t,e){const r=(t.ORDER-o4)/a4,n=t.mul(e,Qi),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,Qi),s),a=t.mul(i,t.sub(o,t.ONE));return yg(t,a,e),a}function PM(t){const e=Ei(t),r=l4(t),n=r(e,e.neg(e.ONE)),s=r(e,n),i=r(e,e.neg(n)),o=(t+_M)/c4;return(a,c)=>{let f=a.pow(c,o),l=a.mul(f,n);const h=a.mul(f,s),u=a.mul(f,i),d=a.eql(a.sqr(l),c),g=a.eql(a.sqr(h),c);f=a.cmov(f,l,d),l=a.cmov(u,h,g);const b=a.eql(a.sqr(l),c),E=a.cmov(f,l,b);return yg(a,E,c),E}}function l4(t){if(t<s4)throw new Error("sqrt is not defined for small field");let e=t-At,r=0;for(;e%Qi===zt;)e/=Qi,r++;let n=Qi;const s=Ei(t);for(;Bw(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return f4;let i=s.pow(n,e);const o=(e+At)/Qi;return function(a,c){if(a.is0(c))return c;if(Bw(a,c)!==1)throw new Error("Cannot find square root");let f=r,l=a.mul(a.ONE,i),h=a.pow(c,e),u=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,g=a.sqr(h);for(;!a.eql(g,a.ONE);)if(d++,g=a.sqr(g),d===f)throw new Error("Cannot find square root");const b=At<<BigInt(f-d-1),E=a.pow(l,b);f=d,l=a.sqr(E),h=a.mul(h,l),u=a.mul(u,E)}return u}}function CM(t){return t%i4===s4?f4:t%a4===o4?UM:t%c4===FM?PM(t):l4(t)}const RM=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function TM(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=RM.reduce((n,s)=>(n[s]="function",n),e);return ou(t,r),t}function LM(t,e,r){if(r<zt)throw new Error("invalid exponent, negatives unsupported");if(r===zt)return t.ONE;if(r===At)return e;let n=t.ONE,s=e;for(;r>zt;)r&At&&(n=t.mul(n,s)),s=t.sqr(s),r>>=At;return n}function u4(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function Bw(t,e){const r=(t.ORDER-At)/Qi,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function h4(t,e){e!==void 0&&pi(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Ei(t,e,r=!1,n={}){if(t<=zt)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const u=e;u.BITS&&(s=u.BITS),u.sqrt&&(i=u.sqrt),typeof u.isLE=="boolean"&&(r=u.isLE),typeof u.modFromBytes=="boolean"&&(o=u.modFromBytes),a=u.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:f}=h4(t,s);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:f,MASK:jc(c),ZERO:zt,ONE:At,allowedLengths:a,create:u=>Jt(u,t),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return zt<=u&&u<t},is0:u=>u===zt,isValidNot0:u=>!h.is0(u)&&h.isValid(u),isOdd:u=>(u&At)===At,neg:u=>Jt(-u,t),eql:(u,d)=>u===d,sqr:u=>Jt(u*u,t),add:(u,d)=>Jt(u+d,t),sub:(u,d)=>Jt(u-d,t),mul:(u,d)=>Jt(u*d,t),pow:(u,d)=>LM(h,u,d),div:(u,d)=>Jt(u*Iw(d,t),t),sqrN:u=>u*u,addN:(u,d)=>u+d,subN:(u,d)=>u-d,mulN:(u,d)=>u*d,inv:u=>Iw(u,t),sqrt:i||(u=>(l||(l=CM(t)),l(h,u))),toBytes:u=>r?gg(u,f):pg(u,f),fromBytes:(u,d=!0)=>{if(a){if(!a.includes(u.length)||u.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);const b=new Uint8Array(f);b.set(u,r?0:b.length-u.length),u=b}if(u.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+u.length);let g=r?wl(u):iu(u);if(o&&(g=Jt(g,t)),!d&&!h.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:u=>u4(h,u),cmov:(u,d,g)=>g?d:u});return Object.freeze(h)}function d4(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function p4(t){const e=d4(t);return e+Math.ceil(e/2)}function NM(t,e,r=!1){const n=t.length,s=d4(e),i=p4(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?wl(t):iu(t),a=Jt(o,e-At)+At;return r?gg(a,s):pg(a,s)}const ha=BigInt(0),eo=BigInt(1);function ml(t,e){const r=e.negate();return t?r:e}function Sh(t,e){const r=u4(t.Fp,e.map(n=>n.Z));return e.map((n,s)=>t.fromAffine(n.toAffine(r[s])))}function g4(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Oh(t,e){g4(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=jc(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function Aw(t,e,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=eo);const f=e*n,l=f+Math.abs(a)-1,h=a===0,u=a<0,d=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:u,isNegF:d,offsetF:f}}function kM(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function DM(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const _h=new WeakMap,y4=new WeakMap;function Fh(t){return y4.get(t)||1}function Sw(t){if(t!==ha)throw new Error("invalid wNAF")}let jM=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let s=e;for(;r>ha;)r&eo&&(n=n.add(s)),s=s.double(),r>>=eo;return n}precomputeWindow(e,r){const{windows:n,windowSize:s}=Oh(r,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let f=1;f<s;f++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=Oh(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:l,isNeg:h,isNegF:u,offsetF:d}=Aw(n,a,o);n=c,l?i=i.add(ml(u,r[d])):s=s.add(ml(h,r[f]))}return Sw(n),{p:s,f:i}}wNAFUnsafe(e,r,n,s=this.ZERO){const i=Oh(e,this.bits);for(let o=0;o<i.windows&&n!==ha;o++){const{nextN:a,offset:c,isZero:f,isNeg:l}=Aw(n,o,i);if(n=a,!f){const h=r[c];s=s.add(l?h.negate():h)}}return Sw(n),s}getPrecomputes(e,r,n){let s=_h.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(s=n(s)),_h.set(r,s))),s}cached(e,r,n){const s=Fh(e);return this.wNAF(s,this.getPrecomputes(s,e,n),r)}unsafe(e,r,n,s){const i=Fh(e);return i===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),r,s)}createCache(e,r){g4(r,this.bits),y4.set(e,r),_h.delete(e)}hasCache(e){return Fh(e)!==1}};function qM(t,e,r,n){let s=e,i=t.ZERO,o=t.ZERO;for(;r>ha||n>ha;)r&eo&&(i=i.add(s)),n&eo&&(o=o.add(s)),s=s.double(),r>>=eo,n>>=eo;return{p1:i,p2:o}}function zM(t,e,r,n){kM(r,t),DM(n,e);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=n4(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=jc(c),l=new Array(Number(f)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let u=o;for(let d=h;d>=0;d-=c){l.fill(o);for(let b=0;b<i;b++){const E=n[b],U=Number(E>>BigInt(d)&f);l[U]=l[U].add(r[b])}let g=o;for(let b=l.length-1,E=o;b>0;b--)E=E.add(l[b]),g=g.add(E);if(u=u.add(g),d!==0)for(let b=0;b<c;b++)u=u.double()}return u}function Ow(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return TM(e),e}else return Ei(t,{isLE:r})}function MM(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>ha))throw new Error(`CURVE.${a} must be positive bigint`)}const s=Ow(e.p,r.Fp,n),i=Ow(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),k8("HashToScalar-");const Na=BigInt(0),Uo=BigInt(1),$f=BigInt(2);function HM(t){return ou(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function VM(t){const e=HM(t),{P:r,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||ug,f=a?255:448,l=a?32:56,h=BigInt(a?9:5),u=BigInt(a?121665:39081),d=a?$f**BigInt(254):$f**BigInt(447),g=a?BigInt(8)*$f**BigInt(251)-Uo:BigInt(4)*$f**BigInt(445)-Uo,b=d+g+Uo,E=S=>Jt(S,r),U=L(h);function L(S){return gg(E(S),l)}function $(S){const m=mt("u coordinate",S,l);return a&&(m[31]&=127),E(wl(m))}function F(S){return wl(s(mt("scalar",S,l)))}function P(S,m){const x=R($(m),F(S));if(x===Na)throw new Error("invalid private or public key received");return L(x)}function C(S){return P(S,U)}function T(S,m,x){const y=E(S*(m-x));return m=E(m-y),x=E(x+y),{x_2:m,x_3:x}}function R(S,m){Bp("u",S,Na,r),Bp("scalar",m,d,b);const x=m,y=S;let p=Uo,v=Na,I=S,w=Uo,B=Na;for(let _=BigInt(f-1);_>=Na;_--){const k=x>>_&Uo;B^=k,{x_2:p,x_3:I}=T(B,p,I),{x_2:v,x_3:w}=T(B,v,w),B=k;const D=p+v,N=E(D*D),z=p-v,H=E(z*z),V=N-H,M=I+w,K=I-w,Q=E(K*D),te=E(M*z),re=Q+te,le=Q-te;I=E(re*re),w=E(y*E(le*le)),p=E(N*H),v=E(V*(N+E(u*V)))}({x_2:p,x_3:I}=T(B,p,I)),{x_2:v,x_3:w}=T(B,v,w);const O=i(v);return E(p*O)}const A={secretKey:l,publicKey:l,seed:l},j=(S=c(l))=>(Dr(S,A.seed),S);function q(S){const m=j(S);return{secretKey:m,publicKey:C(m)}}return{keygen:q,getSharedSecret:(S,m)=>P(S,m),getPublicKey:S=>C(S),scalarMult:P,scalarMultBase:C,utils:{randomSecretKey:j,randomPrivateKey:j},GuBytes:U.slice(),lengths:A}}const KM=BigInt(1),_w=BigInt(2),GM=BigInt(3),ZM=BigInt(5);BigInt(8);const b4=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),YM={p:b4,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function WM(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=b4,o=t*t%i*t%i,a=Sr(o,_w,i)*o%i,c=Sr(a,KM,i)*t%i,f=Sr(c,ZM,i)*c%i,l=Sr(f,e,i)*f%i,h=Sr(l,r,i)*l%i,u=Sr(h,n,i)*h%i,d=Sr(u,s,i)*u%i,g=Sr(d,s,i)*u%i,b=Sr(g,e,i)*f%i;return{pow_p_5_8:Sr(b,_w,i)*t%i,b2:o}}function XM(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const JM=Ei(YM.p,{isLE:!0});(()=>{const t=JM.ORDER;return VM({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=WM(e);return Jt(Sr(r,GM,t)*n,t)},adjustScalarBytes:XM})})();const Fw=(t,e)=>(t+(t>=0?e:-e)/w4)/e;function QM(t,e,r){const[[n,s],[i,o]]=e,a=Fw(o*t,r),c=Fw(-s*t,r);let f=t-a*n-c*i,l=-a*s-c*o;const h=f<jn,u=l<jn;h&&(f=-f),u&&(l=-l);const d=jc(Math.ceil(n4(r)/2))+Qo;if(f<jn||f>=d||l<jn||l>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:f,k2neg:u,k2:l}}function Ap(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Uh(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return bl(r.lowS,"lowS"),bl(r.prehash,"prehash"),r.format!==void 0&&Ap(r.format),r}let eH=class extends Error{constructor(e=""){super(e)}};const Tn={Err:eH,_tlv:{encode:(t,e)=>{const{Err:r}=Tn;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=xf(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?xf(s.length/2|128):"";return xf(t)+i+s+e},decode(t,e){const{Err:r}=Tn;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of f)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Tn;if(t<jn)throw new e("integer: negative integers are not allowed");let r=xf(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Tn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return iu(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Tn,s=mt("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:f,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=Tn,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}},jn=BigInt(0),Qo=BigInt(1),w4=BigInt(2),If=BigInt(3),tH=BigInt(4);function qo(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let s=mt("private key",e);try{n=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function rH(t,e={}){const r=MM("weierstrass",t,e),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:o,n:a}=i;ou(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=v4(n,s);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(S,m,x){const{x:y,y:p}=m.toAffine(),v=n.toBytes(y);if(bl(x,"isCompressed"),x){l();const I=!n.isOdd(p);return Ys(m4(I),v)}else return Ys(Uint8Array.of(4),v,n.toBytes(p))}function u(S){Ji(S,void 0,"Point");const{publicKey:m,publicKeyUncompressed:x}=f,y=S.length,p=S[0],v=S.subarray(1);if(y===m&&(p===2||p===3)){const I=n.fromBytes(v);if(!n.isValid(I))throw new Error("bad point: is not on curve, wrong x");const w=b(I);let B;try{B=n.sqrt(w)}catch(_){const k=_ instanceof Error?": "+_.message:"";throw new Error("bad point: is not on curve, sqrt error"+k)}l();const O=n.isOdd(B);return(p&1)===1!==O&&(B=n.neg(B)),{x:I,y:B}}else if(y===x&&p===4){const I=n.BYTES,w=n.fromBytes(v.subarray(0,I)),B=n.fromBytes(v.subarray(I,I*2));if(!E(w,B))throw new Error("bad point: is not on curve");return{x:w,y:B}}else throw new Error(`bad point: got length ${y}, expected compressed=${m} or uncompressed=${x}`)}const d=e.toBytes||h,g=e.fromBytes||u;function b(S){const m=n.sqr(S),x=n.mul(m,S);return n.add(n.add(x,n.mul(S,i.a)),i.b)}function E(S,m){const x=n.sqr(m),y=b(S);return n.eql(x,y)}if(!E(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const U=n.mul(n.pow(i.a,If),tH),L=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(U,L)))throw new Error("bad curve params: a or b");function $(S,m,x=!1){if(!n.isValid(m)||x&&n.is0(m))throw new Error(`bad point coordinate ${S}`);return m}function F(S){if(!(S instanceof A))throw new Error("ProjectivePoint expected")}function P(S){if(!c||!c.basises)throw new Error("no endo");return QM(S,c.basises,s.ORDER)}const C=$w((S,m)=>{const{X:x,Y:y,Z:p}=S;if(n.eql(p,n.ONE))return{x,y};const v=S.is0();m==null&&(m=v?n.ONE:n.inv(p));const I=n.mul(x,m),w=n.mul(y,m),B=n.mul(p,m);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(B,n.ONE))throw new Error("invZ was invalid");return{x:I,y:w}}),T=$w(S=>{if(S.is0()){if(e.allowInfinityPoint&&!n.is0(S.Y))return;throw new Error("bad point: ZERO")}const{x:m,y:x}=S.toAffine();if(!n.isValid(m)||!n.isValid(x))throw new Error("bad point: x or y not field elements");if(!E(m,x))throw new Error("bad point: equation left != right");if(!S.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(S,m,x,y,p){return x=new A(n.mul(x.X,S),x.Y,x.Z),m=ml(y,m),x=ml(p,x),m.add(x)}class A{constructor(m,x,y){this.X=$("x",m),this.Y=$("y",x,!0),this.Z=$("z",y),Object.freeze(this)}static CURVE(){return i}static fromAffine(m){const{x,y}=m||{};if(!m||!n.isValid(x)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof A)throw new Error("projective point not allowed");return n.is0(x)&&n.is0(y)?A.ZERO:new A(x,y,n.ONE)}static fromBytes(m){const x=A.fromAffine(g(Ji(m,void 0,"point")));return x.assertValidity(),x}static fromHex(m){return A.fromBytes(mt("pointHex",m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,x=!0){return q.createCache(this,m),x||this.multiply(If),this}assertValidity(){T(this)}hasEvenY(){const{y:m}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(m)}equals(m){F(m);const{X:x,Y:y,Z:p}=this,{X:v,Y:I,Z:w}=m,B=n.eql(n.mul(x,w),n.mul(v,p)),O=n.eql(n.mul(y,w),n.mul(I,p));return B&&O}negate(){return new A(this.X,n.neg(this.Y),this.Z)}double(){const{a:m,b:x}=i,y=n.mul(x,If),{X:p,Y:v,Z:I}=this;let w=n.ZERO,B=n.ZERO,O=n.ZERO,_=n.mul(p,p),k=n.mul(v,v),D=n.mul(I,I),N=n.mul(p,v);return N=n.add(N,N),O=n.mul(p,I),O=n.add(O,O),w=n.mul(m,O),B=n.mul(y,D),B=n.add(w,B),w=n.sub(k,B),B=n.add(k,B),B=n.mul(w,B),w=n.mul(N,w),O=n.mul(y,O),D=n.mul(m,D),N=n.sub(_,D),N=n.mul(m,N),N=n.add(N,O),O=n.add(_,_),_=n.add(O,_),_=n.add(_,D),_=n.mul(_,N),B=n.add(B,_),D=n.mul(v,I),D=n.add(D,D),_=n.mul(D,N),w=n.sub(w,_),O=n.mul(D,k),O=n.add(O,O),O=n.add(O,O),new A(w,B,O)}add(m){F(m);const{X:x,Y:y,Z:p}=this,{X:v,Y:I,Z:w}=m;let B=n.ZERO,O=n.ZERO,_=n.ZERO;const k=i.a,D=n.mul(i.b,If);let N=n.mul(x,v),z=n.mul(y,I),H=n.mul(p,w),V=n.add(x,y),M=n.add(v,I);V=n.mul(V,M),M=n.add(N,z),V=n.sub(V,M),M=n.add(x,p);let K=n.add(v,w);return M=n.mul(M,K),K=n.add(N,H),M=n.sub(M,K),K=n.add(y,p),B=n.add(I,w),K=n.mul(K,B),B=n.add(z,H),K=n.sub(K,B),_=n.mul(k,M),B=n.mul(D,H),_=n.add(B,_),B=n.sub(z,_),_=n.add(z,_),O=n.mul(B,_),z=n.add(N,N),z=n.add(z,N),H=n.mul(k,H),M=n.mul(D,M),z=n.add(z,H),H=n.sub(N,H),H=n.mul(k,H),M=n.add(M,H),N=n.mul(z,M),O=n.add(O,N),N=n.mul(K,M),B=n.mul(V,B),B=n.sub(B,N),N=n.mul(V,z),_=n.mul(K,_),_=n.add(_,N),new A(B,O,_)}subtract(m){return this.add(m.negate())}is0(){return this.equals(A.ZERO)}multiply(m){const{endo:x}=e;if(!s.isValidNot0(m))throw new Error("invalid scalar: out of range");let y,p;const v=I=>q.cached(this,I,w=>Sh(A,w));if(x){const{k1neg:I,k1:w,k2neg:B,k2:O}=P(m),{p:_,f:k}=v(w),{p:D,f:N}=v(O);p=k.add(N),y=R(x.beta,_,D,I,B)}else{const{p:I,f:w}=v(m);y=I,p=w}return Sh(A,[y,p])[0]}multiplyUnsafe(m){const{endo:x}=e,y=this;if(!s.isValid(m))throw new Error("invalid scalar: out of range");if(m===jn||y.is0())return A.ZERO;if(m===Qo)return y;if(q.hasCache(this))return this.multiply(m);if(x){const{k1neg:p,k1:v,k2neg:I,k2:w}=P(m),{p1:B,p2:O}=qM(A,y,v,w);return R(x.beta,B,O,p,I)}else return q.unsafe(y,m)}multiplyAndAddUnsafe(m,x,y){const p=this.multiplyUnsafe(x).add(m.multiplyUnsafe(y));return p.is0()?void 0:p}toAffine(m){return C(this,m)}isTorsionFree(){const{isTorsionFree:m}=e;return o===Qo?!0:m?m(A,this):q.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:m}=e;return o===Qo?this:m?m(A,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(m=!0){return bl(m,"isCompressed"),this.assertValidity(),d(A,this,m)}toHex(m=!0){return Jo(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(m=!0){return this.toBytes(m)}_setWindowSize(m){this.precompute(m)}static normalizeZ(m){return Sh(A,m)}static msm(m,x){return zM(A,s,m,x)}static fromPrivateKey(m){return A.BASE.multiply(qo(s,m))}}A.BASE=new A(i.Gx,i.Gy,n.ONE),A.ZERO=new A(n.ZERO,n.ONE,n.ZERO),A.Fp=n,A.Fn=s;const j=s.BITS,q=new jM(A,e.endo?Math.ceil(j/2):j);return A.BASE.precompute(8),A}function m4(t){return Uint8Array.of(t?2:3)}function v4(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function nH(t,e={}){const{Fn:r}=t,n=e.randomBytes||ug,s=Object.assign(v4(t.Fp,r),{seed:p4(r.ORDER)});function i(u){try{return!!qo(r,u)}catch{return!1}}function o(u,d){const{publicKey:g,publicKeyUncompressed:b}=s;try{const E=u.length;return d===!0&&E!==g||d===!1&&E!==b?!1:!!t.fromBytes(u)}catch{return!1}}function a(u=n(s.seed)){return NM(Ji(u,s.seed,"seed"),r.ORDER)}function c(u,d=!0){return t.BASE.multiply(qo(r,u)).toBytes(d)}function f(u){const d=a(u);return{secretKey:d,publicKey:c(d)}}function l(u){if(typeof u=="bigint")return!1;if(u instanceof t)return!0;const{secretKey:d,publicKey:g,publicKeyUncompressed:b}=s;if(r.allowedLengths||d===g)return;const E=mt("key",u).length;return E===g||E===b}function h(u,d,g=!0){if(l(u)===!0)throw new Error("first arg must be private key");if(l(d)===!1)throw new Error("second arg must be public key");const b=qo(r,u);return t.fromHex(d).multiply(b).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:f,Point:t,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:u=>qo(r,u),precompute(u=8,d=t.BASE){return d.precompute(u,!1)}},lengths:s})}function sH(t,e,r={}){R8(e),ou(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||ug,s=r.hmac||((x,...y)=>e4(e,x,Ys(...y))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:d}=nH(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},b="compact";function E(x){const y=a>>Qo;return x>y}function U(x,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${x}: out of range 1..Point.Fn.ORDER`);return y}function L(x,y){Ap(y);const p=d.signature,v=y==="compact"?p:y==="recovered"?p+1:void 0;return Ji(x,v,`${y} signature`)}class ${constructor(y,p,v){this.r=U("r",y),this.s=U("s",p),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(y,p=b){L(y,p);let v;if(p==="der"){const{r:O,s:_}=Tn.toSig(Ji(y));return new $(O,_)}p==="recovered"&&(v=y[0],p="compact",y=y.subarray(1));const I=o.BYTES,w=y.subarray(0,I),B=y.subarray(I,I*2);return new $(o.fromBytes(w),o.fromBytes(B),v)}static fromHex(y,p){return this.fromBytes(gl(y),p)}addRecoveryBit(y){return new $(this.r,this.s,y)}recoverPublicKey(y){const p=i.ORDER,{r:v,s:I,recovery:w}=this;if(w==null||![0,1,2,3].includes(w))throw new Error("recovery id invalid");if(a*w4<p&&w>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=w===2||w===3?v+a:v;if(!i.isValid(B))throw new Error("recovery id 2 or 3 invalid");const O=i.toBytes(B),_=t.fromBytes(Ys(m4((w&1)===0),O)),k=o.inv(B),D=P(mt("msgHash",y)),N=o.create(-D*k),z=o.create(I*k),H=t.BASE.multiplyUnsafe(N).add(_.multiplyUnsafe(z));if(H.is0())throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return E(this.s)}toBytes(y=b){if(Ap(y),y==="der")return gl(Tn.hexFromSig(this));const p=o.toBytes(this.r),v=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Ys(Uint8Array.of(this.recovery),p,v)}return Ys(p,v)}toHex(y){return Jo(this.toBytes(y))}assertValidity(){}static fromCompact(y){return $.fromBytes(mt("sig",y),"compact")}static fromDER(y){return $.fromBytes(mt("sig",y),"der")}normalizeS(){return this.hasHighS()?new $(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Jo(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Jo(this.toBytes("compact"))}}const F=r.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");const y=iu(x),p=x.length*8-c;return p>0?y>>BigInt(p):y},P=r.bits2int_modN||function(x){return o.create(F(x))},C=jc(c);function T(x){return Bp("num < 2^"+c,x,jn,C),o.toBytes(x)}function R(x,y){return Ji(x,void 0,"message"),y?Ji(e(x),void 0,"prehashed message"):x}function A(x,y,p){if(["recovered","canonical"].some(z=>z in p))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:I,extraEntropy:w}=Uh(p,g);x=R(x,I);const B=P(x),O=qo(o,y),_=[T(O),T(B)];if(w!=null&&w!==!1){const z=w===!0?n(d.secretKey):w;_.push(mt("extraEntropy",z))}const k=Ys(..._),D=B;function N(z){const H=F(z);if(!o.isValidNot0(H))return;const V=o.inv(H),M=t.BASE.multiply(H).toAffine(),K=o.create(M.x);if(K===jn)return;const Q=o.create(V*o.create(D+K*O));if(Q===jn)return;let te=(M.x===K?0:2)|Number(M.y&Qo),re=Q;return v&&E(Q)&&(re=o.neg(Q),te^=1),new $(K,re,te)}return{seed:k,k2sig:N}}function j(x,y,p={}){x=mt("message",x);const{seed:v,k2sig:I}=A(x,y,p);return OM(e.outputLen,o.BYTES,s)(v,I)}function q(x){let y;const p=typeof x=="string"||tu(x),v=!p&&x!==null&&typeof x=="object"&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!p&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)y=new $(x.r,x.s);else if(p){try{y=$.fromBytes(mt("sig",x),"der")}catch(I){if(!(I instanceof Tn.Err))throw I}if(!y)try{y=$.fromBytes(mt("sig",x),"compact")}catch{return!1}}return y||!1}function S(x,y,p,v={}){const{lowS:I,prehash:w,format:B}=Uh(v,g);if(p=mt("publicKey",p),y=R(mt("message",y),w),"strict"in v)throw new Error("options.strict was renamed to lowS");const O=B===void 0?q(x):$.fromBytes(mt("sig",x),B);if(O===!1)return!1;try{const _=t.fromBytes(p);if(I&&O.hasHighS())return!1;const{r:k,s:D}=O,N=P(y),z=o.inv(D),H=o.create(N*z),V=o.create(k*z),M=t.BASE.multiplyUnsafe(H).add(_.multiplyUnsafe(V));return M.is0()?!1:o.create(M.x)===k}catch{return!1}}function m(x,y,p={}){const{prehash:v}=Uh(p,g);return y=R(y,v),$.fromBytes(x,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:d,Point:t,sign:j,verify:S,recoverPublicKey:m,Signature:$,hash:e})}function iH(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=Ei(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),i={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function oH(t){const{CURVE:e,curveOpts:r}=iH(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function aH(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,h4(r.Fn.ORDER,r.Fn.BITS))})}function cH(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:s}=oH(t),i=rH(e,r),o=sH(i,n,s);return aH(t,o)}function Sp(t,e){const r=n=>cH({...t,hash:n});return{...r(e),create:r}}const E4={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},x4={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},$4={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},fH=Ei(E4.p),lH=Ei(x4.p),uH=Ei($4.p);Sp({...E4,Fp:fH,lowS:!1},nu);Sp({...x4,Fp:lH,lowS:!1},vz),Sp({...$4,Fp:uH,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},mz);const Op="base16",Ri="base64pad",ka="base64url",hH="utf8",Ph=1,dH=2;function Ch(t){const e=t4($8(t,Op));return I8(e,Op)}function $s(t){const e=t4($8(t,hH));return I8(e,Op)}function Bf(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var pH=Object.defineProperty,gH=Object.defineProperties,yH=Object.getOwnPropertyDescriptors,Uw=Object.getOwnPropertySymbols,bH=Object.prototype.hasOwnProperty,wH=Object.prototype.propertyIsEnumerable,Pw=(t,e,r)=>e in t?pH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mH=(t,e)=>{for(var r in e||(e={}))bH.call(e,r)&&Pw(t,r,e[r]);if(Uw)for(var r of Uw(e))wH.call(e,r)&&Pw(t,r,e[r]);return t},vH=(t,e)=>gH(t,yH(e));function Ea(t){const e=[];return t.forEach(r=>{const[n,s]=r.split(":");e.push(`${n}:${s}`)}),e}function I4(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Ea(r.accounts))}),[...new Set(e)]}function EH(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.methods)}),[...new Set(e)]}function xH(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.events)}),[...new Set(e)]}function $H(t,e){const r=[];return Object.values(t).forEach(n=>{Ea(n.accounts).includes(e)&&r.push(...n.methods)}),r}function IH(t,e){const r=[];return Object.values(t).forEach(n=>{Ea(n.accounts).includes(e)&&r.push(...n.events)}),r}function B4(t){return t.includes(":")}function BH(t){return B4(t)?t.split(":")[0]:t}function Cw(t){var e,r,n;const s={};if(!$c(t))return s;for(const[i,o]of Object.entries(t)){const a=B4(i)?[i]:o.chains,c=o.methods||[],f=o.events||[],l=BH(i);s[l]=vH(mH({},s[l]),{chains:co(a,(e=s[l])==null?void 0:e.chains),methods:co(c,(r=s[l])==null?void 0:r.methods),events:co(f,(n=s[l])==null?void 0:n.events)})}return s}function AH(t){const e={};return t?.forEach(r=>{var n;const[s,i]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(n=e[s].chains)==null||n.push(`${s}:${i}`)}),e}function Rw(t,e){e=e.map(n=>n.replace("did:pkh:",""));const r=AH(e);for(const[n,s]of Object.entries(r))s.methods?s.methods=co(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function SH(t,e){var r,n,s,i,o,a;const c=Cw(t),f=Cw(e),l={},h=Object.keys(c).concat(Object.keys(f));for(const u of h)l[u]={chains:co((r=c[u])==null?void 0:r.chains,(n=f[u])==null?void 0:n.chains),methods:co((s=c[u])==null?void 0:s.methods,(i=f[u])==null?void 0:i.methods),events:co((o=c[u])==null?void 0:o.events,(a=f[u])==null?void 0:a.events)};return l}const OH={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},_H={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ee(t,e){const{message:r,code:n}=_H[t];return{message:e?`${r} ${e}`:r,code:n}}function Xe(t,e){const{message:r,code:n}=OH[t];return{message:e?`${r} ${e}`:r,code:n}}function da(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function $c(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function er(t){return typeof t>"u"}function De(t,e){return e&&er(t)?!0:typeof t=="string"&&!!t.trim().length}function bg(t,e){return typeof t=="number"&&!isNaN(t)}function FH(t,e){const{requiredNamespaces:r}=e,n=Object.keys(t.namespaces),s=Object.keys(r);let i=!0;return Xi(s,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:f}=t.namespaces[o],l=Ea(a),h=r[o];(!Xi(O8(o,h),l)||!Xi(h.methods,c)||!Xi(h.events,f))&&(i=!1)}),i):!1}function vl(t){return De(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function UH(t){if(De(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&vl(r)}}return!1}function PH(t,e){let r=null;return De(t?.publicKey,!1)||(r=ee("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Tw(t){let e=!0;return da(t)?t.length&&(e=t.every(r=>De(r,!1))):e=!1,e}function CH(t,e,r){let n=null;return da(e)&&e.length?e.forEach(s=>{n||vl(s)||(n=Xe("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):vl(t)||(n=Xe("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function RH(t,e,r){let n=null;return Object.entries(t).forEach(([s,i])=>{if(n)return;const o=CH(s,O8(s,i),`${e} ${r}`);o&&(n=o)}),n}function TH(t,e){let r=null;return da(t)?t.forEach(n=>{r||UH(n)||(r=Xe("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=Xe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function LH(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const s=TH(n?.accounts,`${e} namespace`);s&&(r=s)}),r}function NH(t,e){let r=null;return Tw(t?.methods)?Tw(t?.events)||(r=Xe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Xe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function A4(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const s=NH(n,`${e}, namespace`);s&&(r=s)}),r}function kH(t,e,r){let n=null;if(t&&$c(t)){const s=A4(t,e);s&&(n=s);const i=RH(t,e,r);i&&(n=i)}else n=ee("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return n}function Rh(t,e){let r=null;if(t&&$c(t)){const n=A4(t,e);n&&(r=n);const s=LH(t,e);s&&(r=s)}else r=ee("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function S4(t){return De(t.protocol,!0)}function DH(t,e){let r=!1;return t?t&&da(t)&&t.length&&t.forEach(n=>{r=S4(n)}):r=!0,r}function jH(t){return typeof t=="number"}function $r(t){return typeof t<"u"&&typeof t!==null}function qH(t){return!(!t||typeof t!="object"||!t.code||!bg(t.code)||!t.message||!De(t.message,!1))}function zH(t){return!(er(t)||!De(t.method,!1))}function MH(t){return!(er(t)||er(t.result)&&er(t.error)||!bg(t.id)||!De(t.jsonrpc,!1))}function HH(t){return!(er(t)||!De(t.name,!1))}function Lw(t,e){return!(!vl(e)||!I4(t).includes(e))}function VH(t,e,r){return De(r,!1)?$H(t,e).includes(r):!1}function KH(t,e,r){return De(r,!1)?IH(t,e).includes(r):!1}function Nw(t,e,r){let n=null;const s=GH(t),i=ZH(e),o=Object.keys(s),a=Object.keys(i),c=kw(Object.keys(t)),f=kw(Object.keys(e)),l=c.filter(h=>!f.includes(h));return l.length&&(n=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),Xi(o,a)||(n=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;const u=Ea(e[h].accounts);u.includes(h)||(n=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${u.toString()}`))}),o.forEach(h=>{n||(Xi(s[h].methods,i[h].methods)?Xi(s[h].events,i[h].events)||(n=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):n=ee("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function GH(t){const e={};return Object.keys(t).forEach(r=>{var n;r.includes(":")?e[r]=t[r]:(n=t[r].chains)==null||n.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function kw(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function ZH(t){const e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:Ea(t[r].accounts)?.forEach(s=>{e[s]={accounts:t[r].accounts.filter(i=>i.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}),e}function YH(t,e){return bg(t)&&t<=e.max&&t>=e.min}const Th={};class Da{static get(e){return Th[e]}static set(e,r){Th[e]=r}static delete(e){delete Th[e]}}function WH(t){const e=Ac.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function XH({publicKey:t,signature:e,payload:r}){var n;const s=_p(r.method),i=128|parseInt(((n=r.version)==null?void 0:n.toString())||"4"),o=eV(r.address),a=r.era==="00"?new Uint8Array([0]):_p(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),f=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${QH(r.tip)}`),h=rV(l),u=new Uint8Array([0,...t,o,...e,...a,...f,...h,...s]),d=tV(u.length+1);return new Uint8Array([...d,i,...u])}function JH(t){const e=_p(t),r=h5.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function _p(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function QH(t){return t.startsWith("0x")?t.slice(2):t}function eV(t){const e=Ac.decode(t)[0];return e===42?0:e===60?2:1}function tV(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function rV(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function nV(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=WH(t.transaction.address),n=XH({publicKey:r,signature:e,payload:t.transaction}),s=Buffer.from(n).toString("hex");return JH(s)}function sV({logger:t,name:e}){const r=typeof t=="string"?bq({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}const O4="wc",_4=2,F4="client",wg=`${O4}@${_4}:${F4}:`,Lh={name:F4,logger:"error"},Dw="WALLETCONNECT_DEEPLINK_CHOICE",iV="proposal",jw="Proposal expired",oV="session",Po=Z.SEVEN_DAYS,aV="engine",Ze={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1114},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:Z.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:Z.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1119}}},Nh={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},Jr={idle:"IDLE",active:"ACTIVE"},cV={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},fV="request",lV=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],uV="wc",hV="auth",dV="authKeys",pV="pairingTopics",gV="requests",au=`${uV}@${1.5}:${hV}:`,Zf=`${au}:PUB_KEY`;var yV=Object.defineProperty,bV=Object.defineProperties,wV=Object.getOwnPropertyDescriptors,qw=Object.getOwnPropertySymbols,mV=Object.prototype.hasOwnProperty,vV=Object.prototype.propertyIsEnumerable,Fp=(t,e,r)=>e in t?yV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ge=(t,e)=>{for(var r in e||(e={}))mV.call(e,r)&&Fp(t,r,e[r]);if(qw)for(var r of qw(e))vV.call(e,r)&&Fp(t,r,e[r]);return t},Ye=(t,e)=>bV(t,wV(e)),G=(t,e,r)=>Fp(t,typeof e!="symbol"?e+"":e,r);class EV extends wT{constructor(e){super(e),G(this,"name",aV),G(this,"events",new t0),G(this,"initialized",!1),G(this,"requestQueue",{state:Jr.idle,queue:[]}),G(this,"sessionRequestQueue",{state:Jr.idle,queue:[]}),G(this,"emittedSessionRequests",new Dq({limit:500})),G(this,"requestQueueDelay",Z.ONE_SECOND),G(this,"expectedPairingMethodMap",new Map),G(this,"recentlyDeletedMap",new Map),G(this,"recentlyDeletedLimit",200),G(this,"relayMessageCache",[]),G(this,"pendingSessions",new Map),G(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ze)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},Z.toMiliseconds(this.requestQueueDelay)))}),G(this,"connect",async r=>{var n;this.isInitialized(),await this.confirmOnlineStateOrThrow();const s=Ye(ge({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s),s.optionalNamespaces=SH(s.requiredNamespaces,s.optionalNamespaces),s.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:f,relays:l,authentication:h,walletPay:u}=s,d=((n=h?.[0])==null?void 0:n.ttl)||Ze.wc_sessionPropose.req.ttl||Z.FIVE_MINUTES;this.validateRequestExpiry(d);let g=i,b,E=!1;try{if(g){const A=this.client.core.pairing.pairings.get(g);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),E=A.active}}catch(A){throw this.client.logger.error(`connect() -> pairing.get(${g}) failed`),A}if(!g||!E){const{topic:A,uri:j}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});g=A,b=j}if(!g){const{message:A}=ee("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(A)}const U=await this.client.core.crypto.generateKeyPair(),L=Pt(d),$=ge(Ye(ge(ge({requiredNamespaces:o,optionalNamespaces:a,relays:l??[{protocol:tE}],proposer:{publicKey:U,metadata:this.client.metadata},expiryTimestamp:L,pairingTopic:g},c&&{sessionProperties:c}),f&&{scopedProperties:f}),{id:Wn()}),(h||u)&&{requests:{authentication:h?.map(A=>{const{domain:j,chains:q,nonce:S,uri:m,exp:x,nbf:y,type:p,statement:v,requestId:I,resources:w,signatureTypes:B}=A;return{domain:j,chains:q,nonce:S,type:p??"caip122",aud:m,version:"1",iat:new Date().toISOString(),exp:x,nbf:y,statement:v,requestId:I,resources:w,signatureTypes:B}}),walletPay:u}}),F=me("session_connect",$.id),{reject:P,resolve:C,done:T}=Oo(d,jw),R=({id:A})=>{A===$.id&&(this.client.events.off("proposal_expire",R),this.pendingSessions.delete($.id),this.events.emit(F,{error:{message:jw,code:0}}))};return this.client.events.on("proposal_expire",R),this.events.once(F,({error:A,session:j})=>{this.client.events.off("proposal_expire",R),A?P(A):j&&C(j)}),await this.setProposal($.id,$),await this.sendProposeSession({proposal:$,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:$.id}}}).catch(A=>{throw this.deleteProposal($.id),A}),{uri:b,approval:T}}),G(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}}),G(this,"approve",async r=>{var n,s,i;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=r?.id)==null?void 0:n.toString(),trace:[Er.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(j){throw o.setError(Ui.no_internet_connection),j}try{await this.isValidProposalId(r?.id)}catch(j){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Ui.proposal_not_found),j}try{await this.isValidApprove(r)}catch(j){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ui.session_approve_namespace_validation_failure),j}const{id:a,relayProtocol:c,namespaces:f,sessionProperties:l,scopedProperties:h,sessionConfig:u,proposalRequestsResponses:d}=r,g=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:b,proposer:E,requiredNamespaces:U,optionalNamespaces:L}=g;let $=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:b});$||($=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:Er.session_approve_started,properties:{topic:b,trace:[Er.session_approve_started,Er.session_namespaces_validation_success]}}));const F=await this.client.core.crypto.generateKeyPair(),P=E.publicKey,C=await this.client.core.crypto.generateSharedKey(F,P),T=Ye(ge(ge(ge({relay:{protocol:c??"irn"},namespaces:f,controller:{publicKey:F,metadata:this.client.metadata},expiry:Pt(Po)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),u&&{sessionConfig:u}),{proposalRequestsResponses:d}),R=ve.relay;$.addTrace(Er.subscribing_session_topic);try{await this.client.core.relayer.subscribe(C,{transportType:R,internal:{skipSubscribe:!0}})}catch(j){throw $.setError(Ui.subscribe_session_topic_failure),j}$.addTrace(Er.subscribe_session_topic_success);const A=Ye(ge({},T),{topic:C,requiredNamespaces:U,optionalNamespaces:L,pairingTopic:b,acknowledged:!1,self:T.controller,peer:{publicKey:E.publicKey,metadata:E.metadata},controller:F,transportType:ve.relay,authentication:d?.authentication,walletPayResult:d?.walletPay});await this.client.session.set(C,A),$.addTrace(Er.store_session);try{await this.sendApproveSession({sessionTopic:C,proposal:g,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:F},sessionSettleRequest:T,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:ge({correlationId:a},this.getTVFApproveParams(A))}}),$.addTrace(Er.session_approve_publish_success)}catch(j){throw this.client.logger.error(j),this.client.session.delete(C,Xe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(C),j}return this.client.core.eventClient.deleteEvent({eventId:$.eventId}),await this.client.core.pairing.updateMetadata({topic:b,metadata:E.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:b}),await this.setExpiry(C,Pt(Po)),{topic:C,acknowledged:()=>Promise.resolve(this.client.session.get(C))}}),G(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:s}=r;let i;try{i=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}i&&await this.sendError({id:n,topic:i,error:s,rpcOpts:Ze.wc_sessionPropose.reject}),await this.deleteProposal(n)}),G(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:n,namespaces:s}=r,{done:i,resolve:o,reject:a}=Oo(Z.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Wn(),f=Mi().toString(),l=this.client.session.get(n).namespaces;return this.events.once(me("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:s}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:f}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:l}),a(h)}),{acknowledged:i}}),G(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=r,s=Wn(),{done:i,resolve:o,reject:a}=Oo(Z.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(me("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,Pt(Po)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}}),G(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(E){throw this.client.logger.error("request() -> isValidRequest() failed"),E}const{chainId:n,request:s,topic:i,expiry:o=Ze.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(i);a?.transportType===ve.relay&&await this.confirmOnlineStateOrThrow();const c=Wn(),f=Mi().toString(),{done:l,resolve:h,reject:u}=Oo(o,"Request expired. Please try again.");this.events.once(me("session_request",c),({error:E,result:U})=>{E?u(E):h(U)});const d="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:f,topic:i,method:d,params:{request:Ye(ge({},s),{expiryTimestamp:Pt(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(E=>u(E)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),await l();const b={request:Ye(ge({},s),{expiryTimestamp:Pt(o)}),chainId:n};return await Promise.all([new Promise(async E=>{await this.sendRequest({clientRpcId:c,relayRpcId:f,topic:i,method:d,params:b,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,b)}).catch(U=>u(U)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),E()}),new Promise(async E=>{var U;if(!((U=a.sessionConfig)!=null&&U.disableDeepLink)){const L=await Rq(this.client.core.storage,Dw);await Uq({id:c,topic:i,wcDeepLink:L})}E()}),l()]).then(E=>E[2])}),G(this,"respond",async r=>{var n,s;this.isInitialized();const i=this.client.core.eventClient.createEvent({properties:{topic:r?.topic||((s=(n=r?.response)==null?void 0:n.id)==null?void 0:s.toString()),trace:[Er.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw i.addTrace(h?.message),i.setError(Ui.session_request_response_validation_failure),h}i.addTrace(Er.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,f=this.client.session.get(o);f.transportType===ve.relay&&await this.confirmOnlineStateOrThrow();const l=this.getAppLinkIfEnabled(f.peer.metadata,f.transportType);try{i.addTrace(Er.session_request_response_publish_started),Bn(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:l}):rn(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:l}),this.cleanupAfterResponse(r)}catch(h){throw i.addTrace(h?.message),i.setError(Ui.session_request_response_publish_failure),h}}),G(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:n}=r;if(this.client.session.keys.includes(n)){const s=Wn(),i=Mi().toString(),{done:o,resolve:a,reject:c}=Oo(Z.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(me("session_ping",s),({error:f})=>{f?c(f):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),G(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:n,event:s,chainId:i}=r,o=Mi().toString(),a=Wn();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:s,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),G(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:Xe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:s}=ee("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(s)}}),G(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(n=>FH(n,r)))),G(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),G(this,"authenticate",async(r,n)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const i=n&&this.client.core.linkModeSupportedApps.includes(n)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=i?ve.link_mode:ve.relay;o===ve.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:f,domain:l,nonce:h,type:u,exp:d,nbf:g,methods:b=[],expiry:E}=r,U=[...r.resources||[]],{topic:L,uri:$}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:L,uri:$}});const F=await this.client.core.crypto.generateKeyPair(),P=Ch(F);if(await Promise.all([this.client.auth.authKeys.set(Zf,{responseTopic:P,publicKey:F}),this.client.auth.pairingTopics.set(P,{topic:P,pairingTopic:L})]),await this.client.core.relayer.subscribe(P,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${L}`),b.length>0){const{namespace:w}=Kf(a[0]);let B=Jz(w,"request",b);Gf(U)&&(B=eM(B,U.pop())),U.push(B)}const C=E&&E>Ze.wc_sessionAuthenticate.req.ttl?E:Ze.wc_sessionAuthenticate.req.ttl,T={authPayload:{type:u??"caip122",chains:a,statement:c,aud:f,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:d,nbf:g,resources:U},requester:{publicKey:F,metadata:this.client.metadata},expiryTimestamp:Pt(C)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...b])],events:["chainChanged","accountsChanged"]}},A={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:L,proposer:{publicKey:F,metadata:this.client.metadata},expiryTimestamp:Pt(Ze.wc_sessionPropose.req.ttl),id:Wn()},{done:j,resolve:q,reject:S}=Oo(C,"Request expired"),m=Wn(),x=me("session_connect",A.id),y=me("session_request",m),p=async({error:w,session:B})=>{this.events.off(y,v),w?S(w):B&&q({session:B})},v=async w=>{var B,O,_;if(await this.deletePendingAuthRequest(m,{message:"fulfilled",code:0}),w.error){const M=Xe("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return w.error.code===M.code?void 0:(this.events.off(x,p),S(w.error.message))}await this.deleteProposal(A.id),this.events.off(x,p);const{cacaos:k,responder:D}=w.result,N=[],z=[];for(const M of k){await pw({cacao:M,projectId:this.client.core.projectId})||(this.client.logger.error(M,"Signature verification failed"),S(Xe("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:K}=M,Q=Gf(K.resources),te=[mp(K.iss)],re=yl(K.iss);if(Q){const le=gw(Q),nt=yw(Q);N.push(...le),te.push(...nt)}for(const le of te)z.push(`${le}:${re}`)}const H=await this.client.core.crypto.generateSharedKey(F,D.publicKey);let V;N.length>0&&(V={topic:H,acknowledged:!0,self:{publicKey:F,metadata:this.client.metadata},peer:D,controller:D.publicKey,expiry:Pt(Po),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:L,namespaces:Rw([...new Set(N)],[...new Set(z)]),transportType:o},await this.client.core.relayer.subscribe(H,{transportType:o}),await this.client.session.set(H,V),L&&await this.client.core.pairing.updateMetadata({topic:L,metadata:D.metadata}),V=this.client.session.get(H)),(B=this.client.metadata.redirect)!=null&&B.linkMode&&(O=D.metadata.redirect)!=null&&O.linkMode&&(_=D.metadata.redirect)!=null&&_.universal&&n&&(this.client.core.addLinkModeSupportedApp(D.metadata.redirect.universal),this.client.session.update(H,{transportType:ve.link_mode})),q({auths:k,session:V})};this.events.once(x,p),this.events.once(y,v);let I;try{if(i){const w=nn("wc_sessionAuthenticate",T,m);this.client.core.history.set(L,w);const B=await this.client.core.crypto.encode("",w,{type:dH,encoding:ka});I=Bf(n,L,B)}else await Promise.all([this.sendRequest({topic:L,method:"wc_sessionAuthenticate",params:T,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:m}),this.sendRequest({topic:L,method:"wc_sessionPropose",params:A,expiry:Ze.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:A.id})])}catch(w){throw this.events.off(x,p),this.events.off(y,v),w}return await this.setProposal(A.id,A),await this.setAuthRequest(m,{request:Ye(ge({},T),{verifyContext:{}}),pairingTopic:L,transportType:o}),{uri:I??$,response:j}}),G(this,"approveSessionAuthenticate",async r=>{const{id:n,auths:s}=r,i=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[Pi.authenticated_session_approve_started]}});try{this.isInitialized()}catch(E){throw i.setError(_a.no_internet_connection),E}const o=this.getPendingAuthRequest(n);if(!o)throw i.setError(_a.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||ve.relay;a===ve.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),l=Ch(c),h={type:Ph,receiverPublicKey:c,senderPublicKey:f},u=[],d=[];for(const E of s){if(!await pw({cacao:E,projectId:this.client.core.projectId})){i.setError(_a.invalid_cacao);const P=Xe("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:l,error:P,encodeOpts:h}),new Error(P.message)}i.addTrace(Pi.cacaos_verified);const{p:U}=E,L=Gf(U.resources),$=[mp(U.iss)],F=yl(U.iss);if(L){const P=gw(L),C=yw(L);u.push(...P),$.push(...C)}for(const P of $)d.push(`${P}:${F}`)}const g=await this.client.core.crypto.generateSharedKey(f,c);i.addTrace(Pi.create_authenticated_session_topic);let b;if(u?.length>0){b={topic:g,acknowledged:!0,self:{publicKey:f,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Pt(Po),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Rw([...new Set(u)],[...new Set(d)]),transportType:a},i.addTrace(Pi.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(E){throw i.setError(_a.subscribe_authenticated_session_topic_failure),E}i.addTrace(Pi.subscribe_authenticated_session_topic_success),await this.client.session.set(g,b),i.addTrace(Pi.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(Pi.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:n,result:{cacaos:s,responder:{publicKey:f,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(E){throw i.setError(_a.authenticated_session_approve_publish_failure),E}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:b}}),G(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:n,reason:s}=r,i=this.getPendingAuthRequest(n);if(!i)throw new Error(`Could not find pending auth request with id ${n}`);i.transportType===ve.relay&&await this.confirmOnlineStateOrThrow();const o=i.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Ch(o),f={type:Ph,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:s,encodeOpts:f,rpcOpts:Ze.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),G(this,"formatAuthMessage",r=>{this.isInitialized();const{request:n,iss:s}=r;return Z8(n,s)}),G(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),G(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&i.topic&&i.topic!==n.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),G(this,"deleteSession",async r=>{var n;const{topic:s,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,Xe("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),i||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Dw).catch(f=>this.client.logger.warn(f)),s===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=Jr.idle),await Promise.all(this.getPendingSessionRequests().filter(f=>f.topic===s).map(f=>this.deletePendingSessionRequest(f.id,Xe("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),G(this,"deleteProposal",async(r,n)=>{if(n)try{const s=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(Ui.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,Xe("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),G(this,"deletePendingSessionRequest",async(r,n,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==r),s&&(this.sessionRequestQueue.state=Jr.idle,this.client.events.emit("session_request_expire",{id:r}))}),G(this,"deletePendingAuthRequest",async(r,n,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)])}),G(this,"setExpiry",async(r,n)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,n),await this.client.session.update(r,{expiry:n}))}),G(this,"setProposal",async(r,n)=>{this.client.core.expirer.set(r,Pt(Ze.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,n)}),G(this,"setAuthRequest",async(r,n)=>{const{request:s,pairingTopic:i,transportType:o=ve.relay}=n;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:i,verifyContext:s.verifyContext,transportType:o})}),G(this,"setPendingSessionRequest",async r=>{const{id:n,topic:s,params:i,verifyContext:o}=r,a=i.request.expiryTimestamp||Pt(Ze.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:s,params:i,verifyContext:o})}),G(this,"sendRequest",async r=>{const{topic:n,method:s,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:f,appLink:l,tvf:h,publishOpts:u={}}=r,d=nn(s,i,c);let g;const b=!!l;try{const L=b?ka:Ri;g=await this.client.core.crypto.encode(n,d,{encoding:L})}catch(L){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),L}let E;if(lV.includes(s)){const L=$s(JSON.stringify(d)),$=$s(g);E=await this.client.core.verify.register({id:$,decryptedId:L})}const U=ge(ge({},Ze[s].req),u);if(U.attestation=E,o&&(U.ttl=o),a&&(U.id=a),this.client.core.history.set(n,d),b){const L=Bf(l,n,g);await global.Linking.openURL(L,this.client.name)}else U.tvf=Ye(ge({},h),{correlationId:d.id}),f?(U.internal=Ye(ge({},U.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,g,U)):this.client.core.relayer.publish(n,g,U).catch(L=>this.client.logger.error(L));return d.id}),G(this,"sendProposeSession",async r=>{const{proposal:n,publishOpts:s}=r,i=nn("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,i);const o=await this.client.core.crypto.encode(n.pairingTopic,i,{encoding:Ri}),a=$s(JSON.stringify(i)),c=$s(o),f=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:Ye(ge({},s),{publishMethod:"wc_proposeSession",attestation:f})})}),G(this,"sendApproveSession",async r=>{const{sessionTopic:n,pairingProposalResponse:s,proposal:i,sessionSettleRequest:o,publishOpts:a}=r,c=uc(i.id,s),f=await this.client.core.crypto.encode(i.pairingTopic,c,{encoding:Ri}),l=nn("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(n,l,{encoding:Ri});this.client.core.history.set(n,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:i.pairingTopic,sessionProposalResponse:f,sessionSettlementRequest:h},opts:Ye(ge({},a),{publishMethod:"wc_approveSession"})})}),G(this,"sendResult",async r=>{const{id:n,topic:s,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,f=uc(n,i);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const g=h?ka:Ri;l=await this.client.core.crypto.encode(s,f,Ye(ge({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),g}let u,d;try{u=await this.client.core.history.get(s,n);const g=u.request;try{d=this.getTVFParams(n,g.params,i)}catch(b){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${b?.message}`)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${n}) failed`),g}if(h){const g=Bf(c,s,l);await global.Linking.openURL(g,this.client.name)}else{const g=u.request.method,b=Ze[g].res;b.tvf=Ye(ge({},d),{correlationId:n}),o?(b.internal=Ye(ge({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,l,b)):this.client.core.relayer.publish(s,l,b).catch(E=>this.client.logger.error(E))}await this.client.core.history.resolve(f)}),G(this,"sendError",async r=>{const{id:n,topic:s,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=r,f=J2(n,i);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?ka:Ri;l=await this.client.core.crypto.encode(s,f,Ye(ge({},o||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),d}let u;try{u=await this.client.core.history.get(s,n)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${s}, ${n}) failed`),d}if(h){const d=Bf(c,s,l);await global.Linking.openURL(d,this.client.name)}else{const d=u.request.method,g=a||Ze[d].res;this.client.core.relayer.publish(s,l,g)}await this.client.core.history.resolve(f)}),G(this,"cleanup",async()=>{const r=[],n=[];this.client.session.getAll().forEach(s=>{let i=!1;_o(s.expiry)&&(i=!0),this.client.core.crypto.keychain.has(s.topic)||(i=!0),i&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{_o(s.expiryTimestamp)&&n.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...n.map(s=>this.deleteProposal(s))])}),G(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),G(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),G(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Jr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Jr.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=Jr.idle}),G(this,"processRequest",async r=>{const{topic:n,payload:s,attestation:i,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:s,attestation:i,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,s);case"wc_sessionPing":return await this.onSessionPingRequest(n,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),G(this,"onRelayEventResponse",async r=>{const{topic:n,payload:s,transportType:i}=r,o=(await this.client.core.history.get(n,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,s,i);case"wc_sessionSettle":return this.onSessionSettleResponse(n,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,s);case"wc_sessionExtend":return this.onSessionExtendResponse(n,s);case"wc_sessionPing":return this.onSessionPingResponse(n,s);case"wc_sessionRequest":return this.onSessionRequestResponse(n,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),G(this,"onRelayEventUnknownPayload",r=>{const{topic:n}=r,{message:s}=ee("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),G(this,"shouldIgnorePairingRequest",r=>{const{topic:n,requestMethod:s}=r,i=this.expectedPairingMethodMap.get(n);return!i||i.includes(s)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),G(this,"onSessionProposeRequest",async r=>{const{topic:n,payload:s,attestation:i,encryptedId:o}=r,{params:a,id:c}=s;try{const f=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),f?.setError(On.proposal_listener_not_found)),this.isValidConnect(ge({},s.params));const l=a.expiryTimestamp||Pt(Ze.wc_sessionPropose.req.ttl),h=ge({id:c,pairingTopic:n,expiryTimestamp:l,attestation:i,encryptedId:o},a);await this.setProposal(c,h);const u=await this.getVerifyContext({attestationId:i,hash:$s(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});f?.addTrace(tn.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:u})}catch(f){await this.sendError({id:c,topic:n,error:f,rpcOpts:Ze.wc_sessionPropose.autoReject}),this.client.logger.error(f)}}),G(this,"onSessionProposeResponse",async(r,n,s)=>{const{id:i}=n;if(Bn(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const f=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:f});const l=await this.client.core.crypto.generateSharedKey(c,f);this.pendingSessions.set(i,{sessionTopic:l,pairingTopic:r,proposalId:i,publicKey:c});const h=await this.client.core.relayer.subscribe(l,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(rn(n)){await this.deleteProposal(i);const o=me("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),G(this,"onSessionSettleRequest",async(r,n)=>{const{id:s,params:i}=n;try{this.isValidSessionSettleRequest(i);const{relay:o,controller:a,expiry:c,namespaces:f,sessionProperties:l,scopedProperties:h,sessionConfig:u,proposalRequestsResponses:d}=n.params,g=[...this.pendingSessions.values()].find(U=>U.sessionTopic===r);if(!g)return this.client.logger.error(`Pending session not found for topic ${r}`);const b=this.client.proposal.get(g.proposalId),E=Ye(ge(ge(ge({topic:r,relay:o,expiry:c,namespaces:f,acknowledged:!0,pairingTopic:g.pairingTopic,requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces,controller:a.publicKey,self:{publicKey:g.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),u&&{sessionConfig:u}),{transportType:ve.relay,authentication:d?.authentication,walletPayResult:d?.walletPay});await this.client.session.set(E.topic,E),await this.setExpiry(E.topic,E.expiry),await this.client.core.pairing.updateMetadata({topic:g.pairingTopic,metadata:E.peer.metadata}),this.pendingSessions.delete(g.proposalId),this.deleteProposal(g.proposalId,!1),this.cleanupDuplicatePairings(E),await this.sendResult({id:n.id,topic:r,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:E}),this.events.emit(me("session_connect",g.proposalId),{session:E})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),G(this,"onSessionSettleResponse",async(r,n)=>{const{id:s}=n;Bn(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(me("session_approve",s),{})):rn(n)&&(await this.client.session.delete(r,Xe("USER_DISCONNECTED")),this.events.emit(me("session_approve",s),{error:n.error}))}),G(this,"onSessionUpdateRequest",async(r,n)=>{const{params:s,id:i}=n;try{const o=`${r}_session_update`,a=Da.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:r,error:Xe("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ge({topic:r},s));try{Da.set(o,i),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:i,topic:r,result:!0})}catch(c){throw Da.delete(o),c}this.client.events.emit("session_update",{id:i,topic:r,params:s})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),G(this,"isRequestOutOfSync",(r,n)=>n.toString().slice(0,-3)<r.toString().slice(0,-3)),G(this,"onSessionUpdateResponse",(r,n)=>{const{id:s}=n,i=me("session_update",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Bn(n)?this.events.emit(me("session_update",s),{}):rn(n)&&this.events.emit(me("session_update",s),{error:n.error})}),G(this,"onSessionExtendRequest",async(r,n)=>{const{id:s}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Pt(Po)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(i){await this.sendError({id:s,topic:r,error:i}),this.client.logger.error(i)}}),G(this,"onSessionExtendResponse",(r,n)=>{const{id:s}=n,i=me("session_extend",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Bn(n)?this.events.emit(me("session_extend",s),{}):rn(n)&&this.events.emit(me("session_extend",s),{error:n.error})}),G(this,"onSessionPingRequest",async(r,n)=>{const{id:s}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(i){await this.sendError({id:s,topic:r,error:i}),this.client.logger.error(i)}}),G(this,"onSessionPingResponse",(r,n)=>{const{id:s}=n,i=me("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);Bn(n)?this.events.emit(me("session_ping",s),{}):rn(n)&&this.events.emit(me("session_ping",s),{error:n.error})},500)}),G(this,"onSessionDeleteRequest",async(r,n)=>{const{id:s}=n;try{await this.isValidDisconnect({topic:r,reason:n.params}),this.cleanupPendingSentRequestsForTopic({topic:r,error:Xe("USER_DISCONNECTED")}),await this.deleteSession({topic:r,id:s})}catch(i){this.client.logger.error(i)}}),G(this,"onSessionRequest",async r=>{var n,s,i;const{topic:o,payload:a,attestation:c,encryptedId:f,transportType:l}=r,{id:h,params:u}=a;try{await this.isValidRequest(ge({topic:o},u));const d=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:$s(JSON.stringify(nn("wc_sessionRequest",u,h))),encryptedId:f,metadata:d.peer.metadata,transportType:l}),b={id:h,topic:o,params:u,verifyContext:g};await this.setPendingSessionRequest(b),l===ve.link_mode&&(n=d.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((s=d.peer.metadata.redirect)==null?void 0:s.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(b):(this.addSessionRequestToSessionRequestQueue(b),this.processSessionRequestQueue())}catch(d){await this.sendError({id:h,topic:o,error:d}),this.client.logger.error(d)}}),G(this,"onSessionRequestResponse",(r,n)=>{const{id:s}=n,i=me("session_request",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Bn(n)?this.events.emit(me("session_request",s),{result:n.result}):rn(n)&&this.events.emit(me("session_request",s),{error:n.error})}),G(this,"onSessionEventRequest",async(r,n)=>{const{id:s,params:i}=n;try{const o=`${r}_session_event_${i.event.name}`,a=Da.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ge({topic:r},i)),this.client.events.emit("session_event",{id:s,topic:r,params:i}),Da.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),G(this,"onSessionAuthenticateResponse",(r,n)=>{const{id:s}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),Bn(n)?this.events.emit(me("session_request",s),{result:n.result}):rn(n)&&this.events.emit(me("session_request",s),{error:n.error})}),G(this,"onSessionAuthenticateRequest",async r=>{var n;const{topic:s,payload:i,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:f,authPayload:l,expiryTimestamp:h}=i.params,u=await this.getVerifyContext({attestationId:o,hash:$s(JSON.stringify(i)),encryptedId:a,metadata:f.metadata,transportType:c}),d={requester:f,pairingTopic:s,id:i.id,authPayload:l,verifyContext:u,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:d,pairingTopic:s,transportType:c}),c===ve.link_mode&&(n=f.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(f.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:i.params,id:i.id,verifyContext:u})}catch(f){this.client.logger.error(f);const l=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),u=this.getAppLinkIfEnabled(i.params.requester.metadata,c),d={type:Ph,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:i.id,topic:s,error:f,encodeOpts:d,rpcOpts:Ze.wc_sessionAuthenticate.autoReject,appLink:u})}}),G(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),G(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Jr.idle,this.processSessionRequestQueue()},Z.toMiliseconds(this.requestQueueDelay))}),G(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:n})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(i=>i.topic===r&&i.request.method==="wc_sessionRequest").forEach(i=>{this.events.emit(me("session_request",i.request.id),{error:n})})}),G(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Jr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(n){this.client.logger.error(n)}}),G(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=Jr.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),G(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const n=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);n&&this.onSessionProposeRequest({topic:r.topic,payload:nn("wc_sessionPropose",Ye(ge({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),G(this,"isValidConnect",async r=>{if(!$r(r)){const{message:f}=ee("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(f)}const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=r;if(er(n)||await this.isValidPairingTopic(n),!DH(c)){const{message:f}=ee("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(f)}if(s&&!er(s)&&$c(s)!==0){const f="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(f):this.client.logger.warn(f),this.validateNamespaces(s,"requiredNamespaces")}if(i&&!er(i)&&$c(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),o&&!er(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!er(a)){this.validateSessionProps(a,"scopedProperties");const f=Object.keys(s||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(l=>f.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(f)}`)}}),G(this,"validateNamespaces",(r,n)=>{const s=kH(r,"connect()",n);if(s)throw new Error(s.message)}),G(this,"isValidApprove",async r=>{if(!$r(r))throw new Error(ee("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:s,relayProtocol:i,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),f=Rh(s,"approve()");if(f)throw new Error(f.message);const l=Nw(c.requiredNamespaces,s,"approve()");if(l)throw new Error(l.message);if(!De(i,!0)){const{message:h}=ee("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(o&&!er(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!er(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(u=>h.has(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),G(this,"isValidReject",async r=>{if(!$r(r)){const{message:i}=ee("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(i)}const{id:n,reason:s}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!qH(s)){const{message:i}=ee("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(i)}}),G(this,"isValidSessionSettleRequest",r=>{if(!$r(r)){const{message:f}=ee("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(f)}const{relay:n,controller:s,namespaces:i,expiry:o}=r;if(!S4(n)){const{message:f}=ee("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(f)}const a=PH(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Rh(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(_o(o)){const{message:f}=ee("EXPIRED","onSessionSettleRequest()");throw new Error(f)}}),G(this,"isValidUpdate",async r=>{if(!$r(r)){const{message:c}=ee("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:n,namespaces:s}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const i=this.client.session.get(n),o=Rh(s,"update()");if(o)throw new Error(o.message);const a=Nw(i.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),G(this,"isValidExtend",async r=>{if(!$r(r)){const{message:s}=ee("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),G(this,"isValidRequest",async r=>{if(!$r(r)){const{message:c}=ee("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:n,request:s,chainId:i,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!Lw(a,i)){const{message:c}=ee("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!zH(s)){const{message:c}=ee("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!VH(a,i,s.method)){const{message:c}=ee("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),G(this,"isValidRespond",async r=>{var n;if(!$r(r)){const{message:a}=ee("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:s,response:i}=r;try{await this.isValidSessionTopic(s)}catch(a){throw(n=r?.response)!=null&&n.id&&this.cleanupAfterResponse(r),a}if(!MH(i)){const{message:a}=ee("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(a)}const o=this.client.pendingRequest.get(i.id);if(o.topic!==s){const{message:a}=ee("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${i.id}, expected topic: ${o.topic}, received topic: ${s}`);throw new Error(a)}}),G(this,"isValidPing",async r=>{if(!$r(r)){const{message:s}=ee("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),G(this,"isValidEmit",async r=>{if(!$r(r)){const{message:a}=ee("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:n,event:s,chainId:i}=r;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!Lw(o,i)){const{message:a}=ee("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!HH(s)){const{message:a}=ee("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!KH(o,i,s.name)){const{message:a}=ee("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),G(this,"isValidDisconnect",async r=>{if(!$r(r)){const{message:s}=ee("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),G(this,"isValidAuthenticate",r=>{const{chains:n,uri:s,domain:i,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!De(s,!1))throw new Error("uri is required parameter");if(!De(i,!1))throw new Error("domain is required parameter");if(!De(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>Kf(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Kf(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),G(this,"getVerifyContext",async r=>{const{attestationId:n,hash:s,encryptedId:i,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||oc,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ve.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const f=await this.client.core.verify.resolve({attestationId:n,hash:s,encryptedId:i,verifyUrl:o.verifyUrl});f&&(c.verified.origin=f.origin,c.verified.isScam=f.isScam,c.verified.validation=f.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(f){this.client.logger.warn(f)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),G(this,"validateSessionProps",(r,n)=>{Object.values(r).forEach((s,i)=>{if(s==null){const{message:o}=ee("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[i]}`);throw new Error(o)}})}),G(this,"getPendingAuthRequest",r=>{const n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0}),G(this,"addToRecentlyDeleted",(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const i=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=i)break;this.recentlyDeletedMap.delete(o)}}}),G(this,"checkRecentlyDeleted",r=>{const n=this.recentlyDeletedMap.get(r);if(n){const{message:s}=ee("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(s)}}),G(this,"isLinkModeEnabled",(r,n)=>{var s,i,o,a,c,f,l,h,u;return!r||n!==ve.link_mode?!1:((i=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((f=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:f.universal)!==""&&((l=r?.redirect)==null?void 0:l.universal)!==void 0&&((h=r?.redirect)==null?void 0:h.universal)!==""&&((u=r?.redirect)==null?void 0:u.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),G(this,"getAppLinkIfEnabled",(r,n)=>{var s;return this.isLinkModeEnabled(r,n)?(s=r?.redirect)==null?void 0:s.universal:void 0}),G(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const n=nw(r,"topic")||"",s=decodeURIComponent(nw(r,"wc_ev")||""),i=this.client.session.keys.includes(n);i&&this.client.session.update(n,{transportType:ve.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:s,sessionExists:i})}),G(this,"registerLinkModeListeners",async()=>{var r;if(Tq()||F8()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await n.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),G(this,"getTVFApproveParams",r=>{try{const n=I4(r.namespaces),s=EH(r.namespaces),i=xH(r.namespaces),o=r.sessionProperties,a=r.scopedProperties;return{approvedChains:n,approvedMethods:s,approvedEvents:i,sessionProperties:o,scopedProperties:a}}catch(n){return this.client.logger.warn(n,"Error getting TVF approve params"),{}}}),G(this,"getTVFParams",(r,n,s)=>{var i,o,a;if(!((i=n.request)!=null&&i.method))return{};const c={correlationId:r,rpcMethods:[n.request.method],chainId:n.chainId};try{const f=this.extractTxHashesFromResult(n.request,s);c.txHashes=f,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(f){this.client.logger.warn(f,"Error getting TVF params")}return c}),G(this,"isValidContractData",r=>{var n;if(!r)return!1;try{const s=r?.data||((n=r?.[0])==null?void 0:n.data);if(!s.startsWith("0x"))return!1;const i=s.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),G(this,"extractTxHashesFromResult",(r,n)=>{var s;try{if(!n)return[];const i=r.method,o=cV[i];if(i==="sui_signTransaction")return[Cz(n.transactionBytes)];if(i==="near_signTransaction")return[lw(n)];if(i==="near_signTransactions")return n.map(c=>lw(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(s=n.tx_json)==null?void 0:s.hash];if(i==="polkadot_signTransaction")return[nV({transaction:r.params.transactionPayload,signature:n.signature})];if(i==="algo_signTxn")return da(n)?n.map(c=>uw(c)):[uw(n)];if(i==="cosmos_signDirect")return[Tz(n)];if(i==="wallet_sendCalls")return Lz(n);if(typeof n=="string")return[n];const a=n[o.key];if(da(a))return i==="solana_signAllTransactions"?a.map(c=>Pz(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn(i,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,s]of Object.entries(r))for(const i of s)try{await this.onProviderMessageEvent({topic:n,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${i}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(xe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:n,attestation:s,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Zf)?this.client.auth.authKeys.get(Zf):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,n,{receiverPublicKey:o,encoding:i===ve.link_mode?ka:Ri});Qp(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:i,encryptedId:$s(n)})):e0(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:i}),this.client.core.history.delete(r,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:i})),await this.client.core.relayer.messages.ack(r,n)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${n}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ar.expired,async e=>{const{topic:r,id:n}=Fq(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,ee("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,ee("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(ji.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(ji.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!De(e,!1)){const{message:r}=ee("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=ee("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(_o(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=ee("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!De(e,!1)){const{message:r}=ee("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=ee("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(_o(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=ee("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=ee("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(De(e,!1)){const{message:r}=ee("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=ee("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!jH(e)){const{message:r}=ee("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=ee("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(_o(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=ee("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}validateRequestExpiry(e){if(e&&!YH(e,Nh)){const{message:r}=ee("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${Nh.min} and ${Nh.max}`);throw new Error(r)}}}class xV extends bo{constructor(e,r){super(e,r,iV,wg),this.core=e,this.logger=r}}let $V=class extends bo{constructor(e,r){super(e,r,oV,wg),this.core=e,this.logger=r}};class IV extends bo{constructor(e,r){super(e,r,fV,wg,n=>n.id),this.core=e,this.logger=r}}class BV extends bo{constructor(e,r){super(e,r,dV,au,()=>Zf),this.core=e,this.logger=r}}class AV extends bo{constructor(e,r){super(e,r,pV,au),this.core=e,this.logger=r}}class SV extends bo{constructor(e,r){super(e,r,gV,au,n=>n.id),this.core=e,this.logger=r}}var OV=Object.defineProperty,_V=(t,e,r)=>e in t?OV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kh=(t,e,r)=>_V(t,typeof e!="symbol"?e+"":e,r);class FV{constructor(e,r){this.core=e,this.logger=r,kh(this,"authKeys"),kh(this,"pairingTopics"),kh(this,"requests"),this.authKeys=new BV(this.core,this.logger),this.pairingTopics=new AV(this.core,this.logger),this.requests=new SV(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var UV=Object.defineProperty,PV=(t,e,r)=>e in t?UV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fe=(t,e,r)=>PV(t,typeof e!="symbol"?e+"":e,r);let CV=class U4 extends bT{constructor(e){super(e),fe(this,"protocol",O4),fe(this,"version",_4),fe(this,"name",Lh.name),fe(this,"metadata"),fe(this,"core"),fe(this,"logger"),fe(this,"events",new wi.EventEmitter),fe(this,"engine"),fe(this,"session"),fe(this,"proposal"),fe(this,"pendingRequest"),fe(this,"auth"),fe(this,"signConfig"),fe(this,"on",(n,s)=>this.events.on(n,s)),fe(this,"once",(n,s)=>this.events.once(n,s)),fe(this,"off",(n,s)=>this.events.off(n,s)),fe(this,"removeListener",(n,s)=>this.events.removeListener(n,s)),fe(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),fe(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"update",async n=>{try{return await this.engine.update(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"request",async n=>{try{return await this.engine.request(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"find",n=>{try{return this.engine.find(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),fe(this,"authenticate",async(n,s)=>{try{return await this.engine.authenticate(n,s)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),fe(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),this.name=e?.name||Lh.name,this.metadata=Oq(e?.metadata),this.signConfig=e?.signConfig;const r=sV({logger:e?.logger||Lh.logger,name:this.name});this.logger=r,this.core=e?.core||new pT(e),this.session=new $V(this.core,this.logger),this.proposal=new xV(this.core,this.logger),this.pendingRequest=new IV(this.core,this.logger),this.engine=new EV(this),this.auth=new FV(this.core,this.logger)}static async init(e){const r=new U4(e);return await r.initialize(),r}get context(){return pq(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const RV=CV;function TV(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function P4(t,...e){if(!TV(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function zw(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function LV(t,e){P4(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Co=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Dh=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function NV(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function C4(t){return typeof t=="string"&&(t=NV(t)),P4(t),t}let kV=class{clone(){return this._cloneInto()}};function DV(t){const e=n=>t().update(C4(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function jV(t=32){if(Co&&typeof Co.getRandomValues=="function")return Co.getRandomValues(new Uint8Array(t));if(Co&&typeof Co.randomBytes=="function")return Co.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function qV(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}class zV extends kV{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Dh(this.buffer)}update(e){zw(this);const{view:r,buffer:n,blockLen:s}=this;e=C4(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=Dh(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){zw(this),LV(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;qV(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=Dh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%r&&e.buffer.set(n),e}}const Af=BigInt(2**32-1),Up=BigInt(32);function R4(t,e=!1){return e?{h:Number(t&Af),l:Number(t>>Up&Af)}:{h:Number(t>>Up&Af)|0,l:Number(t&Af)|0}}function MV(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:i,l:o}=R4(t[s],e);[r[s],n[s]]=[i,o]}return[r,n]}const HV=(t,e)=>BigInt(t>>>0)<<Up|BigInt(e>>>0),VV=(t,e,r)=>t>>>r,KV=(t,e,r)=>t<<32-r|e>>>r,GV=(t,e,r)=>t>>>r|e<<32-r,ZV=(t,e,r)=>t<<32-r|e>>>r,YV=(t,e,r)=>t<<64-r|e>>>r-32,WV=(t,e,r)=>t>>>r-32|e<<64-r,XV=(t,e)=>e,JV=(t,e)=>t,QV=(t,e,r)=>t<<r|e>>>32-r,eK=(t,e,r)=>e<<r|t>>>32-r,tK=(t,e,r)=>e<<r-32|t>>>64-r,rK=(t,e,r)=>t<<r-32|e>>>64-r;function nK(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const sK=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),iK=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,oK=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),aK=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,cK=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),fK=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,oe={fromBig:R4,split:MV,toBig:HV,shrSH:VV,shrSL:KV,rotrSH:GV,rotrSL:ZV,rotrBH:YV,rotrBL:WV,rotr32H:XV,rotr32L:JV,rotlSH:QV,rotlSL:eK,rotlBH:tK,rotlBL:rK,add:nK,add3L:sK,add3H:iK,add4L:oK,add4H:aK,add5H:fK,add5L:cK},[lK,uK]=oe.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Is=new Uint32Array(80),Bs=new Uint32Array(80);let hK=class extends zV{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:f,El:l,Fh:h,Fl:u,Gh:d,Gl:g,Hh:b,Hl:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=l|0,this.Fh=h|0,this.Fl=u|0,this.Gh=d|0,this.Gl=g|0,this.Hh=b|0,this.Hl=E|0}process(e,r){for(let $=0;$<16;$++,r+=4)Is[$]=e.getUint32(r),Bs[$]=e.getUint32(r+=4);for(let $=16;$<80;$++){const F=Is[$-15]|0,P=Bs[$-15]|0,C=oe.rotrSH(F,P,1)^oe.rotrSH(F,P,8)^oe.shrSH(F,P,7),T=oe.rotrSL(F,P,1)^oe.rotrSL(F,P,8)^oe.shrSL(F,P,7),R=Is[$-2]|0,A=Bs[$-2]|0,j=oe.rotrSH(R,A,19)^oe.rotrBH(R,A,61)^oe.shrSH(R,A,6),q=oe.rotrSL(R,A,19)^oe.rotrBL(R,A,61)^oe.shrSL(R,A,6),S=oe.add4L(T,q,Bs[$-7],Bs[$-16]),m=oe.add4H(S,C,j,Is[$-7],Is[$-16]);Is[$]=m|0,Bs[$]=S|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:f,Dl:l,Eh:h,El:u,Fh:d,Fl:g,Gh:b,Gl:E,Hh:U,Hl:L}=this;for(let $=0;$<80;$++){const F=oe.rotrSH(h,u,14)^oe.rotrSH(h,u,18)^oe.rotrBH(h,u,41),P=oe.rotrSL(h,u,14)^oe.rotrSL(h,u,18)^oe.rotrBL(h,u,41),C=h&d^~h&b,T=u&g^~u&E,R=oe.add5L(L,P,T,uK[$],Bs[$]),A=oe.add5H(R,U,F,C,lK[$],Is[$]),j=R|0,q=oe.rotrSH(n,s,28)^oe.rotrBH(n,s,34)^oe.rotrBH(n,s,39),S=oe.rotrSL(n,s,28)^oe.rotrBL(n,s,34)^oe.rotrBL(n,s,39),m=n&i^n&a^i&a,x=s&o^s&c^o&c;U=b|0,L=E|0,b=d|0,E=g|0,d=h|0,g=u|0,{h,l:u}=oe.add(f|0,l|0,A|0,j|0),f=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const y=oe.add3L(j,S,x);n=oe.add3H(y,A,q,m),s=y|0}({h:n,l:s}=oe.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=oe.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=oe.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l}=oe.add(this.Dh|0,this.Dl|0,f|0,l|0),{h,l:u}=oe.add(this.Eh|0,this.El|0,h|0,u|0),{h:d,l:g}=oe.add(this.Fh|0,this.Fl|0,d|0,g|0),{h:b,l:E}=oe.add(this.Gh|0,this.Gl|0,b|0,E|0),{h:U,l:L}=oe.add(this.Hh|0,this.Hl|0,U|0,L|0),this.set(n,s,i,o,a,c,f,l,h,u,d,g,b,E,U,L)}roundClean(){Is.fill(0),Bs.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const dK=DV(()=>new hK);const mg=BigInt(0),T4=BigInt(1),pK=BigInt(2);function vg(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Eg(t){if(!vg(t))throw new Error("Uint8Array expected")}function jh(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const gK=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function xg(t){Eg(t);let e="";for(let r=0;r<t.length;r++)e+=gK[t[r]];return e}function L4(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?mg:BigInt("0x"+t)}const xn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Mw(t){if(t>=xn._0&&t<=xn._9)return t-xn._0;if(t>=xn.A&&t<=xn.F)return t-(xn.A-10);if(t>=xn.a&&t<=xn.f)return t-(xn.a-10)}function N4(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=Mw(t.charCodeAt(i)),a=Mw(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function yK(t){return L4(xg(t))}function Yf(t){return Eg(t),L4(xg(Uint8Array.from(t).reverse()))}function k4(t,e){return N4(t.toString(16).padStart(e*2,"0"))}function Pp(t,e){return k4(t,e).reverse()}function $n(t,e,r){let n;if(typeof e=="string")try{n=N4(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(vg(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}function Hw(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];Eg(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}const qh=t=>typeof t=="bigint"&&mg<=t;function bK(t,e,r){return qh(t)&&qh(e)&&qh(r)&&e<=t&&t<r}function ja(t,e,r,n){if(!bK(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function wK(t){let e;for(e=0;t>mg;t>>=T4,e+=1);return e}const mK=t=>(pK<<BigInt(t-1))-T4,vK={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||vg(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function $g(t,e,r={}){const n=(s,i,o)=>{const a=vK[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(r))n(s,i,!0);return t}function Vw(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const Me=BigInt(0),Ae=BigInt(1),zi=BigInt(2),EK=BigInt(3),Cp=BigInt(4),Kw=BigInt(5),Gw=BigInt(8);function Te(t,e){const r=t%e;return r>=Me?r:e+r}function xK(t,e,r){if(e<Me)throw new Error("invalid exponent, negatives unsupported");if(r<=Me)throw new Error("invalid modulus");if(r===Ae)return Me;let n=Ae;for(;e>Me;)e&Ae&&(n=n*t%r),t=t*t%r,e>>=Ae;return n}function Qr(t,e,r){let n=t;for(;e-- >Me;)n*=n,n%=r;return n}function Zw(t,e){if(t===Me)throw new Error("invert: expected non-zero number");if(e<=Me)throw new Error("invert: expected positive modulus, got "+e);let r=Te(t,e),n=e,s=Me,i=Ae;for(;r!==Me;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==Ae)throw new Error("invert: does not exist");return Te(s,e)}function $K(t){const e=(t-Ae)/zi;let r,n,s;for(r=t-Ae,n=0;r%zi===Me;r/=zi,n++);for(s=zi;s<t&&xK(s,e,t)!==t-Ae;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+Ae)/Cp;return function(a,c){const f=a.pow(c,o);if(!a.eql(a.sqr(f),c))throw new Error("Cannot find square root");return f}}const i=(r+Ae)/zi;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,f=o.pow(o.mul(o.ONE,s),r),l=o.pow(a,i),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let u=1;for(let g=o.sqr(h);u<c&&!o.eql(g,o.ONE);u++)g=o.sqr(g);const d=o.pow(f,Ae<<BigInt(c-u-1));f=o.sqr(d),l=o.mul(l,d),h=o.mul(h,f),c=u}return l}}function IK(t){if(t%Cp===EK){const e=(t+Ae)/Cp;return function(r,n){const s=r.pow(n,e);if(!r.eql(r.sqr(s),n))throw new Error("Cannot find square root");return s}}if(t%Gw===Kw){const e=(t-Kw)/Gw;return function(r,n){const s=r.mul(n,zi),i=r.pow(s,e),o=r.mul(n,i),a=r.mul(r.mul(o,zi),i),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return $K(t)}const BK=(t,e)=>(Te(t,e)&Ae)===Ae,AK=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function SK(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=AK.reduce((n,s)=>(n[s]="function",n),e);return $g(t,r)}function OK(t,e,r){if(r<Me)throw new Error("invalid exponent, negatives unsupported");if(r===Me)return t.ONE;if(r===Ae)return e;let n=t.ONE,s=e;for(;r>Me;)r&Ae&&(n=t.mul(n,s)),s=t.sqr(s),r>>=Ae;return n}function _K(t,e){const r=new Array(e.length),n=e.reduce((i,o,a)=>t.is0(o)?i:(r[a]=i,t.mul(i,o)),t.ONE),s=t.inv(n);return e.reduceRight((i,o,a)=>t.is0(o)?i:(r[a]=t.mul(i,r[a]),t.mul(i,o)),s),r}function D4(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function j4(t,e,r=!1,n={}){if(t<=Me)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:i}=D4(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:i,MASK:mK(s),ZERO:Me,ONE:Ae,create:c=>Te(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Me<=c&&c<t},is0:c=>c===Me,isOdd:c=>(c&Ae)===Ae,neg:c=>Te(-c,t),eql:(c,f)=>c===f,sqr:c=>Te(c*c,t),add:(c,f)=>Te(c+f,t),sub:(c,f)=>Te(c-f,t),mul:(c,f)=>Te(c*f,t),pow:(c,f)=>OK(a,c,f),div:(c,f)=>Te(c*Zw(f,t),t),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>Zw(c,t),sqrt:n.sqrt||(c=>(o||(o=IK(t)),o(a,c))),invertBatch:c=>_K(a,c),cmov:(c,f,l)=>l?f:c,toBytes:c=>r?Pp(c,i):k4(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?Yf(c):yK(c)}});return Object.freeze(a)}const Yw=BigInt(0),Sf=BigInt(1);function zh(t,e){const r=e.negate();return t?r:e}function q4(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Mh(t,e){q4(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function FK(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function UK(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Hh=new WeakMap,z4=new WeakMap;function Vh(t){return z4.get(t)||1}function PK(t,e){return{constTimeNegate:zh,hasPrecomputes(r){return Vh(r)!==1},unsafeLadder(r,n,s=t.ZERO){let i=r;for(;n>Yw;)n&Sf&&(s=s.add(i)),i=i.double(),n>>=Sf;return s},precomputeWindow(r,n){const{windows:s,windowSize:i}=Mh(n,e),o=[];let a=r,c=a;for(let f=0;f<s;f++){c=a,o.push(c);for(let l=1;l<i;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,s){const{windows:i,windowSize:o}=Mh(r,e);let a=t.ZERO,c=t.BASE;const f=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let u=0;u<i;u++){const d=u*o;let g=Number(s&f);s>>=h,g>o&&(g-=l,s+=Sf);const b=d,E=d+Math.abs(g)-1,U=u%2!==0,L=g<0;g===0?c=c.add(zh(U,n[b])):a=a.add(zh(L,n[E]))}return{p:a,f:c}},wNAFUnsafe(r,n,s,i=t.ZERO){const{windows:o,windowSize:a}=Mh(r,e),c=BigInt(2**r-1),f=2**r,l=BigInt(r);for(let h=0;h<o;h++){const u=h*a;if(s===Yw)break;let d=Number(s&c);if(s>>=l,d>a&&(d-=f,s+=Sf),d===0)continue;let g=n[u+Math.abs(d)-1];d<0&&(g=g.negate()),i=i.add(g)}return i},getPrecomputes(r,n,s){let i=Hh.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&Hh.set(n,s(i))),i},wNAFCached(r,n,s){const i=Vh(r);return this.wNAF(i,this.getPrecomputes(i,r,s),n)},wNAFCachedUnsafe(r,n,s,i){const o=Vh(r);return o===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),n,i)},setWindowSize(r,n){q4(n,e),z4.set(r,n),Hh.delete(r)}}}function CK(t,e,r,n){if(FK(r,t),UK(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,i=wK(BigInt(r.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),f=Math.floor((e.BITS-1)/o)*o;let l=s;for(let h=f;h>=0;h-=o){c.fill(s);for(let d=0;d<n.length;d++){const g=n[d],b=Number(g>>BigInt(h)&BigInt(a));c[b]=c[b].add(r[d])}let u=s;for(let d=c.length-1,g=s;d>0;d--)g=g.add(c[d]),u=u.add(g);if(l=l.add(u),h!==0)for(let d=0;d<o;d++)l=l.double()}return l}function RK(t){return SK(t.Fp),$g(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...D4(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Ir=BigInt(0),Ct=BigInt(1),Of=BigInt(2),TK=BigInt(8),LK={zip215:!0};function NK(t){const e=RK(t);return $g(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function kK(t){const e=NK(t),{Fp:r,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,f=Of<<BigInt(a*8)-Ct,l=r.create,h=j4(e.n,e.nBitLength),u=e.uvRatio||((y,p)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(p))}}catch{return{isValid:!1,value:Ir}}}),d=e.adjustScalarBytes||(y=>y),g=e.domain||((y,p,v)=>{if(jh("phflag",v),p.length||v)throw new Error("Contexts/pre-hash are not supported");return y});function b(y,p){ja("coordinate "+y,p,Ir,f)}function E(y){if(!(y instanceof $))throw new Error("ExtendedPoint expected")}const U=Vw((y,p)=>{const{ex:v,ey:I,ez:w}=y,B=y.is0();p==null&&(p=B?TK:r.inv(w));const O=l(v*p),_=l(I*p),k=l(w*p);if(B)return{x:Ir,y:Ct};if(k!==Ct)throw new Error("invZ was invalid");return{x:O,y:_}}),L=Vw(y=>{const{a:p,d:v}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:I,ey:w,ez:B,et:O}=y,_=l(I*I),k=l(w*w),D=l(B*B),N=l(D*D),z=l(_*p),H=l(D*l(z+k)),V=l(N+l(v*l(_*k)));if(H!==V)throw new Error("bad point: equation left != right (1)");const M=l(I*w),K=l(B*O);if(M!==K)throw new Error("bad point: equation left != right (2)");return!0});class ${constructor(p,v,I,w){this.ex=p,this.ey=v,this.ez=I,this.et=w,b("x",p),b("y",v),b("z",I),b("t",w),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(p){if(p instanceof $)throw new Error("extended point not allowed");const{x:v,y:I}=p||{};return b("x",v),b("y",I),new $(v,I,Ct,l(v*I))}static normalizeZ(p){const v=r.invertBatch(p.map(I=>I.ez));return p.map((I,w)=>I.toAffine(v[w])).map($.fromAffine)}static msm(p,v){return CK($,h,p,v)}_setWindowSize(p){C.setWindowSize(this,p)}assertValidity(){L(this)}equals(p){E(p);const{ex:v,ey:I,ez:w}=this,{ex:B,ey:O,ez:_}=p,k=l(v*_),D=l(B*w),N=l(I*_),z=l(O*w);return k===D&&N===z}is0(){return this.equals($.ZERO)}negate(){return new $(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:p}=e,{ex:v,ey:I,ez:w}=this,B=l(v*v),O=l(I*I),_=l(Of*l(w*w)),k=l(p*B),D=v+I,N=l(l(D*D)-B-O),z=k+O,H=z-_,V=k-O,M=l(N*H),K=l(z*V),Q=l(N*V),te=l(H*z);return new $(M,K,te,Q)}add(p){E(p);const{a:v,d:I}=e,{ex:w,ey:B,ez:O,et:_}=this,{ex:k,ey:D,ez:N,et:z}=p;if(v===BigInt(-1)){const ur=l((B-w)*(D+k)),hr=l((B+w)*(D-k)),Et=l(hr-ur);if(Et===Ir)return this.double();const dr=l(O*Of*z),pr=l(_*Of*N),gr=pr+dr,yr=hr+ur,br=pr-dr,Bi=l(gr*Et),Ai=l(yr*br),Si=l(gr*br),Oi=l(Et*yr);return new $(Bi,Ai,Oi,Si)}const H=l(w*k),V=l(B*D),M=l(_*I*z),K=l(O*N),Q=l((w+B)*(k+D)-H-V),te=K-M,re=K+M,le=l(V-v*H),nt=l(Q*te),Mr=l(re*le),$i=l(Q*le),Ii=l(te*re);return new $(nt,Mr,Ii,$i)}subtract(p){return this.add(p.negate())}wNAF(p){return C.wNAFCached(this,p,$.normalizeZ)}multiply(p){const v=p;ja("scalar",v,Ct,n);const{p:I,f:w}=this.wNAF(v);return $.normalizeZ([I,w])[0]}multiplyUnsafe(p,v=$.ZERO){const I=p;return ja("scalar",I,Ir,n),I===Ir?P:this.is0()||I===Ct?this:C.wNAFCachedUnsafe(this,I,$.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return C.unsafeLadder(this,n).is0()}toAffine(p){return U(this,p)}clearCofactor(){const{h:p}=e;return p===Ct?this:this.multiplyUnsafe(p)}static fromHex(p,v=!1){const{d:I,a:w}=e,B=r.BYTES;p=$n("pointHex",p,B),jh("zip215",v);const O=p.slice(),_=p[B-1];O[B-1]=_&-129;const k=Yf(O),D=v?f:r.ORDER;ja("pointHex.y",k,Ir,D);const N=l(k*k),z=l(N-Ct),H=l(I*N-w);let{isValid:V,value:M}=u(z,H);if(!V)throw new Error("Point.fromHex: invalid y coordinate");const K=(M&Ct)===Ct,Q=(_&128)!==0;if(!v&&M===Ir&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==K&&(M=l(-M)),$.fromAffine({x:M,y:k})}static fromPrivateKey(p){return A(p).point}toRawBytes(){const{x:p,y:v}=this.toAffine(),I=Pp(v,r.BYTES);return I[I.length-1]|=p&Ct?128:0,I}toHex(){return xg(this.toRawBytes())}}$.BASE=new $(e.Gx,e.Gy,Ct,l(e.Gx*e.Gy)),$.ZERO=new $(Ir,Ct,Ct,Ir);const{BASE:F,ZERO:P}=$,C=PK($,a*8);function T(y){return Te(y,n)}function R(y){return T(Yf(y))}function A(y){const p=r.BYTES;y=$n("private key",y,p);const v=$n("hashed private key",i(y),2*p),I=d(v.slice(0,p)),w=v.slice(p,2*p),B=R(I),O=F.multiply(B),_=O.toRawBytes();return{head:I,prefix:w,scalar:B,point:O,pointBytes:_}}function j(y){return A(y).pointBytes}function q(y=new Uint8Array,...p){const v=Hw(...p);return R(i(g(v,$n("context",y),!!s)))}function S(y,p,v={}){y=$n("message",y),s&&(y=s(y));const{prefix:I,scalar:w,pointBytes:B}=A(p),O=q(v.context,I,y),_=F.multiply(O).toRawBytes(),k=q(v.context,_,B,y),D=T(O+k*w);ja("signature.s",D,Ir,n);const N=Hw(_,Pp(D,r.BYTES));return $n("result",N,r.BYTES*2)}const m=LK;function x(y,p,v,I=m){const{context:w,zip215:B}=I,O=r.BYTES;y=$n("signature",y,2*O),p=$n("message",p),v=$n("publicKey",v,O),B!==void 0&&jh("zip215",B),s&&(p=s(p));const _=Yf(y.slice(O,2*O));let k,D,N;try{k=$.fromHex(v,B),D=$.fromHex(y.slice(0,O),B),N=F.multiplyUnsafe(_)}catch{return!1}if(!B&&k.isSmallOrder())return!1;const z=q(w,D.toRawBytes(),k.toRawBytes(),p);return D.add(k.multiplyUnsafe(z)).subtract(N).clearCofactor().equals($.ZERO)}return F._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:S,verify:x,ExtendedPoint:$,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,p=$.BASE){return p._setWindowSize(y),p.multiply(BigInt(3)),p}}}}BigInt(0),BigInt(1);const Ig=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ww=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const DK=BigInt(1),Xw=BigInt(2);BigInt(3);const jK=BigInt(5),qK=BigInt(8);function zK(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=Ig,o=t*t%i*t%i,a=Qr(o,Xw,i)*o%i,c=Qr(a,DK,i)*t%i,f=Qr(c,jK,i)*c%i,l=Qr(f,e,i)*f%i,h=Qr(l,r,i)*l%i,u=Qr(h,n,i)*h%i,d=Qr(u,s,i)*u%i,g=Qr(d,s,i)*u%i,b=Qr(g,e,i)*f%i;return{pow_p_5_8:Qr(b,Xw,i)*t%i,b2:o}}function MK(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function HK(t,e){const r=Ig,n=Te(e*e*e,r),s=Te(n*n*e,r),i=zK(t*s).pow_p_5_8;let o=Te(t*n*i,r);const a=Te(e*o*o,r),c=o,f=Te(o*Ww,r),l=a===t,h=a===Te(-t,r),u=a===Te(-t*Ww,r);return l&&(o=c),(h||u)&&(o=f),BK(o,r)&&(o=Te(-o,r)),{isValid:l||h,value:o}}const VK=j4(Ig,void 0,!0),KK={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:VK,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:qK,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:dK,randomBytes:jV,adjustScalarBytes:MK,uvRatio:HK};kK(KK);function GK(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),f=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var b=0,E=0,U=0,L=g.length;U!==L&&g[U]===0;)U++,b++;for(var $=(L-U)*l+1>>>0,F=new Uint8Array($);U!==L;){for(var P=g[U],C=0,T=$-1;(P!==0||C<E)&&T!==-1;T--,C++)P+=256*F[T]>>>0,F[T]=P%a>>>0,P=P/a>>>0;if(P!==0)throw new Error("Non-zero carry");E=C,U++}for(var R=$-E;R!==$&&F[R]===0;)R++;for(var A=c.repeat(b);R<$;++R)A+=t.charAt(F[R]);return A}function u(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var b=0;if(g[b]!==" "){for(var E=0,U=0;g[b]===c;)E++,b++;for(var L=(g.length-b)*f+1>>>0,$=new Uint8Array(L);g[b];){var F=r[g.charCodeAt(b)];if(F===255)return;for(var P=0,C=L-1;(F!==0||P<U)&&C!==-1;C--,P++)F+=a*$[C]>>>0,$[C]=F%256>>>0,F=F/256>>>0;if(F!==0)throw new Error("Non-zero carry");U=P,b++}if(g[b]!==" "){for(var T=L-U;T!==L&&$[T]===0;)T++;for(var R=new Uint8Array(E+(L-T)),A=E;T!==L;)R[A++]=$[T++];return R}}}function d(g){var b=u(g);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:u,decode:d}}var ZK=GK,YK=ZK;const M4=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},WK=t=>new TextEncoder().encode(t),XK=t=>new TextDecoder().decode(t);let JK=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}};class QK{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return H4(this,e)}}let eG=class{constructor(e){this.decoders=e}or(e){return H4(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const H4=(t,e)=>new eG({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class tG{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new JK(e,r,n),this.decoder=new QK(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const cu=({name:t,prefix:e,encode:r,decode:n})=>new tG(t,e,r,n),qc=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:s}=YK(r,e);return cu({prefix:t,name:e,encode:n,decode:i=>M4(s(i))})},rG=(t,e,r,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,f=0;for(let l=0;l<i;++l){const h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},nG=(t,e,r)=>{const n=e[e.length-1]==="=",s=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},rt=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>cu({prefix:e,name:t,encode(s){return nG(s,n,r)},decode(s){return rG(s,n,r,t)}}),sG=cu({prefix:"\0",name:"identity",encode:t=>XK(t),decode:t=>WK(t)});var iG=Object.freeze({__proto__:null,identity:sG});const oG=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var aG=Object.freeze({__proto__:null,base2:oG});const cG=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var fG=Object.freeze({__proto__:null,base8:cG});const lG=qc({prefix:"9",name:"base10",alphabet:"0123456789"});var uG=Object.freeze({__proto__:null,base10:lG});const hG=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),dG=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var pG=Object.freeze({__proto__:null,base16:hG,base16upper:dG});const gG=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),yG=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),bG=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),wG=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),mG=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vG=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),EG=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),xG=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),$G=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var IG=Object.freeze({__proto__:null,base32:gG,base32upper:yG,base32pad:bG,base32padupper:wG,base32hex:mG,base32hexupper:vG,base32hexpad:EG,base32hexpadupper:xG,base32z:$G});const BG=qc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),AG=qc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var SG=Object.freeze({__proto__:null,base36:BG,base36upper:AG});const OG=qc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_G=qc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var FG=Object.freeze({__proto__:null,base58btc:OG,base58flickr:_G});const UG=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),PG=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),CG=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),RG=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var TG=Object.freeze({__proto__:null,base64:UG,base64pad:PG,base64url:CG,base64urlpad:RG});const V4=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),LG=V4.reduce((t,e,r)=>(t[r]=e,t),[]),NG=V4.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function kG(t){return t.reduce((e,r)=>(e+=LG[r],e),"")}function DG(t){const e=[];for(const r of t){const n=NG[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const jG=cu({prefix:"ðŸš€",name:"base256emoji",encode:kG,decode:DG});var qG=Object.freeze({__proto__:null,base256emoji:jG}),zG=K4,Jw=128,MG=-128,HG=Math.pow(2,31);function K4(t,e,r){e=e||[],r=r||0;for(var n=r;t>=HG;)e[r++]=t&255|Jw,t/=128;for(;t&MG;)e[r++]=t&255|Jw,t>>>=7;return e[r]=t|0,K4.bytes=r-n+1,e}var VG=Rp,KG=128,Qw=127;function Rp(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw Rp.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&Qw)<<s:(o&Qw)*Math.pow(2,s),s+=7}while(o>=KG);return Rp.bytes=i-n,r}var GG=Math.pow(2,7),ZG=Math.pow(2,14),YG=Math.pow(2,21),WG=Math.pow(2,28),XG=Math.pow(2,35),JG=Math.pow(2,42),QG=Math.pow(2,49),eZ=Math.pow(2,56),tZ=Math.pow(2,63),rZ=function(t){return t<GG?1:t<ZG?2:t<YG?3:t<WG?4:t<XG?5:t<JG?6:t<QG?7:t<eZ?8:t<tZ?9:10},nZ={encode:zG,decode:VG,encodingLength:rZ},G4=nZ;const e2=(t,e,r=0)=>(G4.encode(t,e,r),e),t2=t=>G4.encodingLength(t),Tp=(t,e)=>{const r=e.byteLength,n=t2(t),s=n+t2(r),i=new Uint8Array(s+r);return e2(t,i,0),e2(r,i,n),i.set(e,s),new sZ(t,r,e,i)};let sZ=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};const Z4=({name:t,code:e,encode:r})=>new iZ(t,e,r);let iZ=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Tp(this.code,r):r.then(n=>Tp(this.code,n))}else throw Error("Unknown type, must be binary type")}};const Y4=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),oZ=Z4({name:"sha2-256",code:18,encode:Y4("SHA-256")}),aZ=Z4({name:"sha2-512",code:19,encode:Y4("SHA-512")});var cZ=Object.freeze({__proto__:null,sha256:oZ,sha512:aZ});const W4=0,fZ="identity",X4=M4,lZ=t=>Tp(W4,X4(t)),uZ={code:W4,name:fZ,encode:X4,digest:lZ};var hZ=Object.freeze({__proto__:null,identity:uZ});new TextEncoder,new TextDecoder;({...iG,...aG,...fG,...uG,...pG,...IG,...SG,...FG,...TG,...qG});({...cZ,...hZ});var cn={exports:{}};function dZ(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var pZ=gZ;function gZ(t,e,r){var n=r&&r.stringify||dZ,s=1;if(typeof t=="object"&&t!==null){var i=e.length+s;if(i===1)return t;var o=new Array(i);o[0]=n(t);for(var a=1;a<i;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var f="",l=1-s,h=-1,u=t&&t.length||0,d=0;d<u;){if(t.charCodeAt(d)===37&&d+1<u){switch(h=h>-1?h:0,t.charCodeAt(d+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<d&&(f+=t.slice(h,d)),f+=Number(e[l]),h=d+2,d++;break;case 105:if(l>=c||e[l]==null)break;h<d&&(f+=t.slice(h,d)),f+=Math.floor(Number(e[l])),h=d+2,d++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<d&&(f+=t.slice(h,d));var g=typeof e[l];if(g==="string"){f+="'"+e[l]+"'",h=d+2,d++;break}if(g==="function"){f+=e[l].name||"<anonymous>",h=d+2,d++;break}f+=n(e[l]),h=d+2,d++;break;case 115:if(l>=c)break;h<d&&(f+=t.slice(h,d)),f+=String(e[l]),h=d+2,d++;break;case 37:h<d&&(f+=t.slice(h,d)),f+="%",h=d+2,d++,l--;break}++l}++d}return h===-1?t:(h<u&&(f+=t.slice(h)),f)}const r2=pZ;cn.exports=Gn;const Ic=FZ().console||{},yZ={mapHttpRequest:_f,mapHttpResponse:_f,wrapRequestSerializer:Kh,wrapResponseSerializer:Kh,wrapErrorSerializer:Kh,req:_f,res:_f,err:s2,errWithCause:s2};function ti(t,e){return t==="silent"?1/0:e.levels.values[t]}const Bg=Symbol("pino.logFuncs"),Lp=Symbol("pino.hierarchy"),bZ={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function n2(t,e){const r={logger:e,parent:t[Lp]};e[Lp]=r}function wZ(t,e,r){const n={};e.forEach(s=>{n[s]=r[s]?r[s]:Ic[s]||Ic[bZ[s]||"log"]||ea}),t[Bg]=n}function mZ(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Gn(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Ic;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},s=mZ(t.browser.serialize,n);let i=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(i=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(b){r[b]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",f=Object.create(r);f.log||(f.log=ea),wZ(f,a,r),n2({},f),Object.defineProperty(f,"levelVal",{get:h}),Object.defineProperty(f,"level",{get:u,set:d});const l={transmit:e,serialize:s,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:SZ(t),messageKey:t.messageKey||"msg",onChild:t.onChild||ea};f.levels=vZ(t),f.level=c,f.isLevelEnabled=function(b){return this.levels.values[b]?this.levels.values[b]>=this.levels.values[this.level]:!1},f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=ea,f.serializers=n,f._serialize=s,f._stdErrSerialize=i,f.child=function(...b){return g.call(this,l,...b)},e&&(f._logEvent=Np());function h(){return ti(this.level,this)}function u(){return this._level}function d(b){if(b!=="silent"&&!this.levels.values[b])throw Error("unknown level "+b);this._level=b,Ti(this,l,f,"error"),Ti(this,l,f,"fatal"),Ti(this,l,f,"warn"),Ti(this,l,f,"info"),Ti(this,l,f,"debug"),Ti(this,l,f,"trace"),o.forEach(E=>{Ti(this,l,f,E)})}function g(b,E,U){if(!E)throw new Error("missing bindings for child Pino");U=U||{},s&&E.serializers&&(U.serializers=E.serializers);const L=U.serializers;if(s&&L){var $=Object.assign({},n,L),F=t.browser.serialize===!0?Object.keys($):s;delete E.serializers,Ag([E],F,$,this._stdErrSerialize)}function P(T){this._childLevel=(T._childLevel|0)+1,this.bindings=E,$&&(this.serializers=$,this._serialize=F),e&&(this._logEvent=Np([].concat(T._logEvent.bindings,E)))}P.prototype=this;const C=new P(this);return n2(this,C),C.child=function(...T){return g.call(this,b,...T)},C.level=U.level||this.level,b.onChild(C),C}return f}function vZ(t){const e=t.customLevels||{},r=Object.assign({},Gn.levels.values,e),n=Object.assign({},Gn.levels.labels,EZ(e));return{values:r,labels:n}}function EZ(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}Gn.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},Gn.stdSerializers=yZ,Gn.stdTimeFunctions=Object.assign({},{nullTime:J4,epochTime:Q4,unixTime:OZ,isoTime:_Z});function xZ(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[Lp];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function Ti(t,e,r,n){if(Object.defineProperty(t,n,{value:ti(t.level,r)>ti(n,r)?ea:r[Bg][n],writable:!0,enumerable:!0,configurable:!0}),t[n]===ea){if(!e.transmit)return;const i=e.transmit.level||t.level,o=ti(i,r);if(ti(n,r)<o)return}t[n]=IZ(t,e,r,n);const s=xZ(t);s.length!==0&&(t[n]=$Z(s,t[n]))}function $Z(t,e){return function(){return e.apply(this,[...t,...arguments])}}function IZ(t,e,r,n){return(function(s){return function(){const i=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Ic?Ic:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var f=!1;if(e.serialize&&(Ag(o,this._serialize,this.serializers,this._stdErrSerialize),f=!0),e.asObject||e.formatters?s.call(a,...BZ(this,n,o,i,e)):s.apply(a,o),e.transmit){const l=e.transmit.level||t._level,h=ti(l,r),u=ti(n,r);if(u<h)return;AZ(this,{ts:i,methodLevel:n,methodValue:u,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:ti(t._level,r)},o,f)}}})(t[Bg][n])}function BZ(t,e,r,n,s){const{level:i,log:o=h=>h}=s.formatters||{},a=r.slice();let c=a[0];const f={};let l=(t._childLevel|0)+1;if(l<1&&(l=1),n&&(f.time=n),i){const h=i(e,t.levels.values[e]);Object.assign(f,h)}else f.level=t.levels.values[e];if(s.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;l--&&typeof a[0]=="object";)Object.assign(f,a.shift());return[o(f),...a]}else{if(c!==null&&typeof c=="object"){for(;l--&&typeof a[0]=="object";)Object.assign(f,a.shift());c=a.length?r2(a.shift(),a):void 0}else typeof c=="string"&&(c=r2(a.shift(),a));return c!==void 0&&(f[s.messageKey]=c),[o(f)]}}function Ag(t,e,r,n){for(const s in t)if(n&&t[s]instanceof Error)t[s]=Gn.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s])&&e)for(const i in t[s])e.indexOf(i)>-1&&i in r&&(t[s][i]=r[i](t[s][i]))}function AZ(t,e,r,n=!1){const s=e.send,i=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,f=t._logEvent.bindings;n||Ag(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=i,t._logEvent.messages=r.filter(function(l){return f.indexOf(l)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,s(o,t._logEvent,c),t._logEvent=Np(f)}function Np(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function s2(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function SZ(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?J4:Q4}function _f(){return{}}function Kh(t){return t}function ea(){}function J4(){return!1}function Q4(){return Date.now()}function OZ(){return Math.round(Date.now()/1e3)}function _Z(){return new Date(Date.now()).toISOString()}function FZ(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}cn.exports.default=Gn;cn.exports.pino=Gn;const Sg=1e3*1024;var UZ=Object.defineProperty,PZ=(t,e,r)=>e in t?UZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ws=(t,e,r)=>PZ(t,typeof e!="symbol"?e+"":e,r);let CZ=class{constructor(e){Ws(this,"nodeValue"),Ws(this,"sizeInBytes"),Ws(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},i2=class{constructor(e){Ws(this,"lengthInNodes"),Ws(this,"sizeInBytes"),Ws(this,"head"),Ws(this,"tail"),Ws(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new CZ(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const RZ=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function o2(t){return typeof t=="string"?t:RZ(t)||""}var TZ=Object.defineProperty,LZ=(t,e,r)=>e in t?TZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ff=(t,e,r)=>LZ(t,typeof e!="symbol"?e+"":e,r);let e6=class{constructor(e,r=Sg){Ff(this,"logs"),Ff(this,"level"),Ff(this,"levelValue"),Ff(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=cn.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new i2(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===cn.exports.levels.values.error?console.error(e):r===cn.exports.levels.values.warn?console.warn(e):r===cn.exports.levels.values.debug?console.debug(e):r===cn.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(o2({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new i2(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(o2({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var NZ=Object.defineProperty,kZ=(t,e,r)=>e in t?NZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,DZ=(t,e,r)=>kZ(t,e+"",r);class jZ{constructor(e,r=Sg){DZ(this,"baseChunkLogger"),this.baseChunkLogger=new e6(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}}var qZ=Object.defineProperty,zZ=(t,e,r)=>e in t?qZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,MZ=(t,e,r)=>zZ(t,e+"",r);let HZ=class{constructor(e,r=Sg){MZ(this,"baseChunkLogger"),this.baseChunkLogger=new e6(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var VZ=Object.defineProperty,KZ=Object.defineProperties,GZ=Object.getOwnPropertyDescriptors,a2=Object.getOwnPropertySymbols,ZZ=Object.prototype.hasOwnProperty,YZ=Object.prototype.propertyIsEnumerable,c2=(t,e,r)=>e in t?VZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fo=(t,e)=>{for(var r in e||(e={}))ZZ.call(e,r)&&c2(t,r,e[r]);if(a2)for(var r of a2(e))YZ.call(e,r)&&c2(t,r,e[r]);return t},lo=(t,e)=>KZ(t,GZ(e));function WZ(t){var e,r;const n=new jZ((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:cn.exports(lo(fo({},t.opts),{level:"trace",browser:lo(fo({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})})),chunkLoggerController:n}}function XZ(t){var e,r;const n=new HZ((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:cn.exports(lo(fo({},t.opts),{level:"trace",browser:lo(fo({},(r=t.opts)==null?void 0:r.browser),{write:s=>n.write(s)})}),n),chunkLoggerController:n}}function JZ(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const r=lo(fo({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?WZ(lo(fo({},t),{opts:r})):XZ(lo(fo({},t),{opts:r}))}const QZ=":";function fc(t){const[e,r]=t.split(QZ);return{namespace:e,reference:r}}function eY(t,e){return Z.fromMiliseconds(Date.now()+Z.toMiliseconds(t))}function t6(t){return Date.now()>=Z.toMiliseconds(t)}function Gh(t=[],e=[]){return[...new Set([...t,...e])]}const Uf=BigInt(2**32-1),f2=BigInt(32);function r6(t,e=!1){return e?{h:Number(t&Uf),l:Number(t>>f2&Uf)}:{h:Number(t>>f2&Uf)|0,l:Number(t&Uf)|0}}function n6(t,e=!1){const r=t.length;let n=new Uint32Array(r),s=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=r6(t[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const l2=(t,e,r)=>t>>>r,u2=(t,e,r)=>t<<32-r|e>>>r,qs=(t,e,r)=>t>>>r|e<<32-r,zs=(t,e,r)=>t<<32-r|e>>>r,ec=(t,e,r)=>t<<64-r|e>>>r-32,tc=(t,e,r)=>t>>>r-32|e<<64-r,tY=(t,e)=>e,rY=(t,e)=>t,nY=(t,e,r)=>t<<r|e>>>32-r,sY=(t,e,r)=>e<<r|t>>>32-r,iY=(t,e,r)=>e<<r-32|t>>>64-r,oY=(t,e,r)=>t<<r-32|e>>>64-r;function Pr(t,e,r,n){const s=(e>>>0)+(n>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const Og=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),_g=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,aY=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),cY=(t,e,r,n,s)=>e+r+n+s+(t/2**32|0)|0,fY=(t,e,r,n,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(s>>>0),lY=(t,e,r,n,s,i)=>e+r+n+s+i+(t/2**32|0)|0,Ro=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function fu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function yi(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function qr(t,...e){if(!fu(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function s6(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");yi(t.outputLen),yi(t.blockLen)}function bi(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Fg(t,e){qr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Bc(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function zr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Zh(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function en(t,e){return t<<32-e|t>>>e}const i6=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function o6(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Fn=i6?t=>t:t=>o6(t);function uY(t){for(let e=0;e<t.length;e++)t[e]=o6(t[e]);return t}const Ms=i6?t=>t:uY,a6=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hY=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ta(t){if(qr(t),a6)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=hY[t[r]];return e}const In={_0:48,_9:57,A:65,F:70,a:97,f:102};function h2(t){if(t>=In._0&&t<=In._9)return t-In._0;if(t>=In.A&&t<=In.F)return t-(In.A-10);if(t>=In.a&&t<=In.f)return t-(In.a-10)}function El(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(a6)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=h2(t.charCodeAt(i)),a=h2(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function c6(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Zn(t){return typeof t=="string"&&(t=c6(t)),qr(t),t}function Xs(...t){let e=0;for(let n=0;n<t.length;n++){const s=t[n];qr(s),e+=s.length}const r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){const i=t[n];r.set(i,s),s+=i.length}return r}let lu=class{};function zc(t){const e=n=>t().update(Zn(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function dY(t){const e=(n,s)=>t(s).update(Zn(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function Ug(t=32){if(Ro&&typeof Ro.getRandomValues=="function")return Ro.getRandomValues(new Uint8Array(t));if(Ro&&typeof Ro.randomBytes=="function")return Uint8Array.from(Ro.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const pY=BigInt(0),qa=BigInt(1),gY=BigInt(2),yY=BigInt(7),bY=BigInt(256),wY=BigInt(113),f6=[],l6=[],u6=[];for(let t=0,e=qa,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],f6.push(2*(5*n+r)),l6.push((t+1)*(t+2)/2%64);let s=pY;for(let i=0;i<7;i++)e=(e<<qa^(e>>yY)*wY)%bY,e&gY&&(s^=qa<<(qa<<BigInt(i))-qa);u6.push(s)}const h6=n6(u6,!0),mY=h6[0],vY=h6[1],d2=(t,e,r)=>r>32?iY(t,e,r):nY(t,e,r),p2=(t,e,r)=>r>32?oY(t,e,r):sY(t,e,r);function EY(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=r[c],l=r[c+1],h=d2(f,l,1)^r[a],u=p2(f,l,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=u}let s=t[2],i=t[3];for(let o=0;o<24;o++){const a=l6[o],c=d2(s,i,a),f=p2(s,i,a),l=f6[o];s=t[l],i=t[l+1],t[l]=c,t[l+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=mY[n],t[1]^=vY[n]}zr(r)}class Pg extends lu{constructor(e,r,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=s,this.rounds=i,yi(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Bc(this.state)}clone(){return this._cloneInto()}keccak(){Ms(this.state32),EY(this.state32,this.rounds),Ms(this.state32),this.posOut=0,this.pos=0}update(e){bi(this),e=Zn(e),qr(e);const{blockLen:r,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:s}=this;e[n]^=r,(r&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){bi(this,!1),qr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return yi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Fg(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,zr(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new Pg(r,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const xY=(t,e,r)=>zc(()=>new Pg(e,t,r));xY(1,136,256/8);function $Y(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i),c=n?4:0,f=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+f,a,n)}function IY(t,e,r){return t&e^~t&r}function BY(t,e,r){return t&e^t&r^e&r}class d6 extends lu{constructor(e,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Zh(this.buffer)}update(e){bi(this),e=Zn(e),qr(e);const{view:r,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=Zh(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){bi(this),Fg(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;r[o++]=128,zr(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)r[h]=0;$Y(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=Zh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const As=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),pt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),gt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),AY=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ss=new Uint32Array(64);class SY extends d6{constructor(e=32){super(64,e,8,!1),this.A=As[0]|0,this.B=As[1]|0,this.C=As[2]|0,this.D=As[3]|0,this.E=As[4]|0,this.F=As[5]|0,this.G=As[6]|0,this.H=As[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,r,n,s,i,o,a,c]}set(e,r,n,s,i,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Ss[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const u=Ss[h-15],d=Ss[h-2],g=en(u,7)^en(u,18)^u>>>3,b=en(d,17)^en(d,19)^d>>>10;Ss[h]=b+Ss[h-7]+g+Ss[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:f,H:l}=this;for(let h=0;h<64;h++){const u=en(a,6)^en(a,11)^en(a,25),d=l+u+IY(a,c,f)+AY[h]+Ss[h]|0,g=(en(n,2)^en(n,13)^en(n,22))+BY(n,s,i)|0;l=f,f=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(n,s,i,o,a,c,f,l)}roundClean(){zr(Ss)}destroy(){this.set(0,0,0,0,0,0,0,0),zr(this.buffer)}}const p6=n6(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),OY=p6[0],_Y=p6[1],Os=new Uint32Array(80),_s=new Uint32Array(80);class Cg extends d6{constructor(e=64){super(128,e,16,!1),this.Ah=gt[0]|0,this.Al=gt[1]|0,this.Bh=gt[2]|0,this.Bl=gt[3]|0,this.Ch=gt[4]|0,this.Cl=gt[5]|0,this.Dh=gt[6]|0,this.Dl=gt[7]|0,this.Eh=gt[8]|0,this.El=gt[9]|0,this.Fh=gt[10]|0,this.Fl=gt[11]|0,this.Gh=gt[12]|0,this.Gl=gt[13]|0,this.Hh=gt[14]|0,this.Hl=gt[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:f,El:l,Fh:h,Fl:u,Gh:d,Gl:g,Hh:b,Hl:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=l|0,this.Fh=h|0,this.Fl=u|0,this.Gh=d|0,this.Gl=g|0,this.Hh=b|0,this.Hl=E|0}process(e,r){for(let $=0;$<16;$++,r+=4)Os[$]=e.getUint32(r),_s[$]=e.getUint32(r+=4);for(let $=16;$<80;$++){const F=Os[$-15]|0,P=_s[$-15]|0,C=qs(F,P,1)^qs(F,P,8)^l2(F,P,7),T=zs(F,P,1)^zs(F,P,8)^u2(F,P,7),R=Os[$-2]|0,A=_s[$-2]|0,j=qs(R,A,19)^ec(R,A,61)^l2(R,A,6),q=zs(R,A,19)^tc(R,A,61)^u2(R,A,6),S=aY(T,q,_s[$-7],_s[$-16]),m=cY(S,C,j,Os[$-7],Os[$-16]);Os[$]=m|0,_s[$]=S|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:f,Dl:l,Eh:h,El:u,Fh:d,Fl:g,Gh:b,Gl:E,Hh:U,Hl:L}=this;for(let $=0;$<80;$++){const F=qs(h,u,14)^qs(h,u,18)^ec(h,u,41),P=zs(h,u,14)^zs(h,u,18)^tc(h,u,41),C=h&d^~h&b,T=u&g^~u&E,R=fY(L,P,T,_Y[$],_s[$]),A=lY(R,U,F,C,OY[$],Os[$]),j=R|0,q=qs(n,s,28)^ec(n,s,34)^ec(n,s,39),S=zs(n,s,28)^tc(n,s,34)^tc(n,s,39),m=n&i^n&a^i&a,x=s&o^s&c^o&c;U=b|0,L=E|0,b=d|0,E=g|0,d=h|0,g=u|0,{h,l:u}=Pr(f|0,l|0,A|0,j|0),f=a|0,l=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const y=Og(j,S,x);n=_g(y,A,q,m),s=y|0}({h:n,l:s}=Pr(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Pr(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Pr(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l}=Pr(this.Dh|0,this.Dl|0,f|0,l|0),{h,l:u}=Pr(this.Eh|0,this.El|0,h|0,u|0),{h:d,l:g}=Pr(this.Fh|0,this.Fl|0,d|0,g|0),{h:b,l:E}=Pr(this.Gh|0,this.Gl|0,b|0,E|0),{h:U,l:L}=Pr(this.Hh|0,this.Hl|0,U|0,L|0),this.set(n,s,i,o,a,c,f,l,h,u,d,g,b,E,U,L)}roundClean(){zr(Os,_s)}destroy(){zr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class FY extends Cg{constructor(){super(48),this.Ah=pt[0]|0,this.Al=pt[1]|0,this.Bh=pt[2]|0,this.Bl=pt[3]|0,this.Ch=pt[4]|0,this.Cl=pt[5]|0,this.Dh=pt[6]|0,this.Dl=pt[7]|0,this.Eh=pt[8]|0,this.El=pt[9]|0,this.Fh=pt[10]|0,this.Fl=pt[11]|0,this.Gh=pt[12]|0,this.Gl=pt[13]|0,this.Hh=pt[14]|0,this.Hl=pt[15]|0}}const yt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class UY extends Cg{constructor(){super(32),this.Ah=yt[0]|0,this.Al=yt[1]|0,this.Bh=yt[2]|0,this.Bl=yt[3]|0,this.Ch=yt[4]|0,this.Cl=yt[5]|0,this.Dh=yt[6]|0,this.Dl=yt[7]|0,this.Eh=yt[8]|0,this.El=yt[9]|0,this.Fh=yt[10]|0,this.Fl=yt[11]|0,this.Gh=yt[12]|0,this.Gl=yt[13]|0,this.Hh=yt[14]|0,this.Hl=yt[15]|0}}const PY=zc(()=>new SY),CY=zc(()=>new Cg),RY=zc(()=>new FY);zc(()=>new UY);const TY=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Ue=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),J=new Uint32Array(32);function Fs(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=J[2*t],f=J[2*t+1],l=J[2*e],h=J[2*e+1],u=J[2*r],d=J[2*r+1],g=J[2*n],b=J[2*n+1],E=Og(c,l,o);f=_g(E,f,h,a),c=E|0,{Dh:b,Dl:g}={Dh:b^f,Dl:g^c},{Dh:b,Dl:g}={Dh:tY(b,g),Dl:rY(b)},{h:d,l:u}=Pr(d,u,b,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^u},{Bh:h,Bl:l}={Bh:qs(h,l,24),Bl:zs(h,l,24)},J[2*t]=c,J[2*t+1]=f,J[2*e]=l,J[2*e+1]=h,J[2*r]=u,J[2*r+1]=d,J[2*n]=g,J[2*n+1]=b}function Us(t,e,r,n,s,i){const o=s[i],a=s[i+1];let c=J[2*t],f=J[2*t+1],l=J[2*e],h=J[2*e+1],u=J[2*r],d=J[2*r+1],g=J[2*n],b=J[2*n+1],E=Og(c,l,o);f=_g(E,f,h,a),c=E|0,{Dh:b,Dl:g}={Dh:b^f,Dl:g^c},{Dh:b,Dl:g}={Dh:qs(b,g,16),Dl:zs(b,g,16)},{h:d,l:u}=Pr(d,u,b,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^u},{Bh:h,Bl:l}={Bh:ec(h,l,63),Bl:tc(h,l,63)},J[2*t]=c,J[2*t+1]=f,J[2*e]=l,J[2*e+1]=h,J[2*r]=u,J[2*r+1]=d,J[2*n]=g,J[2*n+1]=b}function LY(t,e={},r,n,s){if(yi(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class NY extends lu{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,yi(e),yi(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Bc(this.buffer)}update(e){bi(this),e=Zn(e),qr(e);const{blockLen:r,buffer:n,buffer32:s}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===r&&(Ms(s),this.compress(s,0,!1),Ms(s),this.pos=0);const f=Math.min(r-this.pos,i-c),l=o+c;if(f===r&&!(l%4)&&c+f<i){const h=new Uint32Array(a,l,Math.floor((i-c)/4));Ms(h);for(let u=0;c+r<i;u+=s.length,c+=r)this.length+=r,this.compress(h,u,!1);Ms(h);continue}n.set(e.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(e){bi(this),Fg(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,zr(this.buffer.subarray(r)),Ms(n),this.compress(n,0,!0),Ms(n);const s=Bc(e);this.get().forEach((i,o)=>s[o]=Fn(i))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:s,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=i,e.finished=s,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class kY extends NY{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Ue[0]|0,this.v0h=Ue[1]|0,this.v1l=Ue[2]|0,this.v1h=Ue[3]|0,this.v2l=Ue[4]|0,this.v2h=Ue[5]|0,this.v3l=Ue[6]|0,this.v3h=Ue[7]|0,this.v4l=Ue[8]|0,this.v4h=Ue[9]|0,this.v5l=Ue[10]|0,this.v5h=Ue[11]|0,this.v6l=Ue[12]|0,this.v6h=Ue[13]|0,this.v7l=Ue[14]|0,this.v7h=Ue[15]|0,LY(r,e,64,16,16);let{key:n,personalization:s,salt:i}=e,o=0;if(n!==void 0&&(n=Zn(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=Zn(i);const a=Bc(i);this.v4l^=Fn(a[0]),this.v4h^=Fn(a[1]),this.v5l^=Fn(a[2]),this.v5h^=Fn(a[3])}if(s!==void 0){s=Zn(s);const a=Bc(s);this.v6l^=Fn(a[0]),this.v6h^=Fn(a[1]),this.v7l^=Fn(a[2]),this.v7h^=Fn(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:s,v2l:i,v2h:o,v3l:a,v3h:c,v4l:f,v4h:l,v5l:h,v5h:u,v6l:d,v6h:g,v7l:b,v7h:E}=this;return[e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E]}set(e,r,n,s,i,o,a,c,f,l,h,u,d,g,b,E){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=l|0,this.v5l=h|0,this.v5h=u|0,this.v6l=d|0,this.v6h=g|0,this.v7l=b|0,this.v7h=E|0}compress(e,r,n){this.get().forEach((c,f)=>J[f]=c),J.set(Ue,16);let{h:s,l:i}=r6(BigInt(this.length));J[24]=Ue[8]^i,J[25]=Ue[9]^s,n&&(J[28]=~J[28],J[29]=~J[29]);let o=0;const a=TY;for(let c=0;c<12;c++)Fs(0,4,8,12,e,r+2*a[o++]),Us(0,4,8,12,e,r+2*a[o++]),Fs(1,5,9,13,e,r+2*a[o++]),Us(1,5,9,13,e,r+2*a[o++]),Fs(2,6,10,14,e,r+2*a[o++]),Us(2,6,10,14,e,r+2*a[o++]),Fs(3,7,11,15,e,r+2*a[o++]),Us(3,7,11,15,e,r+2*a[o++]),Fs(0,5,10,15,e,r+2*a[o++]),Us(0,5,10,15,e,r+2*a[o++]),Fs(1,6,11,12,e,r+2*a[o++]),Us(1,6,11,12,e,r+2*a[o++]),Fs(2,7,8,13,e,r+2*a[o++]),Us(2,7,8,13,e,r+2*a[o++]),Fs(3,4,9,14,e,r+2*a[o++]),Us(3,4,9,14,e,r+2*a[o++]);this.v0l^=J[0]^J[16],this.v0h^=J[1]^J[17],this.v1l^=J[2]^J[18],this.v1h^=J[3]^J[19],this.v2l^=J[4]^J[20],this.v2h^=J[5]^J[21],this.v3l^=J[6]^J[22],this.v3h^=J[7]^J[23],this.v4l^=J[8]^J[24],this.v4h^=J[9]^J[25],this.v5l^=J[10]^J[26],this.v5h^=J[11]^J[27],this.v6l^=J[12]^J[28],this.v6h^=J[13]^J[29],this.v7l^=J[14]^J[30],this.v7h^=J[15]^J[31],zr(J)}destroy(){this.destroyed=!0,zr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}dY(t=>new kY(t));function g6(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function kp(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Yh(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function kt(t,...e){if(!g6(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function g2(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function DY(t,e){kt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function fi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function pa(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function jY(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const qY=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function zY(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Dp(t){if(typeof t=="string")t=zY(t);else if(g6(t))t=jp(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function MY(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function HY(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const VY=(t,e)=>{function r(n,...s){if(kt(n),!qY)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const f=s[0];if(!f)throw new Error("nonce / iv required");t.varSizeNonce?kt(f):kt(f,t.nonceLength)}const i=t.tagLength;i&&s[1]!==void 0&&kt(s[1]);const o=e(n,...s),a=(f,l)=>{if(l!==void 0){if(f!==2)throw new Error("cipher output not supported");kt(l)}};let c=!1;return{encrypt(f,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,kt(f),a(o.encrypt.length,l),o.encrypt(f,l)},decrypt(f,l){if(kt(f),i&&f.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,l),o.decrypt(f,l)}}}return Object.assign(r,t),r};function y2(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!GY(e))throw new Error("invalid output, must be aligned");return e}function b2(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(r>>s&i),a=Number(r&i);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function KY(t,e,r){kp(r);const n=new Uint8Array(16),s=jY(n);return b2(s,0,BigInt(e),r),b2(s,8,BigInt(t),r),n}function GY(t){return t.byteOffset%4===0}function jp(t){return Uint8Array.from(t)}const y6=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),ZY=y6("expand 16-byte k"),YY=y6("expand 32-byte k"),WY=fi(ZY),XY=fi(YY);function pe(t,e){return t<<e|t>>>32-e}function qp(t){return t.byteOffset%4===0}const Pf=64,JY=16,b6=2**32-1,w2=new Uint32Array;function QY(t,e,r,n,s,i,o,a){const c=s.length,f=new Uint8Array(Pf),l=fi(f),h=qp(s)&&qp(i),u=h?fi(s):w2,d=h?fi(i):w2;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=b6)throw new Error("arx: counter overflow");const b=Math.min(Pf,c-g);if(h&&b===Pf){const E=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let U=0,L;U<JY;U++)L=E+U,d[L]=u[L]^l[U];g+=Pf;continue}for(let E=0,U;E<b;E++)U=g+E,i[U]=s[U]^f[E];g+=b}}function eW(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=MY({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Yh(s),Yh(o),kp(i),kp(r),(a,c,f,l,h=0)=>{kt(a),kt(c),kt(f);const u=f.length;if(l===void 0&&(l=new Uint8Array(u)),kt(l),Yh(h),h<0||h>=b6)throw new Error("arx: counter overflow");if(l.length<u)throw new Error(`arx: output (${l.length}) is shorter than data (${u})`);const d=[];let g=a.length,b,E;if(g===32)d.push(b=jp(a)),E=XY;else if(g===16&&r)b=new Uint8Array(32),b.set(a),b.set(a,16),E=WY,d.push(b);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);qp(c)||d.push(c=jp(c));const U=fi(b);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(E,U,fi(c.subarray(0,16)),U),c=c.subarray(16)}const L=16-s;if(L!==c.length)throw new Error(`arx: nonce must be ${L} or 16 bytes`);if(L!==12){const F=new Uint8Array(12);F.set(c,i?0:12-c.length),c=F,d.push(c)}const $=fi(c);return QY(t,E,U,$,f,l,h,o),pa(...d),l}}const We=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class tW{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Dp(e),kt(e,32);const r=We(e,0),n=We(e,2),s=We(e,4),i=We(e,6),o=We(e,8),a=We(e,10),c=We(e,12),f=We(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let l=0;l<8;l++)this.pad[l]=We(e,16+2*l)}process(e,r,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],f=o[2],l=o[3],h=o[4],u=o[5],d=o[6],g=o[7],b=o[8],E=o[9],U=We(e,r+0),L=We(e,r+2),$=We(e,r+4),F=We(e,r+6),P=We(e,r+8),C=We(e,r+10),T=We(e,r+12),R=We(e,r+14);let A=i[0]+(U&8191),j=i[1]+((U>>>13|L<<3)&8191),q=i[2]+((L>>>10|$<<6)&8191),S=i[3]+(($>>>7|F<<9)&8191),m=i[4]+((F>>>4|P<<12)&8191),x=i[5]+(P>>>1&8191),y=i[6]+((P>>>14|C<<2)&8191),p=i[7]+((C>>>11|T<<5)&8191),v=i[8]+((T>>>8|R<<8)&8191),I=i[9]+(R>>>5|s),w=0,B=w+A*a+j*(5*E)+q*(5*b)+S*(5*g)+m*(5*d);w=B>>>13,B&=8191,B+=x*(5*u)+y*(5*h)+p*(5*l)+v*(5*f)+I*(5*c),w+=B>>>13,B&=8191;let O=w+A*c+j*a+q*(5*E)+S*(5*b)+m*(5*g);w=O>>>13,O&=8191,O+=x*(5*d)+y*(5*u)+p*(5*h)+v*(5*l)+I*(5*f),w+=O>>>13,O&=8191;let _=w+A*f+j*c+q*a+S*(5*E)+m*(5*b);w=_>>>13,_&=8191,_+=x*(5*g)+y*(5*d)+p*(5*u)+v*(5*h)+I*(5*l),w+=_>>>13,_&=8191;let k=w+A*l+j*f+q*c+S*a+m*(5*E);w=k>>>13,k&=8191,k+=x*(5*b)+y*(5*g)+p*(5*d)+v*(5*u)+I*(5*h),w+=k>>>13,k&=8191;let D=w+A*h+j*l+q*f+S*c+m*a;w=D>>>13,D&=8191,D+=x*(5*E)+y*(5*b)+p*(5*g)+v*(5*d)+I*(5*u),w+=D>>>13,D&=8191;let N=w+A*u+j*h+q*l+S*f+m*c;w=N>>>13,N&=8191,N+=x*a+y*(5*E)+p*(5*b)+v*(5*g)+I*(5*d),w+=N>>>13,N&=8191;let z=w+A*d+j*u+q*h+S*l+m*f;w=z>>>13,z&=8191,z+=x*c+y*a+p*(5*E)+v*(5*b)+I*(5*g),w+=z>>>13,z&=8191;let H=w+A*g+j*d+q*u+S*h+m*l;w=H>>>13,H&=8191,H+=x*f+y*c+p*a+v*(5*E)+I*(5*b),w+=H>>>13,H&=8191;let V=w+A*b+j*g+q*d+S*u+m*h;w=V>>>13,V&=8191,V+=x*l+y*f+p*c+v*a+I*(5*E),w+=V>>>13,V&=8191;let M=w+A*E+j*b+q*g+S*d+m*u;w=M>>>13,M&=8191,M+=x*h+y*l+p*f+v*c+I*a,w+=M>>>13,M&=8191,w=(w<<2)+w|0,w=w+B|0,B=w&8191,w=w>>>13,O+=w,i[0]=B,i[1]=O,i[2]=_,i[3]=k,i[4]=D,i[5]=N,i[6]=z,i[7]=H,i[8]=V,i[9]=M}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;pa(n)}update(e){g2(this),e=Dp(e),kt(e);const{buffer:r,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){pa(this.h,this.r,this.buffer,this.pad)}digestInto(e){g2(this),DY(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function rW(t){const e=(n,s)=>t(s).update(Dp(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const nW=rW(t=>new tW(t));function sW(t,e,r,n,s,i=20){let o=t[0],a=t[1],c=t[2],f=t[3],l=e[0],h=e[1],u=e[2],d=e[3],g=e[4],b=e[5],E=e[6],U=e[7],L=s,$=r[0],F=r[1],P=r[2],C=o,T=a,R=c,A=f,j=l,q=h,S=u,m=d,x=g,y=b,p=E,v=U,I=L,w=$,B=F,O=P;for(let k=0;k<i;k+=2)C=C+j|0,I=pe(I^C,16),x=x+I|0,j=pe(j^x,12),C=C+j|0,I=pe(I^C,8),x=x+I|0,j=pe(j^x,7),T=T+q|0,w=pe(w^T,16),y=y+w|0,q=pe(q^y,12),T=T+q|0,w=pe(w^T,8),y=y+w|0,q=pe(q^y,7),R=R+S|0,B=pe(B^R,16),p=p+B|0,S=pe(S^p,12),R=R+S|0,B=pe(B^R,8),p=p+B|0,S=pe(S^p,7),A=A+m|0,O=pe(O^A,16),v=v+O|0,m=pe(m^v,12),A=A+m|0,O=pe(O^A,8),v=v+O|0,m=pe(m^v,7),C=C+q|0,O=pe(O^C,16),p=p+O|0,q=pe(q^p,12),C=C+q|0,O=pe(O^C,8),p=p+O|0,q=pe(q^p,7),T=T+S|0,I=pe(I^T,16),v=v+I|0,S=pe(S^v,12),T=T+S|0,I=pe(I^T,8),v=v+I|0,S=pe(S^v,7),R=R+m|0,w=pe(w^R,16),x=x+w|0,m=pe(m^x,12),R=R+m|0,w=pe(w^R,8),x=x+w|0,m=pe(m^x,7),A=A+j|0,B=pe(B^A,16),y=y+B|0,j=pe(j^y,12),A=A+j|0,B=pe(B^A,8),y=y+B|0,j=pe(j^y,7);let _=0;n[_++]=o+C|0,n[_++]=a+T|0,n[_++]=c+R|0,n[_++]=f+A|0,n[_++]=l+j|0,n[_++]=h+q|0,n[_++]=u+S|0,n[_++]=d+m|0,n[_++]=g+x|0,n[_++]=b+y|0,n[_++]=E+p|0,n[_++]=U+v|0,n[_++]=L+I|0,n[_++]=$+w|0,n[_++]=F+B|0,n[_++]=P+O|0}const iW=eW(sW,{counterRight:!1,counterLength:4,allowShortKeys:!1}),oW=new Uint8Array(16),m2=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(oW.subarray(r))},aW=new Uint8Array(32);function v2(t,e,r,n,s){const i=t(e,r,aW),o=nW.create(i);s&&m2(o,s),m2(o,n);const a=KY(n.length,s?s.length:0,!0);o.update(a);const c=o.digest();return pa(i,a),c}const cW=t=>(e,r,n)=>({encrypt(s,i){const o=s.length;i=y2(o+16,i,!1),i.set(s);const a=i.subarray(0,-16);t(e,r,a,a,1);const c=v2(t,e,r,a,n);return i.set(c,o),pa(c),i},decrypt(s,i){i=y2(s.length-16,i,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=v2(t,e,r,o,n);if(!HY(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),t(e,r,i,i,1),pa(c),i}});VY({blockSize:64,nonceLength:12,tagLength:16},cW(iW));class w6 extends lu{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,s6(e);const n=Zn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),zr(i)}update(e){return bi(this),this.iHash.update(e),this}digestInto(e){bi(this),qr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const m6=(t,e,r)=>new w6(t,e).update(r).digest();m6.create=(t,e)=>new w6(t,e);Uint8Array.from([0]);const Rg=BigInt(0),zp=BigInt(1);function xl(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function to(t,e,r=""){const n=fu(t),s=t?.length,i=e!==void 0;if(!n||i&&s!==e){const o=r&&`"${r}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Cf(t){const e=t.toString(16);return e.length&1?"0"+e:e}function v6(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Rg:BigInt("0x"+t)}function uu(t){return v6(ta(t))}function $l(t){return qr(t),v6(ta(Uint8Array.from(t).reverse()))}function Tg(t,e){return El(t.toString(16).padStart(e*2,"0"))}function Lg(t,e){return Tg(t,e).reverse()}function vt(t,e,r){let n;if(typeof e=="string")try{n=El(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(fu(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=n.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return n}const Wh=t=>typeof t=="bigint"&&Rg<=t;function fW(t,e,r){return Wh(t)&&Wh(e)&&Wh(r)&&e<=t&&t<r}function Mp(t,e,r,n){if(!fW(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function E6(t){let e;for(e=0;t>Rg;t>>=zp,e+=1);return e}const Mc=t=>(zp<<BigInt(t))-zp;function lW(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=u=>new Uint8Array(u),s=u=>Uint8Array.of(u);let i=n(t),o=n(t),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},f=(...u)=>r(o,i,...u),l=(u=n(0))=>{o=f(s(0),u),i=f(),u.length!==0&&(o=f(s(1),u),i=f())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){i=f();const g=i.slice();d.push(g),u+=i.length}return Xs(...d)};return(u,d)=>{c(),l(u);let g;for(;!(g=d(h()));)l();return c(),g}}function hu(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(s,i,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([s,i])=>n(s,i,!1)),Object.entries(r).forEach(([s,i])=>n(s,i,!0))}function E2(t){const e=new WeakMap;return(r,...n)=>{const s=e.get(r);if(s!==void 0)return s;const i=t(r,...n);return e.set(r,i),i}}const Mt=BigInt(0),St=BigInt(1),ro=BigInt(2),x6=BigInt(3),$6=BigInt(4),I6=BigInt(5),uW=BigInt(7),B6=BigInt(8),hW=BigInt(9),A6=BigInt(16);function Qt(t,e){const r=t%e;return r>=Mt?r:e+r}function Or(t,e,r){let n=t;for(;e-- >Mt;)n*=n,n%=r;return n}function x2(t,e){if(t===Mt)throw new Error("invert: expected non-zero number");if(e<=Mt)throw new Error("invert: expected positive modulus, got "+e);let r=Qt(t,e),n=e,s=Mt,i=St;for(;r!==Mt;){const o=n/r,a=n%r,c=s-i*o;n=r,r=a,s=i,i=c}if(n!==St)throw new Error("invert: does not exist");return Qt(s,e)}function Ng(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function S6(t,e){const r=(t.ORDER+St)/$6,n=t.pow(e,r);return Ng(t,n,e),n}function dW(t,e){const r=(t.ORDER-I6)/B6,n=t.mul(e,ro),s=t.pow(n,r),i=t.mul(e,s),o=t.mul(t.mul(i,ro),s),a=t.mul(i,t.sub(o,t.ONE));return Ng(t,a,e),a}function pW(t){const e=xi(t),r=O6(t),n=r(e,e.neg(e.ONE)),s=r(e,n),i=r(e,e.neg(n)),o=(t+uW)/A6;return(a,c)=>{let f=a.pow(c,o),l=a.mul(f,n);const h=a.mul(f,s),u=a.mul(f,i),d=a.eql(a.sqr(l),c),g=a.eql(a.sqr(h),c);f=a.cmov(f,l,d),l=a.cmov(u,h,g);const b=a.eql(a.sqr(l),c),E=a.cmov(f,l,b);return Ng(a,E,c),E}}function O6(t){if(t<x6)throw new Error("sqrt is not defined for small field");let e=t-St,r=0;for(;e%ro===Mt;)e/=ro,r++;let n=ro;const s=xi(t);for(;$2(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return S6;let i=s.pow(n,e);const o=(e+St)/ro;return function(a,c){if(a.is0(c))return c;if($2(a,c)!==1)throw new Error("Cannot find square root");let f=r,l=a.mul(a.ONE,i),h=a.pow(c,e),u=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,g=a.sqr(h);for(;!a.eql(g,a.ONE);)if(d++,g=a.sqr(g),d===f)throw new Error("Cannot find square root");const b=St<<BigInt(f-d-1),E=a.pow(l,b);f=d,l=a.sqr(E),h=a.mul(h,l),u=a.mul(u,E)}return u}}function gW(t){return t%$6===x6?S6:t%B6===I6?dW:t%A6===hW?pW(t):O6(t)}const yW=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bW(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=yW.reduce((n,s)=>(n[s]="function",n),e);return hu(t,r),t}function wW(t,e,r){if(r<Mt)throw new Error("invalid exponent, negatives unsupported");if(r===Mt)return t.ONE;if(r===St)return e;let n=t.ONE,s=e;for(;r>Mt;)r&St&&(n=t.mul(n,s)),s=t.sqr(s),r>>=St;return n}function _6(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function $2(t,e){const r=(t.ORDER-St)/ro,n=t.pow(e,r),s=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function F6(t,e){e!==void 0&&yi(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function xi(t,e,r=!1,n={}){if(t<=Mt)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const u=e;u.BITS&&(s=u.BITS),u.sqrt&&(i=u.sqrt),typeof u.isLE=="boolean"&&(r=u.isLE),typeof u.modFromBytes=="boolean"&&(o=u.modFromBytes),a=u.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:f}=F6(t,s);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:f,MASK:Mc(c),ZERO:Mt,ONE:St,allowedLengths:a,create:u=>Qt(u,t),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return Mt<=u&&u<t},is0:u=>u===Mt,isValidNot0:u=>!h.is0(u)&&h.isValid(u),isOdd:u=>(u&St)===St,neg:u=>Qt(-u,t),eql:(u,d)=>u===d,sqr:u=>Qt(u*u,t),add:(u,d)=>Qt(u+d,t),sub:(u,d)=>Qt(u-d,t),mul:(u,d)=>Qt(u*d,t),pow:(u,d)=>wW(h,u,d),div:(u,d)=>Qt(u*x2(d,t),t),sqrN:u=>u*u,addN:(u,d)=>u+d,subN:(u,d)=>u-d,mulN:(u,d)=>u*d,inv:u=>x2(u,t),sqrt:i||(u=>(l||(l=gW(t)),l(h,u))),toBytes:u=>r?Lg(u,f):Tg(u,f),fromBytes:(u,d=!0)=>{if(a){if(!a.includes(u.length)||u.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);const b=new Uint8Array(f);b.set(u,r?0:b.length-u.length),u=b}if(u.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+u.length);let g=r?$l(u):uu(u);if(o&&(g=Qt(g,t)),!d&&!h.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:u=>_6(h,u),cmov:(u,d,g)=>g?d:u});return Object.freeze(h)}function U6(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function P6(t){const e=U6(t);return e+Math.ceil(e/2)}function mW(t,e,r=!1){const n=t.length,s=U6(e),i=P6(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=r?$l(t):uu(t),a=Qt(o,e-St)+St;return r?Lg(a,s):Tg(a,s)}const ga=BigInt(0),no=BigInt(1);function Il(t,e){const r=e.negate();return t?r:e}function Xh(t,e){const r=_6(t.Fp,e.map(n=>n.Z));return e.map((n,s)=>t.fromAffine(n.toAffine(r[s])))}function C6(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Jh(t,e){C6(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),s=2**t,i=Mc(t),o=BigInt(t);return{windows:r,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function I2(t,e,r){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>n&&(a-=i,c+=no);const f=e*n,l=f+Math.abs(a)-1,h=a===0,u=a<0,d=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:u,isNegF:d,offsetF:f}}function vW(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function EW(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Qh=new WeakMap,R6=new WeakMap;function ed(t){return R6.get(t)||1}function B2(t){if(t!==ga)throw new Error("invalid wNAF")}class xW{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let s=e;for(;r>ga;)r&no&&(n=n.add(s)),s=s.double(),r>>=no;return n}precomputeWindow(e,r){const{windows:n,windowSize:s}=Jh(r,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let f=1;f<s;f++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=Jh(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:l,isNeg:h,isNegF:u,offsetF:d}=I2(n,a,o);n=c,l?i=i.add(Il(u,r[d])):s=s.add(Il(h,r[f]))}return B2(n),{p:s,f:i}}wNAFUnsafe(e,r,n,s=this.ZERO){const i=Jh(e,this.bits);for(let o=0;o<i.windows&&n!==ga;o++){const{nextN:a,offset:c,isZero:f,isNeg:l}=I2(n,o,i);if(n=a,!f){const h=r[c];s=s.add(l?h.negate():h)}}return B2(n),s}getPrecomputes(e,r,n){let s=Qh.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(s=n(s)),Qh.set(r,s))),s}cached(e,r,n){const s=ed(e);return this.wNAF(s,this.getPrecomputes(s,e,n),r)}unsafe(e,r,n,s){const i=ed(e);return i===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),r,s)}createCache(e,r){C6(r,this.bits),R6.set(e,r),Qh.delete(e)}hasCache(e){return ed(e)!==1}}function $W(t,e,r,n){let s=e,i=t.ZERO,o=t.ZERO;for(;r>ga||n>ga;)r&no&&(i=i.add(s)),n&no&&(o=o.add(s)),s=s.double(),r>>=no,n>>=no;return{p1:i,p2:o}}function IW(t,e,r,n){vW(r,t),EW(n,e);const s=r.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=E6(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=Mc(c),l=new Array(Number(f)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let u=o;for(let d=h;d>=0;d-=c){l.fill(o);for(let b=0;b<i;b++){const E=n[b],U=Number(E>>BigInt(d)&f);l[U]=l[U].add(r[b])}let g=o;for(let b=l.length-1,E=o;b>0;b--)E=E.add(l[b]),g=g.add(E);if(u=u.add(g),d!==0)for(let b=0;b<c;b++)u=u.double()}return u}function A2(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return bW(e),e}else return xi(t,{isLE:r})}function BW(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>ga))throw new Error(`CURVE.${a} must be positive bigint`)}const s=A2(e.p,r.Fp,n),i=A2(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),c6("HashToScalar-");const za=BigInt(0),To=BigInt(1),Rf=BigInt(2);function AW(t){return hu(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function SW(t){const e=AW(t),{P:r,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||Ug,f=a?255:448,l=a?32:56,h=BigInt(a?9:5),u=BigInt(a?121665:39081),d=a?Rf**BigInt(254):Rf**BigInt(447),g=a?BigInt(8)*Rf**BigInt(251)-To:BigInt(4)*Rf**BigInt(445)-To,b=d+g+To,E=S=>Qt(S,r),U=L(h);function L(S){return Lg(E(S),l)}function $(S){const m=vt("u coordinate",S,l);return a&&(m[31]&=127),E($l(m))}function F(S){return $l(s(vt("scalar",S,l)))}function P(S,m){const x=R($(m),F(S));if(x===za)throw new Error("invalid private or public key received");return L(x)}function C(S){return P(S,U)}function T(S,m,x){const y=E(S*(m-x));return m=E(m-y),x=E(x+y),{x_2:m,x_3:x}}function R(S,m){Mp("u",S,za,r),Mp("scalar",m,d,b);const x=m,y=S;let p=To,v=za,I=S,w=To,B=za;for(let _=BigInt(f-1);_>=za;_--){const k=x>>_&To;B^=k,{x_2:p,x_3:I}=T(B,p,I),{x_2:v,x_3:w}=T(B,v,w),B=k;const D=p+v,N=E(D*D),z=p-v,H=E(z*z),V=N-H,M=I+w,K=I-w,Q=E(K*D),te=E(M*z),re=Q+te,le=Q-te;I=E(re*re),w=E(y*E(le*le)),p=E(N*H),v=E(V*(N+E(u*V)))}({x_2:p,x_3:I}=T(B,p,I)),{x_2:v,x_3:w}=T(B,v,w);const O=i(v);return E(p*O)}const A={secretKey:l,publicKey:l,seed:l},j=(S=c(l))=>(qr(S,A.seed),S);function q(S){const m=j(S);return{secretKey:m,publicKey:C(m)}}return{keygen:q,getSharedSecret:(S,m)=>P(S,m),getPublicKey:S=>C(S),scalarMult:P,scalarMultBase:C,utils:{randomSecretKey:j,randomPrivateKey:j},GuBytes:U.slice(),lengths:A}}const OW=BigInt(1),S2=BigInt(2),_W=BigInt(3),FW=BigInt(5);BigInt(8);const T6=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),UW={p:T6,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function PW(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),i=T6,o=t*t%i*t%i,a=Or(o,S2,i)*o%i,c=Or(a,OW,i)*t%i,f=Or(c,FW,i)*c%i,l=Or(f,e,i)*f%i,h=Or(l,r,i)*l%i,u=Or(h,n,i)*h%i,d=Or(u,s,i)*u%i,g=Or(d,s,i)*u%i,b=Or(g,e,i)*f%i;return{pow_p_5_8:Or(b,S2,i)*t%i,b2:o}}function CW(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const RW=xi(UW.p,{isLE:!0});(()=>{const t=RW.ORDER;return SW({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=PW(e);return Qt(Or(r,_W,t)*n,t)},adjustScalarBytes:CW})})();const O2=(t,e)=>(t+(t>=0?e:-e)/L6)/e;function TW(t,e,r){const[[n,s],[i,o]]=e,a=O2(o*t,r),c=O2(-s*t,r);let f=t-a*n-c*i,l=-a*s-c*o;const h=f<qn,u=l<qn;h&&(f=-f),u&&(l=-l);const d=Mc(Math.ceil(E6(r)/2))+ra;if(f<qn||f>=d||l<qn||l>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:f,k2neg:u,k2:l}}function Hp(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function td(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return xl(r.lowS,"lowS"),xl(r.prehash,"prehash"),r.format!==void 0&&Hp(r.format),r}class LW extends Error{constructor(e=""){super(e)}}const Ln={Err:LW,_tlv:{encode:(t,e)=>{const{Err:r}=Ln;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,s=Cf(n);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const i=n>127?Cf(s.length/2|128):"";return Cf(t)+i+s+e},decode(t,e){const{Err:r}=Ln;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const f=e.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of f)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Ln;if(t<qn)throw new e("integer: negative integers are not allowed");let r=Cf(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Ln;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return uu(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Ln,s=vt("signature",t),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:f,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(t){const{_tlv:e,_int:r}=Ln,n=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),i=n+s;return e.encode(48,i)}},qn=BigInt(0),ra=BigInt(1),L6=BigInt(2),Tf=BigInt(3),NW=BigInt(4);function zo(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let s=vt("private key",e);try{n=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function kW(t,e={}){const r=BW("weierstrass",t,e),{Fp:n,Fn:s}=r;let i=r.CURVE;const{h:o,n:a}=i;hu(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=k6(n,s);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(S,m,x){const{x:y,y:p}=m.toAffine(),v=n.toBytes(y);if(xl(x,"isCompressed"),x){l();const I=!n.isOdd(p);return Xs(N6(I),v)}else return Xs(Uint8Array.of(4),v,n.toBytes(p))}function u(S){to(S,void 0,"Point");const{publicKey:m,publicKeyUncompressed:x}=f,y=S.length,p=S[0],v=S.subarray(1);if(y===m&&(p===2||p===3)){const I=n.fromBytes(v);if(!n.isValid(I))throw new Error("bad point: is not on curve, wrong x");const w=b(I);let B;try{B=n.sqrt(w)}catch(_){const k=_ instanceof Error?": "+_.message:"";throw new Error("bad point: is not on curve, sqrt error"+k)}l();const O=n.isOdd(B);return(p&1)===1!==O&&(B=n.neg(B)),{x:I,y:B}}else if(y===x&&p===4){const I=n.BYTES,w=n.fromBytes(v.subarray(0,I)),B=n.fromBytes(v.subarray(I,I*2));if(!E(w,B))throw new Error("bad point: is not on curve");return{x:w,y:B}}else throw new Error(`bad point: got length ${y}, expected compressed=${m} or uncompressed=${x}`)}const d=e.toBytes||h,g=e.fromBytes||u;function b(S){const m=n.sqr(S),x=n.mul(m,S);return n.add(n.add(x,n.mul(S,i.a)),i.b)}function E(S,m){const x=n.sqr(m),y=b(S);return n.eql(x,y)}if(!E(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const U=n.mul(n.pow(i.a,Tf),NW),L=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(U,L)))throw new Error("bad curve params: a or b");function $(S,m,x=!1){if(!n.isValid(m)||x&&n.is0(m))throw new Error(`bad point coordinate ${S}`);return m}function F(S){if(!(S instanceof A))throw new Error("ProjectivePoint expected")}function P(S){if(!c||!c.basises)throw new Error("no endo");return TW(S,c.basises,s.ORDER)}const C=E2((S,m)=>{const{X:x,Y:y,Z:p}=S;if(n.eql(p,n.ONE))return{x,y};const v=S.is0();m==null&&(m=v?n.ONE:n.inv(p));const I=n.mul(x,m),w=n.mul(y,m),B=n.mul(p,m);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(B,n.ONE))throw new Error("invZ was invalid");return{x:I,y:w}}),T=E2(S=>{if(S.is0()){if(e.allowInfinityPoint&&!n.is0(S.Y))return;throw new Error("bad point: ZERO")}const{x:m,y:x}=S.toAffine();if(!n.isValid(m)||!n.isValid(x))throw new Error("bad point: x or y not field elements");if(!E(m,x))throw new Error("bad point: equation left != right");if(!S.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(S,m,x,y,p){return x=new A(n.mul(x.X,S),x.Y,x.Z),m=Il(y,m),x=Il(p,x),m.add(x)}class A{constructor(m,x,y){this.X=$("x",m),this.Y=$("y",x,!0),this.Z=$("z",y),Object.freeze(this)}static CURVE(){return i}static fromAffine(m){const{x,y}=m||{};if(!m||!n.isValid(x)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof A)throw new Error("projective point not allowed");return n.is0(x)&&n.is0(y)?A.ZERO:new A(x,y,n.ONE)}static fromBytes(m){const x=A.fromAffine(g(to(m,void 0,"point")));return x.assertValidity(),x}static fromHex(m){return A.fromBytes(vt("pointHex",m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,x=!0){return q.createCache(this,m),x||this.multiply(Tf),this}assertValidity(){T(this)}hasEvenY(){const{y:m}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(m)}equals(m){F(m);const{X:x,Y:y,Z:p}=this,{X:v,Y:I,Z:w}=m,B=n.eql(n.mul(x,w),n.mul(v,p)),O=n.eql(n.mul(y,w),n.mul(I,p));return B&&O}negate(){return new A(this.X,n.neg(this.Y),this.Z)}double(){const{a:m,b:x}=i,y=n.mul(x,Tf),{X:p,Y:v,Z:I}=this;let w=n.ZERO,B=n.ZERO,O=n.ZERO,_=n.mul(p,p),k=n.mul(v,v),D=n.mul(I,I),N=n.mul(p,v);return N=n.add(N,N),O=n.mul(p,I),O=n.add(O,O),w=n.mul(m,O),B=n.mul(y,D),B=n.add(w,B),w=n.sub(k,B),B=n.add(k,B),B=n.mul(w,B),w=n.mul(N,w),O=n.mul(y,O),D=n.mul(m,D),N=n.sub(_,D),N=n.mul(m,N),N=n.add(N,O),O=n.add(_,_),_=n.add(O,_),_=n.add(_,D),_=n.mul(_,N),B=n.add(B,_),D=n.mul(v,I),D=n.add(D,D),_=n.mul(D,N),w=n.sub(w,_),O=n.mul(D,k),O=n.add(O,O),O=n.add(O,O),new A(w,B,O)}add(m){F(m);const{X:x,Y:y,Z:p}=this,{X:v,Y:I,Z:w}=m;let B=n.ZERO,O=n.ZERO,_=n.ZERO;const k=i.a,D=n.mul(i.b,Tf);let N=n.mul(x,v),z=n.mul(y,I),H=n.mul(p,w),V=n.add(x,y),M=n.add(v,I);V=n.mul(V,M),M=n.add(N,z),V=n.sub(V,M),M=n.add(x,p);let K=n.add(v,w);return M=n.mul(M,K),K=n.add(N,H),M=n.sub(M,K),K=n.add(y,p),B=n.add(I,w),K=n.mul(K,B),B=n.add(z,H),K=n.sub(K,B),_=n.mul(k,M),B=n.mul(D,H),_=n.add(B,_),B=n.sub(z,_),_=n.add(z,_),O=n.mul(B,_),z=n.add(N,N),z=n.add(z,N),H=n.mul(k,H),M=n.mul(D,M),z=n.add(z,H),H=n.sub(N,H),H=n.mul(k,H),M=n.add(M,H),N=n.mul(z,M),O=n.add(O,N),N=n.mul(K,M),B=n.mul(V,B),B=n.sub(B,N),N=n.mul(V,z),_=n.mul(K,_),_=n.add(_,N),new A(B,O,_)}subtract(m){return this.add(m.negate())}is0(){return this.equals(A.ZERO)}multiply(m){const{endo:x}=e;if(!s.isValidNot0(m))throw new Error("invalid scalar: out of range");let y,p;const v=I=>q.cached(this,I,w=>Xh(A,w));if(x){const{k1neg:I,k1:w,k2neg:B,k2:O}=P(m),{p:_,f:k}=v(w),{p:D,f:N}=v(O);p=k.add(N),y=R(x.beta,_,D,I,B)}else{const{p:I,f:w}=v(m);y=I,p=w}return Xh(A,[y,p])[0]}multiplyUnsafe(m){const{endo:x}=e,y=this;if(!s.isValid(m))throw new Error("invalid scalar: out of range");if(m===qn||y.is0())return A.ZERO;if(m===ra)return y;if(q.hasCache(this))return this.multiply(m);if(x){const{k1neg:p,k1:v,k2neg:I,k2:w}=P(m),{p1:B,p2:O}=$W(A,y,v,w);return R(x.beta,B,O,p,I)}else return q.unsafe(y,m)}multiplyAndAddUnsafe(m,x,y){const p=this.multiplyUnsafe(x).add(m.multiplyUnsafe(y));return p.is0()?void 0:p}toAffine(m){return C(this,m)}isTorsionFree(){const{isTorsionFree:m}=e;return o===ra?!0:m?m(A,this):q.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:m}=e;return o===ra?this:m?m(A,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(m=!0){return xl(m,"isCompressed"),this.assertValidity(),d(A,this,m)}toHex(m=!0){return ta(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(m=!0){return this.toBytes(m)}_setWindowSize(m){this.precompute(m)}static normalizeZ(m){return Xh(A,m)}static msm(m,x){return IW(A,s,m,x)}static fromPrivateKey(m){return A.BASE.multiply(zo(s,m))}}A.BASE=new A(i.Gx,i.Gy,n.ONE),A.ZERO=new A(n.ZERO,n.ONE,n.ZERO),A.Fp=n,A.Fn=s;const j=s.BITS,q=new xW(A,e.endo?Math.ceil(j/2):j);return A.BASE.precompute(8),A}function N6(t){return Uint8Array.of(t?2:3)}function k6(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function DW(t,e={}){const{Fn:r}=t,n=e.randomBytes||Ug,s=Object.assign(k6(t.Fp,r),{seed:P6(r.ORDER)});function i(u){try{return!!zo(r,u)}catch{return!1}}function o(u,d){const{publicKey:g,publicKeyUncompressed:b}=s;try{const E=u.length;return d===!0&&E!==g||d===!1&&E!==b?!1:!!t.fromBytes(u)}catch{return!1}}function a(u=n(s.seed)){return mW(to(u,s.seed,"seed"),r.ORDER)}function c(u,d=!0){return t.BASE.multiply(zo(r,u)).toBytes(d)}function f(u){const d=a(u);return{secretKey:d,publicKey:c(d)}}function l(u){if(typeof u=="bigint")return!1;if(u instanceof t)return!0;const{secretKey:d,publicKey:g,publicKeyUncompressed:b}=s;if(r.allowedLengths||d===g)return;const E=vt("key",u).length;return E===g||E===b}function h(u,d,g=!0){if(l(u)===!0)throw new Error("first arg must be private key");if(l(d)===!1)throw new Error("second arg must be public key");const b=zo(r,u);return t.fromHex(d).multiply(b).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:f,Point:t,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:u=>zo(r,u),precompute(u=8,d=t.BASE){return d.precompute(u,!1)}},lengths:s})}function jW(t,e,r={}){s6(e),hu(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||Ug,s=r.hmac||((x,...y)=>m6(e,x,Xs(...y))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:d}=DW(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},b="compact";function E(x){const y=a>>ra;return x>y}function U(x,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${x}: out of range 1..Point.Fn.ORDER`);return y}function L(x,y){Hp(y);const p=d.signature,v=y==="compact"?p:y==="recovered"?p+1:void 0;return to(x,v,`${y} signature`)}class ${constructor(y,p,v){this.r=U("r",y),this.s=U("s",p),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(y,p=b){L(y,p);let v;if(p==="der"){const{r:O,s:_}=Ln.toSig(to(y));return new $(O,_)}p==="recovered"&&(v=y[0],p="compact",y=y.subarray(1));const I=o.BYTES,w=y.subarray(0,I),B=y.subarray(I,I*2);return new $(o.fromBytes(w),o.fromBytes(B),v)}static fromHex(y,p){return this.fromBytes(El(y),p)}addRecoveryBit(y){return new $(this.r,this.s,y)}recoverPublicKey(y){const p=i.ORDER,{r:v,s:I,recovery:w}=this;if(w==null||![0,1,2,3].includes(w))throw new Error("recovery id invalid");if(a*L6<p&&w>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=w===2||w===3?v+a:v;if(!i.isValid(B))throw new Error("recovery id 2 or 3 invalid");const O=i.toBytes(B),_=t.fromBytes(Xs(N6((w&1)===0),O)),k=o.inv(B),D=P(vt("msgHash",y)),N=o.create(-D*k),z=o.create(I*k),H=t.BASE.multiplyUnsafe(N).add(_.multiplyUnsafe(z));if(H.is0())throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return E(this.s)}toBytes(y=b){if(Hp(y),y==="der")return El(Ln.hexFromSig(this));const p=o.toBytes(this.r),v=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Xs(Uint8Array.of(this.recovery),p,v)}return Xs(p,v)}toHex(y){return ta(this.toBytes(y))}assertValidity(){}static fromCompact(y){return $.fromBytes(vt("sig",y),"compact")}static fromDER(y){return $.fromBytes(vt("sig",y),"der")}normalizeS(){return this.hasHighS()?new $(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return ta(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return ta(this.toBytes("compact"))}}const F=r.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");const y=uu(x),p=x.length*8-c;return p>0?y>>BigInt(p):y},P=r.bits2int_modN||function(x){return o.create(F(x))},C=Mc(c);function T(x){return Mp("num < 2^"+c,x,qn,C),o.toBytes(x)}function R(x,y){return to(x,void 0,"message"),y?to(e(x),void 0,"prehashed message"):x}function A(x,y,p){if(["recovered","canonical"].some(z=>z in p))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:I,extraEntropy:w}=td(p,g);x=R(x,I);const B=P(x),O=zo(o,y),_=[T(O),T(B)];if(w!=null&&w!==!1){const z=w===!0?n(d.secretKey):w;_.push(vt("extraEntropy",z))}const k=Xs(..._),D=B;function N(z){const H=F(z);if(!o.isValidNot0(H))return;const V=o.inv(H),M=t.BASE.multiply(H).toAffine(),K=o.create(M.x);if(K===qn)return;const Q=o.create(V*o.create(D+K*O));if(Q===qn)return;let te=(M.x===K?0:2)|Number(M.y&ra),re=Q;return v&&E(Q)&&(re=o.neg(Q),te^=1),new $(K,re,te)}return{seed:k,k2sig:N}}function j(x,y,p={}){x=vt("message",x);const{seed:v,k2sig:I}=A(x,y,p);return lW(e.outputLen,o.BYTES,s)(v,I)}function q(x){let y;const p=typeof x=="string"||fu(x),v=!p&&x!==null&&typeof x=="object"&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!p&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)y=new $(x.r,x.s);else if(p){try{y=$.fromBytes(vt("sig",x),"der")}catch(I){if(!(I instanceof Ln.Err))throw I}if(!y)try{y=$.fromBytes(vt("sig",x),"compact")}catch{return!1}}return y||!1}function S(x,y,p,v={}){const{lowS:I,prehash:w,format:B}=td(v,g);if(p=vt("publicKey",p),y=R(vt("message",y),w),"strict"in v)throw new Error("options.strict was renamed to lowS");const O=B===void 0?q(x):$.fromBytes(vt("sig",x),B);if(O===!1)return!1;try{const _=t.fromBytes(p);if(I&&O.hasHighS())return!1;const{r:k,s:D}=O,N=P(y),z=o.inv(D),H=o.create(N*z),V=o.create(k*z),M=t.BASE.multiplyUnsafe(H).add(_.multiplyUnsafe(V));return M.is0()?!1:o.create(M.x)===k}catch{return!1}}function m(x,y,p={}){const{prehash:v}=td(p,g);return y=R(y,v),$.fromBytes(x,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:d,Point:t,sign:j,verify:S,recoverPublicKey:m,Signature:$,hash:e})}function qW(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=xi(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),i={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function zW(t){const{CURVE:e,curveOpts:r}=qW(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function MW(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,F6(r.Fn.ORDER,r.Fn.BITS))})}function HW(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:s}=zW(t),i=kW(e,r),o=jW(i,n,s);return MW(t,o)}function Vp(t,e){const r=n=>HW({...t,hash:n});return{...r(e),create:r}}const D6={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},j6={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},q6={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},VW=xi(D6.p),KW=xi(j6.p),GW=xi(q6.p);Vp({...D6,Fp:VW,lowS:!1},PY);Vp({...j6,Fp:KW,lowS:!1},RY),Vp({...q6,Fp:GW,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},CY);function kg(t){return t.includes(":")}function rc(t){return kg(t)?t.split(":")[0]:t}const ZW={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function _2(t,e){const{message:r,code:n}=ZW[t];return{message:e?`${r} ${e}`:r,code:n}}function rd(t,e){return!!Array.isArray(t)}function lc(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function YW({logger:t,name:e}){const r=typeof t=="string"?JZ({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}function WW(t){return Number.isSafeInteger(t)&&t>=0}function XW(t){return t!=null&&typeof t!="function"&&WW(t.length)}function JW(t){return t==="__proto__"}function Dg(t){return t==null||typeof t!="object"&&typeof t!="function"}function z6(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function jg(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const QW="[object RegExp]",M6="[object String]",H6="[object Number]",V6="[object Boolean]",K6="[object Arguments]",eX="[object Symbol]",tX="[object Date]",rX="[object Map]",nX="[object Set]",sX="[object Array]",iX="[object ArrayBuffer]",G6="[object Object]",oX="[object DataView]",aX="[object Uint8Array]",cX="[object Uint8ClampedArray]",fX="[object Uint16Array]",lX="[object Uint32Array]",uX="[object Int8Array]",hX="[object Int16Array]",dX="[object Int32Array]",pX="[object Float32Array]",gX="[object Float64Array]";function qg(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function yX(t,e){return Mo(t,void 0,t,new Map,e)}function Mo(t,e,r,n=new Map,s=void 0){const i=s?.(t,e,r,n);if(i!==void 0)return i;if(Dg(t))return t;if(n.has(t))return n.get(t);if(Array.isArray(t)){const o=new Array(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=Mo(t[a],a,r,n,s);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;n.set(t,o);for(const[a,c]of t)o.set(a,Mo(c,a,r,n,s));return o}if(t instanceof Set){const o=new Set;n.set(t,o);for(const a of t)o.add(Mo(a,void 0,r,n,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(qg(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=Mo(t[a],a,r,n,s);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return n.set(t,o),Cr(o,t,r,n,s),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return n.set(t,o),Cr(o,t,r,n,s),o}if(typeof Blob<"u"&&t instanceof Blob){const o=new Blob([t],{type:t.type});return n.set(t,o),Cr(o,t,r,n,s),o}if(t instanceof Error){const o=new t.constructor;return n.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Cr(o,t,r,n,s),o}if(t instanceof Boolean){const o=new Boolean(t.valueOf());return n.set(t,o),Cr(o,t,r,n,s),o}if(t instanceof Number){const o=new Number(t.valueOf());return n.set(t,o),Cr(o,t,r,n,s),o}if(t instanceof String){const o=new String(t.valueOf());return n.set(t,o),Cr(o,t,r,n,s),o}if(typeof t=="object"&&bX(t)){const o=Object.create(Object.getPrototypeOf(t));return n.set(t,o),Cr(o,t,r,n,s),o}return t}function Cr(t,e,r=t,n,s){const i=[...Object.keys(e),...z6(e)];for(let o=0;o<i.length;o++){const a=i[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=Mo(e[a],a,r,n,s))}}function bX(t){switch(jg(t)){case K6:case sX:case iX:case oX:case V6:case tX:case pX:case gX:case uX:case hX:case dX:case rX:case H6:case G6:case QW:case nX:case M6:case eX:case aX:case cX:case fX:case lX:return!0;default:return!1}}function wX(t,e){return yX(t,(r,n,s,i)=>{if(typeof t=="object"){if(jg(t)===G6&&typeof t.constructor!="function"){const o={};return i.set(t,o),Cr(o,t,s,i),o}switch(Object.prototype.toString.call(t)){case H6:case M6:case V6:{const o=new t.constructor(t?.valueOf());return Cr(o,t),o}case K6:{const o={};return Cr(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}}})}function F2(t){return wX(t)}function U2(t){return t!==null&&typeof t=="object"&&jg(t)==="[object Arguments]"}function Kp(t){return typeof t=="object"&&t!==null}function mX(t){return Kp(t)&&XW(t)}function vX(){}function nd(t){return qg(t)}function sd(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function EX(t){if(Dg(t))return t;if(Array.isArray(t)||qg(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t);if(e==null)return Object.assign(Object.create(e),t);const r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const n=new r(t);return n.lastIndex=t.lastIndex,n}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){let n;return t instanceof AggregateError?n=new r(t.errors,t.message,{cause:t.cause}):n=new r(t.message,{cause:t.cause}),n.stack=t.stack,Object.assign(n,t),n}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const n=Object.create(e);return Object.assign(n,t)}return t}function xX(t,...e){const r=e.slice(0,-1),n=e[e.length-1];let s=t;for(let i=0;i<r.length;i++){const o=r[i];s=Gp(s,o,n,new Map)}return s}function Gp(t,e,r,n){if(Dg(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(n.has(e))return EX(n.get(e));if(n.set(e,t),Array.isArray(e)){e=e.slice();for(let i=0;i<e.length;i++)e[i]=e[i]??void 0}const s=[...Object.keys(e),...z6(e)];for(let i=0;i<s.length;i++){const o=s[i];if(JW(o))continue;let a=e[o],c=t[o];if(U2(a)&&(a={...a}),U2(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=F2(a)),Array.isArray(a))if(Array.isArray(c)){const l=[],h=Reflect.ownKeys(c);for(let u=0;u<h.length;u++){const d=h[u];l[d]=c[d]}c=l}else if(mX(c)){const l=[];for(let h=0;h<c.length;h++)l[h]=c[h];c=l}else c=[];const f=r(c,a,o,t,e,n);f!==void 0?t[o]=f:Array.isArray(a)||Kp(c)&&Kp(a)&&(sd(c)||sd(a)||nd(c)||nd(a))?t[o]=Gp(c,a,r,n):c==null&&sd(a)?t[o]=Gp({},a,r,n):c==null&&nd(a)?t[o]=F2(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function $X(t,...e){return xX(t,...e,vX)}const P2="error",IX="wss://relay.walletconnect.org",BX="wc",Z6="universal_provider",Lf=`${BX}@2:${Z6}:`,Y6="https://rpc.walletconnect.org/v1/",W6="generic",AX=`${Y6}bundler`,na="call_status",SX=86400,zg={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var OX=Object.defineProperty,_X=Object.defineProperties,FX=Object.getOwnPropertyDescriptors,C2=Object.getOwnPropertySymbols,UX=Object.prototype.hasOwnProperty,PX=Object.prototype.propertyIsEnumerable,R2=(t,e,r)=>e in t?OX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nf=(t,e)=>{for(var r in e||(e={}))UX.call(e,r)&&R2(t,r,e[r]);if(C2)for(var r of C2(e))PX.call(e,r)&&R2(t,r,e[r]);return t},CX=(t,e)=>_X(t,FX(e));function X6(t,e,r){var n;const s=fc(t);return((n=e.rpcMap)==null?void 0:n[s.reference])||`${Y6}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function RX(t){return t.includes(":")?t.split(":")[1]:t}function J6(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function TX(t,e){const r=Object.keys(e.namespaces).filter(s=>s.includes(t));if(!r.length)return[];const n=[];return r.forEach(s=>{const i=e.namespaces[s].accounts;n.push(...i)}),n}function T2(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var n,s;return((n=r?.chains)==null?void 0:n.length)&&((s=r?.chains)==null?void 0:s.length)>0}))}function kf(t={},e={}){const r=T2(L2(t)),n=T2(L2(e));return $X(r,n)}function L2(t){var e,r,n,s,i;const o={};if(!lc(t))return o;for(const[a,c]of Object.entries(t)){const f=kg(a)?[a]:c.chains,l=c.methods||[],h=c.events||[],u=c.rpcMap||{},d=rc(a);o[d]=CX(Nf(Nf({},o[d]),c),{chains:Gh(f,(e=o[d])==null?void 0:e.chains),methods:Gh(l,(r=o[d])==null?void 0:r.methods),events:Gh(h,(n=o[d])==null?void 0:n.events)}),(lc(u)||lc(((s=o[d])==null?void 0:s.rpcMap)||{}))&&(o[d].rpcMap=Nf(Nf({},u),(i=o[d])==null?void 0:i.rpcMap))}return o}function N2(t){return t.includes(":")?t.split(":")[2]:t}function k2(t){const e={};for(const[r,n]of Object.entries(t)){const s=n.methods||[],i=n.events||[],o=n.accounts||[],a=kg(r)?[r]:n.chains?n.chains:J6(n.accounts);e[r]={chains:a,methods:s,events:i,accounts:o}}return e}function id(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function LX(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const Q6={},sa=t=>Q6[t],od=(t,e)=>{Q6[t]=e};var NX=Object.defineProperty,D2=Object.getOwnPropertySymbols,kX=Object.prototype.hasOwnProperty,DX=Object.prototype.propertyIsEnumerable,j2=(t,e,r)=>e in t?NX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,q2=(t,e)=>{for(var r in e||(e={}))kX.call(e,r)&&j2(t,r,e[r]);if(D2)for(var r of D2(e))DX.call(e,r)&&j2(t,r,e[r]);return t};const z2="eip155",jX=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],qX=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,ad=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,M2=t=>Object.keys(t).filter(e=>jX.includes(e)).reduce((e,r)=>(e[r]=zX(t[r]),e),{}),zX=t=>typeof t=="string"&&LX(t)?JSON.parse(t):t,MX=(t,e,r)=>{const{sessionProperties:n={},scopedProperties:s={}}=t,i={};if(!lc(s)&&!lc(n))return;const o=M2(n);for(const a of r){const c=qX(a);if(!c)continue;i[ad(c)]=o;const f=s?.[`${z2}:${c}`];if(f){const l=f?.[`${z2}:${c}:${e}`];i[ad(c)]=q2(q2({},i[ad(c)]),M2(l||f))}}for(const[a,c]of Object.entries(i))Object.keys(c).length===0&&delete i[a];return Object.keys(i).length>0?i:void 0};var HX=Object.defineProperty,VX=(t,e,r)=>e in t?HX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,KX=(t,e,r)=>VX(t,e+"",r);let cd,GX=class e5{constructor(e){KX(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return cd||(cd=new e5(e)),cd}};var ZX=Object.defineProperty,YX=Object.defineProperties,WX=Object.getOwnPropertyDescriptors,H2=Object.getOwnPropertySymbols,XX=Object.prototype.hasOwnProperty,JX=Object.prototype.propertyIsEnumerable,V2=(t,e,r)=>e in t?ZX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,QX=(t,e)=>{for(var r in e||(e={}))XX.call(e,r)&&V2(t,r,e[r]);if(H2)for(var r of H2(e))JX.call(e,r)&&V2(t,r,e[r]);return t},eJ=(t,e)=>YX(t,WX(e));async function tJ(t,e){const r=fc(t.result.capabilities.caip345.caip2),n=t.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(n.map(h=>rJ(r.reference,h,e))),i=s.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);s.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!i.length||i.some(h=>!h),a=i.every(h=>h?.status==="0x1"),c=i.every(h=>h?.status==="0x0"),f=i.some(h=>h?.status==="0x0");let l;return o?l=100:a?l=200:c?l=500:f&&(l=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:i,status:l}}async function rJ(t,e,r){return await r(parseInt(t)).request(nn("eth_getTransactionReceipt",[e]))}async function nJ({sendCalls:t,storage:e}){const r=await e.getItem(na);await e.setItem(na,eJ(QX({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:eY(SX)}}))}async function sJ({resultId:t,storage:e}){const r=await e.getItem(na);if(r){delete r[t],await e.setItem(na,r);for(const n in r)t6(r[n].expiry)&&delete r[n];await e.setItem(na,r)}}async function iJ({resultId:t,storage:e}){const r=await e.getItem(na),n=r?.[t];if(n&&!t6(n.expiry))return n;await sJ({resultId:t,storage:e})}var oJ=Object.defineProperty,aJ=Object.defineProperties,cJ=Object.getOwnPropertyDescriptors,K2=Object.getOwnPropertySymbols,fJ=Object.prototype.hasOwnProperty,lJ=Object.prototype.propertyIsEnumerable,Zp=(t,e,r)=>e in t?oJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fd=(t,e)=>{for(var r in e||(e={}))fJ.call(e,r)&&Zp(t,r,e[r]);if(K2)for(var r of K2(e))lJ.call(e,r)&&Zp(t,r,e[r]);return t},ld=(t,e)=>aJ(t,cJ(e)),Li=(t,e,r)=>Zp(t,typeof e!="symbol"?e+"":e,r);class uJ{constructor(e){Li(this,"name","eip155"),Li(this,"client"),Li(this,"chainId"),Li(this,"namespace"),Li(this,"httpProviders"),Li(this,"events"),Li(this,"storage"),this.namespace=e.namespace,this.events=sa("events"),this.client=sa("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=GX.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);const n=this.chainId;this.chainId=parseInt(e),this.events.emit(zg.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const n=r||X6(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jp(new Q2(n,sa("disableProviderPing")))}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;const s=parseInt(RX(r));e[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){const r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=ld(fd({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,n;let s=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const i=parseInt(s,16);if(this.isChainApproved(i))this.setDefaultChain(`${i}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${i}`);else throw new Error(`Failed to switch to chain 'eip155:${i}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,n,s,i,o;const a=(n=(r=e.request)==null?void 0:r.params)==null?void 0:n[0],c=((i=(s=e.request)==null?void 0:s.params)==null?void 0:i[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const f=this.client.session.get(e.topic),l=((o=f?.sessionProperties)==null?void 0:o.capabilities)||{},h=c.length>0?c.join(","):`0x${this.chainId.toString(16)}`,u=`${a}${h}`,d=l?.[u];if(d)return d;let g;try{g=MX(f,a,c)}catch(E){console.warn("Failed to extract capabilities from session",E)}if(g)return g;const b=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:ld(fd({},f.sessionProperties||{}),{capabilities:ld(fd({},l||{}),{[u]:b})})})}catch(E){console.warn("Failed to update session with capabilities",E)}return b}async getCallStatus(e){var r,n,s;const i=this.client.session.get(e.topic),o=(r=i.sessionProperties)==null?void 0:r.bundler_name;if(o){const f=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(f,e)}catch(l){console.warn("Failed to fetch call status from bundler",l,f)}}const a=(n=i.sessionProperties)==null?void 0:n.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(f){console.warn("Failed to fetch call status from custom bundler",f,a)}const c=await iJ({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await tJ(c,this.getHttpProvider.bind(this))}catch(f){console.warn("Failed to fetch call status from stored send calls",f,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var n;const s=new URL(e),i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(nn("eth_getUserOperationReceipt",[(n=r.request.params)==null?void 0:n[0]]))});if(!i.ok)throw new Error(`Failed to fetch user operation receipt - ${i.status}`);return await i.json()}getBundlerUrl(e,r){return`${AX}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,n,s;const i=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=i?.id,c=i?.capabilities||{},f=(n=c?.caip345)==null?void 0:n.caip2,l=(s=c?.caip345)==null?void 0:s.transactionHashes;return!a||!f||!(l!=null&&l.length)||await nJ({sendCalls:{request:o,result:i},storage:this.storage}),i}}var hJ=Object.defineProperty,dJ=(t,e,r)=>e in t?hJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lo=(t,e,r)=>dJ(t,typeof e!="symbol"?e+"":e,r);class pJ{constructor(e){Lo(this,"name",W6),Lo(this,"client"),Lo(this,"httpProviders"),Lo(this,"events"),Lo(this,"namespace"),Lo(this,"chainId"),this.namespace=e.namespace,this.events=sa("events"),this.client=sa("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);const n=this.chainId;this.chainId=e,this.events.emit(zg.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return fc(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const n={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(s=>{var i,o;const a=fc(s),c=(o=(i=this.namespace)==null?void 0:i.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];n[a.reference]=this.createHttpProvider(s,c)}),n}getHttpProvider(e){const r=fc(e).reference,n=this.httpProviders[r];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return n}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||X6(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Jp(new Q2(n,sa("disableProviderPing")))}}var gJ=Object.defineProperty,yJ=Object.defineProperties,bJ=Object.getOwnPropertyDescriptors,G2=Object.getOwnPropertySymbols,wJ=Object.prototype.hasOwnProperty,mJ=Object.prototype.propertyIsEnumerable,Yp=(t,e,r)=>e in t?gJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ma=(t,e)=>{for(var r in e||(e={}))wJ.call(e,r)&&Yp(t,r,e[r]);if(G2)for(var r of G2(e))mJ.call(e,r)&&Yp(t,r,e[r]);return t},Df=(t,e)=>yJ(t,bJ(e)),Kt=(t,e,r)=>Yp(t,typeof e!="symbol"?e+"":e,r);let vJ=class t5{constructor(e){Kt(this,"client"),Kt(this,"namespaces"),Kt(this,"optionalNamespaces"),Kt(this,"sessionProperties"),Kt(this,"scopedProperties"),Kt(this,"events",new t0),Kt(this,"rpcProviders",{}),Kt(this,"session"),Kt(this,"providerOpts"),Kt(this,"logger"),Kt(this,"uri"),Kt(this,"disableProviderPing",!1),Kt(this,"connectParams");var r,n;this.providerOpts=e,this.logger=YW({logger:(r=e.logger)!=null?r:P2,name:(n=this.providerOpts.name)!=null?n:Z6}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const r=new t5(e);return await r.initialize(),r}async request(e,r,n){const[s,i]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Ma({},e),chainId:`${s}:${i}`,topic:this.session.topic,expiry:n})}sendAsync(e,r,n,s){const i=new Date().getTime();this.request(e,n,s).then(o=>r(null,uc(i,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:_2("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.connectParams=e,this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:n,response:s}=await this.client.authenticate(e,r);n&&(this.uri=n,this.events.emit("display_uri",n));const i=await s();if(this.session=i.session,this.session){const o=k2(this.session.namespaces);this.namespaces=kf(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return i}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){var r,n;const{uri:s,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:(r=this.connectParams)==null?void 0:r.authentication,walletPay:(n=this.connectParams)==null?void 0:n.walletPay});s&&(this.uri=s,this.events.emit("display_uri",s));const o=await i();this.session=o;const a=k2(o.namespaces);return this.namespaces=kf(this.namespaces,a),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[n,s]=this.validateChain(e),i=this.getProvider(n);i?i.setDefaultChain(s,r):this.session&&this.logger.warn(`Provider for namespace '${n}' not found in setDefaultChain`)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(!rd(r))return;for(const n of r)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn(r,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await RV.init({core:this.providerOpts.core,logger:this.providerOpts.logger||P2,relayUrl:this.providerOpts.relayUrl||IX,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(n){throw this.logger.error(n,"Failed to get session"),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const n=this.client.session.getAll();this.session=n[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>rc(r)))];od("client",this.client),od("events",this.events),od("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const n=TX(r,this.session);if(n?.length===0)return;const s=J6(n),i=kf(this.namespaces,this.optionalNamespaces),o=Df(Ma({},i[r]),{accounts:n,chains:s});r==="eip155"?this.rpcProviders[r]=new uJ({namespace:o}):this.rpcProviders[r]=new pJ({namespace:o})})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:n}=e;n===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:n,topic:s}=e;if(s!==((r=this.session)==null?void 0:r.topic))return;const{event:i}=n;if(i.name==="accountsChanged"){const o=i.data;o&&rd(o)&&this.events.emit("accountsChanged",o.map(N2))}else if(i.name==="chainChanged"){const o=n.chainId,a=n.event.data,c=rc(o),f=id(o)!==id(a)?`${c}:${id(a)}`:o;this.onChainChanged({currentCaipChainId:f})}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var n,s;if(e!==((n=this.session)==null?void 0:n.topic))return;const{namespaces:i}=r,o=(s=this.client)==null?void 0:s.session.get(e);this.session=Df(Ma({},o),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Df(Ma({},_2("USER_DISCONNECTED")),{data:e.topic})))}),this.on(zg.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(Df(Ma({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[W6]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:n={},sessionProperties:s,scopedProperties:i}=e;this.optionalNamespaces=kf(r,n),this.sessionProperties=s,this.scopedProperties=i}validateChain(e){const[r,n]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(o=>rc(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const s=rc(Object.keys(this.namespaces)[0]),i=this.rpcProviders[s].getDefaultChain();return[s,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:n=!1}){if(!this.namespaces)return;const[s,i]=this.validateChain(e);if(i){if(this.updateNamespaceChain(s,i),n)this.events.emit("chainChanged",i),this.emitAccountsChangedOnChainChange({namespace:s,currentCaipChainId:e,previousCaipChainId:r});else{const o=this.getProvider(s);o?o.setDefaultChain(i):this.session&&this.logger.warn(`Provider for namespace '${s}' not found during chain change`)}await this.persist("namespaces",this.namespaces)}}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:n}){var s,i;try{if(n===r)return;const o=(i=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:i.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(N2);if(!rd(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,r){if(!this.namespaces)return;const n=this.namespaces[e]?e:`${e}:${r}`,s={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=r):this.namespaces[n]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var n;const s=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.setItem(`${Lf}/${e}${s}`,r)}async getFromStore(e){var r;const n=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${Lf}/${e}${n}`)}async deleteFromStore(e){var r;const n=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${Lf}/${e}${n}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const n of r)n.startsWith(Lf)&&await this.client.core.storage.removeItem(n)}catch(r){this.logger.warn(r,"Failed to cleanup storage")}}};const EJ=vJ,xJ="wc",$J="ethereum_provider",IJ=`${xJ}@2:${$J}:`,BJ="https://rpc.walletconnect.org/v1/",Bl=["eth_sendTransaction","personal_sign"],r5=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Al=["chainChanged","accountsChanged"],n5=["chainChanged","accountsChanged","message","disconnect","connect"],AJ=async()=>{const{createAppKit:t}=await d5(()=>import("./core-DDNlgivr.js").then(e=>e.Z),__vite__mapDeps([0,1,2]));return t};var SJ=Object.defineProperty,OJ=Object.defineProperties,_J=Object.getOwnPropertyDescriptors,Z2=Object.getOwnPropertySymbols,FJ=Object.prototype.hasOwnProperty,UJ=Object.prototype.propertyIsEnumerable,Wp=(t,e,r)=>e in t?SJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ni=(t,e)=>{for(var r in e||(e={}))FJ.call(e,r)&&Wp(t,r,e[r]);if(Z2)for(var r of Z2(e))UJ.call(e,r)&&Wp(t,r,e[r]);return t},Ha=(t,e)=>OJ(t,_J(e)),Gt=(t,e,r)=>Wp(t,typeof e!="symbol"?e+"":e,r);function Sl(t){return Number(t[0].split(":")[1])}function jf(t){return`0x${t.toString(16)}`}function PJ(t){const{chains:e,optionalChains:r,methods:n,optionalMethods:s,events:i,optionalEvents:o,rpcMap:a}=t;if(!Ad(e))throw new Error("Invalid chains");const c={chains:e,methods:n||Bl,events:i||Al,rpcMap:Ni({},e.length?{[Sl(e)]:a[Sl(e)]}:{})},f=i?.filter(d=>!Al.includes(d)),l=n?.filter(d=>!Bl.includes(d));if(!r&&!o&&!s&&!(f!=null&&f.length)&&!(l!=null&&l.length))return{required:e.length?c:void 0};const h=f?.length&&l?.length||!r,u={chains:[...new Set(h?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:r5))],events:[...new Set(c.events.concat(o!=null&&o.length?o:n5))],rpcMap:a};return{required:e.length?c:void 0,optional:r.length?u:void 0}}class du{constructor(){Gt(this,"events",new wi.EventEmitter),Gt(this,"namespace","eip155"),Gt(this,"accounts",[]),Gt(this,"signer"),Gt(this,"chainId",1),Gt(this,"modal"),Gt(this,"rpc"),Gt(this,"STORAGE_KEY",IJ),Gt(this,"on",(e,r)=>(this.events.on(e,r),this)),Gt(this,"once",(e,r)=>(this.events.once(e,r),this)),Gt(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),Gt(this,"off",(e,r)=>(this.events.off(e,r),this)),Gt(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new du;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,n){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),n)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:n,optional:s}=PJ(this.rpc);try{const i=await new Promise(async(a,c)=>{var f,l;this.rpc.showQrModal&&((f=this.modal)==null||f.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const h=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(Ha(Ni({namespaces:Ni({},n&&{[this.namespace]:n})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e?.pairingTopic,scopedProperties:h})).then(u=>{a(u)}).catch(u=>{var d;(d=this.modal)==null||d.showErrorMessage("Unable to connect"),c(new Error(u.message))})});if(!i)return;const o=p1(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:jf(this.chainId)})}catch(i){throw this.signer.logger.error(i),i}finally{(r=this.modal)==null||r.close()}}async authenticate(e,r){var n;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{const s=await new Promise(async(o,a)=>{var c,f;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(f=this.modal)==null||f.subscribeState(l=>{!l.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Ha(Ni({},e),{chains:this.rpc.chains}),r).then(l=>{o(l)}).catch(l=>{var h;(h=this.modal)==null||h.showErrorMessage("Unable to connect"),a(new Error(l.message))})}),i=s.session;if(i){const o=p1(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:jf(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{(n=this.modal)==null||n.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",jf(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ha(Ni({},zI("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",jf(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,n,s]=e.split(":");return{chainId:`${r}:${n}`,address:s}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,n;const s=(r=e?.chains)!=null?r:[],i=(n=e?.optionalChains)!=null?n:[],o=s.concat(i);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?e?.methods||Bl:[],c=s.length?e?.events||Al:[],f=e?.optionalMethods||[],l=e?.optionalEvents||[],h=e?.rpcMap||this.buildRpcMap(o,e.projectId),u=e?.qrModalOptions||void 0;return{chains:s?.map(d=>this.formatChainId(d)),optionalChains:i.map(d=>this.formatChainId(d)),methods:a,events:c,optionalMethods:f,optionalEvents:l,rpcMap:h,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:u,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const n={};return e.forEach(s=>{n[s]=this.getRpcUrl(s,r)}),n}async initialize(e){var r;if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?Sl(this.rpc.chains):Sl(this.rpc.optionalChains),this.signer=await EJ.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let n;try{const s=await AJ(),{convertWCMToAppKitOptions:i}=await Promise.resolve().then(function(){return MJ}),o=i(Ha(Ni({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!o.networks.length)throw new Error("No networks found for WalletConnect");n=s(Ha(Ni({},o),{universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:((r=this.rpc.qrModalOptions)==null?void 0:r.enableMobileFullScreen)===!0}))}catch(s){throw console.warn(s),new Error("To use QR modal, please install @reown/appkit package")}if(n)try{this.modal=n}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:n,rpcMap:s}=e;r&&Ad(r)&&(this.rpc.chains=r.map(i=>this.formatChainId(i)),r.forEach(i=>{this.rpc.rpcMap[i]=s?.[i]||this.getRpcUrl(i)})),n&&Ad(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n?.map(i=>this.formatChainId(i)),n.forEach(i=>{this.rpc.rpcMap[i]=s?.[i]||this.getRpcUrl(i)}))}getRpcUrl(e,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[e])||`${BJ}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r?.accounts),this.setAccounts(r?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const CJ=du;var RJ=Object.defineProperty,TJ=Object.defineProperties,LJ=Object.getOwnPropertyDescriptors,Y2=Object.getOwnPropertySymbols,NJ=Object.prototype.hasOwnProperty,kJ=Object.prototype.propertyIsEnumerable,W2=(t,e,r)=>e in t?RJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,s5=(t,e)=>{for(var r in e||(e={}))NJ.call(e,r)&&W2(t,r,e[r]);if(Y2)for(var r of Y2(e))kJ.call(e,r)&&W2(t,r,e[r]);return t},DJ=(t,e)=>TJ(t,LJ(e));function jJ(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const qJ=t=>{const[e,r]=t.split(":");return i5({id:r,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function zJ(t){var e,r,n,s,i,o,a;const c=(e=t.chains)==null?void 0:e.map(qJ).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const f=c.find(h=>{var u;return h.id===((u=t.defaultChain)==null?void 0:u.id)}),l={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:jJ(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:f,metadata:DJ(s5({},t.metadata),{name:((r=t.metadata)==null?void 0:r.name)||"WalletConnect",description:((n=t.metadata)==null?void 0:n.description)||"Connect to WalletConnect-compatible wallets",url:((s=t.metadata)==null?void 0:s.url)||"https://walletconnect.org",icons:((i=t.metadata)==null?void 0:i.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){const h=[...(t.mobileWallets||[]).map(g=>({id:g.id,name:g.name,links:g.links})),...(t.desktopWallets||[]).map(g=>({id:g.id,name:g.name,links:{native:g.links.native,universal:g.links.universal}}))],u=[...l.featuredWalletIds||[],...l.excludeWalletIds||[]],d=h.filter(g=>!u.includes(g.id));d.length&&(l.customWallets=d)}return l}function i5(t){return s5({formatters:void 0,fees:void 0,serializers:void 0},t)}var MJ=Object.freeze({__proto__:null,convertWCMToAppKitOptions:zJ,defineChain:i5});const lte=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:CJ,OPTIONAL_EVENTS:n5,OPTIONAL_METHODS:r5,REQUIRED_EVENTS:Al,REQUIRED_METHODS:Bl,default:du},Symbol.toStringTag,{value:"Module"}));export{cQ as G,tQ as P,Q$ as Q,fQ as R,lQ as U,rQ as a,M7 as e,lte as i,eQ as s};
